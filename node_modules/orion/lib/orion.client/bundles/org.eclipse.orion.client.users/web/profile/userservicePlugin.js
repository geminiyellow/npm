!function(e,n){"function"==typeof define&&define.amd?define("orion/Deferred",n):"object"==typeof exports?module.exports=n():(e.orion=e.orion||{},e.orion.Deferred=n())}(this,function(){function e(){for(var e;e=i.shift();)e();s=!1}function n(e){i.push(e),s||(s=!0,a())}function t(e){return function(n){e(n)}}function r(e,n,r){try{var o=e(n),i=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof i)if(o===r.promise)r.reject(new TypeError);else{var s=o.cancel;"function"==typeof s?r._parentCancel=s.bind(o):delete r._parentCancel,i.call(o,t(r.resolve),t(r.reject),t(r.progress))}else r.resolve(o)}catch(a){r.reject(a)}}function o(){function e(){for(var e;e=u.shift();){var n=e.deferred,t="fulfilled"===c?"resolve":"reject",o=e[t];"function"==typeof o?r(o,a,n):n[t](a)}}function t(t){delete f._parentCancel,c="rejected",a=t,u.length&&n(e)}function i(r){function s(e){return function(n){c&&"assumed"!==c||e(n)}}delete f._parentCancel;try{var d=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof d)if(r===f)t(new TypeError);else{c="assumed";var l=r&&r.cancel;if("function"!=typeof l){var p=new o;r=p.promise;try{d(p.resolve,p.reject,p.progress)}catch(m){p.reject(m)}l=r.cancel,d=r.then}a=r,d.call(r,s(i),s(t)),f._parentCancel=l.bind(r)}else c="fulfilled",a=r,u.length&&n(e)}catch(h){s(t)(h)}}function s(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!c){var n=new Error("Cancel");n.name="Cancel",t(n)}}var a,c,u=[],f=this;this.resolve=function(e){return c||i(e),f},this.reject=function(e){return c||t(e),f},this.progress=function(e){return c||u.forEach(function(n){if(n.progress)try{n.progress(e)}catch(t){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(s,0):s(),f},this.then=function(t,r,i){var s=new o;return s._parentCancel=f.promise.cancel,u.push({resolve:t,reject:r,progress:i,deferred:s}),("fulfilled"===c||"rejected"===c)&&n(e),s.promise},this.promise={then:f.then,cancel:f.cancel}}var i=[],s=!1,a=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var n=process.nextTick;return function(){n(e)}}if("function"==typeof MutationObserver){var t=document.createElement("div"),r=new MutationObserver(e);return r.observe(t,{attributes:!0}),function(){t.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,n){function t(e,n){a||(s[e]=n,0===--i&&c.resolve(s))}function r(e,r){if(!a){if(n)try{return void t(e,n(r))}catch(o){r=o}c.reject(r)}}var i=e.length,s=[],a=!1,c=new o;return c.then(void 0,function(){a=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?c.resolve(s):e.forEach(function(e,n){e.then(t.bind(void 0,n),r.bind(void 0,n))}),c.promise},o.when=function(e,n,t,r){var i,s;return e&&"function"==typeof e.then?i=e:(s=new o,s.resolve(e),i=s.promise),i.then(n,t,r)},o}),function(e,n){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],n):"object"==typeof exports?module.exports=n(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=n(e.orion.Deferred))}(this,function(e){function n(e,n){this.__objectId=e,this.__methods=n}function t(t){function r(e){p&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),p===self?p.postMessage(e):p.postMessage(e,"*"))}function o(){var e=[];return Object.keys(E).forEach(function(n){var t=E[n];e.push({serviceId:n,names:t.names,methods:t.methods,properties:t.properties})}),{headers:d||{},services:e}}function i(e,n){if(n&&n instanceof XMLHttpRequest){var t,r;try{t=n.status,r=n.statusText}catch(o){t=0,r=""}return{status:t||0,statusText:r}}return n}function s(e){var n=e?JSON.parse(JSON.stringify(e,i)):e;return e instanceof Error&&(n.__isError=!0,n.message=n.message||e.message,n.name=n.name||e.name),n}function a(t){if(!p)return(new e).reject(new Error("plugin not connected"));t.id=String(m++);var r=new e;y[t.id]=r,r.then(null,function(e){l&&e instanceof Error&&"Cancel"===e.name&&b({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var o=Object.prototype.toString;return t.params.forEach(function(e,i){if("[object Object]"===o.call(e)&&!(e instanceof n)){var s,a;for(s in e)"[object Function]"===o.call(e[s])&&(a=a||[],a.push(s));if(a){var c=h++;w[c]=e;var u=function(){delete w[c]};r.then(u,u),t.params[i]=new n(c,a)}}}),b(t),r.promise}function c(e,n){e||0===e?b({id:e,result:null,error:n}):console.log(n)}function u(e,n,t,r){r.forEach(function(e,n){if(e&&"undefined"!=typeof e.__objectId){var t={};e.__methods.forEach(function(n){t[n]=function(){return a({objectId:e.__objectId,method:n,params:Array.prototype.slice.call(arguments)})}}),r[n]=t}});var o=void 0===typeof e?null:{id:e,result:null,error:null};try{var i=t.apply(n,r);if(!o)return;i&&"function"==typeof i.then?(g[e]=i,i.then(function(n){delete g[e],o.result=n,b(o)},function(n){g[e]&&(delete g[e],o.error=s(n),b(o))},function(){b({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=i,b(o))}catch(c){o&&(o.error=s(c),b(o))}}function f(e){if(e.source===p||"undefined"==typeof window){var n="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(n.method){var t=n.method,r=n.params||[];if("serviceId"in n){var o=E[n.serviceId];o||c(n.id,"service not found"),o=o.implementation,t in o?u(n.id,o,o[t],r):c(n.id,"method not found")}else if("objectId"in n){var i=w[n.objectId];i||c(n.id,"object not found"),!t in i?u(n.id,i,i[t],r):c(n.id,"method not found")}else if("requestId"in n){var s=g[n.requestId];s&&"cancel"===t&&s.cancel&&s.cancel.apply(s,r)}else{if(!("responseId"in n))throw new Error("Bad method: "+n.method);var a=y[n.responseId];a&&"progress"===t&&a.progress&&a.progress.apply(a,r)}}else{var f=y[String(n.id)];delete y[String(n.id)],n.error?f.reject(n.error):f.resolve(n.result)}}catch(d){console.log("Plugin._messageHandler "+d)}}}var d=t,l=!1,p=null,m=0,h=0,v=0,g={},y={},w={},E={},b=r;this.updateHeaders=function(e){if(l)throw new Error("Cannot update headers. Plugin Provider is connected");d=e},this.registerService=function(e,n,t){if(l)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var r=null,o=[];for(r in n)"function"==typeof n[r]&&o.push(r);E[v++]={names:e,methods:o,implementation:n,properties:t||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,n){if(l)return void(e&&e());if("undefined"==typeof window)p=self;else if(window!==window.parent)p=window.parent;else{if(null===window.opener)return void(n&&n("No valid plugin target"));p=window.opener}addEventListener("message",f,!1);var t={method:"plugin",params:[o()]};r(t),l=!0,e&&e()},this.disconnect=function(){l&&(removeEventListener("message",f),p=null,l=!1)}}return t}),define("orion/xhr",["orion/Deferred"],function(e){function n(e,n,t,r){var o,i="undefined"!=typeof t.response?t.response:t.responseText,s="string"==typeof i?i:null;try{o=t.status}catch(a){o=0}var c={args:n,response:i,responseText:s,status:o,url:e,xhr:t};return"undefined"!=typeof r&&(c.error=r),c}function t(t,r,o){o=o||{};var i,s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,a=new e,c=o.headers||{},u=o.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof o.data||"POST"!==t&&"PUT"!==t||(i=o.data);var f=!1,d=!1;a.promise.then(void 0,function(e){f=!0,!d&&e instanceof Error&&"Cancel"===e.name&&s.abort()}),s.onabort=function(){if(d=!0,!f){var e=new Error("Cancel");e.name="Cancel",a.reject(e)}},s.onload=function(){var e=n(r,o,s);200<=s.status&&s.status<400?a.resolve(e):(a.reject(e),u&&"undefined"!=typeof console&&console.log(new Error(s.statusText)))},s.onerror=function(){var e=n(r,o,s);a.reject(e),u&&"undefined"!=typeof console&&console.log(new Error(s.statusText))},s.onprogress=function(e){e.xhr=s,a.progress(e)};try{if(s.open(t,r,!0),"string"==typeof o.responseType&&(s.responseType=o.responseType),"number"==typeof o.timeout)if("number"==typeof s.timeout)s.timeout=o.timeout,s.addEventListener("timeout",function(){a.reject(n(r,o,s,"Timeout exceeded"))});else{var l=setTimeout(function(){a.reject(n(r,o,s,"Timeout exceeded"))},o.timeout);a.promise.then(clearTimeout.bind(null,l),clearTimeout.bind(null,l))}Object.keys(c).forEach(function(e){s.setRequestHeader(e,c[e])}),s.send(i||null)}catch(p){a.reject(n(r,o,s,p))}return a.promise}return t}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var n=this._namedListeners[e.type];return n&&n.forEach(function(n){try{"function"==typeof n?n(e):n.handleEvent(e)}catch(t){"undefined"!=typeof console&&console.log(t)}}),!e.defaultPrevented},addEventListener:function(e,n){("function"==typeof n||n.handleEvent)&&(this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(n))},removeEventListener:function(e,n){var t=this._namedListeners[e];if(t)for(var r=0;r<t.length;r++)if(t[r]===n){1===t.length?delete this._namedListeners[e]:t.splice(r,1);break}}},e.prototype.constructor=e,e.attach=function(n){var t=new e;n.dispatchEvent=t.dispatchEvent.bind(t),n.addEventListener=t.addEventListener.bind(t),n.removeEventListener=t.removeEventListener.bind(t)},e}),define("orion/form",[],function(){function e(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape).replace("%20","+")}return{encodeFormData:function(n){n=n||{};for(var t=Object.keys(n),r=[],o=0;o<t.length;o++){var i=t[o],s=n[i];r.push(e(i)+"="+e(s))}return r.join("&")},encodeSlug:function(e){return e.replace(/([^\u0020-\u007e]|%)+/g,encodeURIComponent)}}}),define("profile/UsersService",["orion/Deferred","orion/xhr","orion/EventTarget","orion/form"],function(e,n,t,r){function o(e){return""===e?null:JSON.parse(e)}function i(e){t.attach(this),e&&(this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.core.user",this))}return i.prototype={getUsersListSubset:function(t,r,i){var s=new e,a=this,c="../users?start="+t+"&rows="+r;return n("GET",c,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){var n=o(e.response);i&&("function"==typeof i?i(n):a.dispatchEvent({type:i,data:n})),s.resolve(n)},function(e){s.reject(e.response||e)}),s},getUsersList:function(t){var r=new e,i=this;return n("GET","../users",{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){var n=o(e.response);t&&("function"==typeof t?t(n):i.dispatchEvent({type:t,data:n})),r.resolve(n.users)},function(e){r.reject(e.response||e)}),r},deleteUser:function(t,r){var i=new e,s=this;return n("DELETE",t,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){var n=o(e.response);r&&("function"==typeof r?r(n):s.dispatchEvent({type:r,data:n})),i.resolve(n)},function(e){var n=e;try{n=o(e.response||e.error)}catch(t){}i.reject(n)}),i},createUser:function(t){t=t||{};var i={login:t.login,password:t.password,email:t.email};return n("POST","../users",{headers:{"Content-Type":"application/x-www-form-urlencoded","Orion-Version":"1"},timeout:15e3,data:r.encodeFormData(i)}).then(function(n){return(new e).resolve(o(n.response))},function(n){var t=n;try{t=o(n.response||n.error)}catch(r){}return(new e).reject(t)})},getUserInfo:function(t,r){var i=new e,s=this;return n("GET",t,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){var n=o(e.response);r&&("function"==typeof r?r(n):s.dispatchEvent({type:r,data:n})),i.resolve(n)},function(e){i.reject(e.response||e)}),i},updateUserInfo:function(t,r,i){var s=new e,a=this,c=t;return r.password!==r.passwordRetype?(s.reject({message:"Passwords do not match!"}),s):(n("PUT",c,{headers:{"Content-Type":"application/json; charset=UTF-8","Orion-Version":"1"},timeout:15e3,data:JSON.stringify(r)}).then(function(e){var n=o(e.response);i&&("function"==typeof i?i(n):a.dispatchEvent({type:i,data:n})),s.resolve(n)},function(e){if(409===e.status){var n=o(e.response),t=n.Message;alert(t)}s.reject(e.response||e)}),s)},resetUserPassword:function(t,i,s){var a=new e,c=this;return n("POST","../users",{headers:{"Content-Type":"application/x-www-form-urlencoded","Orion-Version":"1"},timeout:15e3,data:r.encodeFormData({reset:!0,login:t,password:i})}).then(function(e){var n=o(e.response);s&&("function"==typeof s?s(n):c.dispatchEvent({type:s,data:n})),a.resolve(n)},function(e){a.reject(e.response||e)}),a}},i}),define("domReady",[],function(){function e(e){var n;for(n=0;n<e.length;n+=1)e[n](u)}function n(){var n=f;c&&n.length&&(f=[],e(n))}function t(){c||(c=!0,s&&clearInterval(s),n())}function r(e){return c?e(u):f.push(e),r}var o,i,s,a="undefined"!=typeof window&&window.document,c=!a,u=a?document:null,f=[];if(a){if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1);else if(window.attachEvent){window.attachEvent("onload",t),i=document.createElement("div");try{o=null===window.frameElement}catch(d){}i.doScroll&&o&&window.external&&(s=setInterval(function(){try{i.doScroll(),t()}catch(e){}},30))}"complete"===document.readyState&&t()}return r.version="2.0.1",r.load=function(e,n,t,o){o.isBuild?t(null):r(t)},r}),define("profile/userservicePlugin",["orion/plugin","profile/UsersService","domReady!"],function(e,n){var t=new n,r=document.createElement("a");r.href="../mixloginstatic/LoginWindow.html";var o=r.href,i={name:"Orion User Profile",version:"1.0",description:"This plugin supports access and modification of a user's profile information.",login:o},s=new e(i);t.info=function(){return{name:"User profile"}},t.getDivContent=function(){var e={actions:[{id:"saveProfileButton",name:"Save Profile",tooltip:"Save Profile",action:"saveProfile"},{id:"resetProfileButton",name:"Reset",tooltip:"Reset Profile Information",action:"resetProfile"},{id:"deleteProfileButton",name:"Delete Profile",tooltip:"Delete Profile",action:"deleteProfile"}],sections:[{id:"personalInformation",name:"Personal Information",data:[{type:"TextBox",props:{id:"pi_login",readOnly:!1,name:"login"},label:"Login:"},{type:"TextBox",props:{id:"pi_name",readOnly:!1,name:"Name"},label:"Name:"},{type:"TextBox",props:{id:"pi_email",readOnly:!1,name:"email"},label:"Email:"},{type:"CheckBox",props:{id:"pi_emailConfirmed",readOnly:!0,name:"emailConfirmed"},label:"Email confirmed:"},{type:"DateLong",props:{id:"pi_lastLogin",name:"LastLogInTimestamp"},label:"Last login:	"},{type:"Text",props:{id:"pi_diskUsage",name:"diskUsage"},label:"Disk Usage:	"},{type:"DateLong",props:{id:"pi_diskUsageTimestamp",name:"diskUsageTimestamp"},label:"Disk Usage Last Calculated:	"}]},{id:"gitInformation",name:"Git (Defaults used to configure clones)",data:[{type:"TextBox",props:{id:"git_mail",readOnly:!1,name:"GitMail"},label:"Git Mail:"},{type:"TextBox",props:{id:"git_name",readOnly:!1,name:"GitName"},label:"Git Name:"}]},{id:"openids",name:"Manage External Accounts",type:"iframe",data:{src:"../mixloginstatic/manageOpenids.html"}}]};return e},t.initProfile=function(e,n,r){return this.getUserInfo(e,function(e){t.dispatchEvent({type:n,data:e}),t.dispatchEvent({type:r,data:e})})},t.fire=function(e,n,t){switch(e){case"saveProfile":return this.updateUserInfo(n,t,function(e,n){return this.initProfile(e,"requiredPluginsChanged","userInfoChanged"),n&&n.Message?n:{Message:"Profile saved!",status:200}}.bind(this,n));case"resetProfile":return this.getUserInfo(n,"userInfoChanged");case"deleteProfile":var r=t.login?t.login:n;if(confirm("Do you really want to delete user "+r+"?"))return this.deleteUser(n,"userDeleted");break;default:return this.updateUserInfo(n,t,function(e,n){return this.initProfile(e,"requiredPluginsChanged","userInfoChanged"),n&&n.Message?n:{Message:"Profile saved!",status:200}}.bind(this,n))}},s.registerService("orion.core.user",t),s.connect()});