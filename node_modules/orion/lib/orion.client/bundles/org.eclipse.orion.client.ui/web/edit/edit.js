!function(){function e(){for(var e=navigator.userAgent,t={browser:!1,version:!1},n=1,i=[{name:"Chrome/Chromium",regExp:/(?:chrome|crios|chromium)\/(\d+)/i,minVersion:24},{name:"Firefox",regExp:/firefox\/(\d+)/i,minVersion:17},{name:"Microsoft Internet Explorer",regExp:/msie\s(\d+)/i,minVersion:10},{name:"Microsoft Internet Explorer",regExp:/Trident\/(\d+)/i,minVersion:6},{name:"Safari",regExp:/version\/(\d+).*?safari/i,minVersion:6}],r=0;r<i.length;r++){var o=i[r],s=e.match(o.regExp);if(s){t.browser=!0,t.version=s[n]>=o.minVersion,t.name=o.name;break}}return t}function t(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function n(e){throw alert(e),new Error("unsupported browser")}var i=e();if(i.browser)i.version||n("Sorry, your browser version is not supported.\n\nTo use Orion, please upgrade to the latest version of "+i.name+".\n");else if(t()&&!localStorage.skipBrowserCheck){if(!confirm("Sorry, your browser is not supported. The latest version of Chrome, Firefox or Safari web browser is recommended.\nContinue anyway?"))throw"unsupported browser";localStorage.skipBrowserCheck=1}else t()||n("Sorry, your browser is not supported.\n\nTo use Orion, the latest version of the Chrome, Firefox, or Safari web browser is recommended.\n");return{isSupportedBrowser:e,supportsLocalStorage:t,throwBrowserAlert:n}}(),define("orion/browserCompatibility",function(){}),function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=o.shift();)e();s=!1}function t(e){o.push(e),s||(s=!0,a())}function n(e){return function(t){e(t)}}function i(e,t,i){try{var r=e(t),o=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof o)if(r===i.promise)i.reject(new TypeError);else{var s=r.cancel;"function"==typeof s?i._parentCancel=s.bind(r):delete i._parentCancel,o.call(r,n(i.resolve),n(i.reject),n(i.progress))}else i.resolve(r)}catch(a){i.reject(a)}}function r(){function e(){for(var e;e=d.shift();){var t=e.deferred,n="fulfilled"===l?"resolve":"reject",r=e[n];"function"==typeof r?i(r,a,t):t[n](a)}}function n(n){delete c._parentCancel,l="rejected",a=n,d.length&&t(e)}function o(i){function s(e){return function(t){l&&"assumed"!==l||e(t)}}delete c._parentCancel;try{var h=i&&("object"==typeof i||"function"==typeof i)&&i.then;if("function"==typeof h)if(i===c)n(new TypeError);else{l="assumed";var u=i&&i.cancel;if("function"!=typeof u){var p=new r;i=p.promise;try{h(p.resolve,p.reject,p.progress)}catch(f){p.reject(f)}u=i.cancel,h=i.then}a=i,h.call(i,s(o),s(n)),c._parentCancel=u.bind(i)}else l="fulfilled",a=i,d.length&&t(e)}catch(g){s(n)(g)}}function s(){var e=c._parentCancel;if(e)delete c._parentCancel,e();else if(!l){var t=new Error("Cancel");t.name="Cancel",n(t)}}var a,l,d=[],c=this;this.resolve=function(e){return l||o(e),c},this.reject=function(e){return l||n(e),c},this.progress=function(e){return l||d.forEach(function(t){if(t.progress)try{t.progress(e)}catch(n){}}),c.promise},this.cancel=function(){return c._parentCancel?setTimeout(s,0):s(),c},this.then=function(n,i,o){var s=new r;return s._parentCancel=c.promise.cancel,d.push({resolve:n,reject:i,progress:o,deferred:s}),("fulfilled"===l||"rejected"===l)&&t(e),s.promise},this.promise={then:c.then,cancel:c.cancel}}var o=[],s=!1,a=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var n=document.createElement("div"),i=new MutationObserver(e);return i.observe(n,{attributes:!0}),function(){n.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return r.all=function(e,t){function n(e,t){a||(s[e]=t,0===--o&&l.resolve(s))}function i(e,i){if(!a){if(t)try{return void n(e,t(i))}catch(r){i=r}l.reject(i)}}var o=e.length,s=[],a=!1,l=new r;return l.then(void 0,function(){a=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===o?l.resolve(s):e.forEach(function(e,t){e.then(n.bind(void 0,t),i.bind(void 0,t))}),l.promise},r.when=function(e,t,n,i){var o,s;return e&&"function"==typeof e.then?o=e:(s=new r,s.resolve(e),o=s.promise),o.then(t,n,i)},r}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var t=this._namedListeners[e.type];return t&&t.forEach(function(t){try{"function"==typeof t?t(e):t.handleEvent(e)}catch(n){"undefined"!=typeof console&&console.log(n)}}),!e.defaultPrevented},addEventListener:function(e,t){("function"==typeof t||t.handleEvent)&&(this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(t))},removeEventListener:function(e,t){var n=this._namedListeners[e];if(n)for(var i=0;i<n.length;i++)if(n[i]===t){1===n.length?delete this._namedListeners[e]:n.splice(i,1);break}}},e.prototype.constructor=e,e.attach=function(t){var n=new e;t.dispatchEvent=n.dispatchEvent.bind(n),t.addEventListener=n.addEventListener.bind(n),t.removeEventListener=n.removeEventListener.bind(n)},e}),define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function n(e,t,n){this._properties=n||{},this._properties["service.id"]=e,this._properties.objectClass=t,this._properties["service.names"]=t}function i(e,t,n){this._serviceId=e,this._serviceReference=t,this._internalRegistry=n}function r(t,n){function i(i){return function(){var r;try{if(!n())throw new Error("Service was unregistered");var o=t[i].apply(t,Array.prototype.slice.call(arguments));if(o&&"function"==typeof o.then)return o;r=new e,r.resolve(o)}catch(s){r=new e,r.reject(s)}return r.promise}}var r;for(r in t)"function"==typeof t[r]&&(this[r]=i(r))}function o(e,t){this.type=e,this.serviceReference=t}function s(){this._entries=[],this._namedReferences={},this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?!0:!1},unregisterService:function(t){var n=e._entries[t];if(!n)throw new Error("Service has already been unregistered: "+t);var i=n.reference;e._serviceEventTarget.dispatchEvent(new o("unregistering",i)),e._entries[t]=null;var r=i.getProperty("objectClass");r.forEach(function(t){for(var n=e._namedReferences[t],r=0;r<n.length;r++)if(n[r]===i){1===n.length?delete e._namedReferences[t]:n.splice(r,1);break}})},modifyService:function(t){var n=e._entries[t];if(!n)throw new Error("Service not found while trying to send modified event: "+t);var i=n.reference;e._serviceEventTarget.dispatchEvent(new o("modified",i))}}}return n.prototype={getPropertyKeys:function(){var e,t=[];for(e in this._properties)this._properties.hasOwnProperty(e)&&t.push(e);return t},getProperty:function(e){return this._properties[e]}},n.prototype.constructor=n,i.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw new Error("Service has already been unregistered: "+this._serviceId);return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{},e["service.id"]=this._serviceId,e.objectClass=t.objectClass,e["service.names"]=t["service.names"],this._internalRegistry.modifyService(this._serviceId)}},i.prototype.constructor=i,s.prototype={getService:function(e){var t;if("string"==typeof e){var n=this._namedReferences[e];n&&n.some(function(e){return t=this._entries[e.getProperty("service.id")].service,!!t},this)}else{var i=this._entries[e.getProperty("service.id")];i&&(t=i.service)}return t||null},getServiceReferences:function(e){if(e)return this._namedReferences[e]?this._namedReferences[e]:[];var t=[];return this._entries.forEach(function(e){e&&t.push(e.reference)}),t},registerService:function(e,t,s){if("undefined"==typeof t||null===t)throw new Error("invalid service");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var a=this._entries.length,l=new n(a,e,s),d=this._namedReferences;e.forEach(function(e){d[e]=d[e]||[],d[e].push(l)});var c=new r(t,this._internalRegistry.isRegistered.bind(null,a));this._entries.push({reference:l,service:c});var h=this._internalRegistry;return this._serviceEventTarget.dispatchEvent(new o("registered",l)),new i(a,l,h)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}},s.prototype.constructor=s,{ServiceRegistry:s}}),define("orion/xhr",["orion/Deferred"],function(e){function t(e,t,n,i){var r,o="undefined"!=typeof n.response?n.response:n.responseText,s="string"==typeof o?o:null;try{r=n.status}catch(a){r=0}var l={args:t,response:o,responseText:s,status:r,url:e,xhr:n};return"undefined"!=typeof i&&(l.error=i),l}function n(n,i,r){r=r||{};var o,s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,a=new e,l=r.headers||{},d=r.log||!1;"undefined"==typeof l["X-Requested-With"]&&(l["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof r.data||"POST"!==n&&"PUT"!==n||(o=r.data);var c=!1,h=!1;a.promise.then(void 0,function(e){c=!0,!h&&e instanceof Error&&"Cancel"===e.name&&s.abort()}),s.onabort=function(){if(h=!0,!c){var e=new Error("Cancel");e.name="Cancel",a.reject(e)}},s.onload=function(){var e=t(i,r,s);200<=s.status&&s.status<400?a.resolve(e):(a.reject(e),d&&"undefined"!=typeof console&&console.log(new Error(s.statusText)))},s.onerror=function(){var e=t(i,r,s);a.reject(e),d&&"undefined"!=typeof console&&console.log(new Error(s.statusText))},s.onprogress=function(e){e.xhr=s,a.progress(e)};try{if(s.open(n,i,!0),"string"==typeof r.responseType&&(s.responseType=r.responseType),"number"==typeof r.timeout)if("number"==typeof s.timeout)s.timeout=r.timeout,s.addEventListener("timeout",function(){a.reject(t(i,r,s,"Timeout exceeded"))});else{var u=setTimeout(function(){a.reject(t(i,r,s,"Timeout exceeded"))},r.timeout);a.promise.then(clearTimeout.bind(null,u),clearTimeout.bind(null,u))}Object.keys(l).forEach(function(e){s.setRequestHeader(e,l[e])}),s.send(o||null)}catch(p){a.reject(t(i,r,s,p))}return a.promise}return n}),define("orion/preferences",["require","orion/Deferred","orion/xhr"],function(e,t,n){function i(e,t){this._name=e,this._providers=t,this._flushPending=!1,this._cached=null,this._stores=[],this._pendingDeletes=[],this._dirty=[]}function r(e,t){return{get:function(n,i){if(0===t)return null;var r=localStorage.getItem(e+n);if(null===r)return null;var o=JSON.parse(r);return i||-1===t||o._expires&&o._expires>(new Date).getTime()?(delete o._expires,o):null},set:function(n,i){if(0!==t)if(-1!==t&&(i._expires=(new Date).getTime()+1e3*t),0===Object.keys(i).length)localStorage.removeItem(e+n);else{var r=JSON.stringify(i);localStorage.setItem(e+n,r),delete i._expires}},remove:function(t){localStorage.removeItem(e+t)}}}function o(e){this._currentPromises={},this._cache=new r("/orion/preferences/user",3600),this._service=null,this.available=function(){if(!this._service){var t=e.getServiceReferences("orion.core.preference.provider");t.length>0&&(this._service=e.getService(t[0]))}return!!this._service}}function s(e){this._location=e,this._currentPromise=null,this._cache=new r("/orion/preferences/default",3600)}function a(){this._cache=new r("/orion/preferences/local",-1)}function l(t,n){this._userProvider=new o(t),this._localProvider=new a,n=n||"defaults.pref",-1===n.indexOf("://")&&(n=e.toUrl(n)),this._defaultsProvider=new s(n),this._serviceRegistration=t.registerService("orion.core.preference",this)}return i.prototype={_flush:function(){for(var e=[],n=0;n<this._stores.length;++n){var i=this._stores[n];if(-1!==this._dirty.indexOf(i)&&e.push(this._providers[n].put(this._name,i)),this._pendingDeletes[n]&&this._pendingDeletes[n].length>0){for(var r=0;r<this._pendingDeletes[n].length;r++)e.push(this._providers[n].remove(this._name,this._pendingDeletes[n][r]));delete this._pendingDeletes[n]}}return this._dirty=[],t.all(e)},_scheduleFlush:function(e){e&&-1===this._dirty.indexOf(e)&&this._dirty.push(e),this._flushPending||(this._flushPending=!0,window.setTimeout(function(){this._flushPending&&(this._flushPending=!1,this._flush())}.bind(this),0))},_getCached:function(){if(!this._cached){this._cached={};for(var e=0;e<this._stores.length;++e){var t=this._stores[e];for(var n in t)t.hasOwnProperty(n)&&"undefined"==typeof this._cached[n]&&(this._cached[n]=t[n])}}return this._cached},keys:function(){return Object.keys(this._getCached())},get:function(e){var t=this._getCached();return t[e]},put:function(e,t){if(0!==this._stores.length){var n=this._stores[0];n[e]!==t&&(n[e]=t,this._cached=null,this._scheduleFlush(n))}},remove:function(e){for(var t=0;t<this._stores.length;++t){var n=this._stores[t];if(n.hasOwnProperty(e))return delete n[e],this._pendingDeletes[t]||(this._pendingDeletes[t]=[]),this._pendingDeletes[t].push(e),this._cached=null,this._scheduleFlush(),!0}return!1},clear:function(){for(var e=0;e<this._stores.length;++e)this._stores[e]={},this._scheduleFlush(this._stores[e]);this._cached=null},sync:function(e){if(this._flushPending)return this._flushPending=!1,this._flush();for(var n=this,i=[],r=0;r<this._providers.length;++r)i.push(this._providers[r].get(this._name,e).then(function(e){return function(t){n._stores[e]=t}}(r)));return t.all(i).then(function(){n._cached=null,n._getCached()})},flush:function(){this._flush()}},o.prototype={get:function(e,n){if(this._currentPromises[e])return this._currentPromises[e];var i=new t,r=null;if(n?this._cache.remove(e):r=this._cache.get(e),null!==r)i.resolve(r);else{this._currentPromises[e]=i;var o=this;this._service.get(e).then(function(t){o._cache.set(e,t),delete o._currentPromises[e],i.resolve(t)},function(t){if(404===t.status){var n={};o._cache.set(e,n),delete o._currentPromises[e],i.resolve(n)}else delete o._currentPromises[e],i.resolve(o._cache.get(e,!0)||{})})}return i},put:function(e,t){return this._cache.set(e,t),this._service.put(e,t)},remove:function(e,t){var n=this._cache.get(e);return delete n[t],this._cache.set(e,n),this._service.remove(e,t)}},s.prototype={get:function(e,i){if(this._currentPromise)return this._currentPromise;var r=new t,o=null;if(i?this._cache.remove(e):o=this._cache.get(e),null!==o)r.resolve(o);else{this._currentPromise=r;var s=this;n("GET",this._location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(t){var n=JSON.parse(t.response);s._cache.set(e,n[e]||{}),s._currentPromise=null,r.resolve(n[e]||{})},function(t){if(401===t.xhr.status||404===t.xhr.status)s._cache.set(e,{}),s._currentPromise=null,r.resolve({});else{s._currentPromise=null;var n=s._cache.get(e,!0);r.resolve(null!==n?n[e]||{}:{})}})}return r},put:function(){var e=new t;return e.resolve(),e},remove:function(e,t){var n=this._cache.get(e);delete n[t],this.put(e,n)}},a.prototype={get:function(e){var n=new t,i=this._cache.get(e);return n.resolve(null!==i?i:{}),n},put:function(e,n){var i=new t;return this._cache.set(e,n),i.resolve(),i},remove:function(e,t){var n=this._cache.get(e);delete n[t],this.put(e,n)}},l.DEFAULT_SCOPE=1,l.LOCAL_SCOPE=2,l.USER_SCOPE=4,l.prototype={listenForChangedSettings:function(e,t,n){return(!t||"number"!=typeof t||t>7||1>t)&&(n=t,t=l.DEFAULT_SCOPE|l.LOCAL_SCOPE|l.USER_SCOPE),window.addEventListener("storage",n,!1),0!==(l.USER_SCOPE&t)?"/orion/preferences/user"+e:0!==(l.LOCAL_SCOPE&t)?"/orion/preferences/local"+e:"/orion/preferences/default"+e},getPreferences:function(e,t){(!t||"number"!=typeof t||t>7||1>t)&&(t=l.DEFAULT_SCOPE|l.LOCAL_SCOPE|l.USER_SCOPE);var n=[];l.USER_SCOPE&t&&this._userProvider.available()&&n.push(this._userProvider),l.LOCAL_SCOPE&t&&n.push(this._localProvider),l.DEFAULT_SCOPE&t&&n.push(this._defaultsProvider);var r=new i(e,n),o=r.sync().then(function(){return r});return o},getSetting:function(e,t,n){for(var i,r=0;r<e.length;r++)if(e[r].label===t)for(var o=0;o<e[r].data.length;o++)if(e[r].data[o].label===n){i=e[r].data[o].value;break}return i}},{PreferencesService:l}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function n(e){return 0===e.length?"":e.join("&")}function i(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),n=t[1]?decodeURIComponent(t[1]):"",i=t[2]?decodeURIComponent(t[2]):"";return[n,i]}function r(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function o(e,n){var r="",o=[],s=0;return{next:function(){if(r!==e.query&&(r=e.query,o=t(r)),s<o.length){var a=i(o[s++]);switch(n){case"keys":return a[0];case"values":return a[1];case"keys+values":return[a[0],a[1]];default:throw new TypeError}}throw A}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function a(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var n=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=n+e.path}}else e.path=t.path}function l(e){return e.toLowerCase()}function d(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function c(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/")}function h(e){e.scheme&&(e.scheme=l(e.scheme)),e.port&&(e.port=d(e.port)),e.host&&e.path&&(e.path=c(e.path))}function u(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function p(e,t){if("string"!=typeof e)throw new TypeError;e=u(e);var n=y.exec(e);if(!n)return null;var i={};if(i.scheme=n[1]||"",i.scheme&&!w.test(i.scheme))return null;var r=n[2];if(r){var o=_.exec(r);if(i.userinfo=o[1],i.host=o[2],i.port=o[3],i.port&&!b.test(i.port))return null}return i.path=n[3],i.query=n[4],i.fragment=n[5],a(i,t),h(i),i}function f(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function g(e,t){var n;if(t){if(t=t.href||t,n=p(t),!n||!n.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:n})}var i=p(e,n);if(!i)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:i,writable:!0});var r=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?r:null},enumerable:!0})}try{var m;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(m=new window.URL("http://www.w3.org?q")).protocol&&m.query)return}catch(v){}var y=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,_=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,C=/^\S*$/,w=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,b=/^\d*$/,x=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,S=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,L=/^([^?#\s]*)$/,E=/^([^\s]*)$/,k=C,T=/([^:]*):?(.*)/,A="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),N={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(n){e(n);var r,o=t(this._url.query);return o.some(function(e){var t=i(e);return t[0]===n?(r=t[1],!0):void 0}),r},enumerable:!0},set:{value:function(o,s){e(o),e(s);var a=t(this._url.query),l=a.some(function(e,t){var n=i(e);return n[0]===o?(n[1]=s,a[t]=r(n),!0):void 0});l||a.push(r([o,s])),this._url.query=n(a)},enumerable:!0},has:{value:function(n){e(n);var r=t(this._url.query);return r.some(function(e){var t=i(e);return t[0]===n?!0:void 0})},enumerable:!0},"delete":{value:function(r){e(r);var o=t(this._url.query),s=o.filter(function(e){var t=i(e);return t[0]!==r});return s.length!==o.length?(this._url.query=n(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var n=o(this._url,"keys+values");try{for(;;){var i=n.next();e.call(t,i[1],i[0],this)}}catch(r){if(r!==A)throw r}},enumerable:!0},keys:{value:function(){return o(this._url,"keys")},enumerable:!0},values:{value:function(){return o(this._url,"values")},enumerable:!0},items:{value:function(){return o(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(n){e(n);var r=[],o=t(this._url.query);return o.forEach(function(e){var t=i(e);t[0]===n&&r.push(t[1])}),r},enumerable:!0},append:{value:function(i,o){e(i),e(o);var s=t(this._url.query);s.push(r([i,o])),this._url.query=n(s)},enumerable:!0}}),Object.defineProperties(g.prototype,{href:{get:function(){return this._url?f(this._url):this._input},set:function(t){e(t),this._input=t,this._url=p(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var n=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===n||w.test(n))&&(this._url.scheme=l(n))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=T.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var n=T.exec(this._userinfo),i=[encodeURIComponent(t||"")];n[2]&&i.push(n[2]),this._userinfo=i.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=T.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var n=T.exec(this._userinfo),i=[n[1]||""];t&&i.push(encodeURIComponent(t)),this._userinfo=i.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var n=S.exec(t);n&&(this._url.host=n[1],this._url.port=d(n[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var n=x.exec(t);n&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===N[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var n=b.exec(t);n&&(this._url.port=d(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var n=L.exec(t);n&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?c(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var n=E.exec(t);n&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var n=k.exec(t);n&&(this._url.fragment=t)}},enumerable:!0}});var M=window.URL||window.webkitURL;M&&M.createObjectURL&&(Object.defineProperty(g,"createObjectURL",{value:M.createObjectURL.bind(M),enumerable:!1}),Object.defineProperty(g,"revokeObjectURL",{value:M.revokeObjectURL.bind(M),enumerable:!1})),window.URL=g}(),define("orion/URL-shim",function(){}),define("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/URL-shim"],function(e,t){function n(e,t){var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;n.sort(),i.sort();for(var r=0,o=n.length;o>r;r++){var s=n[r];if(s!==i[r])return!1;var a=e[s],l=t[s];if(a!==l&&JSON.stringify(a)!==JSON.stringify(l))return!1}return!0}function i(e){if(-1===e.indexOf("://"))try{return new URL(e,location.href).href}catch(t){}return e}function r(e){function t(){return n=n||Object.keys(e)}var n=null,i={key:function(e){return t()[e]},getItem:function(t){return e[t]},setItem:function(t,i){e[t]=i,n=null},removeItem:function(t){delete e[t],n=null},clear:function(){t().forEach(function(t){delete e[t]}.bind(this)),n=null}};return Object.defineProperty(i,"length",{get:function(){return t().length}}),i}function o(e,t){if(t&&t instanceof XMLHttpRequest){var n,i;try{n=t.status,i=t.statusText}catch(r){n=0,i=""}return{status:n||0,statusText:i}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,o)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function a(e,t){this.type=e,this.plugin=t}function l(e,t){this.__objectId=e,this.__methods=t}function d(i,r,o){function d(e){w&&o.postMessage(e,w)}function c(t){if(!w)return(new e).reject(new Error("plugin not connected"));t.id=String(M++);var n=new e;R[t.id]=n,n.then(null,function(e){"active"===A&&e instanceof Error&&"Cancel"===e.name&&d({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var i=Object.prototype.toString;return t.params.forEach(function(e,r){if("[object Object]"===i.call(e)&&!(e instanceof l)){var o,s;for(o in e)"[object Function]"===i.call(e[o])&&(s=s||[],s.push(o));if(s){var a=I++;P[a]=e;var d=function(){delete P[a]};n.then(d,d),t.params[r]=new l(a,s)}}}),o.postMessage(t,w),n.promise}function h(e,t){e||0===e?d({id:e,result:null,error:t}):console.log(t)}function u(e,t,n,i){i.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var n={};e.__methods.forEach(function(t){n[t]=function(){return c({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),i[t]=n}});var r=void 0===typeof e?null:{id:e,result:null,error:null};try{var o=n.apply(t,i);if(!r)return;o&&"function"==typeof o.then?(D[e]=o,o.then(function(t){delete D[e],r.result=t,d(r)},function(t){D[e]&&(delete D[e],r.error=s(t),d(r))},function(){d({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(r.result=o,d(r))}catch(a){r&&(r.error=s(a),d(r))}}function p(e){try{if(e.method){var t=e.method,n=e.params||[];if("serviceId"in e){var i=O[e.serviceId];i||h(e.id,"service not found"),t in i?u(e.id,i,i[t],n):h(e.id,"method not found")}else if("objectId"in e){var r=P[e.objectId];r||h(e.id,"object not found"),t in r?u(e.id,r,r[t],n):h(e.id,"method not found")}else if("requestId"in e){var s=D[e.requestId];s&&"cancel"===t&&s.cancel&&s.cancel.apply(s,n)}else if("responseId"in e){var a=R[e.responseId];a&&"progress"===t&&a.progress&&a.progress.apply(a,n)}else if("plugin"===e.method){var l=e.params[0];x({headers:l.headers,services:l.services}).then(function(){C&&C.resolve(y)})}else{if("timeout"!==e.method)throw new Error("Bad method: "+e.method);C&&C.reject(e.error)}}else{var d=R[String(e.id)];if(delete R[String(e.id)],e.error){var c=o.handleServiceError(y,e.error);d.reject(c)}else d.resolve(e.result)}}catch(p){console.log("Plugin._messageHandler "+p)}}function f(e){var n={};if(e.methods&&(e.methods.forEach(function(t){n[t]=function(){var n={serviceId:e.serviceId,method:t,params:Array.prototype.slice.call(arguments)};return"active"===A?c(n):y.start({"transient":!0}).then(function(){return c(n)})}}),n.addEventListener&&n.removeEventListener)){var i=new t,r=I++;P[r]={handleEvent:i.dispatchEvent.bind(i)};var o=new l(r,["handleEvent"]),s=n.addEventListener;n.addEventListener=function(e,t){i._namedListeners[e]||s(e,o),i.addEventListener(e,t)};var a=n.removeEventListener;n.removeEventListener=function(e,t){i.removeEventListener(e,t),i._namedListeners[e]||a(e,o)}}return n}function g(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=i;var n=e.names||e.type||[];return Array.isArray(n)||(n=[n]),t.objectClass=n,t}function m(e){var t=f(e),n=g(e),i=o.registerService(e.names||e.type,t,n);N[e.serviceId]={registration:i,proxy:t}}function v(){o.persist(i,{created:S,headers:L,services:E,autostart:k,lastModified:T})}var y=this;r=r||{};var _,C,w,b,x,S=r.created||(new Date).getTime(),L=r.headers||{},E=r.services||[],k=r.autostart,T=r.lastModified||0,A="installed",N={},M=0,I=0,D={},R={},P={},O={};this._persist=v,this._resolve=function(){A="resolved",o.dispatchEvent(new a("resolved",y))},this._getAutostart=function(){return k},this._getCreated=function(){return S},this.getLocation=function(){return i},this.getHeaders=function(){return JSON.parse(JSON.stringify(L))},this.getName=function(){var e=this.getHeaders();return e?e.name||"":null},this.getVersion=function(){var e=this.getHeaders();return e?e.version||"0.0.0":null},this.getLastModified=function(){return T},this.getServiceReferences=function(){var e=[];return Object.keys(N).forEach(function(t){e.push(N[t].registration.getReference())}),e},this.setParent=function(t){return b!==t?(b=t,y.stop({"transient":!0}).then(function(){return"started"===k?y.start({"transient":!0}):"lazy"===k?y.start({lazy:!0,"transient":!0}):void 0})):(new e).resolve()},this.getState=function(){return A},this.start=function(t){if("uninstalled"===A)return(new e).reject(new Error("Plugin is uninstalled"));if(_)return _.promise.then(this.start.bind(this,t));if("active"===A)return(new e).resolve();if(!t||!t.transient){var n=t&&t.lazy?"lazy":"started";n!==k&&(k=n,v())}var r=o.getState();if("starting"!==r&&"active"!==r)return t.transient?(new e).reject(new Error("start transient error")):(new e).resolve();if("installed"===A)try{this._resolve()}catch(s){return(new e).reject(s)}if("resolved"===A&&E.forEach(function(e){m(e)}),t&&t.lazy)return"starting"!==A&&(A="starting",o.dispatchEvent(new a("lazy activation",y))),(new e).resolve();var l=new e;return _=l,A="starting",o.dispatchEvent(new a("starting",y)),C=new e,w=o.connect(i,p,b),C.then(function(){C=null,A="active",o.dispatchEvent(new a("started",y)),_=null,l.resolve()},function(){C=null,A="stopping",o.dispatchEvent(new a("stopping",y)),Object.keys(N).forEach(function(e){N[e].registration.unregister(),delete N[e]}),o.disconnect(w),w=null,A="resolved",_=null,o.dispatchEvent(new a("stopped",y)),l.reject(new Error("plugin activation error"))}),l.promise},this.stop=function(t){if("uninstalled"===A)return(new e).reject(new Error("Plugin is uninstalled"));if(_)return _.promise.then(this.stop.bind(this,t));if(t&&t.transient||"stopped"!==k&&(k="stopped",v()),"active"!==A&&"starting"!==A)return(new e).resolve();var n=new e;return _=n,A="stopping",o.dispatchEvent(new a("stopping",y)),Object.keys(N).forEach(function(e){N[e].registration.unregister(),delete N[e]}),w&&(o.disconnect(w),w=null),A="resolved",_=null,o.dispatchEvent(new a("stopped",y)),n.resolve(),n.promise},x=function(t){if("uninstalled"===A)return(new e).reject(new Error("Plugin is uninstalled"));if(!t)return 0===T&&(T=(new Date).getTime(),v()),o.loadManifest(i).then(x);var r=L,s=E,l=k;if(L=t.headers||{},E=t.services||{},k=t.autostart||k,t.lastModified?T=t.lastModified:(T=(new Date).getTime(),v()),n(L,r)&&n(E,s)&&k===l)return(new e).resolve();if("active"===A||"starting"===A){var d=[];Object.keys(E).forEach(function(e){var t=E[e];d.push(e);var i=N[e];if(i){if(n(t.methods,Object.keys(i.proxy))){var r=g(t),o=i.registration.getReference(),s={};return o.getPropertyKeys().forEach(function(e){s[e]=o.getProperty(e)}),void(n(r,s)||i.registration.setProperties(r))}i.registration.unregister(),delete N[e]}m(t)}),Object.keys(N).forEach(function(e){-1===d.indexOf(e)&&(N[e].registration.unregister(),delete N[e])})}return"active"===A&&(o.disconnect(w),C=new e,w=o.connect(i,p,b),C.then(function(){C=null},function(){C=null,A="stopping",o.dispatchEvent(new a("stopping"),y),Object.keys(N).forEach(function(e){N[e].registration.unregister(),delete N[e]}),o.disconnect(w),w=null,A="resolved",o.dispatchEvent(new a("stopped",y))})),(new e).resolve()},this.update=function(e){return x(e).then(function(){o.dispatchEvent(new a("updated",y))})},this.uninstall=function(){return"uninstalled"===A?(new e).reject(new Error("Plugin is uninstalled")):"active"===A||"starting"===A||"stopping"===A?this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this)):(o.removePlugin(this),A="uninstalled",o.dispatchEvent(new a("uninstalled",y)),(new e).resolve())}}function c(n,o){function s(e){var t=e.source;f.some(function(n){if(t===n.target){try{var i;if("undefined"==typeof n.useStructuredClone){var r="string"!=typeof e.data;i=r?e.data:JSON.parse(e.data),n.useStructuredClone=r
}else i=n.useStructuredClone?e.data:JSON.parse(e.data);n.handler(i)}catch(o){}return!0}})}o=o||{};var l=o.storage||localStorage;l.getItem||(l=r(l));var c,u="installed",p=[],f=[],g=new t,m={},v={registerService:n.registerService.bind(n),connect:function(e,t,n,i){function r(e){var n=new Error(e);n.name="timeout",t({method:"timeout",error:n})}var o={handler:t,url:e},s=setTimeout(r.bind(null,"Load timeout for: "+e),i||15e3),a=document.createElement("iframe");return a.name=e+"_"+(new Date).getTime(),a.src=e,a.onload=function(){clearTimeout(s),s=setTimeout(r.bind(null,"Plugin handshake timeout for: "+e),5e3)},a.sandbox="allow-scripts allow-same-origin",a.style.width=a.style.height="100%",a.frameBorder=0,(n||c).appendChild(a),o.target=a.contentWindow,o.close=function(){if(clearTimeout(s),a){var e=a.parentNode;e&&e.removeChild(a),a=null}},f.push(o),o},disconnect:function(e){for(var t=0;t<f.length;t++)if(e===f[t]){f.splice(t,1);try{e.close()}catch(n){}break}},removePlugin:function(e){for(var t=0;t<p.length;t++)if(e===p[t]){p.splice(t,1);break}l.removeItem("plugin."+e.getLocation())},persist:function(e,t){l.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.target.postMessage(t.useStructuredClone?e:JSON.stringify(e),t.url)},dispatchEvent:function(e){try{g.dispatchEvent(e)}catch(t){console&&console.log("PluginRegistry.dispatchEvent "+t)}},loadManifest:function(t){var n=new e,i=v.connect(t,function(e){if(i&&e.method)if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];v.disconnect(i),i=null,n.resolve(t)}else"timeout"===e.method&&(v.disconnect(i),i=null,n.reject(e.error))});return n.promise},getState:function(){return u},handleServiceError:function(e,t){if(t&&401===t.status){var n=e.getHeaders(),i=e.getName()||e.getLocation(),r=document.createElement("span");if(r.appendChild(document.createTextNode("Authentication required for: "+i+".")),n.login){r.appendChild(document.createTextNode(" "));var o=document.createElement("a");o.target="_blank",o.textContent="Login",o.href=n.login,h.test(o.href)?(r.appendChild(o),r.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+n.login)}var s=new XMLSerializer;return{Severity:"Error",HTML:!0,Message:s.serializeToString(r)}}if(t.__isError){var a=t;t=new Error(a.message),Object.keys(a).forEach(function(e){t[e]=a[e]}),delete t.__isError}return t}};this.getLocation=function(){return"System"},this.getHeaders=function(){return{}},this.getName=function(){return"System"},this.getVersion=function(){return"0.0.0"},this.getLastModified=function(){return 0},this.getState=v.getState,this.init=function(){if("starting"!==u&&"active"!==u&&"stopping"!==u){addEventListener("message",s,!1);for(var e=[],t=0,n=l.length;n>t;t++)e.push(l.key(t));e.forEach(function(e){if(0===e.indexOf("plugin.")){var t=e.substring("plugin.".length),n=JSON.parse(l.getItem(e));n.created&&p.push(new d(t,n,v))}}),p.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1}),o.parent?c=o.parent:(c=document.createElement("div"),o.visible||(c.style.display="none",c.style.visibility="hidden"),document.body.appendChild(c)),o.plugins&&Object.keys(o.plugins).forEach(function(e){e=i(e);var t=this.getPlugin(e);if(!t){var n=o.plugins[e];"object"!=typeof n&&(n={}),n.autostart=n.autostart||o.defaultAutostart||"lazy",p.push(new d(e,n,v))}}.bind(this)),u="starting"}},this.start=function(){if("starting"!==u&&this.init(),"starting"!==u)return(new e).reject("Cannot start framework. Framework is already "+u+".");var t=[],n=(new Date).getTime();return p.forEach(function(e){var i=e._getAutostart();return 0===e.getLastModified()?void t.push(e.update().then(function(){return"started"===i?e.start({"transient":!0}):"lazy"===i?e.start({lazy:!0,"transient":!0}):void e._resolve()})):void("started"===i?t.push(e.start({"transient":!0})):"lazy"===i?(t.push(e.start({lazy:!0,"transient":!0})),n>e.getLastModified()+864e5&&e.update()):e._resolve())}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){u="active"})},this.stop=function(){if("starting"!==u&&"active"!==u)return(new e).reject("Cannot stop registry. Registry is already "+u+".");u="stopping";var t=[];return p.forEach(function(e){t.push(e.stop({"transient":!0}))}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){if(!o.parent){var e=c.parentNode;e&&e.removeChild(c)}c=null,removeEventListener("message",s),u="resolved"})},this.update=function(){this.stop().then(this.start.bind(this))},this.uninstall=function(){return(new e).reject("Cannot uninstall registry")},this.installPlugin=function(t,n){t=i(t);var r=this.getPlugin(t);if(r)return(new e).resolve(r);if(m[t])return m[t];if(n)return r=new d(t,n,v),p.push(r),r._persist(),v.dispatchEvent(new a("installed",r)),(new e).resolve(r);var o=v.loadManifest(t).then(function(e){return r=new d(t,e,v),p.push(r),r._persist(),delete m[t],v.dispatchEvent(new a("installed",r)),r},function(e){throw delete m[t],e});return m[t]=o,o},this.getPlugins=function(){return p.slice()},this.getPlugin=function(e){var t=null;return e=i(e),p.some(function(n){return e===n.getLocation()?(t=n,!0):void 0}),t},this.addEventListener=g.addEventListener.bind(g),this.removeEventListener=g.removeEventListener.bind(g),this.resolvePlugins=function(){var e=!0;return p.forEach(function(t){e=e&&t._resolve()}),e}}var h=new RegExp("^http[s]?","i");return{Plugin:d,PluginRegistry:c}}),define("orion/objects",[],function(){function e(e){for(var t=Object.prototype.hasOwnProperty,n=1,i=arguments.length;i>n;n++){var r=arguments[n];for(var o in r)t.call(r,o)&&(e[o]=r[o])}return e}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var n=Object.create(Object.getPrototypeOf(t));return e(n,t),n},mixin:e,toArray:function(e){return Array.isArray(e)?e:[e]}}}),define("orion/serviceTracker",[],function(){function e(e,i){function r(e){var t=e.getProperty("service.id"),n=this.addingService(e);n&&(d[t]=e,c[t]=n)}function o(e){var t=e.getProperty("service.id"),n=c[t];delete d[t],delete c[t],this.removedService(e,n)}function s(e){return-1!==e.getProperty("objectClass").indexOf(i)}this.serviceRegistry=e;var a,l,d={},c={},h=t;this.close=function(){if(h!==n)throw"Already closed";h=t,e.removeEventListener("registered",a),e.removeEventListener("unregistering",l),a=null,l=null;var i=this;this.getServiceReferences().forEach(function(e){o.call(i,e)}),"function"==typeof this.onClose&&this.onClose()},this.getServiceReferences=function(){var e=Object.keys(d);return e.length?e.map(function(e){return d[e]}):null},this.open=function(){if(h!==t)throw"Already open";h=n;var d=this;a=function(e){return s(e.serviceReference)&&(r.call(d,e.serviceReference),"function"==typeof d.onServiceAdded)?d.onServiceAdded(e.serviceReference,d.serviceRegistry.getService(e.serviceReference)):void 0},l=function(e){s(e.serviceReference)&&o.call(d,e.serviceReference)},e.addEventListener("registered",a),e.addEventListener("unregistering",l),e.getServiceReferences(i).forEach(function(t){return r.call(d,t),"function"==typeof d.onServiceAdded?d.onServiceAdded(t,e.getService(t)):void 0}),"function"==typeof this.onOpen&&this.onOpen()}}var t=0,n=1;return e.prototype={addingService:function(e){return this.serviceRegistry.getService(e)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(){}},e}),define("orion/config",["orion/Deferred","orion/objects","orion/preferences","orion/serviceTracker"],function(e,t,n,i){var r,o,s,a,l,d=n.PreferencesService,c=d.DEFAULT_SCOPE,h="pid",u="orion.cm.managedservice",p="/cm/configurations";return r=function(t,n,r){function o(e,t,n){c[e]||(c[e]=[]),p[e]||(p[e]=[]),c[e].push(t),p[e].push(n)}function s(e,t,n){var i=c[e],r=p[e];i.length>1?i.splice(i.indexOf(t),1):delete c[e],r.length>1?r.splice(r.indexOf(n),1):delete p[e]}function a(e){return c[e]||[]}function l(e){return p[e]||[]}function d(e,t,i){t.forEach(function(r,o){try{var s=e[o].getProperty("__plugin__"),a=s&&n.getPlugin(s);(!s||a&&"active"===a.getState())&&t[o].updated(i)}catch(l){"undefined"!=typeof console&&console.log(l)}})}i.call(this,t,u);var c={},p={},f=function(n){var i=[];return n.plugin.getServiceReferences().forEach(function(e){if(-1!==e.getProperty("objectClass").indexOf(u)){var n=e.getProperty(h),o=t.getService(e);if(n&&o){var s=r._find(n),a=s&&s.getProperties();i.push(o.updated(a))}}}),e.all(i)};this.addingService=function(e){var n=e.getProperty(h),i=t.getService(e);return n&&i?(o(n,e,i),i):null},this.onServiceAdded=function(e,t){var n=e.getProperty(h),i=r._find(n);d([e],[t],i&&i.getProperties())},this.onOpen=function(){n.addEventListener("started",f)},this.onClose=function(){n.removeEventListener("started",f)},this.notifyUpdated=function(e){var t=e.getPid();d(a(t),l(t),e.getProperties())},this.notifyDeleted=function(e){var t=e.getPid();d(a(t),l(t),null)},this.removedService=function(e,t){var n=e.getProperty(h);s(n,e,t)}},o=function(){function e(e,t,n){this.store=new s(this,n),this.configAdmin=new a(this,this.store),this.tracker=new r(e,t,this.store)}return e.prototype={getConfigurationAdmin:function(){var e=this;return this.configAdmin._init().then(function(t){return e.tracker.open(),t})},notifyDeleted:function(e){this.tracker.notifyDeleted(e)},notifyUpdated:function(e){this.tracker.notifyUpdated(e)}},e}(),a=function(){function e(e,t){this.factory=e,this.store=t}return e.prototype={_prefName:p,_init:function(){var e=this;return this.store._init().then(function(){return e})},getConfiguration:function(e){return this.store.get(e)},getDefaultConfiguration:function(e){return this.store._find(e,c)},listConfigurations:function(){return this.store.list()}},e}(),s=function(){function t(t,n){this.factory=t,this.prefsService=n,this.configs=this.defaultConfigs=null,this.pref=null;var i=this;this.initPromise=e.all([this.prefsService.getPreferences(p,c),this.prefsService.getPreferences(p)]).then(function(e){var t=e[0];i.pref=e[1],i.defaultConfigs=i._toConfigs(t,!0),i.configs=i._toConfigs(i.pref,!1,t)})}return t.prototype={_toConfigs:function(e,t,n){var i=Object.create(null),r=this;return e.keys().forEach(function(o){if(!i[o]){var s=e.get(o),a=n&&n.get(o);"object"==typeof s&&null!==s&&Object.keys(s).length>0&&(s[h]=o,i[o]=new l(r.factory,r,s,t,a))}}),i},_init:function(){return this.initPromise},_find:function(e,t){return t===d.DEFAULT_SCOPE?this.defaultConfigs[e]||null:this.configs[e]||null},get:function(e){var t=this._find(e),n=this._find(e,c);if(!t){var i=n&&n.getProperties(!0);t=new l(this.factory,this,e,!1,i),this.configs[e]=t}return t},list:function(){var e=this,t=[];return this.pref.keys().forEach(function(n){var i=e._find(n);i&&null!==i.getProperties()&&t.push(i)}),t},remove:function(e){this.pref.remove(e),delete this.configs[e]},save:function(e,t){var n=t.getProperties(!0)||{},i=this._find(e,c);if(i){var r=i.getProperties(!0);Object.keys(r).forEach(function(e){Object.prototype.hasOwnProperty.call(n,e)&&n[e]===r[e]&&delete n[e]})}this.pref.put(e,n)}},t}(),l=function(){function e(e,n){n=t.clone(n),delete n[h],e.properties=n}function n(t,n,i,r,o){if(this.factory=t,this.store=n,this.readOnly=r,null!==i&&"object"==typeof i)this.pid=i[h],e(this,i);else{if("string"!=typeof i)throw new Error("Invalid pid/properties "+i);this.pid=i,this.properties=null}if(o){var s=this;Object.keys(o).forEach(function(e){e===h||Object.prototype.hasOwnProperty.call(s.properties,e)||(s.properties[e]=o[e])})}}return n.prototype={_checkReadOnly:function(){if(this.readOnly)throw new Error("Configuration is read only")},_checkRemoved:function(){if(this.removed)throw new Error("Configuration was removed")},getPid:function(){return this._checkRemoved(),this.pid},getProperties:function(e){this._checkRemoved();var n=null;return this.properties&&(n=t.clone(this.properties),e||(n[h]=this.pid)),n},remove:function(){this._checkReadOnly(),this._checkRemoved(),this.factory.notifyDeleted(this),this.store.remove(this.pid),this.removed=!0},update:function(t){this._checkReadOnly(),this._checkRemoved(),e(this,t),this.store.save(this.pid,this),this.factory.notifyUpdated(this)},toString:function(){return"[ConfigImpl pid: "+this.pid+", properties: "+JSON.stringify(this.properties)+"]"}},n}(),{ConfigurationAdminFactory:o}}),define("orion/bootstrap",["require","orion/Deferred","orion/serviceregistry","orion/preferences","orion/pluginregistry","orion/config"],function(e,t,n,i,r,o){function s(){if(a)return a;a=new t;var s=new n.ServiceRegistry,l=new i.PreferencesService(s);return l.getPreferences("/plugins").then(function(n){var i={plugins:{}};n.keys().forEach(function(t){var r=e.toUrl(t);i.plugins[r]=n[t]});var d=new r.PluginRegistry(s,i);return d.start().then(function(){return s.getServiceReferences("orion.core.preference.provider").length>0?l.getPreferences("/plugins",l.USER_SCOPE).then(function(n){var i=[];return n.keys().forEach(function(t){var n=e.toUrl(t);d.getPlugin(n)||i.push(d.installPlugin(n,{autostart:"lazy"}).then(function(e){return e.update().then(function(){return e.start({lazy:!0})})}))}),t.all(i,function(e){console.log(e)})}):void 0}).then(function(){return new o.ConfigurationAdminFactory(s,d,l).getConfigurationAdmin().then(s.registerService.bind(s,"orion.cm.configadmin"))}).then(function(){var e=s.getService("orion.core.auth");if(e){var t=e.getUser().then(function(t){return t?void localStorage.setItem("lastLogin",(new Date).getTime()):e.getAuthForm(window.location.href).then(function(e){setTimeout(function(){window.location=e},0)})}),n=localStorage.getItem("lastLogin");if(!n||n<(new Date).getTime()-9e5)return t}}).then(function(){var e={serviceRegistry:s,preferences:l,pluginRegistry:d};return a.resolve(e),e})})}var a;return{startup:s}}),function(){function e(e,t,n,i,r,o){t[e]&&(n.push(e),(t[e]===!0||1===t[e])&&i.push(r+e+"/"+o))}function t(e,t,n,i,r){var o=i+t+"/"+r;require._fileExists(e.toUrl(o+".js"))&&n.push(o)}function n(e,t,i){var r;for(r in t)!t.hasOwnProperty(r)||e.hasOwnProperty(r)&&!i?"object"==typeof t[r]&&n(e[r],t[r],i):e[r]=t[r]}var i=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(r){var o=r.config?r.config():{};return o=o||{},{version:"2.0.1+",load:function(r,s,a,l){l=l||{},l.locale&&(o.locale=l.locale);var d,c,h,u=i.exec(r),p=u[1],f=u[4],g=u[5],m=f.split("-"),v=[],y={},_="";if(u[5]?(p=u[1],d=p+g):(d=r,g=u[4],f=o.locale,f||(f=o.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),m=f.split("-")),l.isBuild){for(v.push(d),t(s,"root",v,p,g),c=0;c<m.length;c++)h=m[c],_+=(_?"-":"")+h,t(s,_,v,p,g);s(v,function(){a()})}else s([d],function(t){var i,r=[];for(e("root",t,r,v,p,g),c=0;c<m.length;c++)i=m[c],_+=(_?"-":"")+i,e(_,t,r,v,p,g);s(v,function(){var e,i,o;for(e=r.length-1;e>-1&&r[e];e--)o=r[e],i=t[o],(i===!0||1===i)&&(i=s(p+o+"/"+g)),n(y,i);a(y)})})}}})}(),define("orion/i18n",[],function(){return{load:function(e,t,n,i){i=i||{};var r=/(^.*(?:^|\/)nls(?:\/|$))([^\/]*)\/?([^\/]*)/,o=r.exec(e);if(!o)return void n(null);if(!t.defined||t.defined(e))try{return void n(t(e))}catch(s){}if(i.isBuild||i.isTest)return void n({});if(t.specified&&!t.specified("orion/bootstrap"))return void n({});var a=o[1],l=o[3]?o[2]:"",d=o[3]||o[2];t(["orion/bootstrap"],function(s){s.startup().then(function(s){var c=s.serviceRegistry,h=c.getServiceReferences("orion.i18n.message");if(l){var u=h.some(function(t){return e===t.getProperty("name")?(c.getService(t).getMessageBundle().then(function(e){n(e)},function(){n({})}),!0):!1});u||n({})}else{var p,f={};h.forEach(function(e){var n=e.getProperty("name");if((o=r.exec(n))&&a===o[1]&&d===(o[3]||o[2]))if(l=o[3]?o[2]:""){var s=i.locale||("undefined"!=typeof navigator?navigator.language||navigator.userLanguage:null);if(!s||0!==s.toLowerCase().indexOf(l.toLowerCase()))return;f[l]=!0,t.specified&&t.specified(n)||define(n,["orion/i18n!"+n],function(e){return e})}else p=e}),t.specified&&t.specified(e)?n(f):p?c.getService(p).getMessageBundle().then(function(t){Object.keys(f).forEach(function(e){"undefined"==typeof t[e]&&(t[e]=f[e])}),define(e,[],t),n(t)},function(){define(e,[],f),n(f)}):(define(e,[],f),n(f))}})})}}}),define("orion/edit/nls/root/messages",{Editor:"Editor",switchEditor:"Switch Editor",Fetching:"Fetching: ${0}",confirmUnsavedChanges:"There are unsaved changes.  Do you still want to navigate away?",searchFiles:"Search Files...",searchTerm:"Enter search term:",unsavedChanges:"There are unsaved changes.",unsavedAutoSaveChanges:"Please stay on the page until Auto Save is complete.",Save:"Save",Saved:"Saved",Blame:"Blame",BlameTooltip:"Show blame annotations",saveOutOfSync:"Resource is out of sync with the server. Do you want to save it anyway?",loadOutOfSync:"Resource is out of sync with the server. Do you want to load it anyway? This will overwrite your local changes.",ReadingMetadata:"Reading metadata of ${0}",ReadingMetadataError:"Can not get metadata of ${0}",Reading:"Reading ${0}",readonly:"Read Only.",saveFile:"Save this file",gotoLine:"Go to Line...",gotoLineTooltip:"Go to specified line number",gotoLinePrompt:"Go to line:",Undo:"Undo",Redo:"Redo",Find:"Find...",noResponse:"No response from server.  Check your internet connection and try again.",savingFile:"Saving file ${0}",running:"Running ${0}","Saving...":"Saving...",View:"View",SidePanel:"Side Panel",SidePanelTooltip:"Choose what to show in the side panel.",Actions:"Actions",Navigator:"Navigator",FolderNavigator:"Folder Navigator",Project:"Project",New:"New",File:"File",Edit:"Edit",Tools:"Tools",Add:"Add",noActions:"There are no actions for the current selection.",NoFile:"Use the ${0} to create new files and folders. Click a file to start coding.",LocalEditorSettings:"Local Editor Settings",NoProject:"${0} is not a project. To convert it to a project use ${1}.",NoProjects:"There are no projects in your workspace. Use the ${0} menu to create projects.",disconnected:"(disconnected)",ChooseFS:"Choose Filesystem",ChooseFSTooltip:"Choose the filesystem you want to view.",FSTitle:"${0} (${1})",Deploy:"Deploy","Deploy As":"Deploy As",Import:"Import",Export:"Export",OpenWith:"Open With",OpenRelated:"Open Related",Dependency:"Dependency",UnnamedCommand:"Unnamed"}),define("orion/edit/nls/messages",["orion/i18n!orion/edit/nls/messages","orion/edit/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/util",[],function(){function e(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function t(e,t){return e.createElementNS?e.createElementNS(y,t):e.createElement(t)}var n=navigator.userAgent,i=-1!==n.indexOf("MSIE")||-1!==n.indexOf("Trident")?document.documentMode:void 0,r=parseFloat(n.split("Firefox/")[1]||n.split("Minefield/")[1])||void 0,o=-1!==n.indexOf("Opera")?parseFloat(n.split("Version/")[1]):void 0,s=parseFloat(n.split("Chrome/")[1])||void 0,a=-1!==n.indexOf("Safari")&&!s,l=parseFloat(n.split("WebKit/")[1])||void 0,d=-1!==n.indexOf("Android"),c=-1!==n.indexOf("iPad"),h=-1!==n.indexOf("iPhone"),u=c||h,p=-1!==navigator.platform.indexOf("Mac"),f=-1!==navigator.platform.indexOf("Win"),g=-1!==navigator.platform.indexOf("Linux"),m="undefined"!=typeof document&&"ontouchstart"in document.createElement("input"),v=f?"\r\n":"\n",y="http://www.w3.org/1999/xhtml";return{formatMessage:e,createElement:t,isIE:i,isFirefox:r,isOpera:o,isChrome:s,isSafari:a,isWebkit:l,isAndroid:d,isIPad:c,isIPhone:h,isIOS:u,isMac:p,isWindows:f,isLinux:g,isTouch:m,platformDelimiter:v}}),define("orion/webui/littlelib",["orion/util"],function(e){function t(e,t){return t||(t=document),t.querySelector(e)}function n(e,t){return t||(t=document),t.querySelectorAll(e)}function i(e,t){return Array.prototype.slice.call(n(e,t))}function r(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}function o(e,t){if(!e||!t)return!1;if(e===t)return!0;var n=e.compareDocumentPosition(t);return Boolean(16&n)}function s(e){var t=e.getBoundingClientRect();return{left:t.left+document.documentElement.scrollLeft,top:t.top+document.documentElement.scrollTop,width:t.width,height:t.height}}function a(e){for(;e.hasChildNodes();){var t=e.firstChild;e.removeChild(t)}}function l(t){var n=t.tabIndex;if(0===n&&e.isIE){var i={a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0};i[t.nodeName.toLowerCase()]||t.attributes.tabIndex||(n=-1)}return n}function d(e){if(l(e)>=0)return e;if(e.hasChildNodes())for(var t=0;t<e.childNodes.length;t++){var n=d(e.childNodes[t]);if(n)return n}return null}function c(e){if(l(e)>=0)return e;if(e.hasChildNodes())for(var t=e.childNodes.length-1;t>=0;t--){var n=c(e.childNodes[t]);if(n)return n}return null}function h(e,t){if(3===e.nodeType){var n=y.exec(e.nodeValue);n&&n.length>1&&t(e,n)}if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)h(e.childNodes[i],t)}function u(e,t){h(e,function(e,n){var i=t[n[1]]||n[1];e.parentNode.replaceChild(document.createTextNode(i),e)})}function p(e,t){h(e,function(e,n){var i=t[n[1]];if(i){var r=document.createRange(),o=n.index;r.setStart(e,o),r.setEnd(e,o+n[0].length),r.deleteContents(),r.insertNode(i)}})}function f(t,n){function i(e){_.forEach(function(t){var n=!1,i=t.excludeNodes.some(function(t){return document.body.contains(t)?(n=!0,t.contains(e.target)):!1});if(n&&!i)try{t.dismiss(e)}catch(r){"undefined"!=typeof console&&console&&console.error(r&&r.message)}}),_=_.filter(function(e){return e.excludeNodes.some(function(e){return document.body.contains(e)})})}null===_&&(_=[],document.addEventListener("click",i,!0),e.isIOS&&document.addEventListener("touchend",function(e){function t(){e.target.removeEventListener("click",t)}0===e.touches.length&&e.target.addEventListener("click",t)},!1)),_.push({excludeNodes:t,dismiss:n})}function g(e){_=_.filter(function(t){return e!==t.dismiss})}function m(e){window.document.all&&(e.keyCode=0),e.preventDefault&&(e.preventDefault(),e.stopPropagation())}function v(e){for(var t=document.getElementsByTagName("iframe"),n=0;n<t.length;n++)t[n].parentNode.style.pointerEvents=e?"":"none"}var y=/\$\{([^\}]+)\}/,_=null,C={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46};return{$:t,$$:n,$$array:i,node:r,contains:o,bounds:s,empty:a,firstTabbable:d,lastTabbable:c,stop:m,processTextNodes:u,processDOMNodes:p,addAutoDismiss:f,setFramesEnabled:v,removeAutoDismiss:g,KEY:C}}),define("orion/webui/dropdown",["require","orion/webui/littlelib","orion/EventTarget"],function(e,t,n){function i(e){n.attach(this),this._init(e)}function r(e,t){t=void 0===t?"span":t;var n=document.createElement(t);n.tabIndex=0,n.className="dropdownMenuItem",n.role="menuitem";var i=document.createElement("span");i.appendChild(document.createTextNode(e)),i.classList.add("dropdownCommandName"),n.appendChild(i);var r=document.createElement("li");return r.appendChild(n),r}function o(){var e=document.createElement("li");return e.classList.add("dropdownSeparator"),e}function s(e,t){var n=document.createElement("span");n.classList.add("dropdownKeyBinding"),n.appendChild(document.createTextNode(t)),e.appendChild(n)}return i.prototype={_init:function(e){if(this._dropdownNode=t.node(e.dropdown),!this._dropdownNode)throw"no dom node for dropdown found";if(this._populate=e.populate,this._selectionClass=e.selectionClass,this._parentDropdown=e.parentDropdown,this._positioningNode=e.positioningNode,!this._parentDropdown)for(var n=this._dropdownNode.parentNode;n&&document!==n;){if(n.classList&&n.classList.contains("dropdownMenu")){this._parentDropdown=n.dropdown;break}n=n.parentNode}if(this._dropdownNode.tabIndex=0,this._triggerNode=e.triggerNode?e.triggerNode:t.$(".dropdownTrigger",this._dropdownNode.parentNode),!this._triggerNode)throw"no dom node for dropdown trigger found";if(!e.skipTriggerEventListeners){var i=this;this._triggerNode.addEventListener("click",function(e){i.toggle(e)&&t.stop(e)},!1),"span"===this._triggerNode.tagName.toLowerCase()&&this._triggerNode.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&(i.toggle(),t.stop(e))},!1)}this._dropdownNode.addEventListener("keydown",this._dropdownKeyDown.bind(this),!1)},addTriggerNode:function(e){var n=this;e.addEventListener("click",function(e){n.toggle(e)&&t.stop(e)},!1)},toggle:function(e){return this.isVisible()?this.close():this.open(e)},isVisible:function(){return this._isVisible},open:function(e){var n=!1;if(!this.isVisible()){this.dispatchEvent({type:"triggered",dropdown:this,event:e}),t.setFramesEnabled(!1),this._populate&&(this.empty(),this._populate(this._dropdownNode));var i=this.getItems();if(i.length>0){if(!this._hookedAutoDismiss){this._boundAutoDismiss?t.removeAutoDismiss(this._boundAutoDismiss):this._boundAutoDismiss=this._autoDismiss.bind(this);var r=t.$$array(".dropdownSubMenu",this._dropdownNode);t.addAutoDismiss([this._triggerNode].concat(r),this._boundAutoDismiss),this._hookedAutoDismiss=!0}this._triggerNode.classList.add("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.add(this._selectionClass),this._dropdownNode.classList.add("dropdownMenuOpen"),this._isVisible=!0,this._positionDropdown(e),this._focusDropdownNode(),n=!0,this._parentDropdown&&this._parentDropdown.submenuOpen(this)}}return n},_focusDropdownNode:function(){this._dropdownNode.focus()},_autoDismiss:function(e){if(this.close(!1)&&this._dropdownNode.contains(e.target))for(var t=this._parentDropdown;t;)t.close(!1),t=t._parentDropdown},_positionDropdown:function(){if(this._dropdownNode.style.left="",this._dropdownNode.style.top="",this._positioningNode)return void(this._dropdownNode.style.left=this._positioningNode.offsetLeft+"px");var e=t.bounds(this._dropdownNode),n=t.bounds(document.body);if(e.left+e.width>n.left+n.width)if(this._triggerNode.classList.contains("dropdownMenuItem"))this._dropdownNode.style.left=-e.width+"px";else{var i=t.bounds(this._boundingNode(this._triggerNode)),r=t.bounds(this._triggerNode);this._dropdownNode.style.left=r.left-i.left-e.width+r.width+"px"}var o=e.top+e.height-(n.top+n.height);o>0&&(this._dropdownNode.style.top=Math.floor(this._dropdownNode.style.top-o)+"px")},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var n=t.getPropertyValue("position");return"absolute"!==n&&e.parentNode&&e!==document.body?this._boundingNode(e.parentNode):e},close:function(e){var n=!1;return this.isVisible()&&(this._triggerNode.classList.remove("dropdownTriggerOpen"),this._selectionClass&&this._triggerNode.classList.remove(this._selectionClass),this._dropdownNode.classList.remove("dropdownMenuOpen"),t.setFramesEnabled(!0),e&&this._triggerNode.focus(),this._isVisible=!1,this._selectedItem&&(this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=null),n=!0),n},getItems:function(){var e=t.$$array("li:not(.dropdownSeparator) > .dropdownMenuItem",this._dropdownNode,!0),n=[],i=this;return e.forEach(function(e){e.parentNode.parentNode===i._dropdownNode&&n.push(e)}),n.forEach(function(e){e._hasDropdownMouseover||(e.addEventListener("mouseover",function(n){e.dropdown?e.dropdown.open(n):(i._closeSelectedSubmenu(),t.stop(n)),i._selectItem(e)}),e._hasDropdownMouseover=!0)}),n},empty:function(){var e=t.$$array("li",this._dropdownNode),n=this;e.forEach(function(e){e.parentNode===n._dropdownNode&&e.parentNode.removeChild(e)}),this._hookedAutoDismiss=!1},_dropdownKeyDown:function(e){if(e.keyCode===t.KEY.UP||e.keyCode===t.KEY.DOWN||e.keyCode===t.KEY.RIGHT||e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.LEFT){var n=this.getItems();if(n.length&&n.length>0){if(this._selectedItem){var i=n.indexOf(this._selectedItem);0>i&&(i=n.indexOf(this._selectedItem.parentNode)),i>=0&&(e.keyCode===t.KEY.UP&&i>0?(i--,this._selectItem(n[i])):e.keyCode===t.KEY.DOWN&&i<n.length-1?(i++,this._selectItem(n[i])):e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.RIGHT?this._selectedItem.classList.contains("dropdownTrigger")&&this._selectedItem.dropdown?(this._selectedItem.dropdown.open(),this._selectedItem.dropdown._selectItem()):e.keyCode===t.KEY.ENTER&&this._selectedItem.click():e.keyCode===t.KEY.LEFT&&this._selectedItem.parentNode.parentNode.classList.contains("dropdownMenuOpen")&&(this.close(!0),this._parentDropdown&&this._parentDropdown._dropdownNode.focus()))}else this._selectItem(n[0]);t.stop(e)}}else e.keyCode===t.KEY.ESCAPE&&(this.close(!0),t.stop(e))},_selectItem:function(e){var t=e||this.getItems()[0];t&&(this._selectedItem&&this._selectedItem.classList.remove("dropdownMenuItemSelected"),this._selectedItem=t,this._selectedItem.classList.add("dropdownMenuItemSelected")),document.activeElement!==this._dropdownNode&&this._dropdownNode.focus()},submenuOpen:function(e){e!==this._selectedSubmenu&&(this._closeSelectedSubmenu(),this._selectedSubmenu=e)},_closeSelectedSubmenu:function(){for(var e=this._selectedSubmenu;e;)e.close(),e=e._selectedSubmenu},destroy:function(){this.empty(),this._boundAutoDismiss&&t.removeAutoDismiss(this._boundAutoDismiss)},appendMenuItem:function(e,t){var n=r(e,t);return this._dropdownNode.appendChild(n),n},appendSeparator:function(){var e=o();return this._dropdownNode.appendChild(e),e}},i.prototype.constructor=i,{Dropdown:i,appendKeyBindingString:s,createMenuItem:r,createSeparator:o}}),define("text",["module"],function(e){var t,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,a=s&&location.protocol&&location.protocol.replace(/\:/,""),l=s&&location.hostname,d=s&&(location.port||void 0),c=[],h=e.config&&e.config()||{};return t={version:"2.0.5",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:h.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(r){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,o=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(r="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var o,s,a,l=t.xdRegExp.exec(e);return l?(o=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,h.isBuild&&(c[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return void i();h.isBuild=r.isBuild;var o=t.parseName(e),c=o.moduleName+(o.ext?"."+o.ext:""),u=n.toUrl(c),p=h.useXhr||t.useXhr;!s||p(u,a,l,d)?t.get(u,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)})},write:function(e,n,i){if(c.hasOwnProperty(n)){var r=t.jsEscape(c[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,o){var s=t.parseName(n),a=s.ext?"."+s.ext:"",l=s.moduleName+a,d=i.toUrl(s.moduleName+a)+".js";t.load(l,i,function(){var n=function(e){return r(d,e)};n.asModule=function(e,t){return r.asModule(e,d,t)},t.write(e,l,n,o)},o)}},"node"===h.env||!h.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("﻿")&&(i=i.substring(1)),t(i)}):"xhr"===h.env||!h.env&&t.createXhr()?t.get=function(e,n,i,r){var o,s=t.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);h.onXhr&&h.onXhr(s,e),s.onreadystatechange=function(){var t,r;
4===s.readyState&&(t=s.status,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=s,i(r)):n(s.responseText))},s.send(null)}:("rhino"===h.env||!h.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(t.get=function(e,t){var n,i,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);l=String(n.toString())}finally{a.close()}t(l)}),t}),define("text!orion/webui/dropdowntriggerbutton.html",[],function(){return'<button class="dropdownTrigger">${ButtonText}<!--span class="dropdownArrowDown core-sprite-openarrow"></span--></button><ul class="dropdownMenu"></ul>'}),define("text!orion/webui/dropdowntriggerbuttonwitharrow.html",[],function(){return'<button class="dropdownTrigger dropdownDefaultButton">${ButtonText}<span class="dropdownArrowDown core-sprite-openarrow"></span></button><ul class="dropdownMenu"></ul>'}),define("text!orion/webui/submenutriggerbutton.html",[],function(){return'<li class="dropdownSubMenu"><span class="dropdownTrigger dropdownMenuItem" role="menuitem" tabindex="0"><span class="dropdownCommandName">${ButtonText}</span><span class="dropdownArrowRight core-sprite-closedarrow"></span></span><ul class="dropdownMenu"></ul></li>'}),define("text!orion/webui/checkedmenuitem.html",[],function(){return'<li><label class="dropdownMenuItem"><input class="checkedMenuItem" role="menuitem" type="checkbox" />${ItemText}</label></li>'}),define("orion/webui/tooltip",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){if(this._node=t.node(e.node),!this._node)throw"no dom node for tooltip found";this._position=e.position||["right","above","below","left"],this._text=e.text,this._hideDelay=void 0===e.hideDelay?200:e.hideDelay,this._tailSize=e.tailSize||10,this._trigger=e.trigger||"mouseover",this._afterShowing=e.afterShowing,this._afterHiding=e.afterHiding;var n=this;if("click"===this._trigger)this._showDelay=0,this._node.addEventListener("click",this._clickHandler=function(e){e.target===n._node&&(n.show(),t.stop(e))},!1);else if("mouseover"===this._trigger){this._showDelay=void 0===e.showDelay?500:e.showDelay;var i=["mouseout","click"];this._node.addEventListener("mouseover",this._mouseoverHandler=function(e){t.contains(n._node,e.target)&&(n.show(),t.stop(e))},!1),this._leaveHandler=function(e){t.contains(n._node,e.target)&&n.hide()};for(var r=0;r<i.length;r++)this._node.addEventListener(i[r],this._leaveHandler,!1)}},_makeTipNode:function(){if(!this._tip){if(this._tip=document.createElement("span"),this._tip.classList.add("tooltipContainer"),this._tipInner=document.createElement("div"),this._tipInner.classList.add("tooltip"),this._text){this._tipTextContent=document.createElement("div"),this._tipTextContent.classList.add("textContent"),this._tipInner.appendChild(this._tipTextContent);var e=document.createTextNode(this._text);this._tipTextContent.appendChild(e)}this._tip.appendChild(this._tipInner),document.body.appendChild(this._tip);var n=this;t.addAutoDismiss([this._tip,this._node],function(){n.hide()}),"mouseover"===this._trigger&&(this._tipInner.role="tooltip",this._tipInner.id="tooltip"+(new Date).getTime().toString(),this._node.setAttribute("aria-describedby",this._tipInner.id),this._tip.addEventListener("mouseover",function(){n._timeout&&(window.clearTimeout(n._timeout),n._timeout=null),n._tip.addEventListener("mouseout",function(e){t.contains(n._tip,e.target)&&(n.hide(),t.stop(e))},!1)},!1))}return this._tip},_positionTip:function(e,n){this._makeTipNode(),"left"===e?this._tipInner.classList.add("left"):this._tipInner.classList.remove("left");var i,r=this._node;for(i=t.bounds(r);r&&!i.width&&!i.height;r=r.parentNode)i=t.bounds(r);var o,s,a=t.bounds(this._tipInner);switch(e){case"above":o=i.top-a.height-this._tailSize-1,s=i.left-this._tailSize;break;case"below":o=i.top+i.height+this._tailSize+1,s=i.left-this._tailSize;break;case"left":o=i.top-this._tailSize/2,s=i.left-a.width-this._tailSize-1;break;default:o=i.top-this._tailSize/2,s=i.left+i.width+this._tailSize+1}var l=t.bounds(document.documentElement);if(o+a.height>l.height){if(!n)return!1;o=l.height-a.height-1}if(s+a.width>l.width){if(!n)return!1;s=l.width-a.width-1}if(0>s){if(!n)return!1;s=4}if(0>o){if(!n)return!1;o=4}return this._tail&&this._tail.previousPosition!==e&&(this._tip.removeChild(this._tail),this._tail=null),this._tail||(this._tail=document.createElement("span"),this._tail.classList.add("tooltipTailFrom"+e),"above"===e||"left"===e?this._tip.appendChild(this._tail):this._tip.insertBefore(this._tail,this._tipInner),this._tail.previousPosition=e),this._tip.style.top=o+"px",this._tip.style.left=s+"px",!0},contentContainer:function(){return this._makeTipNode(),this._tipInner},show:function(){this._tip&&this._tip.classList.contains("tooltipShowing")||(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._showDelay?this._timeout=window.setTimeout(this._showImmediately.bind(this),this._showDelay):this._showImmediately())},_showImmediately:function(){for(var e=!1,t=0;!e&&t<this._position.length;)e=this._positionTip(this._position[t]),t++;e||this._positionTip(this._position[0],!0),this._tip.classList.add("tooltipShowing"),this._afterShowing&&this._afterShowing()},hide:function(e){if(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._tip&&this._tip.classList.contains("tooltipShowing")){void 0===e&&(e=this._hideDelay);var t=this;this._timeout=window.setTimeout(function(){t._tip.classList.remove("tooltipShowing"),t._tip.removeAttribute("style"),t._afterHiding&&t._afterHiding()},e)}},destroy:function(){if(this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),this._tip&&(document.body.removeChild(this._tip),this._tip=null,this._tipInner=null,this._tipTextContent=null,this._tail=null),this._node){this._node.removeEventListener("click",this._clickHandler,!1),this._node.removeEventListener("mouseover",this._mouseoverHandler,!1);for(var e=["mouseout","click"],t=0;t<e.length;t++)this._node.removeEventListener(e[t],this._leaveHandler,!1)}}},n.prototype.constructor=n,{Tooltip:n}}),define("orion/commands",["orion/util","orion/webui/littlelib","orion/webui/dropdown","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/dropdowntriggerbuttonwitharrow.html","text!orion/webui/submenutriggerbutton.html","text!orion/webui/checkedmenuitem.html","orion/webui/tooltip"],function(e,t,n,i,r,o,s,a){function l(e){x=e}function d(e){var t=e.invocation;if(t){var n=e.command;if(n.hrefCallback){var i=n.hrefCallback.call(t.handler||window,t);return i.then?i.then(function(e){window.open(e)}):window.open(i),!0}if(t.commandRegistry)return t.commandRegistry._invoke(t),!0;if(n.onClick||n.callback)return window.setTimeout(function(){(n.onClick||n.callback).call(t.handler||window,t)},0),!0}return!1}function c(e,n){for(var i in n)if(n[i]&&n[i].keyBinding&&n[i].command&&n[i].keyBinding.match(e)){var r=n[i],o=r.keyBinding;if((!o.domScope||t.contains(t.node(o.domScope),e.target))&&d(r))return void t.stop(e)}}function h(){var e={};if(x){var t,n,i;for(n=Object.keys(S),t=0;t<n.length;t++)i=n[t],e[i]=S[i];var r=x();for(n=Object.keys(r),t=0;t<n.length;t++)i=n[t],e[i]=r[i]}else e=S;return e}function u(e){c(e,h())}function p(t,n){function i(t){if(e.isMac){if(t.metaKey&&!t.altKey)return t.shiftKey||t.ctrlKey||65!==t.keyCode&&67!==t.keyCode&&86!==t.keyCode&&88!==t.keyCode&&90!==t.keyCode?!1:!0;if(t.ctrlKey)return!1}else{if(t.ctrlKey&&!t.altKey)return t.shiftKey||65!==t.keyCode&&67!==t.keyCode&&86!==t.keyCode&&88!==t.keyCode&&90!==t.keyCode?!1:!0;if(t.altKey&&!t.ctrlKey)return!1}if(t["char"])return t["char"].length>0;if(t.charCode||t.keyCode){var n=t.charCode||t.keyCode;switch(n){case 8:case 9:case 13:case 46:return!0;default:return n>=32&&112>n||n>123}}return!1}if(t=t||window.event,i(t)){if("true"===t.target.contentEditable)return;var r=t.target.nodeName.toLowerCase();if("input"===r){var o=t.target.type.toLowerCase();switch(o){case"text":case"password":case"search":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"range":case"tel":case"time":case"url":case"week":return}}else if("textarea"===r)return}n?n(t):u(t)}function f(){this._init()}function g(e,t,n){t.classList.add("commandImage");var i;return e.imageClass?e.addImageClassToElement?t.classList.add(e.imageClass):(i=document.createElement("span"),t.appendChild(i),i.classList.add(e.spriteClass),i.classList.add(e.imageClass)):(i=new Image,i.alt=e.name,i.name=n,i.id=n,i.src=e.image,t.appendChild(i)),i}function m(e,o,s,a,l,d,c,h,u){if(e=t.node(e),!e)throw"no parent node was specified";var p=document.createRange();p.selectNode(e);var f=p.createContextualFragment(u?r:i);t.processTextNodes(f,{ButtonText:o}),e.appendChild(f);var m,v,y=e.lastChild;return u?(m=y.previousSibling,v=m.lastChild):m=y.previousSibling,a?m.classList.add(a):(m.classList.add("orionButton"),m.classList.add("commandButton")),l&&(d||(m.textContent="",m.setAttribute("aria-label",o)),g({spriteClass:"commandSprite",imageClass:l},m,o),m.classList.add("orionButton")),m.dropdown=new n.Dropdown({dropdown:y,populate:s,selectionClass:c,skipTriggerEventListeners:!!v,positioningNode:h}),y.dropdown=m.dropdown,{menuButton:m,menu:y,dropdown:m.dropdown,dropdownArrow:v}}function v(e,n,i,r){if(e=t.node(e),!e)throw"no parent node was specified";var o=document.createRange();o.selectNode(e);var a=o.createContextualFragment(s);t.processTextNodes(a,{ItemText:n}),e.appendChild(a);var l=e.lastChild,d=t.$(".checkedMenuItem",l);return d.checked=i,d.addEventListener("change",r,!1),d}function y(e,t,n,i,r,o,s){var l;if(o=o||!t.name&&t.hasImage(),t.hrefCallback){l=document.createElement("a"),l.id=i,o&&t.hasImage()?g(t,l,i):(l.className="commandLink",l.appendChild(document.createTextNode(t.name)));var d=t.hrefCallback.call(n.handler,n);d.then?d.then(function(e){l.href=e}):l.href=d?d:"#"}else{if(l=document.createElement("button"),l.className="orionButton",o)t.hasImage()?(g(t,l,i),t.name&&l.setAttribute("aria-label",t.name)):(l.classList.add("commandButton"),l.classList.add("commandMissingImageButton"),l.appendChild(document.createTextNode(t.name)));else{l.classList.add("commandButton");var c=document.createTextNode(t.name);l.appendChild(c)}var h=s||t.callback;h&&(t.onClick=h,l.addEventListener("click",function(){h.call(n.handler,n)},!1))}if("ul"===e.nodeName.toLowerCase()){var u=document.createElement("li");e.appendChild(u),e=u}else l.classList.add("commandMargins");return e.appendChild(l),t.tooltip&&(l.commandTooltip=new a.Tooltip({node:l,text:t.tooltip,position:["above","below","right","left"]})),r&&(S[t.id]={keyBinding:r,command:t,invocation:n}),l}function _(e,i,r,o,s,l){var d,c,h=e.dropdown;if(i.hrefCallback){c=n.createMenuItem(i.name,"a"),d=c.firstElementChild;var u=i.hrefCallback.call(r.handler,r);u.then?u.then(function(e){d.href=e}):d.href=u?u:"#",d.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&d.click()},!1)}else{c=n.createMenuItem(i.name),d=c.firstElementChild;var p=s||i.callback;p&&(i.onClick=p,d.addEventListener("click",function(){h.close(!0),p.call(r.handler,r)},!1),d.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&(e.preventDefault(),d.click())},!1))}return i.tooltip&&(d.commandTooltip=new a.Tooltip({node:d,text:i.tooltip,position:["above","below","right","left"]})),l&&n.appendKeyBindingString(d,l),e.appendChild(c),o&&(S[i.id]={keyBinding:o,command:i,invocation:r}),d}function C(e,t,n,i,r){this.commandRegistry=r,this.handler=e,this.items=t,this.userData=n,this.command=i,i.parameters&&(this.parameters=i.parameters.makeCopy()),this.id=i.id}function w(e){this._init(e)}var b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAAtJREFUCNdjIBEAAAAwAAFletZ8AAAAAElFTkSuQmCC",x=null,S={};return f.prototype={setProxy:function(e){this.proxy=e},setKeyBindings:function(e){this.bindings=e},_init:function(){var e=this;document.addEventListener("keydown",function(n){return p(n,function(n){var i=e.proxy,r=e.bindings;if(r&&i)for(var o=0;o<r.length;o++)r[o].match(n)&&(i.processKey({type:n.type,keyCode:n.keyCode,altKey:n.altKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey}),t.stop(n))})})}},window.document.addEventListener("keydown",p,!1),C.prototype={collectsParameters:function(){return this.commandRegistry&&this.commandRegistry.collectsParameters()},makeCopy:function(e){var t=new C(this.handler,this.items,this.userData,this.command,this.commandRegistry);return t.domNode=this.domNode,t.domParent=this.domParent,e?t.parameters=e.makeCopy():this.parameters&&(t.parameters=this.parameters.makeCopy()),t}},C.prototype.constructor=C,w.prototype={_init:function(e){this.id=e.id,this.name=e.name,this.tooltip=e.tooltip,this.callback=e.callback,this.hrefCallback=e.hrefCallback,this.choiceCallback=e.choiceCallback,this.positioningNode=e.positioningNode,this.image=e.image||b,this.imageClass=e.imageClass,this.addImageClassToElement=e.addImageClassToElement,this.selectionClass=e.selectionClass,this.spriteClass=e.spriteClass||"commandSprite",this.visibleWhen=e.visibleWhen,this.parameters=e.parameters,this.isEditor=e.isEditor},populateChoicesMenu:function(e,n,i,r,o){var s=this.getChoices(n,i,r),a=s.some(function(e){return e.checked});s.forEach(function(i){if(i.name){var r=document.createElement("li");e.appendChild(r);var s=document.createElement("span");if(s.tabIndex=0,s.role="menuitem",s.classList.add("dropdownMenuItem"),a){var l=document.createElement("span");l.classList.add("check"),l.appendChild(document.createTextNode(i.checked?"●":"")),s.appendChild(l)}var d=document.createTextNode(i.name);s.appendChild(d),r.appendChild(s),s.choice=i,s.addEventListener("click",function(e){e.target.choice&&e.target.choice.callback.call(e.target.choice,n)},!1),s.addEventListener("keydown",function(e){(e.keyCode===t.KEY.ENTER||e.keyCode===t.KEY.SPACE)&&e.target.choice&&e.target.choice.callback.call(e.target.choice,n)},!1)}else o._generateMenuSeparator(e)})},getChoices:function(e,t,n){return this.choiceCallback?this.choiceCallback.call(t,e,n):null},makeChoiceCallback:function(e,t){return function(n){e.callback&&e.callback.call(e,t,n)}},hasImage:function(){return this.imageClass||this.image!==b}},w.prototype.constructor=w,{Command:w,CommandInvocation:C,createDropdownMenu:m,createCheckedMenuItem:v,createCommandItem:y,createCommandMenuItem:_,executeBinding:d,setKeyBindingProvider:l,localKeyBindings:S,CommandsProxy:f,getKeyBindings:h,processKey:u,NO_IMAGE:b,_testMethodProcessKey:c}}),define("orion/nls/root/messages",{Navigator:"Navigator",Sites:"Sites",Shell:"Shell",ShellLinkWorkspace:"Workspace Shell","Get Plugins":"Get Plugins",Global:"Global",Editor:"Editor",EditorRelatedLink:"Show Current Folder",EditorRelatedLinkParent:"Show Enclosing Folder",EditorLinkWorkspace:"Show Workspace",EditorRelatedLinkProj:"Show Project","Filter bindings":"Filter bindings","Orion Editor":"Orion Editor","Orion Image Viewer":"Orion Image Viewer","Orion Markdown Editor":"Orion Markdown Editor","Orion Markdown Viewer":"Orion Markdown Viewer","Orion JSON Editor":"Orion JSON Editor","View on Site":"View on Site","View this file or folder on a web site hosted by Orion":"View this file or folder on a web site hosted by Orion.","Show a list of all the keybindings on this page":"Show a list of all the keybindings on this page","Show Keys":"Show Keys","Hide or show the page banner and footer":"Hide or show the page banner and footer","Toggle banner and footer":"Toggle banner and footer","Choose a file by name and open an editor on it":"Choose a file by name and open an editor on it","Find File Named...":"Find File Named...","System Configuration Details":"System Configuration Details","System Config Tooltip":"Go to the System Configuration Details page","Background Operations":"Background Operations","Background Operations Tooltip":"Go to the Background Operations page","Operation status is unknown":"Operation status is unknown","Unknown item":"Unknown item","Can't search: no search service is available":"Can't search: no search service is available","could not find banner parent, id was ":"could not find banner parent, id was ",Related:"Related",Options:"Options",FAQ:"FAQ","Report a Bug":"Bugs","Privacy Policy":"Privacy","Terms of Use":"Terms","Copyright Agent":"Copyright","Orion Logo":"Orion Logo","Orion is in Beta. Please try it out but BEWARE your data may be lost.":"@buildLabel@","LOG: ":"LOG: ",View:"View","no parent":"no parent","no tree model":"no tree model","no renderer":"no renderer","could not find table row ":"could not find table row ","Resource is out of sync with the server. Do you want to save it anyway?":"Resource is out of sync with the server. Do you want to save it anyway?",Operations:"Operations","Operations running":"Operations running","Some operations finished with warning":"Some operations finished with warning","Some operations finished with error":"Some operations finished with error","no service registry":"no service registry",Tasks:"Tasks",Close:"Close","Expand all":"Expand all","Collapse all":"Collapse all",Search:"Search","Advanced search":"Advanced search",Submit:"Submit",More:"More","Recent searches":"Recent searches","Regular expression":"Regular expression","Search options":"Search options","Global search":"Global search","Orion Home":"Orion Home","Close notification":"Close notification","Operations - Press spacebar to show current operations":"Operations - Press spacebar to show current operations","Type a keyword or wild card to search in root":"Type a keyword or wild card to search in root","Toggle side panel":"Toggle side panel","Open or close the side panel":"Open or close the side panel",Projects:"Projects","Toggle Sidebar":"Toggle Sidebar","Sample HTML5 Site":"Sample HTML5 Site","Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.":"Generate an HTML5 'Hello World' website, including JavaScript, HTML, and CSS files.","Sample Orion Plugin":"Sample Orion Plugin","Generate a sample plugin for integrating with Orion.":"Generate a sample plugin for integrating with Orion.",Browser:"Web Browser",OutlineProgress:"Getting outline for ${0} from ${1}",UnknownError:"An unknown error occurred.",UnknownWarning:"An unknown warning occurred.",Filter:"Filter (* = any string, ? = any character)","To view the browser's context menu, trigger the context menu again.":"To view the browser's context menu, trigger the context menu again.",Edit:"Edit",CentralNavTooltip:"Toggle Navigation Menu"}),define("orion/nls/messages",["orion/i18n!orion/nls/messages","orion/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/uiUtils",["orion/webui/littlelib"],function(e){function t(t){var n="",i=-1!==navigator.platform.indexOf("Mac");if(i?(t.mod4&&(n+="⌃"),t.mod3&&(n+="⌥"),t.mod2&&(n+="⇧"),t.mod1&&(n+="⌘")):(t.mod1&&(n+="Ctrl+"),t.mod2&&(n+="Shift+"),t.mod3&&(n+="Alt+")),t.alphaKey)return n+t.alphaKey;if("keypress"===t.type)return n+t.keyCode;for(var r in e.KEY)if(e.KEY[r]===t.keyCode){if(i)switch(e.KEY[r]){case e.KEY.BKSPC:r="⌫";break;case e.KEY.TAB:r="⇥";break;case e.KEY.ENTER:r="⏎";break;case e.KEY.ESCAPE:r="⎋";break;case e.KEY.SPACE:r="␣";break;case e.KEY.PAGEUP:r="⇞";break;case e.KEY.PAGEDOWN:r="⇟";break;case e.KEY.END:r="⇲";break;case e.KEY.HOME:r="⇱";break;case e.KEY.DEL:r="⌦"}switch(e.KEY[r]){case e.KEY.DOWN:r="↓";break;case e.KEY.UP:r="↑";break;case e.KEY.RIGHT:r="→";break;case e.KEY.LEFT:r="←"}return n+r}var o;switch(t.keyCode){case 59:o=t.mod2?":":";";break;case 61:o=t.mod2?"+":"=";break;case 188:o=t.mod2?"<":",";break;case 190:o=t.mod2?">":".";break;case 191:o=t.mod2?"?":"/";break;case 192:o=t.mod2?"~":"`";break;case 219:o=t.mod2?"{":"[";break;case 220:o=t.mod2?"|":"\\";break;case 221:o=t.mod2?"}":"]";break;case 222:o=t.mod2?'"':"'"}return o?n+o:t.keyCode>=112&&t.keyCode<=123?n+"F"+(t.keyCode-111):n+String.fromCharCode(t.keyCode)}function n(e){for(var n="",i=e.getKeys(),r=0;r<i.length;r++)0!==r&&(n+=" "),n+=t(i[r]);return n}function i(t){var n=t.id,i=t.refNode,r=t.hideRefNode,o=t.initialText,s=t.onComplete,a=t.onEditDestroy,l=t.selectTo,d=t.isInitialValid,c=t.insertAsChild,h=!1,u=function(t){return function(l){if(!h){var c=e.node(n),u=c.value;if(c)return t&&l.keyCode===e.KEY.ESCAPE?(r&&(i.style.display="inline"),h=!0,c.parentNode.removeChild(c),void(a&&a())):void(t&&l.keyCode!==e.KEY.ENTER||(0===u.length||!d&&u===o?(r&&(i.style.display="inline"),h=!0):(s(u),r&&i.parentNode&&(i.style.display="inline"),h=!0),c.parentNode&&c.parentNode.removeChild(c),a&&a()))}}},p=document.createElement("input");p.id=n,p.value=o||"",c?i.appendChild(p):i.parentNode.insertBefore(p,i.nextSibling),p.classList.add("userEditBoxPrompt"),r&&(i.style.display="none"),p.addEventListener("keydown",u(!0),!1),p.addEventListener("blur",u(!1),!1),window.setTimeout(function(){if(p.focus(),o){var t=e.node(n),i=l?o.indexOf(l):-1;if(i>0)if(t.createTextRange){var r=t.createTextRange();r.collapse(!0),r.moveStart("character",0),r.moveEnd("character",i),r.select()}else t.setSelectionRange?t.setSelectionRange(0,i):void 0!==t.selectionStart&&(t.selectionStart=0,t.selectionEnd=i);else t.select()}},0)}function r(e){var t=-1!==window.navigator.platform.indexOf("Mac");return t&&e.metaKey||!t&&e.ctrlKey}function o(e,t){t&&r(t)?window.open(e):window.location=e}function s(t,n){var i=document.createElement("button");return i.className="orionButton commandButton commandMargins",i.addEventListener("click",function(t){n(),e.stop(t)},!1),t&&i.appendChild(document.createTextNode(t)),i}function a(){}function l(e){switch(e.tagName.toLowerCase()){case"button":case"fieldset":case"form":case"input":case"keygen":case"label":case"legend":case"meter":case"optgroup":case"output":case"progress":case"select":case"textarea":return!0}return!1}return{getUserKeyString:n,getUserText:i,openInNewWindow:r,followLink:o,createButton:s,createDropdownButton:a,isFormElement:l}}),define("orion/selection",["orion/EventTarget","orion/Deferred"],function(e){function t(t,n){n||(n="orion.page.selection"),this._serviceRegistry=t,e.attach(this),this._serviceRegistration=t.registerService(n,this),this._selections=null}return t.prototype={getSelection:function(e){var t=this._getSingleSelection();return"function"==typeof e&&e(t),t},getSelections:function(e){var t=Array.isArray(this._selections)?this._selections.slice():[];return"function"==typeof e&&e(t),t},_getSingleSelection:function(){return this._selections&&this._selections.length>0?this._selections[0]:null},setSelections:function(e){var t=this._selections;this._selections=Array.isArray(e)?e.length>0?e.slice():null:e?[e]:null,t!==this._selections&&this.dispatchEvent({type:"selectionChanged",selection:this._getSingleSelection(),selections:this._selections})}},t.prototype.constructor=t,{Selection:t}}),define("orion/explorers/navigationUtils",[],function(){function e(e,t){r||e&&(e.push({domNode:t}),t.tabIndex=-1,t.style.outline="none")}function t(t,n,i){if(t){var r=t.getGridNavHolder(n,!0);r&&e(r,i)}}function n(e,t){if(e)for(var n=0;n<e.length;n++)if(e[n].domNode===t)return void e.splice(n,1)}var i=navigator.userAgent,r=-1!==i.indexOf("iPad");return{addNavGrid:t,generateNavGrid:e,removeNavGrid:n}}),define("orion/PageUtil",[],function(){function e(){var e=window.location.href.split("#")[1];return e=e?"#"+e:""}function t(e){e=e||window.location.toString();var t={resource:""},n=e.indexOf("#");if(-1!==n){var i=e.substring(n+1);if(0!==i.length){var r=i.split(",");t.resource=decodeURIComponent(r[0]);for(var o=1;o<r.length;o++){var s=r[o],a=/([^=]*)(=?)(.*)/.exec(s),l=decodeURIComponent(a[1]||""),d=decodeURIComponent(a[3]||"");""!==l&&"resource"!==l&&(t[l]=d)}}}return t}function n(e,t){var n=e;if(-1===e.indexOf("://")){var r=document.createElement("a");r.href=e,n=r.href}var o=!1;return o=t?t.some(function(e){return new RegExp("^"+e+":","i").test(n)}):i.test(n),o?e:(console.log("Illegal URL Scheme: '"+e+"'"),"")}var i=new RegExp("^http[s]?","i");return{hash:e,matchResourceParameters:t,validateURLScheme:n}}),define("orion/commandRegistry",["orion/commands","orion/explorers/navigationUtils","orion/PageUtil","orion/uiUtils","orion/webui/littlelib","orion/webui/dropdown","orion/webui/tooltip","text!orion/webui/checkedmenuitem.html","text!orion/webui/dropdowntriggerbutton.html","text!orion/webui/submenutriggerbutton.html"],function(e,t,n,i,r,o,s,a,l,d){function c(e){this._commandList={},this._contributionsByScopeId={},this._activeBindings={},this._urlBindings={},this._pendingBindings={},this._init(e),this._parameterCollector=null}function h(e,t){this.token=e,this.parameterName=t}function u(e,t,n){this.event=e,this.handler=t,this.capture=n||!1}function p(e,t,n,i,r,o){this.name=e,this.type=t,this.label=n,this.value=i,this.lines=r||1,this.eventListeners=Array.isArray(o)?o:o?[o]:[]}function f(e,t,n){this._storeParameters(e),this._hasOptionalParameters=t&&t.hasOptionalParameters,this._options=t,this.optionsRequested=!1,this.getParameters=n,this.clientCollect=t&&t.clientCollect,this.getParameterElement=t&&t.getParameterElement,this.getSubmitName=t&&t.getSubmitName}return c.prototype={_init:function(t){this._selectionService=t.selection;var n=this;e.setKeyBindingProvider(function(){return n._activeBindings})},processURL:function(e){for(var t in this._urlBindings)if(this._urlBindings[t]&&this._urlBindings[t].urlBinding&&this._urlBindings[t].command){var n=this._urlBindings[t].urlBinding.match(e);if(n){var i=this._urlBindings[t],r=i.command,o=i.invocation;if(o&&o.parameters&&r.callback){o.parameters.setValue(n.parameterName,n.parameterValue);var s=this;return void window.setTimeout(function(){s._invoke(o)},0)}}}},findCommand:function(e){return this._commandList[e]},runCommand:function(t,n,i,r,o,s){var a=this;if(n){var l=this._commandList[t],d=l&&(l.visibleWhen?l.visibleWhen(n):!0);if(d&&l.callback){var c=new e.CommandInvocation(i,n,o,l,a);return c.domParent=s,a._invoke(c,r)}}else{var h=this._urlBindings[t];if(h&&h.command&&h.command.callback)return a._invoke(h.invocation,r)}},getSelectionService:function(){return this._selectionService},setParameterCollector:function(e){this._parameterCollector=e},openParameterCollector:function(e,t,n){this._parameterCollector&&(this._parameterCollector.close(),this._parameterCollector.open(e,t,n))},confirm:function(e,t,n,i,r,o){var s=!1;if(this._parameterCollector&&!r){var a=this;this._parameterCollector.close();var l=this._parameterCollector.open(e,function(e,r){var o=document.createElement("span");o.classList.add("parameterPrompt"),o.textContent=t,e.appendChild(o);var l=document.createElement("button");l.addEventListener("click",function(){s=!0,a._parameterCollector.close()},!1),r.appendChild(l),l.appendChild(document.createTextNode(n)),l.className="dismissButton";var d=document.createElement("button");return d.addEventListener("click",function(){s=!1,a._parameterCollector.close()},!1),r.appendChild(d),d.appendChild(document.createTextNode(i)),d.className="dismissButton",l},function(){o(s)});if(l)return}s=window.confirm(t),o(s)},closeParameterCollector:function(){this._parameterCollector&&this._parameterCollector.close()},collectsParameters:function(){return this._parameterCollector},_invoke:function(e,t){return this._collectAndInvoke(e.makeCopy(t),!1)},_collectAndInvoke:function(e,t,n){if(e){if(!(this._parameterCollector&&e.parameters&&e.parameters.hasParameters()&&(t||e.parameters.shouldCollectParameters())))return e.command.callback.call(e.handler||window,e);var i=!1;if(e.parameters.updateParameters(e),e.parameters.shouldCollectParameters()&&(i=this._parameterCollector.collectParameters(e,n),!i)){var r=new s.Tooltip({node:e.domNode,afterHiding:function(){this.destroy()},trigger:"click",position:["below","right","above","left"]}),o=r.contentContainer();o.classList.add("parameterPopup");var a=window.document.activeElement,l=this._parameterCollector.getFillFunction(e,function(){a&&a.focus(),r.destroy()},n)(o);r.show(),window.setTimeout(function(){l.focus(),l.select()},0),i=!0}if(!i)return e.command.callback.call(e.handler||window,e)}else window.console.log("Client attempted to invoke command without an available (rendered) command invocation")},collectParameters:function(e,t){this._collectAndInvoke(e,!0,t)},showKeyBindings:function(t){function n(t){return function(){e.executeBinding(t)}}var r,o,s={},a=[];for(var l in this._activeBindings)o=this._activeBindings[l],o&&o.keyBinding&&o.command&&(o.command.name||o.command.tooltip)&&a.push(o);a.sort(function(e,t){var n=e.command.name||e.command.tooltip,i=t.command.name||t.command.tooltip;return n.localeCompare(i)});for(var d=0;d<a.length;d++)o=a[d],o.keyBinding.scopeName?(s[o.keyBinding.scopeName]||(s[o.keyBinding.scopeName]=[]),s[o.keyBinding.scopeName].push(o)):(r=i.getUserKeyString(o.keyBinding),t.createItem(r,o.command.name||o.command.tooltip,n(o)));for(var c in s)s[c].length&&s[c].length>0&&(t.createHeader(c),s[c].forEach(function(e){r=i.getUserKeyString(e.keyBinding),t.createItem(r,e.command.name||e.command.tooltip,n(e))}))},addCommand:function(e){this._commandList[e.id]=e;var t=this._pendingBindings[e.id];if(t){var n=this;t.forEach(function(t){n._addBinding(e,t.type,t.binding,t.bindingOnly)}),delete this._pendingBindings[e.id]}},addCommandGroup:function(e,t,n,i,r,o,s,a,l,d){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var c=this._contributionsByScopeId[e];r&&(c=this._createEntryForPath(c,r)),c[t]?(i&&(c[t].title=i),n&&(c[t].position=n),s&&(c[t].imageClass=s),a&&(c[t].tooltip=a),l&&(c[t].selectionClass=l),d===!0?c[t].pretendDefaultActionId=!0:c[t].defaultActionId=d,c[t].emptyGroupMessage=o):(c[t]={title:i,position:n,emptyGroupMessage:o,imageClass:s,tooltip:a,selectionClass:l,defaultActionId:d===!0?null:d,pretendDefaultActionId:d===!0,children:{}},c.sortedContributions=null)},_createEntryForPath:function(e,t){if(t){var n=t.split("/");n.forEach(function(t){t.length>1&&(e[t]||(e[t]={position:0,children:{}},e.sortedContributions=null),e=e[t].children)})}return e},registerSelectionService:function(e,t){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={}),this._contributionsByScopeId[e].localSelectionService=t},registerCommandContribution:function(e,t,n,i,r,o,s){this._contributionsByScopeId[e]||(this._contributionsByScopeId[e]={});var a=this._contributionsByScopeId[e];i&&(a=this._createEntryForPath(a,i)),a[t]={position:n};var l;o&&(l=this._commandList[t],l?this._addBinding(l,"key",o,r):this._addPendingBinding(t,"key",o,r)),s&&(l=this._commandList[t],l?this._addBinding(l,"url",s,r):this._addPendingBinding(t,"url",s,r)),a.sortedContributions=null},unregisterCommandContribution:function(e,t,n){if(this._contributionsByScopeId[e]){delete this._commandList[t],delete this._activeBindings[t],delete this._urlBindings[t],delete this._pendingBindings[t];var i=this._contributionsByScopeId[e];if(n){var r=n.split("/");r.forEach(function(e){if(e.length>1){if(!i[e])return;i=i[e].children}})}delete i[t],i.sortedContributions=null}},_addBinding:function(e,t,n,i){if(!e.id)throw new Error("No command id: "+e);"key"===t?this._activeBindings[e.id]={command:e,keyBinding:n,bindingOnly:i}:"url"===t&&(this._urlBindings[e.id]={command:e,urlBinding:n,bindingOnly:i})},_addPendingBinding:function(e,t,n,i){this._pendingBindings[e]=this._pendingBindings[e]||[],this._pendingBindings[e].push({type:t,binding:n,bindingOnly:i})},_checkForTrailingSeparator:function(e,t,n){var i;if(("tool"===t||"button"===t)&&(i=e.childNodes.length>0?e.childNodes[e.childNodes.length-1]:null,i&&i.classList.contains("commandSeparator")))return n?(e.removeChild(i),!1):!0;if("menu"===t){var o=r.$$array("li > *",e);
if(o.length>0&&o[o.length-1].classList.contains("dropdownSeparator"))return i=o[o.length-1],n?(i.parentNode.parentNode.removeChild(i.parentNode),!1):!0}return!1},renderCommands:function(e,t,n,i,o,s,a){if("string"!=typeof e)throw"a scope id for rendering must be specified";if(t=r.node(t),!t)throw"no parent";var l=this._contributionsByScopeId[e];if(!n&&l){var d=l.localSelectionService||this._selectionService,c=this;return void(d&&d.getSelections(function(n){c.renderCommands(e,t,n,i,o,s)}))}l&&(this._render(l,t,n,i,o||"button",s,a),this._checkForTrailingSeparator(t,o,!0))},destroy:function(e){if(e=r.node(e),!e)throw"no parent";for(;e.hasChildNodes();){var t=e.firstChild;t.commandTooltip&&t.commandTooltip.destroy(),t.emptyGroupTooltip&&t.emptyGroupTooltip.destroy(),this.destroy(t),e.removeChild(t)}},_render:function(n,r,o,a,l,d,c){var h=n.sortedContributions;if(!h){h=[];var u=!1;for(var p in n)if(Object.prototype.hasOwnProperty.call(n,p)){var f=n[p];f&&"number"==typeof f.position&&(f.id=p,h.push(f),u=!0)}u&&(h.sort(function(e,t){return e.position-t.position}),n.sortedContributions=h)}var g=0,m=this;h.forEach(function(n){function h(e){e&&e.parentNode&&e.parentNode.removeChild(e)}var u,p;if(n.imageClass||(n.imageClass=null),n.children&&Object.getOwnPropertyNames(n.children).length>0){var f,v=n.children;if("tool"===l||"button"===l)if(n.title){var y;if(n.defaultActionId){var _=m._commandList[n.defaultActionId];_&&(_.visibleWhen?_.visibleWhen(o):!0)?(y=new e.CommandInvocation(a,o,d,_,m),y.domParent=r):n.pretendDefaultActionId=!0}f=m._createDropdownMenu(r,n.title,null,null,n.imageClass,n.tooltip,n.selectionClass,null,y,n.pretendDefaultActionId),c&&t.generateNavGrid(c,f.menuButton),f&&(m._render(n.children,f.menu,o,a,"menu",d,c),m._checkForTrailingSeparator(f.menu,"menu",!0),0===f.menu.childNodes.length?n.emptyGroupMessage?f.menuButton.emptyGroupTooltip||(f.menuButton.emptyGroupTooltip=new s.Tooltip({node:f.menuButton,text:n.emptyGroupMessage,trigger:"click",position:["below","right","above","left"]})):(c&&t.removeNavGrid(c,f.menuButton),h(f.menu),h(f.menuButton),h(f.destroyButton)):f.menuButton.style.visibility="visible")}else{var C;if(r.childNodes.length>0&&!m._checkForTrailingSeparator(r,l)&&(C=m.generateSeparatorImage(r)),m._render(v,r,o,a,l,d,c),r.childNodes.length>0){var w=r.childNodes[r.childNodes.length-1];w!==C&&(C=m.generateSeparatorImage(r))}}else if(n.title){var b=m._createDropdownMenu(r,n.title,!0,null,null,n.imageClass);b&&(m._render(v,b.menu,o,a,"menu",d,c),m._checkForTrailingSeparator(b.menu,"menu",!0),0===b.menu.childNodes.length&&b.destroyButton&&r.removeChild(b.destroyButton))}else r.childNodes.length>0&&m._generateMenuSeparator(r),m._render(v,r,o,a,l,d,c),m._generateMenuSeparator(r)}else{var x=m._commandList[n.id],S=x?!0:!1,L=null,E=null;if(x){p=new e.CommandInvocation(a,o,d,x,m),p.domParent=r;var k=!1;try{k=S&&(x.visibleWhen?x.visibleWhen(o):!0)}catch(T){throw console.log(T),T}m._activeBindings[x.id]&&m._activeBindings[x.id].keyBinding&&(L=m._activeBindings[x.id],L.invocation=k?p:null,L.bindingOnly&&(S=!1)),m._urlBindings[x.id]&&m._urlBindings[x.id].urlBinding&&(E=m._urlBindings[x.id],E.invocation=k?p:null,E.bindingOnly&&(S=!1)),S=S&&k}if(S)if(x.choiceCallback){var A,N;"tool"===l||"button"===l?(A=r,N=!1,"ul"===r.nodeName.toLowerCase()&&(A=document.createElement("li"),r.appendChild(A))):(A=r,N=!0);var M=function(e){x.populateChoicesMenu(e,o,a,d,m)};m._createDropdownMenu(A,x.name,N,M.bind(x),x.imageClass,x.tooltip||x.title,x.selectionClass,x.positioningNode)}else{p.handler=p.handler||this,p.domParent=r;var I,D=function(){m._invoke(p)};if("menu"===l){var R=null;L&&L.keyBinding&&(R=i.getUserKeyString(L.keyBinding)),I=e.createCommandMenuItem(r,x,p,null,D,R)}else u=l+x.id+g,I=e.createCommandItem(r,x,p,u,null,"tool"===l,D);t.generateNavGrid(c,I),p.domNode=I,g++}}})},_createDropdownMenu:function(t,n,i,a,l,c,h,u,p,f){if(t=r.node(t),!t||!r.contains(document.body,t))return null;var g,m,v,y,_=t;if(i){var C=document.createRange();C.selectNode(t);var w=C.createContextualFragment(d);r.processTextNodes(w,{ButtonText:n}),t.appendChild(w),y=t.lastChild,m=y.lastChild,g=m.previousSibling,g.dropdown=new o.Dropdown({dropdown:m,populate:a,parentDropdown:t.dropdown}),m.dropdown=g.dropdown}else{"ul"===t.nodeName.toLowerCase()&&(_=document.createElement("li"),t.appendChild(_),y=_);var b=null;l&&(b="dropdownButtonWithIcon",c=c||n),c=l?c||n:c;var x=e.createDropdownMenu(_,n,a,b,l,!1,h,u,p||f);if(v=x.dropdownArrow,g=x.menuButton,v){p&&(p.domNode=x.menuButton);var S=this;g.onclick=function(e){var t=r.bounds(v);e.clientX>=t.left&&x.dropdown?x.dropdown.toggle(e):S._invoke(p)},x.dropdown&&(g.onkeydown=function(e){r.KEY.DOWN===e.keyCode&&(x.dropdown.toggle(e),r.stop(e))})}m=x.menu;var L,E=p&&p.command&&(p.command.tooltip||p.command.name);E?L=p.command.tooltip||p.command.name:E&&(L=c),L&&(g.commandTooltip=new s.Tooltip({node:g,text:L,position:["above","below","right","left"]}))}return{menuButton:g,menu:m,dropdown:g.dropdown,destroyButton:y,dropdownArrow:v}},_generateMenuSeparator:function(e){if(!this._checkForTrailingSeparator(e,"menu")){var t=document.createElement("li");t.classList.add("dropdownSeparator");var n=document.createElement("span");n.classList.add("dropdownSeparator"),t.appendChild(n),e.appendChild(t)}},generateSeparatorImage:function(e){var t;return"ul"===e.nodeName.toLowerCase()?(t=document.createElement("li"),e.appendChild(t)):(t=document.createElement("span"),e.appendChild(t)),t.classList.add("core-sprite-sep"),t.classList.add("imageSprite"),t.classList.add("commandSeparator"),t}},c.prototype.constructor=c,h.prototype={match:function(e){var t=n.matchResourceParameters(e);return"undefined"!=typeof t[this.token]?(this.parameterValue=t[this.token],this):null}},h.prototype.constructor=h,u.prototype.constructor=u,p.prototype={optionsRequested:function(){return this.optionsRequested}},p.prototype.constructor=p,f.prototype={_storeParameters:function(e){if(this.parameterTable=null,e){var t=this.parameterTable={};e.forEach(function(e){t[e.name]=e})}},updateParameters:function(e){"function"==typeof this.getParameters&&this._storeParameters(this.getParameters(e))},hasParameters:function(){return null!==this.parameterTable},shouldCollectParameters:function(){return!this.clientCollect&&this.hasParameters()},parameterNamed:function(e){return this.parameterTable[e]},valueFor:function(e){var t=this.parameterTable[e];return t?t.value:null},setValue:function(e,t){var n=this.parameterTable[e];n&&(n.value=t)},forEach:function(e){for(var t in this.parameterTable)this.parameterTable[t].type&&this.parameterTable[t].name&&e(this.parameterTable[t])},makeCopy:function(){var e=[];this.forEach(function(t){var n=new p(t.name,t.type,t.label,t.value,t.lines,t.eventListeners);e.push(n)});var t=new f(e,this._options,this.getParameters);return t.clientCollect=this.clientCollect,t},hasOptionalParameters:function(){return this._hasOptionalParameters}},f.prototype.constructor=f,{CommandRegistry:c,URLBinding:h,ParametersDescription:f,CommandParameter:p,CommandEventListener:u}}),define("text!orion/banner/slideout.html",[],function(){return'<div id="slideContainer" class="slideParameters slideContainer">\r\n	<span id="pageCommandParameters" class="layoutLeft parameters"></span>\r\n	<span id="pageCommandDismiss" class="layoutRight parametersDismiss"></span>\r\n</div>'}),define("orion/commonHTMLFragments",["require","orion/webui/littlelib","text!orion/banner/slideout.html"],function(e,t,n){function i(e){var i=document.createElement("div");i.innerHTML=n;var r=t.$("#slideContainer",i);return r.id=e+r.id,r=t.$("#pageCommandParameters",i),r.id=e+r.id,r=t.$("#pageCommandDismiss",i),r.id=e+r.id,i.innerHTML}return{slideoutHTMLFragment:i}}),define("orion/section",["orion/webui/littlelib","orion/selection","orion/commandRegistry","orion/commonHTMLFragments","orion/objects","orion/selection"],function(e,t,n,i,r,o){function s(t,n){var r=this;if(this._expandImageClass="core-sprite-openarrow",this._collapseImageClass="core-sprite-closedarrow",this._progressImageClass="core-sprite-progress",this._twistieSpriteClass="modelDecorationSprite",!n.id)throw new Error("Missing required argument: id");if(this.id=n.id,!n.title)throw new Error("Missing required argument: title");var o=n.useAuxStyle?["sectionWrapper","sectionWrapperAux","toolComposite"]:["sectionWrapper","toolComposite"];this.domNode=document.createElement("div"),t.appendChild(this.domNode);for(var s=0;s<o.length;s++)this.domNode.classList.add(o[s]);this.domNode.id=n.id,n.canHide&&(this.twistie=document.createElement("span"),this.twistie.classList.add("modelDecorationSprite"),this.twistie.classList.add("layoutLeft"),this.twistie.classList.add("sectionTitleTwistie"),this.domNode.style.cursor="pointer",this.domNode.appendChild(this.twistie),this.domNode.tabIndex=0,this.domNode.addEventListener("click",function(e){(e.target===r.titleNode||e.target===r.twistie||e.target===r.domNode)&&r._changeExpandedState()},!1),this.domNode.addEventListener("keydown",function(t){t.keyCode!==e.KEY.ENTER||t.target!==r.domNode&&t.target!==r.titleNode&&t.target!==r.twistie||r._changeExpandedState()},!1));var a;if(n.iconClass){var l=document.createElement("span");l.classList.add("sectionIcon"),this.domNode.appendChild(l),a=Array.isArray(n.iconClass)?n.iconClass:[n.iconClass],a.forEach(function(e){l.classList.add(e)})}if(n.headerClass&&(a=Array.isArray(n.headerClass)?n.headerClass:[n.headerClass],a.forEach(function(e){this.domNode.classList.add(e)}.bind(this))),this.titleActionsNode=document.createElement("div"),this.titleActionsNode.id=n.id+"TitleActionsArea",this.titleActionsNode.classList.add("layoutLeft"),this.titleActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.titleActionsNode),this.titleNode=document.createElement("div"),this.titleNode.id=n.id+"Title",this.titleNode.classList.add("sectionAnchor"),this.titleNode.classList.add("sectionTitle"),this.titleNode.classList.add("layoutLeft"),this.domNode.appendChild(this.titleNode),this.titleNode.textContent=n.title,"function"==typeof n.getItemCount){var d=document.createElement("div");d.classList.add("layoutLeft"),d.classList.add("sectionItemCount"),this.domNode.appendChild(d),d.textContent=n.getItemCount(this)}this._progressNode=document.createElement("div"),this._progressNode.id=n.id+"Progress",this._progressNode.classList.add("sectionProgress"),this._progressNode.classList.add("sectionTitle"),this._progressNode.classList.add("layoutLeft"),this._progressNode.style.display="none",this._progressNode.textContent="...",this.domNode.appendChild(this._progressNode),this.titleLeftActionsNode=document.createElement("div"),this.titleLeftActionsNode.id=n.id+"LeftTitleActionsArea",this.titleLeftActionsNode.classList.add("layoutLeft"),this.titleLeftActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.titleLeftActionsNode);var c=document.createElement("div");if(c.id=n.id+"FilterSearchBox",this.domNode.appendChild(c),this._toolActionsNode=document.createElement("div"),this._toolActionsNode.id=n.id+"ToolActionsArea",this._toolActionsNode.classList.add("layoutRight"),this._toolActionsNode.classList.add("sectionActions"),this.domNode.appendChild(this._toolActionsNode),this.actionsNode=document.createElement("ul"),this.actionsNode.id=n.id+"ActionArea",this.actionsNode.classList.add("layoutRight"),this.actionsNode.classList.add("commandList"),this.actionsNode.classList.add("sectionActions"),this.domNode.appendChild(this.actionsNode),this.selectionNode=document.createElement("ul"),this.selectionNode.id=n.id+"SelectionArea",this.selectionNode.classList.add("layoutRight"),this.selectionNode.classList.add("commandList"),this.selectionNode.classList.add("sectionActions"),this.domNode.appendChild(this.selectionNode),n.slideout){var h=i.slideoutHTMLFragment(n.id),u=document.createRange();u.selectNode(this.domNode),h=u.createContextualFragment(h),this.domNode.appendChild(h)}if(this._contentParent=document.createElement("div"),this._contentParent.id=this.id+"Content",this._contentParent.role="region",this._contentParent.classList.add("sectionTable"),this._contentParent.setAttribute("aria-labelledby",this.titleNode.id),t.appendChild(this._contentParent),n.content&&this.setContent(n.content),"function"==typeof n.onExpandCollapse&&(this._onExpandCollapse=n.onExpandCollapse),this._preferenceService=n.preferenceService,this._collapse(),this._preferenceService){var p=this;this._preferenceService.getPreferences("/window/views").then(function(e){var t=e.get(p.id);void 0===t?n.hidden||p._expand():t&&p._expand(),p._updateExpandedState(!1)})}else n.hidden||this._expand(),this._updateExpandedState(!1);this._commandService=n.commandService,this._lastMonitor=0,this._loading={}}function a(e){this._section=e,this._id=++e._lastMonitor}return s.prototype={setTitle:function(e){this.titleNode.textContent=e},getHeaderElement:function(){return this.domNode},getTitleElement:function(){return this.titleNode},getActionElement:function(){return this._toolActionsNode},setContent:function(e){"string"==typeof e?this._contentParent.innerHTML=e:(this._contentParent.innerHTML="",this._contentParent.appendChild(e))},getContentElement:function(){return this._contentParent},embedExplorer:function(t,n,i){this._contentParent.innerHTML="",t.parent||(t.parent=n),this._contentParent.appendChild(t.parent),t.section=this,r.mixin(t,{createActionSections:function(){this.actionsSections&&this.actionsSections.forEach(function(t){if(!e.node(t)){var n=document.createElement("ul");n.id=t,n.classList.add("commandList"),n.classList.add("layoutRight"),this.section.actionsNode.appendChild(n)}}.bind(this))},getCommandsVisible:function(){return"hidden"!==this.section.actionsNode.style.visibility},setCommandsVisible:function(t,n){this.section.actionsNode.style.visibility=t?"":"hidden",void 0===n&&(n=t?null:"cursorOnly"),this.renderer.selectionPolicy=n;var i=this.getNavHandler();i&&i.setSelectionPolicy(n),t?this.updateCommands():this.actionsSections&&this.actionsSections.forEach(function(t){e.node(t)&&this.commandRegistry.destroy(t)}.bind(this))},destroy:function(){Object.getPrototypeOf(this).destroy.call(this);var e=this;this.actionsSections&&(this.actionsSections.forEach(function(t){delete e[t]}),delete this.actionsSections)},updateCommands:function(e){this.section.actionsNode&&this.getCommandsVisible()&&(this.createActionSections(),Object.getPrototypeOf(this).updateCommands.call(this,e))},loaded:function(){var e=this;this.selection||i||(this.serviceRegistry||this.registry?(this.selection=new o.Selection(this.serviceRegistry||this.registry,this.parent.id+"Selection"),this.selection.addEventListener("selectionChanged",function(t){e.updateCommands(t.selections)})):window.console.error("Could not create a Selection for the explorer because of lack of serviceRegistry"));var t=this.registerCommands();t&&t.then?t.then(function(){e.updateCommands()}):e.updateCommands()}}),t.renderer&&(t.renderer.section=this,r.mixin(t.renderer,{getCellHeaderElement:function(e){var t=Object.getPrototypeOf(this).getCellHeaderElement.call(this,e);return t&&this.section.setTitle(t.innerHTML),null}}))},createProgressMonitor:function(){return new a(this)},_setMonitorMessage:function(e,t){this._progressNode.style.display="block",this._loading[e]=t;var n="";for(var i in this._loading)""!==n&&(n+="\n"),n+=this._loading[i];this._progressNode.title=n,this._updateExpandedState(!1)},_monitorDone:function(e){delete this._loading[e];var t="";for(var n in this._loading)""!==t&&(t+="\n"),t+=this._loading[n];this._progressNode.title=t,""===t&&(this._progressNode.style.display="none"),this._updateExpandedState(!1)},_changeExpandedState:function(){this.hidden?this._expand():this._collapse(),this._updateExpandedState(!0)},_updateExpandedState:function(e){var t=!this.hidden,n=this.working,i=this.twistie,r=this.id;i&&(i.classList.remove(this._expandImageClass),i.classList.remove(this._collapseImageClass),i.classList.remove(this._progressImageClass),i.classList.add(n?this._progressImageClass:t?this._expandImageClass:this._collapseImageClass)),this._preferenceService&&e&&this._preferenceService.getPreferences("/window/views").then(function(e){e.put(r,t)}),this._onExpandCollapse&&this._onExpandCollapse(t,this)},_expand:function(){this._contentParent.classList.remove("sectionClosed"),this.domNode.classList.remove("sectionClosed"),this.hidden=!1},_collapse:function(){this.hidden=!0,this._contentParent.classList.add("sectionClosed"),this.domNode.classList.add("sectionClosed")}},s.prototype.constructor=s,a.prototype={begin:function(e){this._section.working=!0,this.status=e,this._section._setMonitorMessage(this.id,e)},worked:function(e){this.status=e,this._section._setMonitorMessage(this.id,e)},done:function(e){this._section.working=!1,this.status=e,this._section._monitorDone(this.id)}},a.prototype.constructor=a,{Section:s}}),define("orion/webui/treetable",["i18n!orion/nls/messages","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(n){var i=n.parent,r=this;if(i=t.node(i),!i)throw e["no parent"];if(!n.model)throw e["no tree model"];if(!n.renderer)throw e["no renderer"];this._parent=i,this._treeModel=n.model,this._onComplete=n.onComplete,this._renderer=n.renderer,this._showRoot=void 0===n.showRoot?!1:n.showRoot,this._indent=void 0===n.indent?16:n.indent,this._onCollapse=n.onCollapse,this._labelColumnIndex=void 0===n.labelColumnIndex?0:n.labelColumnIndex,this._id=void 0===n.id?"treetable":n.id,this._tableStyle=n.tableStyle,this._tableElement=n.tableElement||"table",this._tableBodyElement=n.tableBodyElement||"tbody",this._tableRowElement=n.tableRowElement||"tr",this._treeModel.getRoot(function(e){r._root=e,r._showRoot?(e._depth=0,r._generate([e],0)):r._treeModel.getChildren(e,function(e){r.destroyed||r._generate(e,0)})})},destroy:function(){this.destroyed=!0},_generate:function(e,n){t.empty(this._parent);var i=document.createElement("div");this._renderer.wrapperCallback&&this._renderer.wrapperCallback(i);var r=document.createElement(this._tableElement);this._renderer.tableCallback&&this._renderer.tableCallback(r),r.id=this._id,this._tableStyle&&r.classList.add(this._tableStyle),this._renderer.initTable(r,this),this._bodyElement=document.createElement(this._tableBodyElement),this._renderer.bodyCallback&&this._renderer.bodyCallback(this._bodyElement),this._bodyElement.id=this._id+"tbody",0===e.length?this._renderer.emptyCallback&&this._renderer.emptyCallback(this._bodyElement):this._generateChildren(e,n),r.appendChild(this._bodyElement),i.appendChild(r),this._parent.appendChild(i),this._rowsChanged(),this._onComplete&&this._onComplete(this)},_generateChildren:function(e,t,n){for(var i=0;i<e.length;i++){var r=document.createElement(this._tableRowElement);r.id=this._treeModel.getId(e[i]),r._depth=t,r._item=e[i],this._renderer.render(e[i],r);var o=this._indent*t;r.childNodes[Math.min(r.childNodes.length-1,this._labelColumnIndex)].style.paddingLeft=o+"px",this._renderer.rowCallback&&this._renderer.rowCallback(r,e[i]),n?(this._bodyElement.insertBefore(r,n.nextSibling),n&&(n=r)):this._bodyElement.appendChild(r)}},_rowsChanged:function(){this._renderer.rowsChanged&&this._renderer.rowsChanged()},getSelected:function(){return this._renderer.getSelected()},refresh:function(n,i,r){var o,s=this._treeModel.getId(n);if(s===this._id)this._removeChildRows(s),this._generateChildren(i,0),this._rowsChanged();else if(s===this._treeModel.getId(this._root)&&n.removeAll)this._removeAllRows(),this._generateChildren(i,0),this._rowsChanged();else{var a=t.node(s);a?(a._item=n,a&&(r||a._expanded)?(this._removeChildRows(s),i?(a._expanded=!0,this._renderer.updateExpandVisuals(a,!0),this._generateChildren(i,a._depth+1,a),this._rowsChanged()):(o=this,this._renderer.updateExpandVisuals(a,"progress"),i=this._treeModel.getChildren(a._item,function(e){o.destroyed||(o._renderer.updateExpandVisuals(a,!0),a._expanded||(a._expanded=!0,o._generateChildren(e,a._depth+1,a),o._rowsChanged()))}))):this._renderer.updateExpandVisuals(a,!1)):console.log(e["could not find table row "]+s)}},getItem:function(e){var n=t.node(e);return n&&n._item?n._item:e},toggle:function(e){var n=t.node(e);n&&(n._expanded?this.collapse(e):this.expand(e))},isExpanded:function(e){var n="string"==typeof e?e:this._treeModel.getId(e),i=t.node(n);return i?i._expanded:!1},expand:function(e,n,i){var r="string"==typeof e?e:this._treeModel.getId(e),o=t.node(r);if(o){var s=this;if(o._expanded)return void(n&&n.apply(s,i));this._renderer.updateExpandVisuals(o,"progress"),this._treeModel.getChildren(o._item,function(e){s.destroyed||(s._renderer.updateExpandVisuals(o,!0),o._expanded||(o._expanded=!0,s._generateChildren(e,o._depth+1,o),s._rowsChanged()),n&&n.apply(s,i))})}},_removeChildRows:function(e){for(var n=e===this._id,i=!1,r=-1,o=[],s=t.$$array(".treeTableRow",this._parent),a=0;a<s.length;a++){var l=s[a];if(i)break;n?l._depth>r?o.push(l):i=!0:l.id===e&&(n=!0,r=l._depth)}for(var d=0;d<o.length;d++){var c=o[d];c.parentNode.removeChild(c)}},_removeAllRows:function(){for(var e=t.$$array(".treeTableRow",this._parent),n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n])},collapse:function(e){var n="string"==typeof e?e:this._treeModel.getId(e),i=t.node(n);if(i){if(!i._expanded)return;i._expanded=!1,this._renderer.updateExpandVisuals(i,!1),this._removeChildRows(n),this._rowsChanged()}this._onCollapse&&this._onCollapse(i._item)},getIndent:function(){return this._indent}},n.prototype.constructor=n,{TableTree:n}}),define("orion/treeModelIterator",[],function(){var e={};return e.TreeModelIterator=function(){function e(e,t){this.firstLevelChildren=e,this.reset(),this._init(t)}return e.prototype={_init:function(e){e&&(this.isExpanded=e.isExpanded,this.isExpandable=e.isExpandable,this.forceExpandFunc=e.forceExpandFunc,this.getChildrenFunc=e.getChildrenFunc)},topLevel:function(e){return e.parent?e.parent===this.root:!0},_getChildren:function(e){return"function"==typeof this.getChildrenFunc?this.getChildrenFunc(e):e?e.children:null},_expanded:function(e){if(!e)return!0;var t=this._getChildren(e),n=t&&t.length>0;return this.isExpanded&&n&&(n=this.isExpanded(e)),n},_expandable:function(e){return e?this.isExpandable?this.isExpandable(e):!1:!0},_diveIn:function(e){if(this._expanded(e)){var t=this._getChildren(e);return this.setCursor(t[0]),this.cursor()}return null},_drillToLast:function(e){if(this._expanded(e)){var t=this._getChildren(e);return this._drillToLast(t[t.length-1])}return e},_forward:function(e){if(!this._cursor)return null;var t=this._diveIn(this._cursor);if(!t){if(e&&this._expandable(this._cursor)&&this.forceExpandFunc){var n=this;return this.forceExpandFunc(this._cursor,"first",function(e){e&&n.setCursor(e)})}t=this._findSibling(this._cursor,!0),t&&this.setCursor(t)}return t},_backward:function(e){if(!this._cursor)return null;var t=this._findSibling(this._cursor,!1);if(t&&t!==this._cursor.parent&&(t=this._drillToLast(t)),e&&t&&this._expandable(t)&&this.forceExpandFunc&&t!==this._cursor.parent){var n=this;return this.forceExpandFunc(t,"last",function(e){e&&n.setCursor(e)})}return t&&this.setCursor(t),t},_findSibling:function(e,t){for(var n=this.topLevel(e),i=this._getChildren(e.parent),r=n?this.firstLevelChildren:i,o=0;o<r.length;o++)if(r[o]===e)return 0!==o||t?o===r.length-1&&t?n?null:this._findSibling(e.parent,t):t?r[o+1]:r[o-1]:n?null:e.parent;return null},_inParentChain:function(e,t){for(var n=e.parent;n;){if(n===t)return!0;n=n.parent}return!1},_getTopLevelParent:function(e){if(this.topLevel(e))return e;for(var t=e.parent;t;){if(this.topLevel(t))return t;t=t.parent}return null},_onCollapse:function(e){return this._expanded(e.parent)?e:this._onCollapse(e.parent)},_scan:function(e,t,n){this.setCursor(t);var i=[];for(i.push(t);;){if(!this.iterate(e))break;if(i.push(this.cursor()),n===this.cursor())return i}return i=[],null},setCursor:function(e){this._prevCursor=this._cursor,this._cursor=e},setTree:function(e){this.firstLevelChildren=e,this.firstLevelChildren.length>0&&(this.root=this.firstLevelChildren[0].parent)},scan:function(e,t){var n=this.cursor(),i=this._scan(!0,e,t);return i||(i=this._scan(!1,e,t)),this.setCursor(n),i},iterate:function(e,t){return e?this._forward(t):this._backward(t)},iterateOnTop:function(e,t){var n=this._findSibling(this._getTopLevelParent(this.cursor()),e);n?this.setCursor(n):t&&this.firstLevelChildren.length>0&&this.setCursor(e?this.firstLevelChildren[0]:this.firstLevelChildren[this.firstLevelChildren.length-1])},collapse:function(e){return this._cursor&&this._inParentChain(this._cursor,e)?(this.setCursor(e),this._cursor):null},reset:function(){this._cursor=null,this._prevCursor=null,this.root=null,this.firstLevelChildren.length>0&&(this._cursor=this.firstLevelChildren[0],this.root=this.firstLevelChildren[0].parent)},cursorMoved:function(){return this._cursor!==this._prevCursor},cursor:function(){return this._cursor},prevCursor:function(){return this._prevCursor}},e}(),e}),define("orion/explorers/explorerNavHandler",["orion/webui/littlelib","orion/treeModelIterator","orion/uiUtils"],function(e,t,n){var i={},r=navigator.userAgent,o=-1!==r.indexOf("iPad"),s=-1!==window.navigator.platform.indexOf("Mac");return i.ExplorerNavHandler=function(){function i(i,r,o){this.explorer=i,this.model=this.explorer.model,this._navDict=r,this._listeners=[],this._selections=[],this._currentColumn=0;var s=this._getEventListeningDiv();s.tabIndex=0,s.classList.add("selectionModelContainer");var a=this;this._modelIterator=new t.TreeModelIterator([],{isExpanded:this.isExpanded.bind(this),getChildrenFunc:o.getChildrenFunc,isExpandable:this.explorer.renderer.isExpandable?function(e){return a.explorer.renderer.isExpandable(e)}:function(e){return a.isExpandable(e)},forceExpandFunc:this.explorer.forceExpandFunc?function(e,t,n){return a.explorer.forceExpandFunc(e,t,n)}:void 0}),this._init(o),o&&o.setFocus===!1||s.focus();var l=function(t){return n.isFormElement(t.target)?!0:a.explorer.preventDefaultFunc&&a.explorer.preventDefaultFunc(t,a._modelIterator.cursor())?!0:t.keyCode===e.KEY.DOWN?a.onDownArrow(t):t.keyCode===e.KEY.UP?a.onUpArrow(t):t.keyCode===e.KEY.RIGHT?a.onRightArrow(t):t.keyCode===e.KEY.LEFT?a.onLeftArrow(t):t.keyCode===e.KEY.SPACE?a.onSpace(t):t.keyCode===e.KEY.ENTER?a.onEnter(t):void 0};s.addEventListener("keydown",l,!1),this._listeners.push({type:"keydown",listener:l});var d=function(){a.explorer.onFocus?a.explorer.onFocus(!1):a.toggleCursor(null,!1)};s.addEventListener("blur",d,!1),this._listeners.push({type:"blur",listener:d});var c=function(){a.explorer.onFocus?a.explorer.onFocus(!0):a.toggleCursor(null,!0)};s.addEventListener("focus",c,!1),this._listeners.push({type:"focus",listener:c}),this._parentDiv=s}return i.prototype={destroy:function(){this._parentDiv.classList.remove("selectionModelContainer"),this.removeListeners()},_init:function(e){this._linearGridMove=!1,e&&(this._selectionPolicy=e.selectionPolicy,this.gridClickSelectionPolicy=e.gridClickSelectionPolicy||"none",this.preventDefaultFunc=e.preventDefaultFunc,this.postDefaultFunc=e.postDefaultFunc)},_ctrlKeyOn:function(e){return s?e.metaKey:e.ctrlKey},removeListeners:function(){if(this._listeners)for(var e=0;e<this._listeners.length;e++)this._parentDiv.removeEventListener(this._listeners[e].type,this._listeners[e].listener,!1)},focus:function(){var e=this._getEventListeningDiv();e&&e.focus()},_getEventListeningDiv:function(t){return this.explorer.keyEventListeningDiv&&"function"==typeof this.explorer.keyEventListeningDiv?this.explorer.keyEventListeningDiv(t):e.node(this.explorer._parentId)},isExpandable:function(t){if(!t)return!1;var n=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));return n?!0:!1},isExpanded:function(e){return e?this.explorer.myTree.isExpanded(this.model.getId(e)):!1},refreshSelection:function(e,t){var n=this;this.explorer.selection&&this.explorer.selection.getSelections(function(i){n._clearSelection(t);for(var r=0;r<i.length;r++)n._selections.push(i[r]);n._selections.length>0?n.cursorOn(n._selections[0],!0,!1,e):n.cursorOn(null,!1,!1,e),n._shiftSelectionAnchor&&n._inSelection(n._shiftSelectionAnchor)>=0||(n._shiftSelectionAnchor=null)})},refreshModel:function(e,t,n,i){this._currentColumn=0,this.topIterationNodes=[],this.model=t,this._navDict=e,this.model.getTopIterationNodes?this.topIterationNodes=this.model.getTopIterationNodes():n&&(this.topIterationNodes=n),this._modelIterator.setTree(this.topIterationNodes),!i&&this.explorer.selection&&(this.toggleCursor(this._modelIterator.cursor(),!1),this._modelIterator.reset()),this.refreshSelection(!0)},getTopLevelNodes:function(){return this._modelIterator.firstLevelChildren},_inSelection:function(e){for(var t=this.model.getId(e),n=0;n<this._selections.length;n++)if(t===this.model.getId(this._selections[n]))return n;return-1},_clearSelection:function(e){if(e)for(var t=0;t<this._selections.length;t++)this._checkRow(this._selections[t],!0);this._selections=[]},getSelectionPolicy:function(){return this._selectionPolicy},setSelectionPolicy:function(e){this._selectionPolicy!==e&&(("readonlySelection"===this._selectionPolicy||"readonlySelection"===e)&&this._toggleSelectionClass("disabledRow","readonlySelection"===e),this._selectionPolicy=e,"cursorOnly"===this._selectionPolicy&&this._clearSelection(!0))},setSelection:function(e,t,n){if("readonlySelection"!==this._selectionPolicy){if("cursorOnly"===this._selectionPolicy)return void(t&&this.explorer.renderer._useCheckboxSelection&&this._checkRow(e,!0));if(this._isRowSelectable(e)){if(t&&"singleSelection"!==this._selectionPolicy){var i=this._inSelection(e);i>=0?(this._checkRow(e,!0),this._selections.splice(i,1)):(this._checkRow(e,!1),this._selections.push(e),this._lastSelection=e)}else this._clearSelection(!0),this._checkRow(e,!1),this._selections.push(e),this._lastSelection=e;n&&(this._shiftSelectionAnchor=this._lastSelection),this.explorer.selection&&(this.explorer.renderer.storeSelections(),this.explorer.selection.setSelections(this._selections))}}},moveColumn:function(e,t){e||(e=this.currentModel());var n=this._getGridChildren(e);if(n&&n.length>1||0===t&&n){0!==t&&this.toggleCursor(e,!1);var i=this._currentColumn,r=!0;return i+=t,0>i?(this._linearGridMove&&0!==t&&(this._modelIterator.iterate(!1)?e=this.currentModel():r=!1),i=r?n.length-1:this._currentColumn):i>=n.length&&(this._linearGridMove&&0!==t&&(this._modelIterator.iterate(!0)?e=this.currentModel():r=!1),i=r?0:this._currentColumn),this._currentColumn=i,0!==t&&this.toggleCursor(e,!0),!0}return!1},_getGridChildren:function(e){return this._navDict?this._navDict.getGridNavHolder(e):null},getCurrentGrid:function(e){e||(e=this.currentModel());var t=this._getGridChildren(e);return t&&t.length>0?t[this._currentColumn]:null},getAriaContainerElement:function(e){for(var t,n=this._parentDiv;e&&e!==n&&"grid"!==(t=e.getAttribute("role"))&&"tree"!==t&&"treegrid"!==t;)e=e.parentNode;return e===n?null:e},toggleCursor:function(e,t){var n=this.getRowDiv(e),i=this.getCurrentGrid(e);if(i){if(n&&(t?n.classList.add("treeIterationCursorRow"):n.classList.remove("treeIterationCursorRow")),i.domNode){var r=this.getAriaContainerElement(i.domNode);if(t){if(i.domNode.classList.add("treeIterationCursor"),r){var o=i.domNode.id;r.setAttribute("aria-activedescendant",o)}}else i.domNode.classList.remove("treeIterationCursor")}}else n&&(t?n.classList.add("treeIterationCursorRow_Dotted"):n.classList.remove("treeIterationCursorRow_Dotted"))},currentModel:function(){return this._modelIterator.cursor()},cursorOn:function(e,t,n,i){var r,o;if(e||t){if(o===this._modelIterator.cursor())return;r=this._modelIterator.cursor(),o=e,this._modelIterator.setCursor(o)}else r=this._modelIterator.prevCursor(),o=this._modelIterator.cursor();if((r!==o||t)&&(this.toggleCursor(r,!1),!t||o)){this.moveColumn(null,0),this.toggleCursor(o,!0);var s=this.getRowDiv();if(s&&!i){for(var a=s.parentNode,l=document.documentElement;a&&a!==l;){var d=window.getComputedStyle(a,null);if(!d)break;var c=d.getPropertyValue("overflow-y");
if("auto"===c||"scroll"===c)break;a=a.parentNode}if(a){var h=!0;s.offsetTop<=a.scrollTop?(h=!1,void 0===n&&(n=!1)):s.offsetTop+s.offsetHeight>=a.scrollTop+a.clientHeight&&(h=!1,void 0===n&&(n=!0)),h||s.scrollIntoView(!n)}}this.explorer.onCursorChanged&&this.explorer.onCursorChanged(r,o)}},getSelection:function(){return this._selections},getSelectionIds:function(){for(var e=[],t=0;t<this._selections.length;t++)e.push(this.model.getId(this._selections[t]));return e},getRowDiv:function(t){var n=t?t:this._modelIterator.cursor();if(!n)return null;var i=this.model.getId(n),r=this._navDict.getValue(i);return r&&r.rowDomNode?r.rowDomNode:e.node(i)},iterate:function(e,t,n,i){var r=null;if(this.topIterationNodes&&0!==this.topIterationNodes.length)if(i){var o=this.currentModel();for(r=this._modelIterator.iterate(e,t),r&&this._setCursorOnItem(e,n);r&&r.isNotSelectable;)r=this._modelIterator.iterate(e,t),r&&this._setCursorOnItem(e,n);r||(this.cursorOn(o,!0,!1,!0),this._setCursorOnItem(e,n))}else r=this._modelIterator.iterate(e,t),r&&this._setCursorOnItem(e,n)},_toggleSelectionClass:function(e,t){this._selections.forEach(function(n){var i=this.getRowDiv(n);i&&(t?i.classList.add(e):i.classList.remove(e))}.bind(this))},_setCursorOnItem:function(e,t){if(this.cursorOn(null,!1,e),t){var n=this._inSelection(this._modelIterator.prevCursor()),i=this._inSelection(this._modelIterator.cursor());n>=0&&i>=0?this.setSelection(this._modelIterator.prevCursor(),!0):this.setSelection(this.currentModel(),!0)}},_checkRow:function(t,n){if(this.explorer.renderer._useCheckboxSelection&&"singleSelection"!==this._selectionPolicy){var i=this.getRowDiv(t);if(!i)return;var r=e.node(this.explorer.renderer.getCheckBoxId(i.id)),o=n?!r.checked:!0;o!==r.checked&&this.explorer.renderer.onCheck(i,r,o,!0)}else this._select(t,n)},_select:function(e){e||(e=this._modelIterator.cursor());var t=this.getRowDiv(e);t&&(this._inSelection(e)<0?t.classList.add("checkedRow"):t.classList.remove("checkedRow"))},_onModelGrid:function(e,t){var n=this._getGridChildren(e);if(n)for(var i=0;i<n.length;i++)if(t.target===n[i].domNode)return!0;return!1},onClick:function(t,n){if("readonlySelection"===this._selectionPolicy||this.isDisabled(this.getRowDiv(t)))e.stop(n);else{var i=e.node(this.explorer.renderer.expandCollapseImageId(this.model.getId(t)));if(n.target===i)return;if("none"===this.gridClickSelectionPolicy&&this._onModelGrid(t,n))return;if(this.cursorOn(t,!0,!1,!0),o)this.setSelection(t,!0);else if(this._ctrlKeyOn(n))this.setSelection(t,!0,!0);else if(n.shiftKey&&this._shiftSelectionAnchor){var r=this._modelIterator.scan(this._shiftSelectionAnchor,t);if(r){this._clearSelection(!0);for(var s=0;s<r.length;s++)this.setSelection(r[s],!0)}}else this.setSelection(t,!1,!0)}},onCollapse:function(e){this._modelIterator.collapse(e)&&this.cursorOn()},onUpArrow:function(e){return this.iterate(!1,!1,e.shiftKey,!0),this._ctrlKeyOn(e)||e.shiftKey||this.setSelection(this.currentModel(),!1,!0),e.preventDefault(),!1},onDownArrow:function(e){return this.iterate(!0,!1,e.shiftKey,!0),this._ctrlKeyOn(e)||e.shiftKey||this.setSelection(this.currentModel(),!1,!0),e.preventDefault(),!1},_shouldMoveColumn:function(e){var t=this.currentModel(),n=this._getGridChildren(t);return n&&n.length>1?this.isExpandable(t)?this._ctrlKeyOn(e):!0:!1},onLeftArrow:function(e){if(this._shouldMoveColumn(e))return this.moveColumn(null,-1),e.preventDefault(),!0;var t=this._modelIterator.cursor();return t?this.isExpandable(t)&&this.isExpanded(t)?(this.explorer.myTree.collapse(t),e.preventDefault(),!0):void(this._modelIterator.topLevel(t)?this.explorer.scopeUp&&"function"==typeof this.explorer.scopeUp&&this.explorer.scopeUp():(this.cursorOn(t.parent),this.setSelection(t.parent,!1,!0))):!1},onRightArrow:function(e){if(this._shouldMoveColumn(e))return this.moveColumn(null,1),e.preventDefault(),!0;var t=this._modelIterator.cursor();return t?this.isExpandable(t)&&!this.isExpanded(t)?(this.explorer.myTree.expand(t),this.explorer.postUserExpand&&this.explorer.postUserExpand(this.model.getId(t)),e.preventDefault(),!1):void 0:!1},_isRowSelectable:function(e){return this.explorer.isRowSelectable?this.explorer.isRowSelectable(e):!0},onSpace:function(e){this.setSelection(this.currentModel(),!0,!0),e.preventDefault()},onEnter:function(e){var t=this.getCurrentGrid(this._modelIterator.cursor());if(t)if(t.widget)"function"==typeof t.onClick?t.onClick():"function"==typeof t.widget.focus&&t.widget.focus();else{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,this._ctrlKeyOn(e),!1,!1,!1,0,null),t.domNode.dispatchEvent(n)}else{var i=this._modelIterator.cursor();if(i){if(this.explorer.renderer.getRowActionElement){var r=this.explorer.renderer.getRowActionElement(this.model.getId(i));r.href&&(this._ctrlKeyOn(e)?window.open(r.href):window.location.href=r.href)}return this.explorer.renderer.performRowAction?(this.explorer.renderer.performRowAction(e,i),e.preventDefault(),!1):void 0}}},setIsNotSelectable:function(e,t){e.isNotSelectable=t},disableItem:function(e){var t=this.getRowDiv(e);this.isExpandable(e)&&this.isExpanded(e)&&(this._modelIterator.collapse(e),this.explorer.myTree.toggle(t.id)),t.classList.remove("checkedRow"),t.classList.add("disabledNavRow"),this.setIsNotSelectable(e,!0)},isDisabled:function(e){return e.classList.contains("disabledNavRow")},enableItem:function(e){var t=this.getRowDiv(e);t&&(t.classList.remove("disabledNavRow"),this.setIsNotSelectable(e,!1))}},i}(),i.ExplorerNavDict=function(){function e(e){this._dict={},this._model=e}return e.prototype={addRow:function(e,t){var n=this._model.getId(e);this._dict[n]={model:e,rowDomNode:t}},getValue:function(e){return this._dict[e]},getGridNavHolder:function(e,t){if(!e)return null;var n=this._model.getId(e);return this._dict[n]?(!this._dict[n].gridChildren&&t&&(this._dict[n].gridChildren=[]),this._dict[n].gridChildren):null},initGridNavHolder:function(e){if(!e)return null;var t=this._model.getId(e);this._dict[t]&&(this._dict[t].gridChildren=null)}},e}(),i}),define("orion/explorers/explorer",["i18n!orion/nls/messages","require","orion/webui/littlelib","orion/webui/treetable","orion/explorers/explorerNavHandler","orion/commands"],function(e,t,n,i,r,o){var s={};return s.Explorer=function(){function e(e,t,n,i){this.registry=e,this.renderer=n,this.selection=t,this.commandService=i,this.renderer&&(this.renderer.explorer=this),this.myTree=null}return e.prototype={destroy:function(){this._navHandler&&this._navHandler.destroy(),this.model&&this.model.destroy(),this.myTree&&this.myTree.destroy(),this.destroyed=!0},changedItem:function(e,t){this.myTree&&this.myTree.refresh.bind(this.myTree)(e,t,!0)},updateCommands:function(e){this.myTree&&this.myTree._renderer.updateCommands.bind(this.myTree._renderer)(e)},makeNewItemPlaceholder:function(e,t,n){var i=null,r=this.getRow(e);if(r){var o=r.parentNode,s=document.createElement("tr");s.id=t+"placeHolderRow",s.classList.add("navRow");var a=document.createElement("td");if(a.id=t+"placeHolderCol",a.classList.add("navColumn"),s.appendChild(a),n){var l=r.nextSibling;o.insertBefore(s,l)}else o.insertBefore(s,r);a.style.paddingLeft=r.firstChild.style.paddingLeft,i={wrapperNode:s,refNode:a,destroyFunction:function(){try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch(e){}}}}return i},getRow:function(e){var t=this.model.getId(e);return t?n.node(t):void 0},collapseAll:function(){for(var e=this._navHandler.getTopLevelNodes(),t=0;t<e.length;t++)this.myTree.collapse(e[t])},expandAll:function(e){if(e)this._expandRecursively(e);else{if(!this._navHandler)return;for(var t=this._navHandler.getTopLevelNodes(),n=0;n<t.length;n++)this._expandRecursively(t[n])}},_expandRecursively:function(e){if(this._navHandler&&this._navHandler.isExpandable(e)){var t=this;this.myTree.expand(e,function(){t.model.getChildren(e,function(e){if(void 0!==e&&null!==e)for(var n=e.length,i=0;n>i;i++)t._expandRecursively(e[i])})})}},createTree:function(e,t,o){e="string"==typeof e?e:e.id||e,this.selection&&this.selection.setSelections([]),this.getNavHandler()&&this.getNavHandler()._clearSelection();var s=e+"innerTree",a=n.node(s);a&&n.empty(a),t&&(t.rootId=s),this.model=t,this._parentId=e,this._treeOptions=o;var l=!o||o&&!o.noSelection;l&&(this.selectionPolicy=o?o.selectionPolicy:"",this._navDict=new r.ExplorerNavDict(this.model)),this.myTree=new i.TableTree({id:s,model:t,parent:e,onComplete:o?o.onComplete:void 0,labelColumnIndex:this.renderer.getLabelColumnIndex(),renderer:this.renderer,showRoot:o?!!o.showRoot:!1,indent:o?o.indent:void 0,onCollapse:o?o.onCollapse:void 0,navHandlerFactory:o?o.navHandlerFactory:void 0,tableElement:o?o.tableElement:void 0,tableBodyElement:o?o.tableBodyElement:void 0,tableRowElement:o?o.tableRowElement:void 0}),this.renderer._initializeUIState(),"cursorOnly"===this.selectionPolicy&&this.initNavHandler()},getNavHandler:function(){return this._navHandler},getNavDict:function(){return this._navDict},refreshSelection:function(){if(this.selection){var e=this.getNavHandler(),t=[];if(e&&this.getNavDict())for(var n=e.getSelection(),i=0;i<n.length;i++){var r=e.getRowDiv(n[i]);if(r&&r.parentNode){var o=this.getNavDict().getValue(this.model.getId(n[i]));o.model&&t.push(o.model)}}this.selection.setSelections(t)}},getRootPath:function(){return this.model&&this.model.root?this.model.root.Location:null},initNavHandler:function(){var e=this._treeOptions,t=!e||e&&!e.noSelection;if(t){if(!this.getNavHandler())if(e&&e.navHandlerFactory&&"function"==typeof e.navHandlerFactory.createNavHandler)this._navHandler=e.navHandlerFactory.createNavHandler(this,this._navDict,e);else{var n=e?e.getChildrenFunc:null;this._navHandler=new r.ExplorerNavHandler(this,this._navDict,{getChildrenFunc:n,setFocus:e&&e.setFocus,selectionPolicy:e?e.selectionPolicy:null})}var i=this;this.model.getRoot(function(t){t instanceof Array?i.getNavHandler().refreshModel(i.getNavDict(),i.model,t):t.children&&t.children instanceof Array&&i.getNavHandler().refreshModel(i.getNavDict(),i.model,t.children),e&&e.setFocus&&i.getNavHandler().cursorOn(null,!1,!1,!0)})}},_lastHash:null,checkbox:!1},e}(),s.createExplorerCommands=function(t,n){function i(e){return"function"==typeof e.getItemCount&&e.getItemCount()>0?n?n(e):!0:!1}var r=new o.Command({tooltip:e["Expand all"],imageClass:"core-sprite-expandAll",id:"orion.explorer.expandAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return i(e)},callback:function(e){e.items.expandAll()}}),s=new o.Command({tooltip:e["Collapse all"],imageClass:"core-sprite-collapseAll",id:"orion.explorer.collapseAll",groupId:"orion.explorerGroup",visibleWhen:function(e){return i(e)},callback:function(e){e.items.collapseAll()}});t.addCommand(r),t.addCommand(s)},s.ExplorerModel=function(){function e(e,t,n){this.rootPath=e,this.fetchItems=t,this.idPrefix=n||""}return e.prototype={destroy:function(){this.destroyed=!0},getRoot:function(e){var t=this;this.fetchItems(this.rootPath).then(function(n){t.root=n,e(n)})},getChildren:function(e,t){e.Children?t(e.Children):e.ChildrenLocation?this.fetchItems(e.ChildrenLocation).then(function(n){e.Children=n,t(n)}):t([])},getId:function(e){if(e.Location===this.root.Location)return this.rootId;for(var t=e.Location.replace(/[\\\/]/g,""),n=this.idPrefix,i=0;i<t.length;i++)n+=t[i].match(/[^\.\:\-\_0-9A-Za-z]/g)?t.charCodeAt(i):t[i];return n}},e}(),s.ExplorerFlatModel=function(){function e(e,t,n){this.rootPath=e,this.fetchItems=t,this.root=n}return e.prototype=new s.ExplorerModel,e.prototype.getRoot=function(e){if(this.root)e(this.root);else{var t=this;this.fetchItems(this.rootPath).then(function(n){t.root=n,e(n)})}},e.prototype.getChildren=function(e,t){t(e===this.root?this.root:[])},e}(),s.ExplorerRenderer=function(){function e(e,t){this.explorer=t,this._init(e),this._expandImageClass="core-sprite-openarrow",this._collapseImageClass="core-sprite-closedarrow",this._progressImageClass="core-sprite-progress",this._twistieSpriteClass="modelDecorationSprite"}return e.prototype={_init:function(e){e&&(this._useCheckboxSelection=void 0===e.checkbox?!1:e.checkbox,this.selectionPolicy=e.singleSelection?"singleSelection":"",this._cachePrefix=e.cachePrefix,e.getCheckedFunc&&(this.getCheckedFunc=e.getCheckedFunc),e.onCheckedFunc&&(this.onCheckedFunc=e.onCheckedFunc),this._noRowHighlighting=e.noRowHighlighting,this._highlightSelection=!0,this._treeTableClass=e.treeTableClass||"treetable",e.highlightSelection===!1&&(this._highlightSelection=!1),this.actionScopeId||(this.actionScopeId=e.actionScopeId),this.commandService||(this.commandService=e.commandService))},getLabelColumnIndex:function(){return this.explorer.checkbox?1:0},initTable:function(e,t){this.tableTree=t,this.tableNode=e,n.empty(e),this._treeTableClass&&e.classList.add(this._treeTableClass),this.renderTableHeader(e)},getActionsColumn:function(e,t,n,i,r){n=n||"tool";var o=document.createElement("td");return o.id=t.id+"actionswrapper",i&&o.classList.add(i),this.actionScopeId&&this.commandService?this.commandService.renderCommands(this.actionScopeId,o,e,this.explorer,n,null,r&&this.explorer.getNavDict()?this.explorer.getNavDict().getGridNavHolder(e,!0):null):window.console.log("Warning, no command service or action scope was specified.  No commands rendered."),o},initCheckboxColumn:function(){if(this._useCheckboxSelection){var e=document.createElement("th");return e}},getCheckboxColumn:function(e,t){if(this._useCheckboxSelection){var n=document.createElement("td"),i=document.createElement("span");i.id=this.getCheckBoxId(t.id),i.classList.add("core-sprite-check"),i.classList.add("selectionCheckmarkSprite"),i.rowId=t.id,this.getCheckedFunc&&(i.checked=this.getCheckedFunc(e),i.checked?(this._highlightSelection&&t.classList.add("checkedRow"),i.classList.add("core-sprite-check_on")):(this._highlightSelection&&t.classList.remove("checkedRow"),i.classList.remove("core-sprite-check_on"))),n.appendChild(i);var r=this;return i.addEventListener("click",function(n){var i=n.target.checked?!1:!0;r.onCheck(t,n.target,i,!0,!1,e)},!1),n}},getCheckBoxId:function(e){return e+"selectedState"},onCheck:function(e,t,n,i,r,o){t.checked=n,n?t.classList.add("core-sprite-check_on"):t.classList.remove("core-sprite-check_on"),this.onCheckedFunc&&this.onCheckedFunc(t.rowId,n,i,o),this.explorer.getNavHandler()&&r&&this.explorer.getNavHandler().setSelection(this.explorer.getNavDict().getValue(e.id).model,!0)},storeSelections:function(){if(this.explorer.getNavHandler()){var e=this.explorer.getNavHandler().getSelectionIds(),t=this._getUIStatePreferencePath();t&&window.sessionStorage&&(window.sessionStorage[t+"selection"]=JSON.stringify(e))}},_restoreSelections:function(e){var t=this.explorer.getNavDict(),i=this.explorer.getNavHandler();if(i&&t&&"cursorOnly"!==i.getSelectionPolicy()){var r=window.sessionStorage[e+"selection"];"string"==typeof r&&(r=r.length>0?JSON.parse(r):null);var o;if(r){var s=[];for(o=0;o<r.length;o++){var a=t.getValue(r[o]);if(a&&a.rowDomNode&&a.model){s.push(a.model),this._highlightSelection&&a.rowDomNode.classList.add("checkedRow");var l=n.node(this.getCheckBoxId(a.rowDomNode.id));l&&(l.checked=!0,l.classList.add("core-sprite-check_on"))}}this.explorer.selection&&(this.explorer.selection.setSelections(s),this.explorer.getNavHandler()&&this.explorer.getNavHandler().refreshSelection())}}},_storeExpansions:function(e){window.sessionStorage[e+"expanded"]=JSON.stringify(this._expanded)},_restoreExpansions:function(e){var t=!1,i=window.sessionStorage[e+"expanded"];"string"==typeof i&&(i=i.length>0?JSON.parse(i):null);var r;if(i)for(r=0;r<i.length;r++){var o=n.node(i[r]);if(o){this._expanded.push(i[r]);var s=this;this.tableTree.expand(i[r],function(){s._restoreSelections(e)}),t=!0}}return!t},_getUIStatePreferencePath:function(){if(this.explorer){var e=this.explorer.getRootPath();if(this._cachePrefix&&e){var t=e.replace(/[^\.\:\-\_0-9A-Za-z]/g,"");return"/"+this._cachePrefix+"/"+t+"/uiState"}}return null},expandCollapseImageId:function(e){return e+"__expand"},updateExpandVisuals:function(e,t){var i=n.node(this.expandCollapseImageId(e.id));i&&(i.classList.remove(this._expandImageClass),i.classList.remove(this._collapseImageClass),i.classList.remove(this._progressImageClass),i.classList.add("progress"===t?this._progressImageClass:t?this._expandImageClass:this._collapseImageClass))},getExpandImage:function(e,t,n,i){var r=document.createElement("span");if(r.id=this.expandCollapseImageId(e.id),t.appendChild(r),r.classList.add(this._twistieSpriteClass),r.classList.add(this._collapseImageClass),n){var o=document.createElement("span");t.appendChild(o),o.classList.add(i||"imageSprite"),o.classList.add(n)}var s=this;return r.onclick=function(){if(!s.explorer.getNavHandler().isDisabled(e)){s.tableTree.toggle(e.id);var t=s.tableTree.isExpanded(e.id);if(t)s._expanded.push(e.id),s.explorer.postUserExpand&&s.explorer.postUserExpand(e.id);else for(var n in s._expanded)if(s._expanded[n]===e.id){s._expanded.splice(n,1);break}var i=s._getUIStatePreferencePath();i&&window.sessionStorage&&s._storeExpansions(i)}},r},render:function(e,t){t.classList.add("navRow"),this.renderRow(e,t)},rowsChanged:function(){if("cursorOnly"!==this.explorer.selectionPolicy&&(this.explorer.refreshSelection(),this.explorer.initNavHandler()),!this._noRowHighlighting){var e="darkSectionTreeTableRow",t="lightSectionTreeTableRow";(n.$(".sectionTreeTable",this.tableNode.parentNode)||n.$(".treetable",this.tableNode.parentNode))&&n.$$array(".treeTableRow",this.tableNode).forEach(function(n,i){var r=i%2?e:t,o=r===t?e:t;n.classList.add(r),n.classList.remove(o)})}},updateCommands:function(){if(this.commandService)for(var e=n.$$array(".treeTableRow"),t=0;t<e.length;t++){var i=e[t],r=i.id+"actionswrapper",o=n.node(r);this.commandService.destroy(o),this.actionScopeId&&this.commandService.renderCommands(this.actionScopeId,o,i._item,this.explorer,"tool")}},_initializeUIState:function(){this._expanded=[];var e=this._getUIStatePreferencePath();e&&window.sessionStorage&&this._restoreExpansions(e)&&this._restoreSelections(e)}},e}(),s.SelectionRenderer=function(){function e(e,t){this._init(e),this.explorer=t}return e.prototype=new s.ExplorerRenderer,e.prototype.renderTableHeader=function(e){var t=document.createElement("thead"),n=document.createElement("tr");t.classList.add("navTableHeading"),this._useCheckboxSelection&&n.appendChild(this.initCheckboxColumn(e));for(var i=0,r=this.getCellHeaderElement(i);r;)r.innerHTML.length>0&&r.classList.add("navColumn"),n.appendChild(r),r=this.getCellHeaderElement(++i);t.appendChild(n),i>0&&e.appendChild(t)},e.prototype.renderRow=function(e,t){if(t.verticalAlign="baseline",t.classList.add("treeTableRow"),void 0===e.selectable||e.selectable){var n=this.explorer.getNavDict();if(n){"cursorOnly"!==this.explorer.selectionPolicy&&t.classList.add("selectableNavRow"),n.addRow(e,t);var i=this;t.addEventListener("click",function(t){i.explorer.getNavHandler()&&i.explorer.getNavHandler().onClick(e,t)},!1)}var r=this.getCheckboxColumn(e,t);r&&(r.classList.add("checkColumn"),t.appendChild(r))}for(var o=0,s=this.getCellElement(o,e,t);s;)t.appendChild(s),s.classList.add(0===o?this.getPrimColumnStyle?this.getPrimColumnStyle(e):"navColumn":this.getSecondaryColumnStyle?this.getSecondaryColumnStyle():"secondaryColumn"),s=this.getCellElement(++o,e,t)},e.prototype.getCellHeaderElement=function(){},e.prototype.getCellElement=function(){},e}(),s.SimpleFlatModel=function(){function e(e,t,n){this.items=e,this.getKey=n,this.idPrefix=t,this.root={children:e}}return e.prototype=new s.ExplorerModel,e.prototype.getRoot=function(e){e(this.root)},e.prototype.getId=function(e){for(var t=this.getKey(e),n=t.replace(/[\\\/]/g,""),i="",r=0;r<n.length;r++)i+=n[r].match(/[^\.\:\-\_0-9A-Za-z]/g)?n.charCodeAt(r):n[r];return this.idPrefix+i},e.prototype.getChildren=function(e,t){t(e===this.root?this.items:[])},e}(),s}),define("orion/URITemplate",[],function(){function e(e){this._text=e}function t(e){return e.replace("%25","%")}function n(e,n){if("U"===n)return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});if("U+R"===n)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(h,t);if("U+R-,"===n)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw new Error("Unknown allowed character set: "+n)}function i(e,t,i){for(var r=[],o=0;o<e.length;o++)"undefined"!=typeof e[o]&&r.push(n(e[o],t));return r.join(i)}function r(e,t,i,r){for(var o=Object.keys(e),s=[],a=0;a<o.length;a++)"undefined"!=typeof e[o[a]]&&s.push(n(o[a],t)+i+n(e[o[a]],t));return s.join(r)}function o(e){for(var t=[],n=e.split(","),i=0;i<n.length;i++){var r=n[i].match(c);if(null===r)throw new Error("Bad VarSpec: "+e);t.push({name:r[1],explode:!!r[2],prefix:r[3]?parseInt(r[3],10):-1})}return t}function s(e){if(0===e.length)throw new Error("Invalid Expression: 0 length expression");this._operator=d[e[0]],this._operator?e=e.substring(1):this._operator=d.NUL,this._varSpecList=o(e)}function a(t){for(var n=[],i=0,r=t.indexOf("{",i);-1!==r;){n.push(new e(t.substring(i,r)));var o=t.indexOf("}",r+1);if(-1===o)throw new Error("Invalid template: "+t);n.push(new s(t.substring(r+1,o))),i=o+1,r=t.indexOf("{",i)}return n.push(new e(t.substring(i))),n}function l(e){this._templateComponents=a(e)}var d={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},c=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,h=/%25[0-9A-F][0-9A-F]/g;return e.prototype={expand:function(){return encodeURI(this._text)}},s.prototype={expand:function(e){for(var t=[],o=0;o<this._varSpecList.length;o++){var s=this._varSpecList[o],a=s.name,l=e[a],d=typeof l;if("undefined"!==d&&null!==l){var c=0===t.length?this._operator.first:this._operator.sep;if("string"===d)this._operator.named&&(c+=n(a,"U+R"),c+=0===l.length?this._operator.ifemp:"="),-1!==s.prefix&&s.prefix<l.length&&(l=l.substring(0,s.prefix)),c+=n(l,this._operator.allow);else if(Array.isArray(l)){if(0===l.length)continue;if(s.explode)c+=i(l,this._operator.allow,this._operator.sep);else{var h=i(l,this._operator.allow,",");this._operator.named&&(c+=n(a,"U+R"),c+=0===h.length?this._operator.ifemp:"="),c+=h}}else{if("object"!==d)throw new Error("bad param type: "+a+" : "+d);if(0===Object.keys(l).length)continue;if(s.explode)c+=r(l,this._operator.allow,"=",this._operator.sep);else{var u=r(l,this._operator.allow,",",",");this._operator.named&&(c+=n(a,"U+R"),c+=0===u.length?this._operator.ifemp:"="),c+=u}}t.push(c)}}return t.join("")}},l.prototype={expand:function(e){for(var t=[],n=0;n<this._templateComponents.length;n++)t.push(this._templateComponents[n].expand(e));return t.join("")}},l}),define("orion/i18nUtil",["require","orion/Deferred"],function(e,t){function n(e){var t=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,n){return t[(n<<0)+1]})}function i(e){var t=localStorage.getItem("orion/messageBundle/"+e);if(t){var n=JSON.parse(t);if(n._expires&&n._expires>(new Date).getTime())return delete n._expires,n}return null}function r(e,t){t._expires=(new Date).getTime()+9e5,localStorage.setItem("orion/messageBundle/"+e,JSON.stringify(t)),delete t._expires}function o(n){function o(t){t?e(["i18n!"+n],function(e){e&&r(n,e),l.resolve(e)}):a(new Error(n))}function a(e){l.reject(e)}if(s[n])return s[n];var l=new t;s[n]=l;var d=i(n);if(d)return l.resolve(d),l;try{e([n],o,a)}catch(c){e(["orion/i18n!"+n],o,a)}return l}var s={};return{getMessageBundle:o,formatMessage:n}}),define("orion/edit/editorContext",[],function(){function e(e){var t=Object.create(null);return n(e).forEach(function(n){var i=e.getService(n);Object.keys(i).forEach(function(e){"function"==typeof i[e]&&(t[e]=i[e].bind(i))})}),t}function t(e){var t=Object.create(null);return n(e).forEach(function(e){e.getPropertyKeys().forEach(function(n){"service.id"!==n&&"service.names"!==n&&"objectClass"!==n&&(t[n]=e.getProperty(n))})}),t}function n(e){return e.getServiceReferences("orion.edit.context")}return{getEditorContext:e,getOptions:t}}),define("orion/keyBinding",["orion/util"],function(e){function t(e,t,n,i,r,o){this.type=o||"keydown",this.keyCode="string"==typeof e&&"keydown"===this.type?e.toUpperCase().charCodeAt(0):e,this.mod1=void 0!==t&&null!==t?t:!1,this.mod2=void 0!==n&&null!==n?n:!1,this.mod3=void 0!==i&&null!==i?i:!1,this.mod4=void 0!==r&&null!==r?r:!1}function n(e){this.keys=e}return t.prototype={getKeys:function(){return[this]},match:function(t,n){if(void 0!==n){if(0!==n)return!1}else if(t instanceof Array){if(t.length>1)return!1;t=t[0]}if(t.type!==this.type)return!1;if(this.keyCode===t.keyCode||this.keyCode===String.fromCharCode(e.isOpera?t.which:void 0!==t.charCode?t.charCode:t.keyCode)){var i=e.isMac?t.metaKey:t.ctrlKey;return this.mod1!==i?!1:"keydown"===this.type&&this.mod2!==t.shiftKey?!1:this.mod3!==t.altKey?!1:e.isMac&&this.mod4!==t.ctrlKey?!1:!0}return!1},equals:function(e){return e?this.keyCode!==e.keyCode?!1:this.mod1!==e.mod1?!1:this.mod2!==e.mod2?!1:this.mod3!==e.mod3?!1:this.mod4!==e.mod4?!1:this.type!==e.type?!1:!0:!1}},n.prototype={getKeys:function(){return this.keys.slice(0)},match:function(e,t){var n=this.keys;if(void 0!==t)return t>n.length?!1:n[t].match(e)?t===n.length-1?!0:t+1:!1;if(e instanceof Array||(e=[e]),e.length>n.length)return!1;var i;for(i=0;i<e.length;i++)if(!n[i].match(e[i]))return!1;return i===n.length?!0:i},equals:function(e){if(!e.keys)return!1;if(e.keys.length!==this.keys.length)return!1;for(var t=0;t<e.keys.length;t++)if(!e.keys[t].equals(this.keys[t]))return!1;return!0}},{KeyBinding:t,KeyStroke:t,KeySequence:n}}),define("orion/parameterCollectors",["i18n!orion/nls/messages","require","orion/webui/littlelib"],function(e,t,n){function i(e,t){this._activeContainer=null,this._getElementsFunction=e,this._toolbarLayoutFunction=t}return i.prototype={close:function(){this._activeElements&&(this._activeElements.parameterArea&&n.empty(this._activeElements.parameterArea),this._activeElements.slideContainer&&this._activeElements.slideContainer.classList.remove("slideContainerActive"),this._activeElements.dismissArea&&n.empty(this._activeElements.dismissArea),this._activeElements.commandNode&&this._activeElements.commandNode.classList.remove("activeCommand"),this._toolbarLayoutFunction(this._activeElements),this._activeElements.onClose&&this._activeElements.onClose(),this._oldFocusNode&&(this._oldFocusNode.focus(),this._oldFocusNode=null)),this._activeElements=null},open:function(t,i,r){if("string"==typeof t&&(t=n.node(t)),this._activeElements&&this._activeElements.slideContainer&&this._activeElements.commandNode===t)return this._activeElements.focusNode&&this._activeElements.focusNode.focus(),!0;if(this.close(),this._activeElements=null,this._activeElements=this._getElementsFunction(t),this._activeElements&&this._activeElements.parameterArea&&this._activeElements.slideContainer){this._activeElements.onClose=r;var o=i(this._activeElements.parameterArea,this._activeElements.dismissArea);if(!o)return!1;this._activeElements.focusNode=o;var s=n.$$array("#closebox",this._activeElements.dismissArea||this._activeElements.parameterArea);if(0===s.length){var a=this._activeElements.dismissArea||this._activeElements.parameterArea;s=document.createElement("button"),s.id="closebox",s.className="imageSprite core-sprite-close dismissButton",s.title=e.Close,a.appendChild(s);var l=this;s.addEventListener("click",function(){l.close()},!1)}return this._activeElements.slideContainer.classList.add("slideContainerActive"),this._toolbarLayoutFunction(this._activeElements),o&&(this._oldFocusNode=window.document.activeElement,window.setTimeout(function(){o.focus(),o.select&&o.select()},0)),this._activeElements.commandNode&&this._activeElements.commandNode.classList.add("activeCommand"),!0}return!1},_collectAndCall:function(e,t){n.$$array("input",t).forEach(function(t){"checkbox"===t.type?e.parameters.setValue(t.parameterName,t.checked):"button"!==t.type&&e.parameters.setValue(t.parameterName,t.value.trim())}),n.$$array("textArea",t).forEach(function(t){e.parameters.setValue(t.parameterName,t.value.trim())});var i=e.parameters.getParameterElement;i&&e.parameters.forEach(function(n){var r=i(n,t);r&&("checkbox"===r.type?e.parameters.setValue(r.parameterName,r.checked):"button"!==r.type?e.parameters.setValue(r.parameterName,r.value.trim()):"textarea"!==r.type&&e.parameters.setValue(r.parameterName,r.value.trim()))}),e.command.callback&&e.command.callback.call(e.handler,e)},collectParameters:function(e,t){return e.parameters?(e.domNode&&e.domNode.classList.add("commandMarker"),this.open(e.domNode||e.domParent,this.getFillFunction(e,null,t))):!1},getFillFunction:function(t,i,r){var o=this;return function(s,a){var l=null,d=function(){i&&i(),o.close()},c=function(e){e.keyCode===n.KEY.ENTER&&(o._collectAndCall(t,s),d(),n.stop(e)),e.keyCode===n.KEY.ESCAPE&&("function"==typeof r&&r(),d(),n.stop(e))},h=t.parameters;h.forEach(function(e){var i=h.getParameterElement?h.getParameterElement(e,s):null,r=null;!i&&e.label&&(r=document.createElement("label"),r.classList.add("parameterInput"),r.setAttribute("for",e.name+"parameterCollector"),r.textContent=e.label,s.appendChild(r));var o=e.type,a=e.name+"parameterCollector",u=r||s;"text"===o&&"number"==typeof e.lines&&e.lines>1?(i||(i=document.createElement("textarea"),i.rows=e.lines,i.type="textarea",i.id=a,u.appendChild(i)),c=function(e){e.keyCode===n.KEY.ESCAPE&&(d(),n.stop(e))}):"boolean"===e.type?(i||(i=document.createElement("input"),i.type="checkbox",i.id=a,u.appendChild(i)),e.value&&(i.checked=!0)):(i||(i=document.createElement("input"),i.type=e.type,i.id=a,u.appendChild(i)),e.value&&(i.value=e.value)),i.classList.add("parameterInput"),i.setAttribute("speech","speech"),i.setAttribute("x-webkit-speech","x-webkit-speech"),i.parameterName=e.name,l||(l=i),e.eventListeners.length>0&&e.eventListeners.forEach(function(e){i.addEventListener(e.event,function(n){return e.handler(n,t)},e.capture)}),i.addEventListener("keydown",c,!1)});var u=a;u||(u=document.createElement("span"),u.classList.add("layoutRight"),u.classList.add("parametersDismiss"),s.appendChild(u));var p=function(e){e._collectAndCall(t,s),d()},f=function(e,t){var n=document.createElement("button");return t.appendChild(n),e&&n.appendChild(document.createTextNode(e)),n.classList.add("dismissButton"),n};if(t.parameters.hasOptionalParameters()){t.parameters.optionsRequested=!1;var g=f(e.More,u);g.addEventListener("click",function(){t.parameters.optionsRequested=!0,p(o)},!1)}var m=f(h.getSubmitName?h.getSubmitName(t):e.Submit,u);m.addEventListener("click",function(){p(o)},!1);var v=f(null,u);return v.id="closebox",v.classList.add("imageSprite"),v.classList.add("core-sprite-close"),v.title=e.Close,v.addEventListener("click",function(){d(),"function"==typeof r&&r()},!1),l}}},i.prototype.constructor=i,{CommandParameterCollector:i}}),define("orion/regex",[],function(){function e(e){return e.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&")}function t(e){var t=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(e);return t?{pattern:t[1],flags:t[2]}:null}return{escape:e,parse:t}}),define("orion/contentTypes",[],function(){function e(e,t){return-1!==e.indexOf(t)}function t(t,n){function i(t,n,i,r){var o=n.filename.indexOf(i)>=0,s=e(n.extension,r.toLowerCase());return(o||s)&&(!t||o&&e(t.extension,r.toLowerCase()))?n:t}if("string"!=typeof t)return null;for(var r=t&&t.split(".").pop(),o=null,s=0;s<n.length;s++){var a=n[s];i(o,a,t,r)===a&&(o=a)}return o}function n(e){return null===e||"undefined"==typeof e?[]:Array.isArray(e)?e:[e]}function i(e){return n(e).map(function(e){return String.prototype.toLowerCase.call(e)
})}function r(e){return{id:e.id,name:e.name,image:e.image,imageClass:e.imageClass,"extends":e["extends"],extension:i(e.extension),filename:n(e.filename)}}function o(e){var t=Object.create(null);return e.map(r).forEach(function(e){Object.prototype.hasOwnProperty.call(t,e.id)||(t[e.id]=e)}),t}function s(e){for(var t=e.getServiceReferences(d).concat(e.getServiceReferences(c)),i=[],r=0;r<t.length;r++)for(var s=t[r],a=n(s.getProperty("contentTypes")),l=0;l<a.length;l++)i.push(a[l]);return o(i)}function a(e){if(e&&e.registerService)this.serviceRegistry=e,this.map=s(e),e.registerService(l,this);else{if(!Array.isArray(e))throw new Error("Invalid parameter");this.serviceRegistry=null,this.map=o(e)}}var l="orion.core.contentTypeRegistry",d="orion.core.contenttype",c="orion.file.contenttype";return a.prototype={getContentTypes:function(){var e=this.getContentTypesMap(),t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(e[n]);return t},getContentTypesMap:function(){return this.map},getFileContentType:function(e){return t(e.Name,this.getContentTypes())},getFilenameContentType:function(e){return t(e,this.getContentTypes())},getContentType:function(e){return this.map[e]||null},isExtensionOf:function(e,t){if(e="string"==typeof e?this.getContentType(e):e,t="string"==typeof t?this.getContentType(t):t,!e||!t)return!1;if(e.id===t.id)return!0;for(var n=e,i={};n&&(n=this.getContentType(n["extends"]));){if(n.id===t.id)return!0;if(i[n.id])throw new Error("Cycle: "+n.id);i[n.id]=!0}return!1},isSomeExtensionOf:function(e,t){for(var n=0;n<t.length;n++)if(this.isExtensionOf(e,t[n]))return!0;return!1}},{ContentTypeRegistry:a,getFilenameContentType:t}}),define("orion/PageLinks",["require","orion/Deferred","orion/PageUtil","orion/URITemplate","orion/i18nUtil","orion/objects","orion/URL-shim"],function(e,t,n,i,r,o){function s(){return e.toUrl?new URL(e.toUrl("orion/../"),window.location.href).href.slice(0,-1):new URL("/",window.location.href).href.slice(0,-1)}function a(e,t){return c(e,t).then(function(e){return new p(e)})}function l(e){var t={};return e.getPropertyKeys().forEach(function(n){"objectClass"!==n&&"service.names"!==n&&"service.id"!==n&&"__plugin__"!==n&&(t[n]=e.getProperty(n))}),t}function d(e){return r.getMessageBundle(e.nls).then(function(t){return e.textContent=e.nameKey?t[e.nameKey]:e.name,e},function(){return e.textContent=e.nameKey||e.name,e})}function c(e,r){r=r||"orion.page.link";var o=e.getServiceReferences(r),a=n.matchResourceParameters(window.location.href),c=s(),h={OrionHome:c,Location:a.resource},u=[];return o.forEach(function(e){var r=l(e);if(r.uriTemplate&&(r.nls||r.name)){var o=new i(r.uriTemplate),s=o.expand(h);s=n.validateURLScheme(s),r.href=s,r.nls?u.push(d(r)):(r.textContent=r.name,u.push((new t).resolve(r)))}}),t.all(u)}function h(e){var n;if(!m){n=[];var i=e.getServiceReferences("orion.page.link.category");return i.forEach(function(i){var r=l(i);r.id&&(r.name||r.nameKey)&&(r.service=e.getService(i),r.nls?n.push(d(r)):(r.textContent=r.name,n.push((new t).resolve(r))))}),t.all(n).then(function(e){return m=new u(e)})}return(new t).resolve(m)}function u(e){var t=this.categories=Object.create(null);e.forEach(function(e){t[e.id]=e})}function p(e){this.allPageLinks=e,this.allPageLinks.sort(f)}function f(e,t){var n=e.textContent&&e.textContent.toLowerCase(),i=t.textContent&&t.textContent.toLowerCase();return i>n?-1:n>i?1:0}function g(e,t,n){var i=document.createElement("a");return i.href=e,i.target=t,i.classList.add("targetSelector"),i.textContent=n,i}var m;return o.mixin(u.prototype,{getCategoryIDs:function(){return Object.keys(this.categories)},getCategory:function(e){return this.categories[e]||null}}),o.mixin(p.prototype,{createLinkElements:function(){return this.allPageLinks.map(function(e){return g(e.href,"_self",e.textContent)})},getAllLinks:function(){return this.allPageLinks}}),{getCategoriesInfo:h,getPageLinksInfo:a,getOrionHome:s}}),define("orion/extensionCommands",["require","orion/Deferred","orion/commands","orion/regex","orion/contentTypes","orion/URITemplate","orion/i18nUtil","orion/URL-shim","orion/PageLinks","i18n!orion/edit/nls/messages"],function(e,t,n,i,r,o,s,a,l,d){function c(e){var t={},n=e.getPropertyKeys();return n.forEach(function(n){t[n]=e.getProperty(n)}),t}function h(e){return e.id||e.name}var u={},p=l.getOrionHome();u._cloneItemWithoutChildren=function v(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)"children"!==n&&"Children"!==n&&(t[n]=v(e[n]));return t},u._getOpenWithNavCommandExtensions=function(e){function t(){for(var t=e.getServiceReferences("orion.edit.editor"),n=[],i=0;i<t.length;i++){var r=t[i],o=r.getProperty("id");n.push({id:o,"default":r.getProperty("default")||!1,name:r.getProperty("name"),nameKey:r.getProperty("nameKey"),nls:r.getProperty("nls"),uriTemplate:r.getProperty("orionTemplate")||r.getProperty("uriTemplate"),validationProperties:r.getProperty("validationProperties")||[]})}return n}function n(e,t){for(var n=e.getServiceReferences("orion.navigate.openWith"),i=[],r=[],o=0;o<n.length;o++){var s=n[o];if(s.getProperty("editor")===t.id){var a=s.getProperty("contentType");a instanceof Array?i=i.concat(a):i.push(a||"*/*");var l=s.getProperty("excludedContentTypes");l instanceof Array?r=r.concat(l):null!==l&&"undefined"!=typeof l&&r.push(l)}}return 0===i.length&&(i=null),0===r.length&&(r=null),{contentTypes:i,excludedContentTypes:r}}for(var i,r=t(),o=[],s="orion.editor",a=0;a<r.length;a++){var l=r[a],d=n(e,l),c=d.contentTypes,h=d.excludedContentTypes,u={name:l.name||l.id,nameKey:l.nameKey,id:"eclipse.openWithCommand."+l.id,contentType:c,excludedContentTypes:h,uriTemplate:l.uriTemplate,nls:l.nls,forceSingleItem:!0,isEditor:l["default"]?"default":"editor",validationProperties:l.validationProperties},p={properties:u,service:{}};l.id===s?i=p:o.push(p)}return i&&o.push(i),o},u._makeValidator=function(e,t,n,i){function s(e,t,n,i,r){var o,s=!1;if("!"===t.charAt(0))return"undefined"==typeof e[t.substring(1)];if("undefined"!=typeof e[t]){if("undefined"==typeof n)o=e[t],s=!0;else if("string"==typeof n){if(!i.variableName)return new RegExp(n).test(e[t]);var a=new RegExp(n).exec(e[t]);if(a){var l=a[0];o="before"===i.variableMatchPosition?e[t].substring(0,a.index):"after"===i.variableMatchPosition?e[t].substring(a.index+l.length):"only"===i.variableMatchPosition?l:e[t],s=!0}}else e[t]===n&&(o=e[t],s=!0);var d=i.variableName,c=i.replacements;if(s&&d&&(r[d]=o,r.itemCached=e,c)){if("string"!=typeof o)return window.console.log("Cannot replace "+d+", value is not a string: "+o),s;for(var h=0;h<c.length;h++){var u=!1;if(c[h].pattern){var p=c[h].pattern,f=c[h].replacement||"";r[d]=r[d].replace(new RegExp(p),f).replace(new RegExp(p),f)}else u=!0;u&&window.console.log("Invalid replacements specified in validation property.  "+c[h])}}return s}return!1}function a(e,t,n,i){var r,o,l,d,c=n.match;if((l=t.indexOf("["))>=0){if((d=t.indexOf("]"))<0)return!1;var h,u,p=t.substring(0,l);if(!(h=e[p])||!Array.isArray(h))return!1;if(r=t.substring(l+1,d),u=parseInt(r,10),isNaN(u))return!1;0>u&&(u+=h.length),o=t.substring(d+1),t=p+":"+String(u)+o}return t.indexOf("|")>=0?(r=t.substring(0,t.indexOf("|")),o=t.substring(t.indexOf("|")+1),a(e,r,n,i)?!0:a(e,o,n,i)):t.indexOf(":")>=0?(r=t.substring(0,t.indexOf(":")),o=t.substring(t.indexOf(":")+1),e[r]?a(e[r],o,n,i):!1):s(e,t,c,n,i)}function l(t,n,i){if(i.info.validationProperties)for(var o=0;o<i.info.validationProperties.length;o++){var s=i.info.validationProperties[o];if("undefined"==typeof s.source)return window.console.log("Invalid validationProperties in "+e.id+".  No source property specified."),!1;var l=a(t,s.source,s,i);if(!l)return!1}var d=!0,c=n?r.getFilenameContentType(t.Name,n):null;return c=c||{id:"application/octet-stream"},i.info.excludedContentTypes&&n&&(d=i.info.excludedContentTypes.every(function(e){var t=e.replace(/([*?])/g,".$1");return-1!==c.id.search(t)?!1:!0})),d&&i.info.contentType&&n&&(d=i.info.contentType.some(function(e){var t=e.replace(/([*?])/g,".$1");return-1!==c.id.search(t)?!0:!1})),d}var d={info:e};return d.validationFunction=function(e){if("function"==typeof i&&(e=i.call(this,e)),e){if(Array.isArray(e)){if((this.info.forceSingleItem||this.info.uriTemplate)&&1!==e.length)return!1;if(e.length<1)return!1}else e=[e];for(var t=0;t<e.length;t++)if(!l(e[t],n,this))return!1;return!0}return!1},d.generatesURI=function(){return!!this.info.uriTemplate},d.getURI=function(e){if(this.info.uriTemplate){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);if(this.info.validationProperties)for(var i=0;i<this.info.validationProperties.length;i++){var r=this.info.validationProperties[i];if(r.source&&r.variableName){var s=this.itemCached===e&&this[r.variableName];s||a(e,r.source,r,this),e[r.variableName]?window.console.log("Variable name "+r.variableName+" in the extension "+this.info.id+" conflicts with an existing property in the item metadata."):t[r.variableName]=this[r.variableName]}}t.OrionHome=p;var l=new o(this.info.uriTemplate);return l.expand(t)}return null},d};var f=d.UnnamedCommand,g="";u._createCommandOptions=function(e,n,i,r,o,a){function l(t,s){var l=u._makeValidator(e,i,r,a);if(t.visibleWhen=l.validationFunction.bind(l),o)if(l.generatesURI.bind(l)())t.hrefCallback=function(e){var t=Array.isArray(e.items)?e.items[0]:e.items;return l.getURI.bind(l)(t)};else{var d=e;t.callback=function(e){var r;if(d.forceSingleItem){var o=Array.isArray(e.items)?e.items[0]:e.items;r=u._cloneItemWithoutChildren(o)}else if(Array.isArray(e.items)){r=[];for(var s=0;s<e.items.length;s++)r.push(u._cloneItemWithoutChildren(e.items[s]))}else r=u._cloneItemWithoutChildren(e.items);if(i)var a=i.getService("orion.page.progress");n.run?a?a.progress(n.run(r),"Running command: "+t.name):n.run(r):i&&(a?a.progress(i.getService(n).run(r),"Running command: "+t.name):i.getService(n).run(r))}}s.resolve(t)}var d=new t;if(e.nls){var c=function(t){var n,i;if(t){var r=e.nameKey&&t[e.nameKey],o=e.tooltipKey&&t[e.tooltipKey];n=r||e.name||f,i=o||e.tooltip||g}else n=e.name||e.nameKey||f,i=e.tooltip||e.tooltipKey||g;var s={name:n,image:e.image,id:h(e),tooltip:i,isEditor:e.isEditor,showGlobally:e.showGlobally};l(s,d)};s.getMessageBundle(e.nls).then(c,c.bind(this,null))}else{var p={name:e.name,image:e.image,id:h(e),tooltip:e.tooltip,isEditor:e.isEditor,showGlobally:e.showGlobally};l(p,d)}return d},u.getOpenWithCommand=function(e,t,n){for(var i,r=n||u.getOpenWithCommands(e),o=0;o<r.length;o++)if(r[o].visibleWhen(t)){var s="default"===r[o].isEditor;if((!i||s)&&(i=r[o],s))break}return i},u.getOpenWithCommands=function(e){var t=[];for(var n in e._commandList){var i=e._commandList[n];i.isEditor&&t.push(i)}return t};var m;return u.createAndPlaceFileCommandsExtension=function(e,t,n,i,r,o){var s=o?"all":void 0,a=!!o;return u.createFileCommands(e,null,s,a,t).then(function(e){return r&&0<e.length&&(t.addCommandGroup(n,"eclipse.openWith",1e3,d.OpenWith,r,null,null,null,"dropdownSelection"),t.addCommandGroup(n,"eclipse.fileCommandExtensions",1e3,d.OpenRelated,r)),e.forEach(function(e){var o=null;r&&(o=e.isEditor?r+"/eclipse.openWith":r+"/eclipse.fileCommandExtensions"),t.registerCommandContribution(n,e.id,i,o)}),{}})},u.createFileCommands=function(e,i,r,o,s){function a(){var n=e.getService("orion.core.contentTypeRegistry")||i;return m||t.when(n.getContentTypes(),function(e){return m=e})}r=void 0===r?"global":r,o=void 0===o?!0:o;var l=[];return u._cachedFileCommands||u._createCachedFileCommands(e),("all"===r||"global"===r)&&u._cachedFileCommands.forEach(function(e){var t=e.properties;("all"===r||t.forceSingleItem&&t.showGlobally)&&l.push(e)}),t.when(a(),function(){o&&(u._cachedOpenWithExtensions||(u._cachedOpenWithExtensions=u._getOpenWithNavCommandExtensions(e,m)),l=l.concat(u._cachedOpenWithExtensions),s._addedOpenWithCommands=o);var i=l.map(function(i){var r=i.properties,o=i.service,a=s.findCommand(h(r));return a?(new t).resolve(a):u._createCommandOptions(r,o,e,m,!0).then(function(e){var t=new n.Command(e);return s.addCommand(t),t})});return t.all(i,function(e){return{_error:e}}).then(function(e){return e})})},u._createCachedFileCommands=function(e){var t=e.getServiceReferences("orion.navigate.command");u._cachedFileCommands=[];for(var n=0;n<t.length;n++){var i=t[n].getProperty("id");if("orion.navigateFromMetadata"!==i){var r=e.getService(t[n]),o=c(t[n]);u._cachedFileCommands.push({properties:o,service:r})}}},u.getFileCommandIds=function(){var e=[];if(!u._cachedFileCommands)throw"extensionCommandUtils._cachedFileCommands is not initialized";return u._cachedFileCommands.length&&(e=u._cachedFileCommands.map(function(e){return e.properties.id})),e},u.createOpenWithCommands=function(e,n,i){return i&&i._addedOpenWithCommands?(new t).resolve(u.getOpenWithCommands(i)):u.createFileCommands(e,n,"none",!0,i)},u}),define("orion/breadcrumbs",["require","orion/webui/littlelib"],function(e,t){function n(e){this._init(e)}return n.prototype={_init:function(e){var n=t.node(e.container);if(!n)throw"no parent container";this._container=n,n.classList.remove("currentLocation"),this._id=e.id||"eclipse.breadcrumbs",this._resource=e.resource||null,this._rootSegmentName=e.rootSegmentName,this._workspaceRootSegmentName=e.workspaceRootSegmentName,this._workspaceRootURL=e.workspaceRootURL,this._makeHref=e.makeHref,this._makeFinalHref=e.makeFinalHref,this._maxLength=e.maxLength,this.path="",this.measure(),this.render()},getNavigatorWorkspaceRootSegment:function(){if(this._workspaceRootSegmentName){var n;if(this._resource&&this._resource.Parents&&!this._resource.skip){n=document.createElement("a");var i=this._workspaceRootURL?this._workspaceRootURL:"";this._makeHref?this._makeHref(n,i):n.href=e.toUrl("edit/edit.html")+"#"+i}else n=document.createElement("span");return t.empty(n),n.appendChild(document.createTextNode(this._workspaceRootSegmentName)),n}return null},MAX_LENGTH:500,INCLUDE_FIRST_SECTION:!0,segments:[],buildSegment:function(e){var t=document.createElement("a");return t.classList.add("breadcrumb"),t.appendChild(document.createTextNode(e)),t},addSegmentHref:function(t,n){this._makeHref?this._makeHref(t,n.Location,n):t.href=e.toUrl("edit/edit.html")+"#"+n.ChildrenLocation},buildSegments:function(e,t){if(this._resource.Parents){var n,i,r=this._resource.Parents.slice(0);if(r){var o=r.slice(0);"reverse"===t&&(o=o.reverse().slice(0)),o.forEach(function(t){t.skip||(e?(i=e,e=null):i=t.Name,n=this.buildSegment(i),this.path+=t.Name,this.addSegmentHref(n,t),n.include=!1,this.segments.push(n))}.bind(this))}}},addDivider:function(){var e=document.createElement("span");e.appendChild(document.createTextNode(" / ")),this.path+="/",e.classList.add("breadcrumbSeparator"),this.append(e)},refresh:function(){this.crumbs=t.node(this._id),this.crumbs?t.empty(this.crumbs):(this.crumbs=document.createElement("span"),this.crumbs.id=this._id,this._container.appendChild(this.crumbs),this.dirty=document.createElement("span"),this.dirty.id="dirty",this.dirty.className="modifiedFileMarker",this._container.appendChild(this.dirty)),this.crumbs.style.width="auto",this.crumbs.style.visibility="visible",this.crumbs.parentNode.className="currentLocation",this.crumbs.parentNode.style.width="auto"},append:function(e){this.crumbs.appendChild(e)},addTitle:function(e,t){var n=t||document.title;0===this.crumbs.childNodes.length&&(e=document.createElement("span"),e.appendChild(document.createTextNode(n)),e.classList.add("breadcrumb"),e.classList.add("currentLocation"),this.append(e))},finalSegment:function(e,t){if(!this._resource.skip){var n;n=t?t:this._resource.Name,this._makeFinalHref?(e=this.buildSegment(n),this.addSegmentHref(e,this._resource)):(e=document.createElement("span"),e.appendChild(document.createTextNode(n))),e.classList.add("currentLocation"),this.path+=this._resource.Name,this.append(e)}},firstSegment:function(e){if(e){if(this.append(e),!this._resource||!this._resource.Parents||this._resource.skip)return this._resource.skip||(e.href=""),void e.classList.add("currentLocation");e.classList.add("breadcrumb"),this.addDivider()}},drawSegments:function(){if(this._resource.Parents){var e=this.segments.slice(0);e.forEach(function(e){e.include===!0&&(this.append(e),this.addDivider())}.bind(this))}},measureSegments:function(){if(this.INCLUDE_FIRST_SECTION=!0,this._resource.Parents){var e=this.segments.slice(0).reverse();e.forEach(function(e){this.append(e),this.addDivider(),this.crumbs.offsetWidth<this.MAX_LENGTH?e.include=!0:this.INCLUDE_FIRST_SECTION=!1}.bind(this)),this.segments=e.reverse()}},measure:function(){var e=this._container;e.style.width="auto",this.MAX_LENGTH=this._maxLength?this._maxLength:e.offsetWidth,this.refresh(),this.segments=[],this.crumbs.style.visibility="hidden";var t=this.getNavigatorWorkspaceRootSegment(),n=this._rootSegmentName;n?this.addTitle(t,n):(this.finalSegment(t,n),this._resource&&this._resource.Parents&&(this.buildSegments(n,"reverse"),this.measureSegments(),this.firstSegment(t)),this.crumbs.offsetWidth>=this.MAX_LENGTH&&(this.INCLUDE_FIRST_SECTION=!1))},render:function(){this.refresh();var e=this.getNavigatorWorkspaceRootSegment(),t=this._rootSegmentName;t?this.addTitle(e,t):(this.INCLUDE_FIRST_SECTION===!0&&this.firstSegment(e),this._resource&&this._resource.Parents&&(this.drawSegments(),this.finalSegment(e,t))),this.crumbs.parentNode.style.width=this.crumbs.offsetWidth+20+"px"}},n.prototype.constructor=n,{BreadCrumbs:n}}),define("orion/webui/splitter",["orion/EventTarget","orion/util","orion/webui/littlelib"],function(e,t,n){function i(t){e.attach(this),this._init(t)}var r=5,o="horizontal",s="vertical";return i.prototype={_init:function(e){if(this._tracking=null,this._animationDelay=501,this._closeReversely=e.closeReversely,this.$node=n.node(e.node),!this.$node)throw"no dom node for splitter found";if(this.$sideNode=n.node(e.sidePanel),!this.$sideNode)throw"no dom node for side panel found";if(this.$mainNode=n.node(e.mainPanel),!this.$mainNode)throw"no dom node for main panel found";this._vertical=e.vertical||!1;var i=this.$node.classList;i.add("split"),i.add(this._vertical?"splitVerticalLayout":"splitLayout"),i=this.$sideNode.classList,i.add("hasSplit"),i.add(this._vertical?"sidePanelVerticalLayout":"sidePanelLayout"),i=this.$mainNode.classList,i.add("hasSplit"),i.add(this._vertical?"mainPanelVerticalLayout":"mainPanelLayout"),this._prefix="/orion/splitter/"+(this.$node.id||document.body.id||""),e.toggle&&(this._thumb=document.createElement("div"),this.$node.appendChild(this._thumb),this._thumb.classList.add("splitThumb"),this._thumb.classList.add(this._vertical?"splitVerticalThumbLayout":"splitThumbLayout")),this._closeByDefault="closed"===this.$node.getAttribute("data-initial-state"),"undefined"!=typeof e.closeByDefault&&(this._closeByDefault=e.closeByDefault),this._initializeFromStoredSettings(),this._closed?(this._closed=!1,this._thumbDown(!0,!0)):this._adjustToSplitPosition(),this.$node.style.visibility="visible",this.$mainNode.style.display="block",this.$sideNode.style.display="block",t.isIOS||t.isAndroid?(this.$node.addEventListener("touchstart",this._touchStart.bind(this),!1),this._thumb&&this._thumb.addEventListener("touchstart",this._touchStart.bind(this),!1),this.$node.addEventListener("touchmove",this._touchMove.bind(this),!1),this.$node.addEventListener("touchend",this._touchEnd.bind(this),!1)):(this.$node.addEventListener("mousedown",this._mouseDown.bind(this),!1),window.addEventListener("mouseup",this._mouseUp.bind(this),!1)),window.addEventListener("resize",this._resize.bind(this),!1)},isClosed:function(){return this._closed},getOrientation:function(){return this._vertical?s:o},setOrientation:function(e){var t=e===s;if(t!==this._vertical){this._vertical=t;var n=this.$node.classList;n.toggle("splitLayout"),n.toggle("splitVerticalLayout"),this.$node.style.left="",this.$node.style.top="",n=this.$sideNode.classList,n.toggle("sidePanelLayout"),n.toggle("sidePanelVerticalLayout"),this.$sideNode.style.left="",this.$sideNode.style.top="",this.$sideNode.style.width="",this.$sideNode.style.height="",n=this.$mainNode.classList,n.toggle("mainPanelLayout"),n.toggle("mainPanelVerticalLayout"),this.$mainNode.style.left="",this.$mainNode.style.top="",this.$mainNode.style.width="",this.$mainNode.style.height="",this._thumb&&(n=this._thumb.classList,n.toggle("splitThumbLayout"),n.toggle("splitVerticalThumbLayout")),this._initializeFromStoredSettings(),this._closed?(this._closed=!1,this._thumbDown(!0,!0)):this._adjustToSplitPosition()}},toggleSidePanel:function(){this._thumbDown()},openSidePanel:function(){this._closed||this._thumbDown()},addResizeListener:function(e){this.addEventListener("resize",function(t){e(t.node)})},_initializeFromStoredSettings:function(){var e=localStorage.getItem(this._prefix+"/toggleState");this._closed="string"==typeof e?"closed"===e:this._closeByDefault;var t,i=n.bounds(this.$node.parentNode),r=n.bounds(this.$node);this._vertical?(t=localStorage.getItem(this._prefix+"/yPosition"),t?(this._splitTop=parseInt(t,10),this._splitTop>i.top+i.height-r.height&&(this._splitTop=i.top+i.height/2)):this._closeByDefault&&(this._initialSplit=this._getSplitPosition(),this._splitTop=0)):(t=localStorage.getItem(this._prefix+"/xPosition"),t?(this._splitLeft=parseInt(t,10),this._splitLeft>i.left+i.width-r.width&&(this._splitLeft=i.left+i.width/2)):this._closeByDefault&&(this._initialSplit=this._getSplitPosition(),this._splitLeft=0))},_getSplitPosition:function(){var e=n.bounds(this.$node),t=n.bounds(this.$node.parentNode);return this.vertical?e.top-t.top:e.left-t.left},_adjustToSplitPosition:function(e){var t=n.bounds(this.$node),i=n.bounds(this.$node.parentNode);if(this._vertical){this._splitHeight=t.height,(e||!this._splitTop)&&(this._splitTop=t.top,localStorage.setItem(this._prefix+"/yPosition",this._splitTop));var r=this._splitTop;r=this._splitTop-i.top,this.$sideNode.style.height=r+"px",this.$sideNode.style.display="block",this.$node.style.top=r+"px",this._resize()}else{this._splitWidth=t.width,(e||!this._splitLeft)&&(this._splitLeft=t.left,localStorage.setItem(this._prefix+"/xPosition",this._splitLeft));var o=this._splitLeft;o=this._splitLeft-i.left,this.$sideNode.style.width=o+"px",this.$sideNode.style.display="block",this.$node.style.left=o+"px",this._resize()}},_resize:function(e,t,i){e=e||0;var r=n.bounds(this.$node.parentNode),o=n.bounds(this.$node);this._vertical?(void 0===i&&(i=o.top-r.top),i+=o.height,this.$mainNode.style.top=i+"px"):(void 0===t&&(t=o.left-r.left),t+=o.width,this.$mainNode.style.left=t+"px");var s=this;window.setTimeout(function(){s._notifyResizeListeners(s.$mainNode),s._notifyResizeListeners(s.$sideNode)},e)},_notifyResizeListeners:function(e){this.dispatchEvent({type:"resize",node:e})},_notifyToggleListeners:function(){this.dispatchEvent({type:"toggle",closed:this._closed})},_thumbDown:function(e,t){e||this._addAnimation();var i=this._splitTop,r=this._splitLeft;if(this._closed)this._closed=!1,this._splitLeft||this._splitTop||"number"!=typeof this._initialSplit||(i=r=this._initialSplit);else if(this._closed=!0,this._closeReversely){var o=n.bounds(this.$node.parentNode),s=n.bounds(this.$node);this._vertical?i=o.height-s.height:r=o.width-s.width}else i=r=0;this._vertical?(this.$sideNode.style.height=i+"px",this.$node.style.top=i+"px"):(this.$sideNode.style.width=r+"px",this.$node.style.left=r+"px"),this._resize(this._animationDelay,r,i),e||this._removeAnimation(),t||localStorage.setItem(this._prefix+"/toggleState",this._closed?"closed":null);var a=this;window.setTimeout(function(){a._notifyToggleListeners()},this._animationDelay)},_removeAnimation:function(){var e=this;window.setTimeout(function(){e.$sideNode.classList.remove(e._vertical?"sidePanelVerticalLayoutAnimation":"sidePanelLayoutAnimation"),e.$mainNode.classList.remove(e._vertical?"mainPanelVerticalLayoutAnimation":"mainPanelLayoutAnimation"),e.$node.classList.remove(e._vertical?"splitVerticalLayoutAnimation":"splitLayoutAnimation")},this._animationDelay)},_addAnimation:function(){this.$sideNode.classList.add(this._vertical?"sidePanelVerticalLayoutAnimation":"sidePanelLayoutAnimation"),this.$mainNode.classList.add(this._vertical?"mainPanelVerticalLayoutAnimation":"mainPanelLayoutAnimation"),this.$node.classList.add(this._vertical?"splitVerticalLayoutAnimation":"splitLayoutAnimation")},_down:function(){this.$node.classList.add("splitTracking"),this.$mainNode.classList.add("panelTracking"),this.$sideNode.classList.add("panelTracking")},_move:function(e,t){var i=n.bounds(this.$node.parentNode);if(this._vertical){this._splitTop=t,this._splitTop<i.top+r?this._splitTop=i.top+r:this._splitTop>i.top+i.height-r&&(this._splitTop=i.top+i.height-r);var o=this._splitTop;o=this._splitTop-i.top,this.$node.style.top=o+"px"}else{this._splitLeft=e,this._splitLeft<i.left+r?this._splitLeft=i.left+r:this._splitLeft>i.left+i.width-r&&(this._splitLeft=i.left+i.width-r);var s=this._splitLeft;s=this._splitLeft-i.left,this.$node.style.left=s+"px"}this._adjustToSplitPosition(!0)},_up:function(){this.$node.classList.remove("splitTracking"),this.$mainNode.classList.remove("panelTracking"),this.$sideNode.classList.remove("panelTracking")},_mouseDown:function(e){return e.target===this._thumb?(n.stop(e),this._thumbDown()):void(this._tracking||(this._down(e),this._tracking=this._mouseMove.bind(this),window.addEventListener("mousemove",this._tracking),n.setFramesEnabled(!1),n.stop(e)))},_mouseMove:function(e){this._tracking&&this._move(e.clientX,e.clientY)},_mouseUp:function(e){this._tracking&&(n.setFramesEnabled(!0),window.removeEventListener("mousemove",this._tracking),this._tracking=null,this._up(),n.stop(e))},_touchStart:function(e){var t=e.touches;if(1===t.length){if(n.stop(e),e.target===this._thumb)return this._thumbDown();this._down(e),this._touching=!0}},_touchMove:function(e){if(this._touching){var t=e.touches;if(1===t.length){var n=t[0];this._move(n.clientX,n.clientY)}}},_touchEnd:function(e){var t=e.touches;0===t.length&&(this._touching=!1,this._up())}},i.prototype.constructor=i,{Splitter:i,ORIENTATION_HORIZONTAL:o,ORIENTATION_VERTICAL:s}}),define("orion/keyAssist",["i18n!orion/nls/messages","orion/webui/littlelib","orion/util"],function(e,t,n){function i(e){this.commandRegistry=e.commandRegistry,this.create(),this._filterString="",this._providers=[]}return i.prototype={addProvider:function(e){this._providers.push(e)},create:function(){var i=this._keyAssistDiv=document.createElement("div");i.id="keyAssist",i.style.display="none",i.classList.add("keyAssistFloat"),i.setAttribute("role","menu");var r=this._keyAssistInput=document.createElement("input");r.classList.add("keyAssistInput"),r.type="text",r.placeholder=e["Filter bindings"],i.appendChild(r);var o=this._keyAssistContents=document.createElement("div");o.classList.add("keyAssistContents"),(n.isIOS||n.isAndroid)&&(o.style.overflowY="auto"),i.appendChild(o);var s=this._keyAssistTable=document.createElement("table");s.tabIndex=0,s.classList.add("keyAssistList"),o.appendChild(s),document.body.appendChild(i),r.addEventListener("keydown",function(e){this._keyDown(e)}.bind(this)),s.addEventListener("keydown",function(e){this._keyDown(e)}.bind(this)),r.addEventListener("input",function(){this.filterChanged()}.bind(this)),o.addEventListener(n.isFirefox?"DOMMouseScroll":"mousewheel",function(e){this._scrollWheel(e)}.bind(this)),document.addEventListener("keydown",function(e){e.keyCode===t.KEY.ESCAPE&&this.hide()}.bind(this)),t.addAutoDismiss([i],function(){this.hide()}.bind(this))},createContents:function(){var n=this._keyAssistTable;t.empty(n),this._selectedIndex=-1,this._selectedRow=null,this._keyAssistContents.scrollTop=0,this._idCount=0;for(var i=0;i<this._providers.length;i++)this._providers[i].showKeyBindings(this);this.createHeader(e.Global),this.commandRegistry.showKeyBindings(this)},createItem:function(e,t,n){if(this._filterString){var i,r=this._filterString.toLowerCase();if(r!==this._filterString?(r=this._filterString,i=function(e){return e}):i=function(e){return e.toLowerCase()},-1===i(t).indexOf(r)&&-1===i(e).indexOf(r)&&-1===i(this._lastHeader).indexOf(r))return}var o=this._keyAssistTable.insertRow(-1);o.id="keyAssist-keyBinding-"+this._idCount++,o.setAttribute("role","menuitem"),o._execute=n,o.classList.add("keyAssistItem"),o.addEventListener("click",function(e){this._selectedRow=o,this.execute(),e.preventDefault()}.bind(this));var s=o.insertCell(-1);s.classList.add("keyAssistName"),s.appendChild(document.createTextNode(t)),s=o.insertCell(-1),s.classList.add("keyAssistAccel"),s.appendChild(document.createTextNode(e))},createHeader:function(e){this._lastHeader=e;var t=this._keyAssistTable.insertRow(-1);t.classList.add("keyAssistSection");var n=t.insertCell(-1),i=document.createElement("h2");i.appendChild(document.createTextNode(e)),n.appendChild(i)},execute:function(){window.setTimeout(function(){this.hide();var e=this._selectedRow;this._selectedRow=null,e&&e._execute&&e._execute()}.bind(this),0)},filterChanged:function(){this._timeout&&window.clearTimeout(this._timeout),this._timeout=window.setTimeout(function(){this._timeout=null;var e=this._keyAssistInput.value;this._filterString!==e&&(this._filterString=e,this.createContents())}.bind(this),100)},hide:function(){if(this.isVisible()){var e=document.activeElement,t=this._keyAssistDiv,n=t===e||0!==(16&t.compareDocumentPosition(e));t.style.display="none",n&&1!==document.compareDocumentPosition(this._previousActiveElement)&&this._previousActiveElement.focus(),this._previousActiveElement=null}},isVisible:function(){return"block"===this._keyAssistDiv.style.display},removeProvider:function(e){var t=this._providers.indexOf(e);-1!==t&&this._providers.splice(t,1)},select:function(e){var t,n=this._keyAssistTable.querySelectorAll(".keyAssistItem");if(0===n.length)return void(this._selectedIndex=-1);var i=this._selectedIndex;if(i+=e?1:-1,i%=n.length,0>i&&(i=n.length-1),-1!==this._selectedIndex&&(t=n[this._selectedIndex],t.classList.remove("selected"),this._selectedRow=null),this._selectedIndex=i,-1!==this._selectedIndex){this._selectedRow=t=n[this._selectedIndex],t.classList.add("selected"),this._keyAssistTable.setAttribute("aria-activedescendant",t.id),this._keyAssistTable.focus();var r=t.getBoundingClientRect(),o=this._keyAssistContents,s=o.getBoundingClientRect();t.offsetTop<o.scrollTop?0===i?o.scrollTop=0:t.scrollIntoView(!0):r.bottom>s.bottom&&t.scrollIntoView(!1)}},show:function(){this.isVisible()||(this._previousActiveElement=document.activeElement,this.createContents(),this._keyAssistContents.style.height=Math.floor(.75*this._keyAssistDiv.parentNode.clientHeight)+"px",this._keyAssistDiv.style.display="block",this._keyAssistInput.value=this._filterString,this._keyAssistInput.focus(),this._keyAssistInput.select())},_keyDown:function(e){if(40===e.keyCode)this.select(!0);else if(38===e.keyCode)this.select(!1);else{if(13!==e.keyCode)return;this.execute()}e.preventDefault()},_scrollWheel:function(e){var t=0;t=n.isIE||n.isOpera?-e.wheelDelta:n.isFirefox?40*e.detail:-e.wheelDeltaY;var i=this._keyAssistContents,r=i.scrollTop;return i.scrollTop+=t,r!==i.scrollTop?(e.preventDefault&&e.preventDefault(),!1):void 0}},{KeyAssistPanel:i}}),define("orion/widgets/themes/ThemePreferences",[],function(){function e(e,t){this._preferences=e,this._themeData=t;var n=t.getThemeStorageInfo();this._themeVersion=n.version;var i=e.listenForChangedSettings(n.storage,2,function(e){e.key===i&&this.apply()}.bind(this))}return e.prototype={_initialize:function(e,t,n){var i,r;void 0===this._themeVersion||n.get("version")===this._themeVersion?(i=n.get(e.styleset),r=n.get("selected"),r&&(r=JSON.parse(r))):(i=null,r=null),i||(i=t.getStyles(),n.put(e.styleset,JSON.stringify(i))),r&&void 0!==r[e.selectedKey]||(r=r||{},r[e.selectedKey]=e.defaultTheme,n.put("selected",JSON.stringify(r))),n.put("version",this._themeVersion)},apply:function(){this.setTheme()},getTheme:function(e){var t=this._themeData,n=t.getThemeStorageInfo();this._preferences.getPreferences(n.storage,2).then(function(i){this._initialize(n,t,i);
var r,o=JSON.parse(i.get("selected")),s=JSON.parse(i.get(n.styleset));if(s)for(var a=0;a<s.length;a++)if(s[a].name===o[n.selectedKey]){r=s[a];break}e({style:r,styles:s})}.bind(this))},setTheme:function(e,t){var n=this._themeData,i=n.getThemeStorageInfo();this._preferences.getPreferences(i.storage,2).then(function(r){this._initialize(i,n,r);var o=JSON.parse(r.get("selected"));e||(e=o[i.selectedKey]),o[i.selectedKey]=e,r.put("selected",JSON.stringify(o)),t?r.put(i.styleset,JSON.stringify(t)):t=JSON.parse(r.get(i.styleset));for(var s=0;s<t.length;s++)if(t[s].name===o[i.selectedKey]){n.processSettings(t[s]);break}r.put("version",this._themeVersion)}.bind(this))},setFontSize:function(e){var t=this._themeData,n=t.getThemeStorageInfo();this._preferences.getPreferences(n.storage,2).then(function(i){this._initialize(n,t,i);var r,o=JSON.parse(i.get("selected")),s=JSON.parse(i.get(n.styleset));if(s)for(var a=0;a<s.length;a++)s[a].fontSize=e,s[a].name===o[n.selectedKey]&&(r=s[a]);i.put(n.styleset,JSON.stringify(s)),t.processSettings(r)}.bind(this))}},{ThemePreferences:e}}),define("orion/settings/nls/root/messages",{"Plugin Description":"Plugin Description",Create:"Create","Loading...":"Loading...","Label:":"Label:",Title:"Title",Plugins:"Plugins","User Profile":"User Profile",Git:"Git","Git Settings":"Git Settings",General:"General",Navigation:"Navigation",Links:"Links","Open in same tab":"Open in same tab","Open in new tab":"Open in new tab",Font:"Font",Family:"Family","Sans Serif":"Sans Serif",Serif:"Serif",Size:"Size","8pt":"8pt","9pt":"9pt","10pt":"10pt","12pt":"12pt",Color:"Color",Background:"Background",Strings:"Strings","String Types":"String Types",blue:"blue",Weight:"Weight",Normal:"Normal",Bold:"Bold",Comments:"Comments","Comment Types":"Comment Types",green:"green",Keywords:"Keywords","Keyword Types":"Keyword Types",darkred:"darkred",Categories:"Categories",Username:"Username","Full Name":"Full Name","Email Address":"Email Address","Email Confirmed":"Email Confirmed",Account:"Account","Current Password":"Current Password","New Password":"New Password","Verify Password":"Verify Password",Password:"Password",OpenId:"OpenId",AOL:"AOL",Yahoo:"Yahoo",Google:"Google",Unlink:"Unlink",Link:"Link",Unlinked:"Unlinked",Linked:"Linked","Linked Accounts":"Linked Accounts","Git Email Address":"Git Email Address","Git Username":"Git Username","Git Credentials Storage":"Git Credentials Storage",Update:"Update","Update Profile Settings":"Update Profile Settings","Update Git User Settings":"Update Git User Settings","Update Git Credentials":"Update Git Credentials","User profile data successfully updated.":"User profile data successfully updated.","Git user data successfully updated.":"Git user data successfully updated.","Git Credentials successfully updated.":"Git Credentials successfully updated.","Edit Plugin JavaScript":"Edit Plugin JavaScript","Install Plugin":"Install Plugin","Plugin Name:":"Plugin Name:","Author Name:":"Author Name:","Licence:":"Licence:","Description:":"Description:","A plugin for Eclipse Orion":"A plugin for Eclipse Orion","Plugin Link":"Plugin Link",Install:"Install","Install a plugin by specifying its URL":"Install a plugin by specifying its URL","Plugin URL:":"Plugin URL:",Disable:"Disable",DisableTooltip:"Disable the plugin",Enable:"Enable",EnableTooltip:"Enable the plugin","Reload all":"Reload all","Reload all installed plugins":"Reload all installed plugins","Create a new Orion Plugin":"Create a new Orion Plugin","Find More Orion Plugins":"Find More Orion Plugins","Get Plugins":"Get Plugins",Reload:"Reload","Reload the plugin":"Reload the plugin",Delete:"Delete","Delete this plugin from the configuration":"Delete this plugin from the configuration",DeleteUser:"Delete User Profile as well as workspaces and projects",DeleteUserComfirmation:"WARNING: This will permanently delete your user profile as well all your work!","Type a plugin url here ...":"Type a plugin url here ...","Installed ":"Installed ","Installing ":"Installing ","Already installed":"Already installed"," plugin":" plugin","Reloaded ":"Reloaded ","Uninstalled ":"Uninstalled ","Are you sure you want to uninstall '":"Are you sure you want to uninstall '",Services:"Services",Value:"Value","JavaScript Object":"JavaScript Object","click here, then check javascript console to drill down":"click here, then check javascript console to drill down",Item:"Item","Git Config":"Git Config","Clear Git Credentials":"Clear Git Credentials","Enable Storage":"Enable Storage","Please be aware that your credentials will be stored persistently in the browser.":"Please be aware that your credentials will be stored persistently in the browser.","Do you wish to enable the Key Storage?":"Do you wish to enable the Key Storage?",general:"General",validation:"Validation","Deleted git credentials for ${0}":"Deleted git credentials for ${0}",Editor:"Editor",editorSettings:"Settings",EditorThemes:"Themes",Import:"Import","Import a theme":"Import a theme",Export:"Export","Export a theme":"Export a theme","Theme name:":"Theme name:",yourTheme:"yourTheme",fileManagement:"File Management",typing:"Typing",autoSave:"Auto Save",autoSaveTimeout:"Save interval (ms)",autoLoad:"Auto Load",saveDiffs:"Save file as diffs",trimTrailingWhiteSpace:"Trim Trailing Whitespace on Save",Restore:"Restore Defaults",Default:"Default",keys:"Keys",tabs:"Tabs",tabSize:"Tab Size",expandTab:"Insert spaces for tabs",smoothScrolling:"Smooth Scrolling",scrollAnimation:"Scrolling Animation",scrollAnimationTimeout:"Scrolling Duration (ms)",keyBindings:"Key Bindings",rulers:"Rulers",annotationRuler:"Show Annotation Ruler",lineNumberRuler:"Show Line Number Ruler",foldingRuler:"Show Folding Ruler",overviewRuler:"Show Overview Ruler",whitespaces:"White Spaces",wrapping:"Wrapping",wordWrap:"Word Wrap",showMargin:"Show Margin",marginOffset:"Margin Column",showTabs:"Show Tabs",showSpaces:"Show Spaces",autoSaveTimeoutInvalid:"Invalid save interval.",scrollAnimationTimeoutInvalid:"Invalid scrolling duration.",tabSizeInvalid:"Invalid tab size.",localSettingsTooltip:"Toggle whether this setting is shown in the local editor settings drop down.",editorSettingsInfo:"Use the ${0} and ${1} to toggle whether a given setting is shown in the local editor settings drop down ${2}.",autoPairParentheses:"Autopair (Parentheses)",autoPairBraces:"Autopair {Braces}",autoPairSquareBrackets:"Autopair [Square] Brackets",autoPairAngleBrackets:"Autopair <Angle> Brackets",autoPairQuotations:'Autopair "Strings"',autoCompleteComments:"Autocomplete /** Block Comments */",smartIndentation:"Smart Indentation",sourceControl:"Source Control",showBlame:"Show Blame",languageTools:"Language Tools",showOccurrences:"Show Occurrences",contentAssistAutoTrigger:"Show Content Assist automatically","Editor preferences updated":"Editor preferences updated","Editor defaults restored":"Editor defaults restored",Theme:"Theme","Font Size":"Font Size","New Theme Name:":"New Theme Name:","Font Size:":"Font Size:","UI Theme":"UI Theme","Navigation Bar":"Navigation Bar","Navigation Text":"Navigation Text","Search Box":"Search Box","Tool Panel":"Tool Panel","Selection Bar":"Selection Bar",Location:"Location",Content:"Content","Main Panel":"Main Panel",Button:"Button","Button Text":"Button Text","Section Text":"Section Text","Side Panel":"Side Panel","Line Color":"Line Color","Line Numbers":"Line Numbers",Foreground:"Foreground","Current Line":"Current Line","HTML Attribute":"HTML Attribute","Overview Ruler":"Overview Ruler","HTML Tag":"HTML Tag","Annotation Ruler":"Annotation Ruler","Show Guide":"Show Guide","Check Guide":"Check Guide",Cancel:"Cancel","Revert Theme":"Revert Theme","Update Theme":"Update Theme","Theme:":"Theme:",clickDiagram:"Click diagram to style.",clickUpdate:"Click Update button to save preview.","CSS Class Name":"CSS Class Name","CSS Attribute":"CSS Attribute","CSS Value":"CSS Value","CSS Text":"CSS Text","COLOR:":"Color:","NEW COLOR:":"New Color:",Ok:"Ok","OR HEX:":"Or Hex: ",splitEditors:"Split Editors",splitOrientation:"Split Orientation",horizontal:"Horizontal",vertical:"Vertical"}),define("orion/settings/nls/messages",["orion/i18n!orion/settings/nls/messages","orion/settings/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/editor/eventTarget",[],function(){function e(){}return e.addMixin=function(t){var n=e.prototype;for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},e.prototype={addEventListener:function(e,t,n){this._eventTypes||(this._eventTypes={});var i=this._eventTypes[e];i||(i=this._eventTypes[e]={level:0,listeners:[]});var r=i.listeners;r.push({listener:t,useCapture:n})},dispatchEvent:function(e){var t=e.type;this._dispatchEvent("pre"+t,e),this._dispatchEvent(t,e),this._dispatchEvent("post"+t,e)},_dispatchEvent:function(e,t){var n=this._eventTypes?this._eventTypes[e]:null;if(n){var i=n.listeners;try{if(n.level++,i)for(var r=0,o=i.length;o>r;r++)if(i[r]){var s=i[r].listener;"function"==typeof s?s.call(this,t):s.handleEvent&&"function"==typeof s.handleEvent&&s.handleEvent(t)}}finally{if(n.level--,n.compact&&0===n.level){for(var a=i.length-1;a>=0;a--)i[a]||i.splice(a,1);0===i.length&&delete this._eventTypes[e],n.compact=!1}}}},isListening:function(e){return this._eventTypes?void 0!==this._eventTypes[e]:!1},removeEventListener:function(e,t,n){if(this._eventTypes){var i=this._eventTypes[e];if(i){for(var r=i.listeners,o=0,s=r.length;s>o;o++){var a=r[o];if(a&&a.listener===t&&a.useCapture===n){0!==i.level?(r[o]=null,i.compact=!0):r.splice(o,1);break}}0===r.length&&delete this._eventTypes[e]}}}},{EventTarget:e}}),define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(e,t,n){function i(e){e=e||{},this._document=e.document||document}var r="orion-theme-",o={};return i.getTheme=function(e){e=e||"default";var t=o[e];return t||(t=o[e]=new i),t},i.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(e,t){var n=this,i=n._themeClass;n._themeClass=e,this._load(e,t,function(){n.onThemeChanged({type:"ThemeChanged",oldValue:i,newValue:n.getThemeClass()})})},onThemeChanged:function(e){return this.dispatchEvent(e)},buildStyleSheet:function(e,t){function n(t,n,r){n&&(i.push("."+e+" ."+t+" {"),i.push("	"+(r?"background-color":"color")+": "+n+";"),i.push("}"))}var i=[];return i.push(""),i.push("."+e+" {"),t.fontFamily&&i.push("	font-family: "+t.fontFamily+";"),t.fontSize&&i.push("	font-size: "+t.fontSize+";"),t.fontSize&&i.push("	color: "+t.text+";"),i.push("}"),i.push("."+e+".textview {"),t.background&&i.push("	background-color: "+t.background+";"),i.push("}"),i.push("."+e+" .textviewLeftRuler {"),t.leftRuler&&i.push("	border-right: 1px solid "+t.leftRuler+";"),i.push("}"),i.push("."+e+" .textviewRightRuler {"),t.rightRuler&&i.push("	border-left: 1px solid "+t.rightRuler+";"),i.push("}"),n("ruler.annotations",t.annotationRuler,!0),n("ruler.lines",t.annotationRuler,!0),n("ruler.folding",t.annotationRuler,!0),n("ruler.overview",t.overviewRuler,!0),n("rulerLines",t.lineNumber,!1),n("rulerLines.even",t.lineNumberEven,!1),n("rulerLines.odd",t.lineNumberOdd,!1),n("annotationLine.currentLine",t.currentLine,!0),n("entity-name-tag",t.keyword,!1),n("entity-other-attribute-name",t.attribute,!1),n("string-quoted",t.string,!1),n("meta.annotation.currentLine",t.currentLine,!0),n("keyword",t.keyword,!1),n("string",t.string,!1),n("constant",t.constant,!1),n("comment",t.comment,!1),n("comment.block.documentation",t.comment,!1),n("keyword.other.documentation.markup",t.comment,!1),n("keyword.other.documentation.markup",t.comment,!1),i.join("\n")},_createStyle:function(e,t,i,o){var s=this._document,a=r+e,l=s.getElementById(a);if(l){if(o||l.firstChild.data===t)return;l.removeChild(l.firstChild),l.appendChild(s.createTextNode(t))}else{o?(l=n.createElement(s,"link"),l.rel="stylesheet",l.type="text/css",l.href=t,l.addEventListener("load",function(){i()})):(l=n.createElement(s,"style"),l.appendChild(s.createTextNode(t))),l.id=a;var d=s.getElementsByTagName("head")[0]||s.documentElement;d.appendChild(l)}o||i()},_load:function(t,n,i){if(!t)return void i();if("string"==typeof n)return void this._createStyle(t,n,i);var r=n.href,o=".css";if(r.substring(r.length-o.length)!==o&&(r+=o),/^\//.test(r)||/[a-zA-Z0-9]+:\/\//i.test(r)||!e.toUrl)this._createStyle(t,r,i,!0);else{var s=this;e(["text!"+r],function(e){s._createStyle(t,e,i,!1)})}}},t.EventTarget.addMixin(i.prototype),{TextTheme:i}}),define("orion/widgets/themes/ThemeClass",[],function(){function e(e){this.attributes=[],this.element=document.createElement("div"),this.style=this.element.style,this.className=e,this.classString="."+e+"{ "}function t(){return this.classString=this.classString+this.style.cssText+this.closeString,this.classString}var n,i,r=null,o=" }\n";return e.prototype.className=r,e.prototype.classString=i,e.prototype.style=n,e.prototype.closeString=o,e.prototype.toString=t,{ThemeClass:e}}),define("orion/widgets/themes/container/ThemeSheetWriter",["orion/widgets/themes/ThemeClass"],function(e){function t(){}function n(){var t="",n=[],i=new e.ThemeClass("orionPage");i.style.backgroundColor="#fdfdfd",i.style.width="100%",i.style.height="100%",n.push(i);var r=new e.ThemeClass("topRowBanner");r.style.margin="0",r.style.border="0",r.style.backgroundColor=this.navbar,r.style.height="16px",r.style.padding="10px",r.style.paddingLeft="6px",r.style.paddingRight="2px",r.style.borderBottom="none",r.style.boxShadow="0 2px 2px 0 rgba(0, 0, 0, 0.1),0 1px 0 0 rgba(0, 0, 0, 0.1)",r.style.zIndex="100",n.push(r);var o=new e.ThemeClass("a");o.style.textDecoration="none",o.style.color=this.content,n.push(o);var s=new e.ThemeClass("navlink");s.style.display="inline-block",s.style.padding="2px",s.style.color=this.content,s.style.verticalAlign="bottom",n.push(s);var a=new e.ThemeClass("primaryNav");a.style.color=this.navtext,a.style.fontSize="8pt",a.style.fontWeight="normal",a.style.paddingTop="0",a.style.verticalAlign="baseline",n.push(a);var l=new e.ThemeClass("primaryNav a");l.style.fontSize="8pt",l.style.color=this.navtext,l.style.marginRight="6px",l.style.marginLeft="6px",l.style.verticalAlign="baseline",l.style.textDecoration="none",n.push(l);var d=new e.ThemeClass("primaryNav a:hover");d.style.color="#bfbfbf",d.style.cursor="hand",d.style.color="white",d.style.fontWeight="normal",n.push(d);for(var c in n)t+=n[c].toString();return t}function i(){var t="",n=[],i=new e.ThemeClass("titleArea");i.style.margin="0",i.style.paddingTop="5px",i.style.border="0",i.style.background=this.location,i.style.background="-webkit-gradient(linear, left top, left bottom, color-stop(0%,"+this.location+"), color-stop(100%,"+this.location+"))",i.style.borderBottom="1px solid "+this.location,i.style.minHeight="20px",n.push(i);var r=new e.ThemeClass("breadcrumb");r.style.fontSize="8pt",r.style.textDecoration="none",r.style.color="#f1f1f2;",r.style.paddingTop="2px",n.push(r);var o=new e.ThemeClass("a.breadcrumb:hover");o.style.textDecoration="none",o.style.borderBottom="1px dotted",o.style.color="#F58B0F",o.style.cursor="pointer",n.push(o);var s=new e.ThemeClass("breadcrumbSeparator");s.style.fontSize="8pt",s.style.textDecoration="none",s.style.color=this.separator,s.style.fontWeight="bold",n.push(s);var a=new e.ThemeClass("currentLocation");a.style.fontWeight="bold",a.style.fontSize="8pt",a.style.color=this.breadcrumb,a.style.textDecoration="none",a.style.textWrap="normal",a.style.lineHeight="10pt",n.push(a);var l=new e.ThemeClass("a.currentLocation:hover");l.style.fontWeight="bold",l.style.fontSize="10pt",l.style.color="#666666",l.style.textDecoration="none",l.style.borderBottom="0",n.push(l);var d=new e.ThemeClass("navlinkonpage");if(d.style.color=this.content,d.style.verticalAlign="middle",n.push(d),this.bannerProgress){var c=new e.ThemeClass("topRowBanner .progressPane_running");c.style.borderColor=this.bannerProgress,n.push(c)}for(var h in n)t+=n[h].toString();return t}function r(){var t="",n=[],i=new e.ThemeClass("commandButton");i.style.color="#666",i.style.border="1px solid #dedede",i.style.backgroundColor="#ddd",i.style.textAlign="center",i.style.verticalAlign="middle",i.style.cursor="pointer",i.style.display="inline-block",i.style.padding="4px 6px",i.style.borderRadius="3px",i.style.lineHeight="12px",i.style.fontSize="9pt",i.style.userSelect="none",n.push(i);var r=new e.ThemeClass("commandButton:over");r.style.backgroundColor="#e6e6e6",r.style.border="1px solid #808080",n.push(r);var o=new e.ThemeClass("commandMenu");o.style.color="#222",o.style.display="inline-block",o.style.verticalAlign="baseline",o.style.margin="0",o.style.fontSize="8pt",o.style.fontWeight="normal",o.style.border="1px solid #dedede",o.style.backgroundColor="#efefef",o.style.cursor="pointer",o.style.borderRadius="1px",n.push(o);var s=new e.ThemeClass("commandMenuItem");s.style.border="0",s.style.padding="0",s.style.margin="0",n.push(s);for(var a in n)t+=n[a].toString();return t}function o(){var t="",n=[],i=new e.ThemeClass("searchbox");i.style.backgroundImage="url(../images/core_sprites.png)",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="4px -297px",i.style.width="12px",i.style.height="12px",i.style.backgroundColor=this.search,i.style.border="1px solid "+this.search,i.style.fontSize="11px",i.style.width="15em",i.style.height="16px",i.style.borderRadius="10px",i.style.color="#999",i.style.padding="0",i.style.paddingLeft="20px",i.style.marginLeft="5px",i.style.marginTop="6px !important",i.style.font="7pt Lucida Sans Unicode,Lucida Grande,Verdana,Arial,Helvetica,Myriad,Tahoma,clean,sans-serif !important",n.push(i);var r=new e.ThemeClass("searchbox:focus");r.style.color="white",r.style.outline="none",n.push(r);var o=new e.ThemeClass("checkedRow");o.style.cssText="background-color:"+this.selection+" !important;",n.push(o);var s=new e.ThemeClass("navbar-item-selected");s.style.background=this.selection,s.style.color=this.content,n.push(s);var a=new e.ThemeClass("auxpane");a.style.border="0",a.style.background=this.sidepanel,n.push(a);var l=new e.ThemeClass("mainpane");l.style.background=this.mainpanel,l.style.border=0,n.push(l);var d=new e.ThemeClass("mainToolbar");d.style.background=this.toolpanel,n.push(d);for(var c in n)t+=n[c].toString();return t}function s(){console.log(this.writeNavigationStyle()),console.log(this.writeLocationStyle()),console.log(this.writeMainStyle()),console.log(this.writeButtonStyle())}function a(e){e.navbar.value?(this.navbar=e.navbar.value,this.button=e.button.value,this.location=e.location.value,this.selection=e.selection.value,this.sidepanel=e.sidepanel.value,this.mainpanel=e.mainpanel.value,this.navtext=e.navtext.value,this.search=e.search.value,this.content=e.content.value,this.toolpanel=e.toolpanel.value,this.bannerProgress=e.bannerProgress.value):(this.navbar=e.navbar,this.button=e.button,this.location=e.location,this.selection=e.selection,this.sidepanel=e.sidepanel,this.mainpanel=e.mainpanel,this.navtext=e.navtext,this.search=e.search,this.content=e.content,this.toolpanel=e.toolpanel,this.bannerProgress=e.bannerProgress);var t=this.writeNavigationStyle()+this.writeLocationStyle()+this.writeMainStyle()+this.writeButtonStyle();return t}var l="white",d="#777777",c="#EFEFEF",h="#cedce7",u="#F7F7F7",p="white",f="#bfbfbf",g="#3087B3",m="#444",v="white";return t.prototype.navbar=l,t.prototype.button=d,t.prototype.location=c,t.prototype.selection=h,t.prototype.sidepanel=u,t.prototype.mainpanel=p,t.prototype.navtext=f,t.prototype.content=g,t.prototype.search=m,t.prototype.toolpanel=v,t.prototype.writeNavigationStyle=n,t.prototype.writeLocationStyle=i,t.prototype.writeButtonStyle=r,t.prototype.writeMainStyle=o,t.prototype.render=s,t.prototype.getSheet=a,{ThemeSheetWriter:t}}),define("orion/widgets/themes/ThemeVersion",[],function(){var e="6.0";return e}),define("orion/widgets/themes/container/ThemeData",["i18n!orion/settings/nls/messages","orion/editor/textTheme","orion/widgets/themes/container/ThemeSheetWriter","orion/widgets/themes/ThemeVersion"],function(e,t,n,i){function r(){}function o(){this.styles=[];var e=new r;e.name="Orion",e.navbar="white",e.button="#EFEFEF",e.location="#efefef",e.selection="FEC",e.sidepanel="#FBFBFB",e.mainpanel="white",e.toolpanel="white",e.navtext="#bfbfbf",e.content="#3087B3",e.search="#444",e.breadcrumb="#3087B3",e.separator="#333",e.bannerProgress="whitesmoke",this.styles.push(e);var t=new r;t.name="Orion2014",t.navbar="white",t.button="#EFEFEF",t.location="#EFEFEF",t.selection="FEC",t.sidepanel="#EEEEEE",t.mainpanel="#EEEEEE",t.toolpanel="#EEEEEE",t.navtext="#BFBFBF",t.content="#333333",t.search="#444444",t.breadcrumb="#333333",t.separator="#333333",t.bannerProgress="orange",this.styles.push(t);var n=new r;n.name="Green Zone",n.navbar="seagreen",n.button="lavender",n.location="darkseagreen",n.selection="moccasin",n.sidepanel="aliceblue",n.mainpanel="white",n.toolpanel="white",n.navtext="#FBFBFB",n.content="darkgreen",n.search="darkgreen",n.breadcrumb="#3087B3",n.separator="seagreen",n.bannerProgress="#F2F2F2",this.styles.push(n);var i=new r;i.name="Pretty In Pink",i.navbar="plum",i.button="lavender",i.location="pink",i.selection="lavender",i.sidepanel="seashell",i.mainpanel="white",i.toolpanel="white",i.navtext="#FBFBFB",i.content="mediumorchid",i.search="violet",i.breadcrumb="#3087B3",i.separator="plum",i.bannerProgress="#F2F2F2",this.styles.push(i);var o=new r;o.name="Blue Monday",o.navbar="cornflowerblue",o.button="lavender",o.location="skyblue",o.selection="lavender",o.sidepanel="aliceblue",o.mainpanel="white",o.toolpanel="white",o.navtext="#FBFBFB",o.content="royalblue",o.search="royalblue",o.breadcrumb="#3087B3",o.separator="cornflowerblue",o.bannerProgress="#F2F2F2",this.styles.push(o);var s=new r;s.name="Vanilla Skies",s.navbar="sandybrown",s.button="lemmonchiffon",s.location="cornsilk",s.selection="lemonchiffon",s.sidepanel="white",s.mainpanel="white",s.toolpanel="white",s.navtext="lemonchiffon",s.content="chocolate",s.search="moccasin",s.breadcrumb="#3087B3",s.separator="sandybrown",s.bannerProgress="#F2F2F2",this.styles.push(s);var a=new r;a.name="Beetlejuice",a.navbar="indigo",a.button="slateblue",a.location="darkslateblue",a.selection="silver",a.sidepanel="lavender",a.mainpanel="white",a.toolpanel="white",a.navtext="#FBFBFB",a.content="mediumslateblue",a.search="#444",a.breadcrumb="#3087B3",a.separator="indigo",a.bannerProgress="#F2F2F2",this.styles.push(a);var l=new r;l.name="Red",l.navbar="#CD2127",l.button="#777777",l.location="#D85F56",l.selection="lightcoral",l.sidepanel="#EFDAB2",l.mainpanel="#FDFADD",l.toolpanel="#FDFADD",l.navtext="#FBFBFB",l.content="darkred",l.search="#D85F56",l.breadcrumb="darkred",l.separator="#CD2127",l.bannerProgress="#F2F2F2",this.styles.push(l)}function s(){return this.styles}function a(){return{storage:"/themes",styleset:"styles",defaultTheme:"Orion2014",selectedKey:"selected",version:i}}function l(){var t=10,n=10,i=350,r=32,o=29,s=t+r+o,a={};a.top=t,a.left=n,a.width=i,a.height=i,a.shapes=[{type:"RECTANGLE",name:e["Navigation Bar"],x:n,y:t,width:i,height:r,family:"navbar",fill:"#333",order:1},{type:"TEXT",name:e["Navigation Text"],label:"UserName",x:n+i-70,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif"},{type:"ROUNDRECTANGLE",name:e["Search Box"],x:n+i-145,y:t+10,width:70,height:12,family:"search",fill:"#444",order:3},{type:"RECTANGLE",name:e["Tool Panel"],x:n+.4*i,y:s,width:.6*i-1,height:30,family:"toolpanel",fill:"white",order:4},{type:"RECTANGLE",name:e["Selection Bar"],x:n+.4*i+5,y:s+62,width:.6*i-10,height:20,family:"selection",fill:"#FEC",order:7},{type:"RECTANGLE",name:e.Location,x:n,y:t+r,width:i,height:o,family:"location",fill:"#efefef",order:8},{type:"TEXT",name:e["Navigation Text"],label:"Navigator",x:n+50,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif",order:2},{type:"TEXT",name:e.Content,label:"Breadcrumb",x:n+5,y:t+r+18,family:"content",fill:"#3087B3",font:"8pt sans-serif"},{type:"TEXT",name:e.Content,label:"/",x:n+68,y:t+r+18,family:"content",fill:"#3087B3",font:"8pt sans-serif",order:9},{type:"TEXT",name:e.Content,label:"Location",x:n+74,y:t+r+18,family:"content",fill:"#3087B3",font:"8pt sans-serif"},{type:"RECTANGLE",name:e["Main Panel"],x:n+.4*i,y:s+30,width:.6*i-1,height:i-s+t-31,family:"mainpanel",fill:"white",order:6},{type:"ROUNDRECTANGLE",name:e.Button,x:n+.4*i+5,y:s+5,width:37,height:20,family:"button",fill:"#EFEFEF",order:11},{type:"TEXT",name:e["Button Text"],label:"Button",x:n+.4*i+8,y:s+19,family:"navbar",fill:"#333",font:"8pt sans-serif"},{type:"TRIANGLE",name:"userMenu",x1:n+i-7,y1:t+14,x2:n+i-13,y2:t+14,x3:n+i-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:n+10,y1:s+17,x2:n+16,y2:s+17,x3:n+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"},{type:"TEXT",name:e["Section Text"],label:"Section",x:n+20,y:s+23,family:"navbar",fill:"#333",font:"8pt sans-serif"},{type:"LINE",name:e["Line Color"],x1:n+.4*i,y1:s+30,x2:n+i,y2:s+30,linewidth:2,fill:"#DEDEDE"},{type:"LINE",name:e["Line Color"],x1:n+.4*i,y1:s,x2:n+.4*i,y2:t+i,linewidth:2,fill:"#DEDEDE"},{type:"LINE",name:e["Line Color"],x1:n+10,y1:s+29,x2:n+.4*i-10,y2:s+29,linewidth:2,fill:"#DEDEDE"},{type:"RECTANGLE",name:e["Side Panel"],x:n,y:s,width:.4*i,height:i-s+t,family:"sidepanel",fill:"#FBFBFB",order:12},{type:"TRIANGLE",name:"userMenu",x1:n+i-7,y1:t+14,x2:n+i-13,y2:t+14,x3:n+i-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:n+10,y1:s+17,x2:n+16,y2:s+17,x3:n+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"},{type:"TEXT",name:e["Navigation Text"],label:"Navigator",x:n+50,y:t+20,family:"navtext",fill:"#bfbfbf",font:"8pt sans-serif",order:2},{type:"TRIANGLE",name:"userMenu",x1:n+i-7,y1:t+14,x2:n+i-13,y2:t+14,x3:n+i-10,y3:t+19,family:"userMenu",fill:"#BFBFBF"},{type:"TRIANGLE",name:"userMenu",x1:n+10,y1:s+17,x2:n+16,y2:s+17,x3:n+13,y3:s+22,family:"userMenu",fill:"#BFBFBF"}];for(var l=0;3>l;l++)a.shapes.push({type:"TEXT",name:e.Content,label:"org.eclipse.orion.content",x:n+.4*i+20,y:s+56+20*l,fill:"#3087B3",family:"content"});for(var l=0;3>l;l++)a.shapes.push({type:"TEXT",name:e.Content,label:"Item",x:n+15,y:s+44+20*l,fill:"#3087B3",family:"content"});for(var d=0;3>d;d++)a.shapes.push({type:"TRIANGLE",name:"twisty",x1:n+.4*i+10,y1:s+50+20*d,x2:n+.4*i+15,y2:s+53+20*d,x3:n+.4*i+10,y3:s+56+20*d,family:"navbar",fill:"#333"});return a.shapes.push({type:"IMAGE",name:"logo",x:n+5,y:t+8,source:"../../images/orion-transparent.png",family:"logo"}),a}function d(e){var i=new n.ThemeSheetWriter,r="orionTheme",o=new t.TextTheme.getTheme(r);o.setThemeClass(r,i.getSheet(e))}return r.prototype.name="Orion",r.prototype.navbar="#404648",r.prototype.button="#EFEFEF",r.prototype.location="#333",r.prototype.breadcrumb="#3087B3",r.prototype.separator="#333",r.prototype.selection="FEC",r.prototype.sidepanel="#FBFBFB",r.prototype.mainpanel="white",r.prototype.toolpanel="white",r.prototype.navtext="#bfbfbf",r.prototype.content="#3087B3",r.prototype.search="#444",r.prototype.bannerProgress="white",o.prototype.styles=[],o.prototype.getStyles=s,o.prototype.getThemeStorageInfo=a,o.prototype.getViewData=l,o.prototype.processSettings=d,{ThemeData:o,getStyles:s}}),define("orion/widgets/nls/root/messages",{"no input":"no input","no output":"no output","Choose a Folder":"Choose a Folder",OK:"OK",Profile:"Profile","Sign out":"Sign out","N/A":"N/A","logged in since ":"logged in since ","Sign in":"Sign in","Authentication required!":"Authentication required!","Name:":"Name:","Plug-ins":"Plug-ins"," <No available services or timed out, check URL and try reloading>":" <No available services or timed out, check URL and try reloading>",Properties:"Properties"," (Service Id: ":" (Service Id: ",Services:"Services","SFTP Transfer":"SFTP Transfer","Remote host:":"Remote host:","Port:":"SFTP Port:","Remote path:":"Remote path:","User name:":"User name:","Password:":"Password:","Start Transfer":"Start Transfer","Location:":"Location:","orion.sftpConnections":"orion.sftpConnections","Drag a file here":"Drag a file here","unzip zips":"Unzip *.zip files","or if you prefer":"(or upload a file using the buttons below)",Upload:"Upload","Browse...":"Browse...","Import a file or zip":"Import a file or zip","Missing required argument: searchRenderer":"Missing required argument: searchRenderer","Missing required argument: favService":"Missing required argument: favService","Find File Named":"Find File Named","Type the name of a file to open (? = any character, * = any string):":"Type the name of a file to open (? = any character, * = any string):",Search:"Search","FileName FolderName":"FileName FolderName(Optional)","Searching...":"Searching...","Searching for occurrences of":'Searching for occurrences of: "${0}"',name:"name","orion.widgets.UserMenu":"orion.widgets.UserMenu",test:"test","Sign Out":"Sign Out","Sign Out ":"Sign Out ","</a>":"</a>",">":">","Sign In To ":"Sign In To ","Sign In":"Sign In",Help:"Help","Report a Bug":"Report a Bug","Keyboard Shortcuts":"Keyboard Shortcuts",Settings:"Settings","View profile of ":"View profile of ",Profiles:"Profiles","Information Needed":"Information Needed",Cancel:"Cancel","If the same file exists in both the source and destination:":"If the same file exists in both the source and destination:","Cancel the transfer":"Cancel the transfer","Always overwrite destination":"Always overwrite destination","Overwrite if source is newer":"Overwrite if source is newer",New:"New","Building file skeleton...":"Building file skeleton...",Add:"Add","Upload...":"Upload...","For a list of available commands type '${0}'.":"For a list of available commands type '${0}'.","Main Pages":"Main Pages","Related Links":"Related Links",Yes:"Yes",No:"No","Click or use delete key to delete the search term":"Click or use delete key to delete the search term"}),define("orion/widgets/nls/messages",["orion/i18n!orion/widgets/nls/messages","orion/widgets/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/widgets/userAssistance/UATaskPanel",["orion/webui/littlelib"],function(e){function t(t,n,i){this.elements=i,this.taskPanel=document.createElement("div"),this.taskPanel.className="UAContainer",this.taskPanel.innerHTML='<header class="UAHeader">Develop software from within the cloud</header>',this.elementNode=document.createElement("div"),this.switchesContainer=document.createElement("div"),this.switches=document.createElement("span"),this.radioButtons=[],this.elementNode.className="UAContainer-body",this.taskPanel.appendChild(this.elementNode),this.switchesContainer.className="UAContainer-switch-body",this.switches.className="UAContainer-switches",this.switchesContainer.innerHTML="",this.switchesContainer.appendChild(this.switches),this.taskPanel.appendChild(this.switchesContainer),n===!0?(this.container=document.createElement("div"),this.container.className="UAModal",this.container.appendChild(this.taskPanel),this.backdrop=document.createElement("div"),this.backdrop.className="UAModalBackground",document.body.appendChild(this.backdrop),document.body.appendChild(this.container),e.addAutoDismiss([this.container],this.destroy.bind(this))):t.appendChild(this.taskPanel),this.chosenSwitch=this.createSwitch(null,!0),this.chosenSwitch.firstChild.className="chosenCircle",this.initialize(),this.elements.forEach(this.createSwitch.bind(this))}return t.prototype.elementNode=null,t.prototype.switchesContainer=null,t.prototype.switches=null,t.prototype.radioButtons=null,t.prototype.chosenSwitch=null,t.prototype.addElement=function(e){var t=document.createElement("span");t.className="UAContainer-icon",t.innerHTML='<span class="workingSpan"><img src="'+e.image+'" id="'+e.label+'ImageNode" alt="'+e.alt+'" height="64" width="64"></span><span class="UAIcon-label"><span class="UALabel" id="'+e.label+'LabelNode" >'+e.label+"</span></span>",t.onmouseover=function(){var n=document.getElementById(e.label+"ImageNode");
n.src=e.secondaryImage;var i=document.getElementById(e.label+"LabelNode");i.className="UALabel-live",t.className="UAContainer-icon-live"},t.onmouseout=function(){var n=document.getElementById(e.label+"ImageNode");n.src=e.image;var i=document.getElementById(e.label+"LabelNode");i.className="UALabel",t.className="UAContainer-icon"};var n=this;t.onclick=function(){n.showMedia(e)},this.elementNode.appendChild(t)},t.prototype.clearElements=function(){this.elementNode.innerHTML=""},t.prototype.showMedia=function(e){this.clearElements(),this.addElement(e);var t=document.createElement("span");t.className="UAContainer-media",t.innerHTML='<div></div><div></div><span class="mediaSpan"><img src="'+e.media+'" alt="'+e.alt+'" height="300" width="400"></span>',this.elementNode.appendChild(t),setTimeout(function(){t.style.opacity=1},100);var n=document.getElementById(e.label+"switch");this.chosenSwitch.firstChild.className="circle",this.chosenSwitch=n.parentNode,n.className="chosenCircle"},t.prototype.createSwitch=function(e){var t;t=e?e.label+"switch":"indexSwitch";var n=document.createElement("span");n.className="workingSpan",n.innerHTML='<div class="circle" id ="'+t+'"></div>';var i=this;return n.onclick=e?function(){i.showMedia(e)}:function(){i.initialize(),i.chosenSwitch.firstChild.className="circle",i.chosenSwitch=n,i.chosenSwitch.firstChild.className="chosenCircle"},this.switches.appendChild(n),this.radioButtons[this.radioButtons.length]=n,n},t.prototype.initialize=function(){this.clearElements(),this.elements.forEach(this.addElement.bind(this))},t.prototype.destroy=function(){document.body.removeChild(this.backdrop),document.body.removeChild(this.container)},t}),define("orion/webui/dialog",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/uiUtils"],function(e,t,n,i){function r(){}var o={dialog:null};return r.prototype={DISABLED:"disabled",CONTAINERTEMPLATE:'<div class="dialog" role="dialog"><div class="dialogTitle"><span id="title" class="dialogTitleText layoutLeft"></span><button aria-label="Close" class="dismissButton layoutRight core-sprite-close imageSprite" id="closeDialog"></button></div><div id="dialogContent" class="dialogContent layoutBlock"></div><div id="buttons" class="dialogButtons"></div></div>',_initialize:function(){var e=document.body;this.$frameParent=e,this.$$modalExclusions=this.$$modalExclusions||[];var t=document.createRange();t.selectNode(e);var i=t.createContextualFragment(this.CONTAINERTEMPLATE);e.appendChild(i),this.$frame=e.lastChild,this.title&&n.$("#title",this.$frame).appendChild(document.createTextNode(this.title)),this.$close=n.$("#closeDialog",this.$frame);var r=this;this.$close.addEventListener("click",function(){r.hide()},!1),this.$parent=n.$(".dialogContent",this.$frame),t=document.createRange(),t.selectNode(this.$parent);var o=t.createContextualFragment(this.TEMPLATE);this.messages&&n.processTextNodes(o,this.messages),this.$parent.appendChild(o),this.$buttonContainer=n.$(".dialogButtons",this.$frame),this._makeButtons(),this.$frame.addEventListener("keydown",function(e){e.keyCode===n.KEY.ESCAPE?r.hide():e.keyCode===n.KEY.ENTER&&"function"==typeof r._defaultCallback&&r._defaultCallback()},!1),this._bindElements(this.$parent),"function"==typeof this._bindToDom&&this._bindToDom(this.$parent)},_makeButtons:function(){if(this.$buttonContainer&&Array.isArray(this.buttons)){var e=this;this.buttons.forEach(function(t){var n=i.createButton(t.text,t.callback);t.id&&(n.id=t.id,e["$"+n.id]=n),t.isDefault&&(e._defaultCallback=t.callback,e._defaultButton=n),e.$buttonContainer.appendChild(n)})}},_makeModal:function(){var e=this;this.$frame.addEventListener("blur",function(t){e.$lastFocusedElement=t.target},!0),this._modalListener=function(t){var i=!n.contains(e.$frame,t.target);if(i)for(var r=0;r<e.$$modalExclusions.length;r++)if(n.contains(e.$$modalExclusions[r],t.target)){i=!1;break}i&&(window.setTimeout(function(){(e.$lastFocusedElement||e.$parent).focus()},0),n.stop(t))},this.$frameParent.addEventListener("focus",this._modalListener,!0),this.$frameParent.addEventListener("click",this._modalListener,!0);var t=this.$frameParent.childNodes,i=!1;this._addedBackdrop=[];for(var r=0;r<t.length;r++){for(var o=0;o<this.$$modalExclusions.length;o++)if(n.contains(this.$$modalExclusions[o],t[r])){i=!0;break}if(!i&&t[r]!==e.$frame&&t[r].classList&&!t[r].classList.contains("tooltipContainer")){var s=t[r];s.classList.contains("modalBackdrop")||(s.classList.add("modalBackdrop"),this._addedBackdrop.push(s))}}var a=n.lastTabbable(this.$buttonContainer)||n.lastTabbable(this.$parent);a&&a.addEventListener("keydown",function(t){if(t.keyCode===n.KEY.TAB){var i=e._getFirstFocusField();i&&i!==t.target&&i.focus(),n.stop(t)}},!1)},_addChildDialog:function(e){this.$$modalExclusions.push(e.$frame||e.$parent)},_inModalExclusion:function(e){return this.$$modalExclusions.some(function(t){return e.$frame===t||e.$parent===t})},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.id&&(this["$"+n.id]=n),this._bindElements(n)}},hide:function(e){e||o.dialog!==this||(o.dialog=null),"function"==typeof this._beforeHiding&&this._beforeHiding(),this._modalListener&&(this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0)),this.$frame.classList.remove("dialogShowing"),n.setFramesEnabled(!0),"function"==typeof this._afterHiding&&this._afterHiding();var t=this;this.keepAlive||window.setTimeout(function(){t.destroy()},0)},show:function(e){if(this.modal)if(this._makeModal(),o.dialog){if(!o.dialog._inModalExclusion(this))return void this.hide(!0)}else o.dialog=this;"function"==typeof this._beforeShowing&&this._beforeShowing(),n.setFramesEnabled(!1);var t,i,r=n.bounds(this.$frame),s=n.bounds(document.documentElement);if(e){var a=n.bounds(e);i=a.top+a.height+4,t=a.left+4,i+r.height>s.height&&(i=Math.max(0,s.height-r.height-4)),t+r.width>s.width&&(t=Math.max(0,s.width-r.width-4))}else t=Math.max(0,(s.width-r.width)/2),i=Math.max(0,(s.height-r.height)/2);if(this.$lastFocusedElement=document.activeElement,this.$frame.style.top=i+"px",this.$frame.style.left=t+"px",this.$frame.classList.add("dialogShowing"),"function"==typeof this._afterShowing&&this._afterShowing(),!this.customFocus){var l=this._getFirstFocusField();l.focus()}},_getFirstFocusField:function(){return n.firstTabbable(this.$parent)||this._defaultButton||n.firstTabbable(this.$buttonContainer)||this.$close},destroy:function(){this.$frame&&(o.dialog===this&&(o.dialog=null),n.setFramesEnabled(!0),this._addedBackdrop&&this._addedBackdrop.length>0&&this._addedBackdrop.forEach(function(e){e.classList.remove("modalBackdrop")}),this.$frameParent.removeEventListener("focus",this._modalListener,!0),this.$frameParent.removeEventListener("click",this._modalListener,!0),this.$frameParent.removeChild(this.$frame),this.$frame=void 0,this.$parent=void 0)}},r.prototype.constructor=r,{Dialog:r}}),define("orion/widgets/UserMenu",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/PageLinks","orion/widgets/userAssistance/UATaskPanel","orion/webui/dialog","orion/webui/dropdown"],function(e,t,n,i,r,o,s){function a(e){this._displaySignOut=!0,this._init(e)}return a.prototype={_init:function(e){if(this._dropdownNode=n.node(e.dropdownNode),!this._dropdownNode)throw"no dom node for dropdown found";this._dropdown=e.dropdown,this._serviceRegistry=e.serviceRegistry,this.authenticatedServices={},this.unauthenticatedServices={},this._noSeparator=e.noSeparator,this._dropDownItemClass=e.dropDownItemClass,this._keyAssistClass=e.keyAssistClass,void 0!==e.signOut&&(this._displaySignOut=e.signOut)},isSingleService:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)===1},hasServices:function(){return this.length(this.unauthenticatedServices)+this.length(this.authenticatedServices)>0},length:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t},_makeMenuItem:function(e,t){var i=s.createMenuItem(e),r=i.firstElementChild;return"string"==typeof this._dropDownItemClass&&""!==this._dropDownItemClass&&r.classList.add(this._dropDownItemClass),r.addEventListener("click",t,!1),r.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&t()},!1),r},_renderAuthenticatedService:function(t){var n=this,i=this.authenticatedServices[t].authService;if(i&&i.logout&&this._displaySignOut){var r=this._makeMenuItem(e["Sign Out"],function(){i.logout().then(function(){n.addUserItem(t,i,n.authenticatedServices[t].label),localStorage.removeItem(t),localStorage.removeItem("lastLogin");for(var e=localStorage.length-1;e>=0;e--){var r=localStorage.key(e);r&&0===r.indexOf("/orion/preferences/user")&&localStorage.removeItem(r)}i.getAuthForm(window.location.href).then(function(e){window.location=e})})});this._dropdownNode.appendChild(r.parentNode)}},renderServices:function(){function t(e){return o[e]||(o[e]=r.createDocumentFragment()),o[e]}var r=document,o=[],a=this._serviceRegistry;i.getPageLinksInfo(a,"orion.page.link.user").then(function(i){if(this._dropdown?this._dropdown.empty():this._dropdownNode&&n.empty(this._dropdownNode),i.getAllLinks().forEach(function(e){var i,o;e.category&&(o=/user\.(\d+)/.exec(e.category))&&(i=parseInt(o[1],10)),("number"!=typeof i||isNaN(i))&&(i=1);var s=t(i),a=r.createElement("li"),l=r.createElement("a");l.role="menuitem","string"==typeof this._dropDownItemClass?""!==this._dropDownItemClass&&l.classList.add(this._dropDownItemClass):l.classList.add("dropdownMenuItem"),l.href=e.href,l.textContent=e.textContent,a.appendChild(l),s.appendChild(a),l.addEventListener("keydown",function(e){(e.keyCode===n.KEY.ENTER||e.keyCode===n.KEY.SPACE)&&l.click()},!1)}.bind(this)),this.keyAssistFunction){var l=this._makeMenuItem(e["Keyboard Shortcuts"],this.keyAssistFunction);"string"==typeof this._keyAssistClass?""!==this._keyAssistClass&&l.classList.add(this._keyAssistClass):l.classList.add("key-assist-menuitem");var d=l.parentNode;t(0).appendChild(d)}var c=a.getServiceReferences("orion.page.getstarted")[0];if(c){var h=c.getProperty("data"),u=this._makeMenuItem("Getting Started",this.getStartedDialog.bind(this,h)),p=u.parentNode;t(0).appendChild(p)}var f=this;if(o.sort(function(e,t){return e-t}).forEach(function(e,t){if(t<o.length-1&&!this._noSeparator){var n=s.createSeparator();e.appendChild(n)}f._dropdownNode.appendChild(e)}.bind(this)),this.isSingleService())for(var g in this.authenticatedServices)this.authenticatedServices.hasOwnProperty(g)&&this._renderAuthenticatedService(g,0)}.bind(this))},getStartedDialog:function(e){new r(null,!0,e)},setKeyAssist:function(e){this.keyAssistFunction=e,this.renderServices()},addUserItem:function(e,t,n,i){i?(this.unauthenticatedServices[e]&&delete this.unauthenticatedServices[e],this.authenticatedServices[e]={authService:t,label:n,data:i}):(this.authenticatedServices[e]&&delete this.authenticatedServices[e],this.unauthenticatedServices[e]=this.unauthenticatedServices[e]?{authService:t,label:n,pending:this.unauthenticatedServices[e].pending}:{authService:t,label:n}),this.renderServices()}},a.prototype.constructor=a,{UserMenu:a}}),define("orion/crawler/nls/root/messages",{"Searching file:":"Searching file:","is not supported in this file system":"is not supported in this file system","${0} files found out of ${1}":"${0} files found out of ${1}","The search term on this location will not use indexed files.":"The search term on this location will not use indexed files.","It will take longer time. Do you want to proceed?":"It will take longer time. Do you want to proceed?","Search cancelled by user":"Search cancelled by user",Cancel:"Cancel"}),define("orion/crawler/nls/messages",["orion/i18n!orion/crawler/nls/messages","orion/crawler/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/searchUtils",["i18n!orion/nls/messages","require","orion/regex","orion/commandRegistry","orion/PageUtil","orion/URITemplate"],function(e,t,n,i,r,o){function s(e,t,i){var r="";i&&(r="^");var o=n.parse("/"+r+e.searchStr+"/");if(o){var s=o.pattern,a=o.flags;-1!==a.indexOf("i")||t.caseSensitive||(a+="i"),e.regExp={pattern:s,flags:a},e.wildCard=!0}}var a={};return a.ALL_FILE_TYPE="*.*",a.doSearch=function(t,n,i,r){if(t){var o=i,s=!0;if("*"===o&&(o=""),""===o&&(s=r&&r.type!==a.ALL_FILE_TYPE),s){var l=t.createSearchParams(o,!1,!1,r),d=a.generateSearchHref(l);window.location=d}}else window.alert(e["Can't search: no search service is available"])},a.generateSearchHelper=function(e,t){var n=e.keyword,i=n,r={};if(e.fileType&&e.fileType!==a.ALL_FILE_TYPE&&""===n&&(i="*."+e.fileType),e.regEx)r.searchStr=n,s(r,e,t);else{var o=n.indexOf("*")>-1,l=n.indexOf("?")>-1;o&&(n=n.split("*").join(".*")),l&&(n=n.split("?").join(".")),o||l||e.nameSearch?(r.searchStr=e.caseSensitive?n:n.toLowerCase(),s(r,e,t),r.wildCard=!0):(r.searchStr=e.caseSensitive?n.split("\\").join(""):n.split("\\").join("").toLowerCase(),r.wildCard=!1)}return r.searchStrLength=r.searchStr.length,{params:e,inFileQuery:r,displayedSearchTerm:i}},a.convertSearchParams=function(e){void 0!==e.rows&&(e.rows=parseInt(e.rows,10)),void 0!==e.start&&(e.start=parseInt(e.start,10)),"string"==typeof e.regEx&&(e.regEx="true"===e.regEx.toLowerCase()),"string"==typeof e.caseSensitive&&(e.caseSensitive="true"===e.caseSensitive.toLowerCase()),"string"==typeof e.nameSearch&&(e.nameSearch="true"===e.nameSearch.toLowerCase()),void 0!==e.fileNamePatterns&&(e.fileNamePatterns=a.getFileNamePatternsArray(e.fileNamePatterns))},a.getFileNamePatternsArray=function(e){var t=void 0;if(e){var n=e.trim();n=n.replace(/^(\s*,\s*)+/g,""),n=n.replace(/([^\\]),(\s*,\s*)*/g,"$1/"),n=n.replace(/(\s*\/\s*)/g,"/"),n=n.replace(/\/\/+/g,"/"),n=n.replace(/\/+$/g,""),t=n.split("/")}return t},a.copySearchParams=function(e,t){var n={};for(var i in e)if(void 0!==e[i]&&null!==e[i]){if(!t&&"replace"===i)continue;n[i]=e[i]}return n},a.generateSearchHref=function(e){var n=t.toUrl("search/search.html"),i=a.copySearchParams(e,!0),r=i.resource;i.resource=void 0;var s;return s="undefined"!=typeof i.keyword?new o(n+"#{,resource,params*}").expand({resource:r,params:i}):new o(n+"#{,resource}").expand({resource:r})},a.generateFindURLBinding=function(e,t,n,i,r){var s={find:t.searchStr,regEx:t.wildCard?!0:void 0,caseSensitive:e.caseSensitive?!0:void 0,replaceWith:"string"==typeof i?i:void 0,atLine:"number"==typeof n?n:void 0};if(r)return s;var a=new o("{,params*}").expand({params:s});return","+a},a.convertFindURLBinding=function(e){"string"==typeof e.regEx&&(e.regEx="true"===e.regEx.toLowerCase()),"string"==typeof e.caseSensitive&&(e.caseSensitive="true"===e.caseSensitive.toLowerCase()),"string"==typeof e.atLine&&(e.atLine=parseInt(e.atLine,10))},a.replaceRegEx=function(e,t,n){var i=new RegExp(t.pattern,t.flags);return e.replace(i,n)},a.replaceStringLiteral=function(e,t,i){var r=n.parse("/"+t+"/gim");return a.replaceRegEx(e,r,i)},a.searchOnelineLiteral=function(e,t,n){for(var i,r=0,o=!1,s=[];;){if(i=t.indexOf(e.searchStr,r),0>i)break;if(s.push({startIndex:i,length:e.searchStrLength}),o=!0,n)break;r=i+e.searchStrLength}return o?s:null},a.findRegExp=function(e,t,n,i){if(!t)return null;n=n||"",n+=(-1===n.indexOf("g")?"g":"")+(-1===n.indexOf("m")?"m":"");var r=new RegExp(t,n),o=null;return o=r.exec(e.substring(i)),o&&{startIndex:o.index+i,length:o[0].length}},a.searchOnelineRegEx=function(e,t,n){for(var i=0,r=!1,o=[];;){var s=a.findRegExp(t,e.regExp.pattern,e.regExp.flags,i);if(!s)break;if(o.push(s),r=!0,n)break;i=s.startIndex+s.length}return r?o:null},a.generateNewContents=function(e,t,n,i,r,o){if(i&&t){e||(n.contents=[]);for(var s=0;s<t.length;s++){for(var l,d,c=t[s],h=!1,u=!1,p=[],f=0,g=0;g<i.children.length;g++){var m=i.children[g].lineNumber-1;if(m===s){for(f=g,d=0;d<i.children[g].matches.length;d++)i.children[g+d].checked!==!1&&p.push(d);u=p.length>0,l=i.children[g].matches,h=!0;break}}if(h){var v;if(u){var y=a.replaceCheckedMatches(c,r,l,p,o);for(v=y.replacedStr,d=0;d<i.children[f].matches.length;d++)i.children[f+d].newMatches=y.newMatches}else for(v=c,d=0;d<i.children[f].matches.length;d++)i.children[f+d].newMatches=i.children[f+d].matches;e?n.contents[s]=v:n.contents.push(v)}else e||n.contents.push(c)}}},a.generateMatchContext=function(e,t,n){var i,r,o=[],s=2*e+1;t.length<=s?(i=0,r=t.length-1):(i=n-e,0>i?(i=0,r=i+s-1):(r=n+e,r>t.length-1&&(r=t.length-1,i=r-s+1)));for(var a=i;r>=a;a++)o.push({context:t[a],current:a===n});return o},a.splitFile=function(e){for(var t=0,n=0,i=0,r=0,o=[];;){if(-1!==t&&i>=t&&(t=e.indexOf("\r",i)),-1!==n&&i>=n&&(n=e.indexOf("\n",i)),-1===n&&-1===t){o.push(e.substring(r));break}var s=1;-1!==t&&-1!==n?t+1===n?(s=2,i=n+1):i=(n>t?t:n)+1:i=-1!==t?t+1:n+1,o.push(e.substring(r,i-s)),r=i}return o},a.searchWithinFile=function(e,t,n,i,r,o){var s=a.splitFile(n);if(r&&(t.contents=s),t){t.children=[];for(var l=0,d=0;d<s.length;d++){var c=s[d];if(c&&c.length>0){var h,u=o?c:c.toLowerCase();if(h=e.wildCard?a.searchOnelineRegEx(e,u):a.searchOnelineLiteral(e,u)){var p,f=d+1;if(r)for(var g=0;g<h.length;g++){var m=g+1;p={parent:t,checked:t.checked,type:"detail",matches:h,lineNumber:f,matchNumber:m,name:c,location:t.location+"-"+f+"-"+m},t.children.push(p)}else p={parent:t,context:a.generateMatchContext(2,s,d),checked:t.checked,type:"detail",matches:h,lineNumber:f,name:c,location:t.location+"-"+f},t.children.push(p);l+=h.length}}}t.totalMatches=l}},a.replaceCheckedMatches=function(e,t,n,i,r){for(var o=r,s=0,a="",l=[],d=0;d<n.length;d++){s!==n[d].startIndex&&(a+=e.substring(s,n[d].startIndex)),n[d].length&&(o=n[d].length);for(var c=!1,h=0;h<i.length;h++)if(i[h]===d){c=!0;break}c?(l.push({startIndex:a.length,length:t.length}),a+=t):(l.push({startIndex:a.length,length:o}),a+=e.substring(n[d].startIndex,n[d].startIndex+o)),s=n[d].startIndex+o}return s<e.length&&(a+=e.substring(s)),{replacedStr:a,newMatches:l}},a.fullPathNameByMeta=function(e){var t=e.length,n="";if(t>0)for(var i=t-1;i>-1;i--){var r=""===n?"":"/";n=n+r+e[i].Name}return n},a.path2FolderName=function(e,t,n){var i=n?0:1;return e.substring(0,e.length-t.length-i)},a.getOpenSearchPref=function(e,t){e.getService("orion.core.preference").getPreferences("/cm/configurations").then(function(e){var n,i=e.get("nav.config");n=i&&"undefined"!==i["links.newtab"]&&i["links.newtab"]?!0:!1,t(n)})},a.setOpenSearchPref=function(e,t){e.getService("orion.core.preference").getPreferences("/window/favorites").then(function(e){e.put("openSearchPref",{openInNewTab:t})})},a}),define("orion/crawler/searchCrawler",["i18n!orion/crawler/nls/messages","require","orion/i18nUtil","orion/searchUtils","orion/contentTypes","orion/Deferred"],function(e,t,n,i,r,o){function s(e,t,n,r){this.registry=e,this.fileClient=t,this.fileLocations=[],this.fileSkeleton=[],this._hitCounter=0,this._totalCounter=0,this._searchOnName=r&&r.searchOnName,this._buildSkeletonOnly=r&&r.buildSkeletonOnly,this._fetchChildrenCallBack=r&&r.fetchChildrenCallBack,this._searchParams=n,this.searchHelper=this._searchOnName||this._buildSkeletonOnly?null:i.generateSearchHelper(n),this._location=r&&r.location,this._childrenLocation=r&&r.childrenLocation?r.childrenLocation:this._location,this._reportOnCancel=r&&r.reportOnCancel,this._cancelled=!1,this._statusService=this.registry.getService("orion.page.message"),this._progressService=this.registry.getService("orion.page.progress"),this._statusService&&this._statusService.setCancelFunction(function(){this._cancelFileContentsSearch()}.bind(this))}return s.prototype.search=function(e){var t=this.registry.getService("orion.core.contentTypeRegistry");this._onSearchComplete=e,this._cancelled=!1,this._deferredArray=[],t.getContentTypes().then(function(e){this.contentTypesCache=e;var t=this;this._visitRecursively(this._childrenLocation).then(function(){(!t._cancelled||t._reportOnCancel)&&t._reportResult(),t._cancelled&&t._HandleStatus({name:"Cancel"})}.bind(t),function(e){t._reportResult(),t._HandleStatus(e)}.bind(t))}.bind(this))},s.prototype.searchName=function(e,t){e&&(this._searchParams=e,this.searchHelper=i.generateSearchHelper(e,!0)),t&&(this.onSearchNameComplete=t);var n=[];if(this._cancelled=!1,this._deferredArray=[],this._sort(this.fileSkeleton),this.fileSkeleton.length>0){for(var r=0;r<this.fileSkeleton.length;r++){var o,s=this.fileSkeleton[r].Name.toLowerCase();if(o=this.searchHelper.inFileQuery.wildCard?i.searchOnelineRegEx(this.searchHelper.inFileQuery,s,!0):i.searchOnelineLiteral(this.searchHelper.inFileQuery,s,!0),o&&(n.push(this.fileSkeleton[r]),n.length>=this.searchHelper.params.rows))break}var a={numFound:n.length,docs:n};this.onSearchNameComplete({response:a})}else this.onSearchNameComplete({response:{numFound:0,docs:[]}})},s.prototype.buildSkeleton=function(e,t){this._buildingSkeleton=!0;var n=this.registry.getService("orion.core.contentTypeRegistry");this._cancelled=!1,this._deferredArray=[];var i=this;e(),n.getContentTypes().then(function(e){i.contentTypesCache=e,i._visitRecursively(i._childrenLocation).then(function(){i._buildingSkeleton=!1,t(),i.searchHelper&&!i._buildSkeletonOnly&&i.searchName()})})},s.prototype._sort=function(e){e.sort(function(e,t){var n,r;if("Path asc"===this._searchParams.sort){var o=e.Location&&e.Location.toLowerCase();n=i.path2FolderName(o,e.Name&&e.Name.toLowerCase(),!0);var s=t.Location&&t.Location.toLowerCase();return r=i.path2FolderName(s,t.Name&&t.Name.toLowerCase(),!0),r>n?-1:n>r?1:this._sortOnNameSingle(e,t)}return this._sortOnNameSingle(e,t)}.bind(this))},s.prototype._HandleStatus=function(t){this._statusService&&"Cancel"===t.name&&(console.log("Crawling search cancelled. Deferred array length : "+this._deferredArray.length),this._statusService.setProgressResult({Message:e["Search cancelled by user"],Severity:"Warning"}))},s.prototype._reportResult=function(){this._sort(this.fileLocations);var e={numFound:this.fileLocations.length,docs:this.fileLocations};this._onSearchComplete({response:e})},s.prototype._sortOnNameSingle=function(e,t){var n=e.Name&&e.Name.toLowerCase(),i=t.Name&&t.Name.toLowerCase();return i>n?-1:n>i?1:0},s.prototype._fileNameMatches=function(e){var t=!0;return this.searchHelper.params.fileNamePatterns&&(t=this.searchHelper.params.fileNamePatterns.some(function(t){var n="^"+t.replace(/([*?])/g,".$1")+"$";return e.match(n)})),t},s.prototype._visitRecursively=function(e){var t=[],n=this;return this._fetchChildrenCallBack&&this._fetchChildrenCallBack(e),(n._progressService?this._progressService.progress(n.fileClient.fetchChildren(e),"Crawling search for children of "+e):n.fileClient.fetchChildren(e)).then(function(e){for(var i=0;i<e.length;i++)if(void 0!==e[i].Directory&&e[i].Directory===!1){if(n._searchOnName)t.push(n._buildSingleSkeleton(e[i]));else if(n._buildSkeletonOnly)t.push(n._buildSingleSkeleton(e[i]));else if(!n._cancelled){var s=r.getFilenameContentType(e[i].Name,n.contentTypesCache);if(s&&("text/plain"===s["extends"]||"text/plain"===s.id)&&n._fileNameMatches(e[i].Name)){var a=n._sniffSearch(e[i]);t.push(a),n._deferredArray.push(a)}}}else if(e[i].Location){if(n._cancelled)break;var l=n._visitRecursively(e[i].ChildrenLocation);t.push(l),n._deferredArray.push(l)}return o.all(t)})},s.prototype._hitOnceWithinFile=function(e){var t,n=this._searchParams.caseSensitive?e:e.toLowerCase();return t=this.searchHelper.inFileQuery.wildCard?i.searchOnelineRegEx(this.searchHelper.inFileQuery,n,!0):i.searchOnelineLiteral(this.searchHelper.inFileQuery,n,!0)},s.prototype._reportSingleHit=function(e){if(!this._cancelled){e.LastModified=e.LocalTimeStamp,this.fileLocations.push(e),this._hitCounter++,this._sort(this.fileLocations);var t={numFound:this.fileLocations.length,docs:this.fileLocations};this._onSearchComplete({response:t},!0)}},s.prototype._cancelFileContentsSearch=function(){this._cancelled=!0,this._cancelled&&this._deferredArray.forEach(function(e){e.cancel()})},s.prototype._sniffSearch=function(t){this._totalCounter++;var i=this;if(!this._cancelled)return""!==this.searchHelper.params.keyword?(i._progressService?i._progressService.progress(i.fileClient.read(t.Location),"Reading file "+t.Location):i.fileClient.read(t.Location)).then(function(r){i._hitOnceWithinFile(r)&&i._reportSingleHit(t),i._statusService&&i._statusService.setProgressResult({Message:n.formatMessage(e["${0} files found out of ${1}"],i._hitCounter,i._totalCounter)},e.Cancel)},function(e){e&&e.message&&"cancel"!==e.message.toLowerCase()&&console.error("Error loading file content: "+e.message)}):(this._reportSingleHit(t),void(this._statusService&&this._statusService.setProgressResult({Message:n.formatMessage(e["${0} files found out of ${1}"],this._hitCounter,this._totalCounter)})))},s.prototype._buildSingleSkeleton=function(e){this._totalCounter++,this.fileSkeleton.push(e),this.searchHelper&&!this._buildSkeletonOnly&&this._totalCounter%100===0&&this.searchName();var t=new o;return t.resolve(this._totalCounter),t},s.prototype.constructor=s,{SearchCrawler:s}}),define("orion/webui/dialogs/OpenResourceDialog",["i18n!orion/widgets/nls/messages","orion/crawler/searchCrawler","orion/contentTypes","require","orion/webui/littlelib","orion/util","orion/webui/dialog"],function(e,t,n,i,r,o,s){function a(e){this._init(e)}return a.prototype=new s.Dialog,a.prototype.TEMPLATE='<div role="search"><div><label id="fileNameMessage" for="fileName">${Type the name of a file to open (? = any character, * = any string):}</label></div><div><input id="fileName" type="text" class="setting-control" style="width:90%;"/></div><div id="progress" style="padding: 2px 0 0; width: 100%;"><img src="'+i.toUrl("../../../images/progress_running.gif")+'" class="progressPane_running_dialog" id="crawlingProgress"></img></div><div id="results" style="max-height:250px; height:auto; overflow-y:auto;" aria-live="off"></div><div id="statusbar"></div></div>',a.prototype._init=function(t){if(this.title=t.title||e["Find File Named"],this.modal=!0,this.messages=e,this._searcher=t.searcher,this._progress=t.progress,this._onHide=t.onHide,this._contentTypeService=new n.ContentTypeRegistry(this._searcher.registry),!this._searcher)throw new Error("Missing required argument: searcher");if(this._searchDelay=t.searchDelay||500,this._time=0,this._searcher.setCrawler(null),this._forceUseCrawler=!1,this._initialText=t.initialText,this._message=t.message,this._nameSearch=!0,void 0!==t.nameSearch&&(this._nameSearch=t.nameSearch),this._searchOnRoot=!0,this._fileService=this._searcher.getFileService(),!this._fileService)throw new Error(e["Missing required argument: fileService"]);if(this._searchRenderer=t.searchRenderer,!this._searchRenderer||"function"!=typeof this._searchRenderer.makeRenderFunction)throw new Error(e["Missing required argument: searchRenderer"]);this._initialize()},a.prototype._bindToDom=function(n){var i=this;i.$crawlingProgress.style.display="none",this._nameSearch?this.$fileName.setAttribute("placeholder",e["FileName FolderName"]):this.$fileName.setAttribute("placeholder",e.Search),this.$fileName.addEventListener("input",function(){i._time=+new Date,i._timeoutId&&clearTimeout(i._timeoutId),i._timeoutId=setTimeout(i.checkSearch.bind(i),0)},!1),this.$fileName.addEventListener("keydown",function(e){if(e.keyCode===r.KEY.ENTER){var t=r.$("a",i.$results);t&&(r.stop(e),(o.isMac?e.metaKey:e.ctrlKey)?window.open(t.href):(window.location.href=t.href,i.hide()))}},!1),n.addEventListener("keydown",function(e){var t,n,o,s,a,l=function(e,t,n){return t<e.length-1?e[t+1]:n},d=function(e,t,n){return t>0?e[t-1]:n};(e.keyCode===r.KEY.DOWN||e.keyCode===r.KEY.UP)&&(t=r.$$array("a",i.$results),o=document.activeElement,s=t.indexOf(o),e.keyCode===r.KEY.DOWN?s>=0?(o.classList.remove("treeIterationCursor"),a=l(t,s,t[0]),a.focus(),a.classList.add("treeIterationCursor")):t.length>0&&(a=l(t,-1,t[0]),a.focus(),a.classList.add("treeIterationCursor")):s>=0?(o.classList.remove("treeIterationCursor"),n=i.$fileName,a=d(t,s,n),a.focus(),s>0&&a.classList.add("treeIterationCursor")):t.length>0&&(t[t.length-1].focus(),t[t.length-1].classList.add("treeIterationCursor")),r.stop(e))}),n.addEventListener("mouseup",function(e){e.target.focus()},!1),setTimeout(function(){if(i._forceUseCrawler||!i._fileService.getService(i._searcher.getSearchLocation()).search){var n=i._searchOnRoot?i._searcher.getSearchRootLocation():i._searcher.getChildrenLocation(),r=new t.SearchCrawler(i._searcher.registry,i._fileService,"",{searchOnName:!0,location:n});i._searcher.setCrawler(r),r.buildSkeleton(function(){i.$crawlingProgress.style.display="inline",i.$progress.appendChild(document.createTextNode(e["Building file skeleton..."]))},function(){i.$crawlingProgress.style.display="none",i.$progress.removeChild(i.$progress.lastChild)})}},0),this._message&&(this.$fileNameMessage.removeChild(this.$fileNameMessage.firstChild),this.$fileNameMessage.appendChild(document.createTextNode(this._message))),this._initialText&&(this.$fileName.value=this._initialText,this.doSearch())},a.prototype.checkSearch=function(){clearTimeout(this._timeoutId);var e=(new Date).getTime();e-this._time>this._searchDelay?(this._time=e,this.doSearch()):this._timeoutId=setTimeout(this.checkSearch.bind(this),50)},a.prototype._detectFolderKeyword=function(e){var t,n,i=e,r=null;return this._nameSearch&&(t=/(\S+)\s*(.*)/,n=t.exec(e),n&&3===n.length&&(n[1]&&(i=n[1]),n[2]&&(r=n[2]))),{keyword:i,folderKeyword:r}},a.prototype.doSearch=function(){var t=this.$fileName.value;if(t){var n=this._detectFolderKeyword(t),i=this._searcher.createSearchParams(n.keyword,this._nameSearch,this._searchOnRoot),s=this._searchRenderer.makeRenderFunction(this._contentTypeService,this.$results,!1,this.decorateResult.bind(this));this.currentSearch=s;var a=document.createElement("div");a.appendChild(document.createTextNode(this._nameSearch?e["Searching..."]:o.formatMessage(e["Searching for occurrences of"],t))),r.empty(this.$results),this.$results.appendChild(a),this._searcher.search(i,n.folderKeyword,function(){s===this.currentSearch&&s.apply(null,arguments)}.bind(this))}},a.prototype.decorateResult=function(e){function t(e){0!==e.button||e.ctrlKey||e.metaKey||n.hide()}for(var n=this,i=r.$$array("a",e),o=0;o<i.length;o++){var s=i[o];s.addEventListener("click",t,!1)}},a.prototype._beforeHiding=function(){clearTimeout(this._timeoutId)},a.prototype._afterHiding=function(){this._onHide&&this._onHide()},a.prototype.constructor=a,{OpenResourceDialog:a}}),define("text!orion/banner/banner.html",[],function(){return'<header id="banner" role="banner">\r\n	<!-- Requires some js code to bind the home link, link to progress image, and binding NLS variables  -->\r\n\r\n	<div id="staticBanner" class="layoutBlock topRowBanner"> <!-- primaryNav -->\r\n		<div id="centralNavigationArea" style="position:absolute;left:0;top:0;width:39px;height:36px; z-index:1;border-right:1px solid #ddd;"></div>\r\n\r\n		<!-- Static "Home" link. TODO delete this -->\r\n		<a id="home" class="layoutLeft "></a>\r\n\r\n		<!-- Left banner component: hamburger -->\r\n		<nav id="primaryNav" class="bannerLeftArea" style="z-index:2;" role="navigation">\r\n				<button class="centralNavigation commandSprite core-sprite-hamburger" type="button"id="centralNavigation"></button>\r\n		</nav>\r\n\r\n		<!-- Middle banner component: Breadcrumb bar -->\r\n		<div class="clear navigationBreadcrumb bannerMiddleArea" >\r\n			<div id="location" class="currentLocation"></div>\r\n		</div>\r\n\r\n		<!-- Right banner component: user identity -->\r\n		<div class="bannerRightArea" style="z-index:2;">\r\n			<!-- Global commands support. -->\r\n			<div id="globalActions" class="spacingLeft layoutLeft"></div>\r\n\r\n			<!-- Search. TODO delete this -->\r\n			<input type="text" id="search" autocomplete="off" class="layoutLeft spacingLeft searchbox" role="search" style="display:none;">\r\n			<div id="searchOptions" class="layoutLeft" style="padding-top:1px;display:none;"></div>\r\n\r\n			<!-- User identity menu and Progress -->\r\n			<div id="userMenu" class="spacingRight layoutRight" style="color:#ccc;line-height:16px;">\r\n				<div id="progressPane" class="progressWatch" tabindex="0" role="progressbar">\r\n					<div id="watchButton" class="watchButton"></div>\r\n					<div id="watchBody" class="watchBody">\r\n						<span class="hand longMinute">\r\n							<span class="darkSide"></span>\r\n						</span>\r\n						<span class="hand longHour">\r\n							<span class="darkSide"></span>\r\n						</span>\r\n					</div>\r\n				</div>\r\n				\r\n				<div style="position: absolute;right: 0px;top:0;width: 39px;height:36px; z-index:-50;border-left: 1px solid #ddd;"></div>\r\n				<span id="userTrigger" tabindex="0" role="button" class="dropdownTrigger" style="z-index:2;">\r\n				</span>\r\n				<ul id="userDropdown" class="dropdownMenu" role="menu"></ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n	<!-- IDE notification messages go in here -->\r\n	<div id="notificationArea" class="notificationHide">\r\n		<div class="layoutLeft" id="notifications" aria-live="assertive" aria-atomic="true"></div>\r\n		<div class="layoutRight"><button aria-label="Close" class="dismissButton layoutRight core-sprite-close imageSprite" type="button" id="closeNotifications"></span></div>\r\n	</div>\r\n</header>\r\n'
}),define("text!orion/banner/footer.html",[],function(){return'<!--\r\n<footer id="footerContent" class="layoutBlock footerLayout" role="contentinfo">\r\n	<div class="logoFooter commandSprite core-sprite-orion-logo"></div>\r\n	<div class="footerBlock">${Orion is in Beta. Please try it out but BEWARE your data may be lost.}</div>\r\n	<div class="footerRightBlock">\r\n		<ul>\r\n			<li><a href="https://bugs.eclipse.org/bugs/enter_bug.cgi?product=Orion&version=5.0" target="_blank">${Report a Bug}</a>\r\n			<li><a href="http://www.eclipse.org/legal/privacy.php" target="_blank">${Privacy Policy}</a></li>\r\n			<li><a href="http://www.eclipse.org/legal/termsofuse.php" target="_blank">${Terms of Use}</a></li>\r\n			<li><a href="http://www.eclipse.org/legal/copyright.php" target="_blank">${Copyright Agent}</a></li>\r\n		</ul>\r\n	</div>\r\n</footer>\r\n-->'}),define("text!orion/banner/toolbar.html",[],function(){return'<ul class="layoutLeft commandList pageActions" id="pageActions"></ul>\r\n<ul class="layoutLeft commandList pageActions" id="selectionTools"></ul>\r\n<ul class="layoutLeft commandList pageActions" id="navActions"></ul>\r\n<div class="layoutLeft" style="padding-left:7px;padding-right:7px;margin-top:2px;" id="filterBox" style="visibility: hidden;"></div>\r\n<ul class="layoutRight commandList pageActions" id="settingsActions"></ul>\r\n<div class="layoutRight status" id="statusPane" role="status" aria-live="off"></div>\r\n<ul class="layoutRight commandList pageActions" id="pageNavigationActions"></ul>\r\n'}),define("orion/widgets/input/DropDownMenu",["orion/objects","orion/webui/littlelib"],function(e,t){function n(e,n,i){var r=t.node(e);if(!r)throw new Error("Parent node of dropdown menu not found");this._parent=r,i=i||{},this.options=i,this.navDropDownId=this._parent.id+"_navdropdown",this.selectionClass=i.selectionClass;var o=document.createElement("div");if(o.classList.add("dropdownMenu"),o.classList.add("dropdownMenuOpen"),o.id=this.navDropDownId,o.style.display="none",this._parent.appendChild(o),this._dropdownMenu=o,n=t.node(n),!n)throw"Trigger node of dropdown menu not found";this._triggerNode=n,"hidden"===this._triggerNode.style.visibility&&(this._triggerNode.style.visibility="visible"),i.noClick||(this._triggerNode.onclick=this.click.bind(this)),this._dropdownMenu.addEventListener("keydown",function(e){e.keyCode===t.KEY.ESCAPE&&this.clearPanel()}.bind(this))}return e.mixin(n.prototype,{click:function(){"none"===this._dropdownMenu.style.display?this.updateContent(this.getContentNode(),function(){t.setFramesEnabled(!1),this._dropdownMenu.style.display="",this._positionDropdown(),this.selectionClass&&this._triggerNode.classList.add(this.selectionClass),this.handle=t.addAutoDismiss([this._triggerNode,this._dropdownMenu],this.clearPanel.bind(this)),this.options.onShow&&this.options.onShow()}.bind(this)):this.clearPanel()},clearPanel:function(){this.isVisible()&&(this._dropdownMenu.style.display="none",t.setFramesEnabled(!0),this.selectionClass&&this._triggerNode.classList.remove(this.selectionClass),this.options.onHide&&this.options.onHide())},addContent:function(e){this._dropdownMenu.innerHTML=e},getContentNode:function(){return this._dropdownMenu},updateContent:function(e,t){t()},_positionDropdown:function(){this._dropdownMenu.style.right="";var e=t.bounds(this._dropdownMenu),n=t.bounds(document.body);if(e.left+e.width>n.left+n.width){var i=t.bounds(this._boundingNode(this._triggerNode)),r=t.bounds(this._triggerNode);this._dropdownMenu.style.right=i.width-(r.left-i.left+r.width)+"px"}},_boundingNode:function(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var n=t.getPropertyValue("position");return"absolute"!==n&&e.parentNode&&e!==document.body?this._boundingNode(e.parentNode):e},isDestroyed:function(){return!this._dropdownMenu.parentNode},isVisible:function(){return"none"!==this._dropdownMenu.style.display&&!this.isDestroyed()},focus:function(){this._dropdownMenu.focus()},destroy:function(){this._parent&&(t.setFramesEnabled(!0),t.empty(this._parent),this._parent=this.select=null)}}),n}),define("orion/customGlobalCommands",[],function(){return{}}),define("orion/navigate/nls/root/messages",{"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.":"Click one of the tasks below to create an Orion folder.  You can upload, import, or generate files.","Toggle Left Pane":"Toggle Left Pane","Open or close the left pane":"Open or close the left pane",Navigator:"Navigator","Strings Xtrnalizr":"Strings Xtrnalizr","Externalize Strings from JavaScript files in this folder":"Externalize strings from JavaScript files in this folder.","Choose a Folder":"Choose a Folder","Copy of ${0}":"Copy of ${0}","Enter a new name for '${0}'":"Enter a new name for '${0}'","Choose folder...":"Choose folder...",Rename:"Rename","Rename the selected files or folders":"Rename the selected files or folders","Compare with each other":"Compare with each other","Compare the selected 2 files with each other":"Compare the selected 2 files with each other","Compare with...":"Compare with...","Compare the selected folder with a specified folder":"Compare the selected folder with a specified folder",Delete:"Delete","Unknown item":"Unknown item","Are you sure you want to delete these ${0} items?":"Are you sure you want to delete these ${0} items?","Are you sure you want to delete '${0}'?":"Are you sure you want to delete '${0}'?","Export as zip":"Zip","Create a zip file of the folder contents and download it":"Create a zip file of the folder contents and download it","New File":"File","Create a new file":"Create a new file","Name:":"Name:","New Folder":"Folder","Folder name:":"Folder name:","Create a new folder":"Create a new folder","Creating folder":"Creating folder",Folder:"Folder","Create an empty folder":"Create an empty folder","Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.":"Create an empty folder on the Orion server.  You can import, upload, or create content in the editor.","Sample HTML5 Site":"Sample HTML5 Site","Generate a sample":"Generate a sample",'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.':'Generate an HTML5 "Hello World" website, including JavaScript, HTML, and CSS files.',"Creating a folder for ${0}":"Creating a folder for ${0}","SFTP Import":"SFTP Import","Import content from SFTP":"Import content from SFTP","Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.":"Import content from an SFTP location into an Orion folder.  You will be prompted for the SFTP location and credentials.","Imported Content":"Imported Content","Upload a Zip":"Upload a Zip","Upload content from a local zip file":"Upload content from a local zip file","Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.":"Upload content from a local zip file into an Orion folder.  You will be prompted for the local zip file.","Uploaded Content":"Uploaded Content","Creating an upload folder for ":"Creating an upload folder for ","Clone Git Repository":"Clone Git Repository","Clone a git repository":"Clone a git repository","Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.":"Go to the Orion repositories page to provide a git repository URL.  Once the repository is created, it will appear in the Navigator.","Link to Server":"Link to Server","Link to existing content on the server":"Link to existing content on the server","Create a folder that links to an existing folder on the server.":"Create a folder that links to an existing folder on the server.","Server path:":"Server path:","The name and server location were not specified.":"The name and server location were not specified.","Go Up":"Go Up","Move up to the parent folder":"Move up to the parent folder","Go Into":"Go Into","Move into the selected folder":"Move into the selected folder","File or zip archive":"File or zip archive","Import a file or zip archive from your local file system":"Import a file or zip archive from your local file system","SFTP from...":"SFTP","Copy files and folders from a specified SFTP connection":"Copy files and folders from a specified SFTP connection","Importing from ${0}":"Importing from ${0}","SFTP to...":"SFTP","Copy files and folders to a specified SFTP location":"Copy files and folders to a specified SFTP location",Exporting:"Exporting to ${0}","Pasting ${0}":"Pasting ${0}","Copy to":"Copy to","Move to":"Move to","Copying ${0}":"Copying ${0}","Moving ${0}":"Moving ${0}","Renaming ${0}":"Renaming ${0}","Deleting ${0}":"Deleting ${0}","Creating ${0}":"Creating ${0}","Linking to ${0}":"Linking to ${0}","Move files and folders to a new location":"Move files and folders to a new location",Cut:"Cut",Copy:"Copy","Fetching children of ":"Fetching children of ",Paste:"Paste","Cannot paste into the Workspace root":"Cannot paste into the Workspace root","Open With":"Open With","Loading ":"Loading ",New:"New",File:"File",Actions:"Actions","Orion Content":"Orion Content"," is not supported in this file system":" is not supported in this file system","Create new content":"Create new content","Import from HTTP...":"HTTP","File URL:":"File URL:","Import a file from a URL and optionally unzip it":"Import a file from a URL and optionally unzip it","Unzip *.zip files:":"Unzip *.zip files:","Extracted from:":"Extracted from:","Did not drop ${0}.  Folder drop is not supported in this browser.":"Did not drop ${0}.  Folder drop is not supported in this browser.","You cannot copy files directly into the workspace.  Create a folder first.":"You cannot copy files directly into the workspace.  Create a folder first.","Unzip ${0}?":"Unzip ${0}?","Upload progress: ":"Upload progress: ","Uploading ":"Uploading ","Cancel upload":"Cancel upload","Uploading the following file failed: ":"Uploading the following file failed: ","Enter project name:":"Enter project name:","Creating project ":"Creating project ",NoFile:"Use the ${0} menu to create new files and folders. Click a file to start coding.",Download:"Download",Download_tooltips:"Download the file contents as the displayed name","Downloading...":"Reading file contents...","Download not supported":"Contents download is not supported in this browser."}),define("orion/navigate/nls/messages",["orion/i18n!orion/navigate/nls/messages","orion/navigate/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/fileClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/i18nUtil"],function(e,t,n){function i(t,n,i){if(!t[n])throw n+e[" is not supported in this file system"];return t[n].apply(t,i)}function r(n,o,s,a){if(!n.readBlob)throw e["source file service does not support binary read"];if(!s.writeBlob)throw e["target file service does not support binary write"];if("/"!==o[o.length-1])return i(n,"readBlob",[o]).then(function(e){return i(s,"writeBlob",[a,e])});var l=a.substring(0,a.length-1),d=decodeURIComponent(l.substring(l.lastIndexOf("/")+1)),c=l.substring(0,l.lastIndexOf("/")+1);return i(s,"createFolder",[c,d]).then(function(){},function(){}).then(function(){return i(n,"fetchChildren",[o]).then(function(e){for(var i=[],o=0;o<e.length;++o){var l=e[o].Location,d=l;e[o].Directory&&(d=l.substring(0,l.length-1));var c=decodeURIComponent(d.substring(d.lastIndexOf("/")+1)),h=a+encodeURIComponent(c);e[o].Directory&&(h+="/"),i[o]=r(n,l,s,h)}return t.all(i)})})}function o(i,r){function o(n){var i=new t;return i.reject(e["No Matching FileService for location:"]+n),i}var s=i.getServiceReferences("orion.core.file"),a=s;if(r){a=[];for(var l=0;l<s.length;++l)r(s[l])&&a.push(s[l])}for(var d=[],c=[],h=[],u=[],p={fetchChildren:function(){var e=new t;return e.resolve(u),e},createWorkspace:function(){var n=new t;return n.reject(e["no file service"]),n},loadWorkspaces:function(){var n=new t;return n.reject(e["no file service"]),n},loadWorkspace:function(){var n=new t;return window.setTimeout(function(){n.resolve({Directory:!0,Length:0,LocalTimeStamp:0,Name:e["File Servers"],Location:"/",Children:u,ChildrenLocation:"/"})},100),n},search:o,createProject:o,createFolder:o,createFile:o,deleteFile:o,moveFile:o,copyFile:o,read:o,write:o},f=0;f<a.length;++f){u[f]={Directory:!0,Length:0,LocalTimeStamp:0,Location:a[f].getProperty("top"),ChildrenLocation:a[f].getProperty("top"),Name:a[f].getProperty("Name")};var g=a[f].getProperty("pattern")||a[f].getProperty("top").replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1");"^"!==g[0]&&(g="^"+g),d[f]=new RegExp(g),c[f]=i.getService(a[f]),h[f]=a[f].getProperty("Name"),a[f].getProperty("NameKey")&&a[f].getProperty("nls")&&n.getMessageBundle(a[f].getProperty("nls")).then(function(e,t){u[e].Name=t[a[e].getProperty("NameKey")],h[e]=t[a[e].getProperty("NameKey")]}.bind(this,f))}this._getServiceIndex=function(t){if("/"===t)return-1;if(!t||t.length&&0===t.length)return c[0]?0:-1;for(var n=0;n<d.length;++n)if(d[n].test(t))return n;throw e["No Matching FileService for location:"]+t},this._getService=function(e){var t=this._getServiceIndex(e);return-1===t?p:c[t]},this._getServiceName=function(e){var t=this._getServiceIndex(e);return-1===t?p.Name:h[t]},this._getServiceRootURL=function(e){var t=this._getServiceIndex(e);return-1===t?p.Location:u[t].Location}}return o.prototype={getService:function(e){return this._getService(e)},fileServiceName:function(e){return this._getServiceName(e)},fileServiceRootURL:function(e){return this._getServiceRootURL(e)},fetchChildren:function(e){return i(this._getService(e),"fetchChildren",arguments)},createWorkspace:function(){return i(this._getService(),"createWorkspace",arguments)},loadWorkspaces:function(){return i(this._getService(),"loadWorkspaces",arguments)},loadWorkspace:function(e){return i(this._getService(e),"loadWorkspace",arguments)},createProject:function(e){return i(this._getService(e),"createProject",arguments)},createFolder:function(e){return i(this._getService(e),"createFolder",arguments)},createFile:function(e){return i(this._getService(e),"createFile",arguments)},deleteFile:function(e){return i(this._getService(e),"deleteFile",arguments)},moveFile:function(e,t,n){var o=this._getService(e),s=this._getService(t);if(o===s)return i(o,"moveFile",arguments);var a="/"===e[e.length-1],l=t;if("/"!==l[l.length-1]&&(l+="/"),n)l+=encodeURIComponent(n);else{var d=e;a&&(d=d.substring(0,d.length-1)),l+=d.substring(d.lastIndexOf("/")+1)}return a&&"/"!==l[l.length-1]&&(l+="/"),r(o,e,s,l).then(function(){return i(o,"deleteFile",[e])})},copyFile:function(e,t,n){var o=this._getService(e),s=this._getService(t);if(o===s)return i(o,"copyFile",arguments);var a="/"===e[e.length-1],l=t;if("/"!==l[l.length-1]&&(l+="/"),n)l+=encodeURIComponent(n);else{var d=e;a&&(d=d.substring(0,d.length-1)),l+=d.substring(d.lastIndexOf("/")+1)}return a&&"/"!==l[l.length-1]&&(l+="/"),r(o,e,s,l)},read:function(e){return i(this._getService(e),"read",arguments)},readBlob:function(e){return i(this._getService(e),"readBlob",arguments)},write:function(e){return i(this._getService(e),"write",arguments)},remoteImport:function(e){return i(this._getService(e),"remoteImport",arguments)},remoteExport:function(e){return i(this._getService(e),"remoteExport",arguments)},search:function(e){return i(this._getService(e.resource),"search",arguments)}},o.prototype.constructor=o,{FileClient:o}}),define("orion/webui/SideMenu",["orion/webui/littlelib","orion/PageUtil","orion/URL-shim"],function(e,t){function n(t,n){if(this._parentNode=e.node(t),!this._parentNode)throw new Error("Missing parentNode");this._contentNode=e.node(n),this._categoryInfos=[],this._categorizedPageLinks={},this._categorizedRelatedLinks={},this._categorizedAnchors=null,this._state=localStorage.getItem(i)||s,this._currentCategory="",this._notificationTimeout=null,this._renderTimeout=null}var i="sideMenuNavigation",r="open",o="closed",s=r,a="40px",l=301;return n.prototype={constructor:n.prototype.constructor,setCategories:function(e){this._categoryInfos=e.getCategoryIDs().map(function(t){return e.getCategory(t)}).sort(function(e,t){var n=e.order||100,i=t.order||100;return i>n?-1:n>i?1:e.textContent.localeCompare(t.textContent)})},setPageLinks:function(e){this._categorizedPageLinks={},e.getAllLinks().forEach(function(e){var t=e.category;this._categorizedPageLinks[t]=this._categorizedPageLinks[t]||[],this._categorizedPageLinks[t].push({title:e.textContent,order:e.order||100,href:e.href})},this)},setRelatedLinks:function(e,t){this._categorizedRelatedLinks={},e.forEach(function(e){var n=e.relatedLink,i=e.command,r=e.invocation;if(!t||-1===t.indexOf(n.id)){var o=n.category;this._categorizedRelatedLinks[o]=this._categorizedRelatedLinks[o]||[],this._categorizedRelatedLinks[o].push({title:i.name,order:n.order||100,href:i.hrefCallback.call(r.handler,r)})}},this),this._updateCategoryAnchors(),this._updateCategoryNotifications()},render:function(){if(null===this._categorizedAnchors){this._categorizedAnchors={};var e=new URL(window.location.href);e.hash="",this._currentCategory="",Object.keys(this._categorizedPageLinks).some(function(t){var n=this._categorizedPageLinks[t];return n.some(function(t){var n=new URL(t.href);return t.hash="",e.href===n.href})?(this._currentCategory=t,!0):void 0},this);var t=document.createElement("ul");t.classList.add("sideMenuList"),this._categoryInfos.forEach(function(e){var n=document.createElement("li");n.classList.add("sideMenuItem"),n.classList.add("sideMenu-notification"),this._currentCategory===e.id&&n.classList.add("sideMenuItemActive"),n.categoryId=e.id,n.categoryName=e.textContent||e.id;var i=document.createElement("a");if(i.classList.add("submenu-trigger"),"string"==typeof e.imageDataURI&&0===e.imageDataURI.indexOf("data:image")){var r=document.createElement("img");r.width="16",r.height="16",r.src=e.imageDataURI,i.appendChild(r)}else{var o=e.imageClass||"core-sprite-blank-menu-item";i.classList.add(o)}n.appendChild(i),t.appendChild(n),this._categorizedAnchors[e.id]=i},this),this._updateCategoryAnchors(),this._parentNode.appendChild(t)}this._state===o?(this._contentNode.style.left="0",this._renderTimeout&&(window.clearTimeout(this._renderTimeout),this._renderTimeout=null),this._renderTimeout=window.setTimeout(function(){this._parentNode.style.display="none",this._renderTimeout=null}.bind(this),l),this._parentNode.classList.add("animating")):(this._renderTimeout&&(window.clearTimeout(this._renderTimeout),this._renderTimeout=null),this._parentNode.classList.remove("animating"),this._parentNode.style.display="block",this._parentNode.style.width=a,this._contentNode.style.left=a)},hide:function(){localStorage.setItem(i,o),this._contentNode.style.left="0"},toggle:function(){var e=this._contentNode;e&&e.classList.add("content-fixedHeight-animation"),this._state=this._state===r?o:r,this._state===s?localStorage.removeItem(i):localStorage.setItem(i,this._state),this.render()},_updateCategoryAnchors:function(){Object.keys(this._categorizedAnchors).forEach(function(e){var t=this._categorizedAnchors[e],n=[];if(e===this._currentCategory)return t.href="",t.onclick=function(){return!1},void(t.title=t.parentElement.categoryName);if(this._categorizedPageLinks[e]&&n.push.apply(n,this._categorizedPageLinks[e]),this._categorizedRelatedLinks[e]&&n.push.apply(n,this._categorizedRelatedLinks[e]),0===n.length)t.href="",t.title=t.parentElement.categoryName;else{n.sort(function(e,t){return e.order<t.order?-1:t.order<e.order?1:e.title.localeCompare(t.title)});var i=n.shift();t.href=i.href,t.title=i.title}},this)},_updateCategoryNotifications:function(){clearTimeout(this._notificationTimeout),this._notificationTimeout=setTimeout(this._updateCategoryNotifications.bind(this),3e5);var e=t.matchResourceParameters().resource,n=new URL(e,window.location.href).href;this._categoryInfos.forEach(function(i){if(i.service&&i.service.getNotifications){var r=this._categorizedAnchors[i.id].parentElement;i.service.getNotifications(n).then(function(n){if(e===t.matchResourceParameters().resource){var i="";n.forEach(function(e){"info"!==e.level||i?"warn"!==e.level||i&&"info"!==i?"error"===e.level&&"error"!==i&&(i="error"):i="warn":i="info"}),i?r.setAttribute("level",i):r.removeAttribute("level")}},function(e){window.console.log(e)})}},this)}},n}),define("orion/globalCommands",["i18n!orion/nls/messages","require","orion/commonHTMLFragments","orion/keyBinding","orion/EventTarget","orion/commandRegistry","orion/commands","orion/parameterCollectors","orion/extensionCommands","orion/uiUtils","orion/keyBinding","orion/breadcrumbs","orion/webui/littlelib","orion/webui/splitter","orion/webui/dropdown","orion/webui/tooltip","orion/contentTypes","orion/URITemplate","orion/keyAssist","orion/PageUtil","orion/widgets/themes/ThemePreferences","orion/widgets/themes/container/ThemeData","orion/Deferred","orion/widgets/UserMenu","orion/PageLinks","orion/webui/dialogs/OpenResourceDialog","text!orion/banner/banner.html","text!orion/banner/footer.html","text!orion/banner/toolbar.html","orion/widgets/input/DropDownMenu","orion/util","orion/customGlobalCommands","orion/fileClient","orion/webui/SideMenu","orion/objects"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m,v,y,_,C,w,b,x,S,L,E,k,T,A,N,M,I,D,R){function P(e){var t=document.createElement("a");return t.href=e,t.href}function O(e,t){if(e.getLabel)return e.getLabel();var n=new b;return n.resolve(t.properties.name),n}function B(){var e=document.getElementById("userTrigger"),t=e.className;t+=" imageSprite core-sprite-silhouette",e.className=t}function F(t){var n=u.node("progressPane");n.setAttribute("aria-label",e["Operations - Press spacebar to show current operations"]);var i=t.getService("orion.page.progress");i&&i.init.bind(i)("progressPane")}function V(e){var t=e.getServiceReferences("orion.core.auth");rt=[];var n=it.createMenuGenerator.apply(this,arguments);if(n)for(var i=0;i<t.length;i++){var r=t[i],o=e.getService(r);O(o,r).then(function(e){o.getKey().then(function(t){rt.push(t),o.getUser().then(function(i){n.addUserItem(t,o,e,i)},function(i,r){n.addUserItem(t,o,e,r)}),window.addEventListener("storage",function(){nt[t]!==localStorage.getItem(t)&&(nt[t]=localStorage.getItem(t),o.getUser().then(function(i){n.addUserItem(t,o,e,i)},function(){n.addUserItem(t,o,e)}))},!1)})})}}function j(e){return e}function U(e,t,n,i,r){function o(){if(u)return u;var t=e.getService("orion.core.contentTypeRegistry");return t||(t=new m.ContentTypeRegistry(e),t=e.getService("orion.core.contentTypeRegistry")),t.getContentTypes().then(function(e){return u=e})}function a(e){for(var t,n={},i=e.getPropertyKeys(),r=0;r<i.length;r++)t=i[r],n[t]=e.getProperty(t);return n}function d(e,t){var n=null;return e.some(function(e){return t===e.getProperty("id")?!!(n=e):!1}),n}function c(e){var n=e.command;return!n.visibleWhen||n.visibleWhen(t)?(e.invocation=new s.CommandInvocation(t,t,null,n,i),(new b).resolve(e)):"function"==typeof r?(p||(p=r()),b.when(p,function(r){return!r||t!==Q||n.visibleWhen&&!n.visibleWhen(r)?void 0:(e.invocation=new s.CommandInvocation(r,r,null,n,i),e)})):(new b).resolve()}function h(e,t,n){return n?(new b).resolve({relatedLink:e,command:n}):t.then(function(t){return{relatedLink:e,command:new s.Command(t)}})}var u,p,f=arguments,g=e&&e.getServiceReferences("orion.page.link.related");if(g&&0!==g.length){var v=this;b.when(o(),function(){if(it.beforeGenerateRelatedLinks.apply(v,f)){var t=e.getServiceReferences("orion.navigate.command"),r=[];g.forEach(function(n){var o=a(n);if(o.id){var s;if((o.nls&&o.nameKey||o.name)&&o.uriTemplate)return s=l._createCommandOptions(o,n,e,u,!0),void r.push(h(o,s,null));var c=d(t,o.id);if(c){var p=a(c),f={};R.mixin(f,p,o);var g;(g=i.findCommand(o.id))?r.push(h(f,null,g)):(s=l._createCommandOptions(p,c,e,u,!0),r.push(h(f,s,null)))}}}),b.all(r,j).then(function(e){return e.sort(function(e,t){return e.command.name.localeCompare(t.command.name)}),b.all(e.map(c),j).then(function(t){var r=[];t=t.filter(function(t,n){return t?!0:(r.push(e[n]),!1)}),it.addRelatedLinkCommands.call(v,i,t,r,n),it.afterGenerateRelatedLinks.apply(v,f)})})}})}}function H(e){var t=u.node("globalActions");t&&(e.destroy(t),e.renderCommands(t.id,t,{},{},"tool"))}function W(e){ot=e}function $(e){et&&("*"!==et.charAt(0)||e||(et=et.substring(1)),e&&"*"!==et.charAt(0)&&(et="*"+et),window.document.title=et);var t=u.node("dirty");t&&(t.textContent=e?"*":"")}function K(e){var t,n,i=e.breadcrumbRootName,r=e.serviceRegistry;e.target?(e.searchService&&e.searchService.setLocationByMetaData(e.target),!e.fileService||e.breadcrumbTarget||e.staticBreadcrumb||(n=i?i+" ":"",n+=e.fileService.fileServiceName(e.target.Location),i=null),t=e.name||e.target.Name,Q=e.target,U.call(this,r,e.target,ot,e.commandService,e.makeAlternate)):(e.breadcrumbTarget||(i=i||e.task||e.name),t=e.name,U.call(this,r,{NoTarget:""},ot,e.commandService,e.makeAlternate)),et=e.title,et||(et=t?t+" - "+e.task:e.task),window.document.title=et,it.afterSetPageTarget.apply(this,arguments);var o=u.node(e.breadCrumbContainer?e.breadCrumbContainer:"location");if(o)if(u.empty(o),e.staticBreadcrumb)new h.BreadCrumbs({container:o,rootSegmentName:i});else{var s=r&&new I.FileClient(r),a=e.breadcrumbTarget||e.target,l=s&&a&&a.Location?s.fileServiceRootURL(a.Location):null;new h.BreadCrumbs({container:o,resource:a,rootSegmentName:i,workspaceRootSegmentName:n,workspaceRootURL:l,makeFinalHref:e.makeBreadcrumFinalLink,makeHref:e.makeBreadcrumbLink})}}function G(e){var t=window.getComputedStyle(e,null);if(null===t)return e;var n=t.getPropertyValue("position");return"absolute"!==n&&e.parentNode&&e!==document.body?G(e.parentNode):e}function z(e){var t={},n=null;"string"==typeof e&&(e=u.node(e)),e||(e=u.node("pageActions"));for(var i=e;i&&i.classList;){if(i.classList.contains("toolComposite")){n=i;break}i=i.parentNode}if(e.classList.contains("commandMarker")&&(t.commandNode=e),n||(n=u.node("pageToolbar")),n&&(t.slideContainer=u.$(".slideParameters",n),t.parameterArea=u.$(".parameters",n),t.dismissArea=u.$(".parametersDismiss",n),t.notifications=u.$("#notificationArea",n),n.parentNode&&(t.toolbarTarget=u.$(".toolbarTarget",n.parentNode),t.toolbarTarget))){var r=u.bounds(t.toolbarTarget),o=u.bounds(G(t.toolbarTarget.parentNode));t.toolbarTargetY=r.top-o.top,t.toolbar=n}return t}function q(e){var t=e.slideContainer;if(t&&(t.style.left="",t.style.top="",t.classList.contains("slideContainerActive"))){var n=u.bounds(t),i=u.bounds(t.parentNode);t.style.left=(i.width-n.width)/2+"px",t.style.top="0"}}function Y(){return st}function X(){return at}function J(){return lt}function Z(r,o,l,d,c,h,f,g){function m(e){e=e;for(var t=u.$$array(".targetSelector"),n=0;n<t.length;n++)t[n].target=e}function v(e){e.registerService("orion.cm.managedservice",{updated:function(e){var t;t=e&&"undefined"!==e["links.newtab"]&&e["links.newtab"]?"_blank":"_self",m(t)}},{pid:"nav.config"})}new C.ThemePreferences(d,new w.ThemeData).apply();var _=u.node(r);if(!_)throw e["could not find banner parent, id was "]+r;var x=document.createRange();x.selectNode(_);var A=x.createContextualFragment(E);u.processTextNodes(A,e),_.firstChild?_.insertBefore(A,_.firstChild):_.appendChild(A);var M=u.node("home");M.href=t.toUrl("edit/edit.html"),M.setAttribute("aria-label",e["Orion Home"]);var I=u.node("progressPane");I.src=s.NO_IMAGE;var D=u.node("pageToolbar");D&&(D.classList.add("toolbarLayout"),D.innerHTML=T+n.slideoutHTMLFragment("mainToolbar"));var R=u.node("closeNotifications");if(R&&R.setAttribute("aria-label",e["Close notification"]),N.isFirefox<=17){var P=u.node("staticBanner");P&&(P.style.width="100%",P.style.MozBoxSizing="border-box")}var O=u.node("footer");O&&(O.innerHTML=k,u.processTextNodes(O,e)),l.setParameterCollector(new a.CommandParameterCollector(z,q)),document.addEventListener("keydown",function(e){if(e.keyCode===u.KEY.ESCAPE){var t=o.getService("orion.page.message");t&&t.setProgressMessage("")}},!1),it.generateNavigationMenu.apply(this,arguments),it.afterGenerateNavigationMenu.apply(this,arguments);var B=S.getCategoriesInfo(o),j=S.getPageLinksInfo(o,"orion.page.link");b.all([B,j]).then(function(e){if(this.sideMenu){var t=e[0],n=e[1];this.sideMenu.setCategories(t),this.sideMenu.setPageLinks(n),this.sideMenu.render()}}.bind(this));var U=u.$(".split");if(U){var W=u.$(".sidePanelLayout"),$=u.$(".mainPanelLayout");if(W&&$){st={side:W,main:$},st.splitter=new p.Splitter({node:U,sidePanel:W,mainPanel:$,toggle:!0,closeByDefault:g});var K=new s.Command({name:e["Toggle side panel"],tooltip:e["Open or close the side panel"],id:"orion.toggleSidePane",callback:function(){st.splitter.toggleSidePanel()}});l.addCommand(K),l.registerCommandContribution("pageActions","orion.toggleSidePane",1,null,!0,new i.KeyBinding("l",N.isMac?!1:!0,!0,!1,N.isMac?!0:!1))}}var G=!1,Y=function(e,t){if(!G){var n=t.getService("orion.page.progress"),i=new L.OpenResourceDialog({searcher:e,progress:n,searchRenderer:e.defaultRenderer,onHide:function(){G=!1}});window.setTimeout(function(){G=!0,i.show()},0)}},X=new s.Command({name:e["Find File Named..."],tooltip:e["Choose a file by name and open an editor on it"],id:"orion.openResource",callback:function(){Y(c,o)}});l.addCommand(X),l.registerCommandContribution("globalActions","orion.openResource",100,null,!0,new i.KeyBinding("f",!0,!0));var Z=!1,Q=function(){if(Z)return!1;var e=u.node("banner"),t=u.node("footer"),n=u.node("sideMenu"),i=u.$(".content-fixedHeight"),r="hidden"===e.style.visibility;return r?(e.style.visibility="visible",t.style.visibility="visible",i.classList.remove("content-fixedHeight-maximized"),n&&n.classList.remove("sideMenu-maximized")):(e.style.visibility="hidden",t.style.visibility="hidden",i.classList.add("content-fixedHeight-maximized"),n&&n.classList.add("sideMenu-maximized")),J().dispatchEvent({type:"toggleTrim",maximized:!r}),!0},et=window.orionNoTrim||!1;if(et)Q(),Z=!0,this.sideMenu.hide();else{var tt=new s.Command({name:e["Toggle banner and footer"],tooltip:e["Hide or show the page banner and footer"],id:"orion.toggleTrim",callback:Q});l.addCommand(tt),l.registerCommandContribution("globalActions","orion.toggleTrim",100,null,!0,new i.KeyBinding("m",!0,!0))}var nt=new s.Command({name:e["System Configuration Details"],tooltip:e["System Config Tooltip"],id:"orion.configDetailsPage",hrefCallback:function(){return t.toUrl("help/about.html")}});l.addCommand(nt),l.registerCommandContribution("globalActions","orion.configDetailsPage",100,null,!0,new i.KeyBinding(112,!0,!0));var rt=new s.Command({name:e["Background Operations"],tooltip:e["Background Operations Tooltip"],id:"orion.backgroundOperations",hrefCallback:function(){return t.toUrl("operations/list.html")}});l.addCommand(rt),l.registerCommandContribution("globalActions","orion.backgroundOperations",100,null,!0,new i.KeyBinding("o",!0,!0)),at=new y.KeyAssistPanel({commandRegistry:l});var ot=new s.Command({name:e["Show Keys"],tooltip:e["Show a list of all the keybindings on this page"],id:"orion.keyAssist",callback:function(){return at.isVisible()?at.hide():at.show(),!0}});l.addCommand(ot),l.registerCommandContribution("globalActions","orion.keyAssist",100,null,!0,new i.KeyBinding(191,!1,!0)),H(l),V(o,ot.callback),F(o),window.addEventListener("hashchange",function(){l.processURL(window.location.href)},!1),window.setTimeout(function(){v(o)},0),it.afterGenerateBanner.apply(this,arguments)}var Q,et,tt=P(t.toUrl("auth/NotifyAuthentication.html")),nt={},it={createMenuGenerator:M.createMenuGenerator||function(t,n){var i=u.node("userMenu");if(i){var r=u.node("userDropdown"),o=new f.Dropdown({dropdown:r}),s=new x.UserMenu({dropdownNode:r,dropdown:o,serviceRegistry:t}),a=u.node("userTrigger");return new g.Tooltip({node:a,text:e.Options,position:["below","left"]}),B(),s.setKeyAssist(n),s}},beforeGenerateRelatedLinks:M.beforeGenerateRelatedLinks||function(){return!0},addRelatedLinkCommands:M.addRelatedLinkCommands||function(e,t,n,i){this.sideMenu&&this.sideMenu.setRelatedLinks(t,i)
},afterGenerateRelatedLinks:M.afterGenerateRelatedLinks||function(){},afterSetPageTarget:M.afterSetPageTarget||function(){},generateNavigationMenu:M.generateNavigationMenu||function(){var t=u.node("sideMenu");if(t){var n=u.node("centralNavigation");new g.Tooltip({node:n,text:e.CentralNavTooltip,position:["right"]}),this.sideMenu=new D(t,u.node("pageContent")),n.addEventListener("click",this.sideMenu.toggle.bind(this.sideMenu));var i=u.node("sideMenuToggle");i&&i.addEventListener("click",this.sideMenu.toggle.bind(this.sideMenu))}},afterGenerateNavigationMenu:M.afterGenerateNavigationMenu||function(){},afterGenerateBanner:M.afterGenerateBanner||function(){}},rt=[],ot=[],st=null,at=null,lt=new r;return{generateBanner:Z,getToolbarElements:z,getMainSplitter:Y,getKeyAssist:X,getGlobalEventTarget:J,layoutToolbarElements:q,setPageTarget:K,setDirtyIndicator:$,setPageCommandExclusions:W,notifyAuthenticationSite:tt}}),define("orion/outliner",["i18n!orion/nls/messages","orion/Deferred","orion/webui/littlelib","orion/uiUtils","orion/section","orion/explorers/explorer","orion/commands","orion/URITemplate","orion/EventTarget","orion/i18nUtil","orion/edit/editorContext","orion/keyBinding","orion/globalCommands"],function(e,t,n,i,r,o,s,a,l,d,c,h,u){function p(e,t,n,i){this.explorer=t,this._init(e),this.title=n,this.selectionService=i}function f(e,t,n){this.registry=e,this.renderer=new p({checkbox:!1,treeTableClass:"outlineExplorer"},this,n,t)}function g(e,t){this.items=e,this.root={children:e},this.root.outlinerId=t,this.idItemMap={}}function m(e){this._init(e)}function v(e){this._serviceRegistry=e.serviceRegistry,this._preferences=e.preferences,l.attach(this),this._serviceRegistration=this._serviceRegistry.registerService("orion.edit.outline",this),this._outlinePref=this._preferences.getPreferences("/edit/outline"),this._provider=new t,this._providerResolved=!1,this.filteredProviders=[]}return p.prototype=new o.SelectionRenderer,p.prototype.constructor=p,p.prototype.getLabelColumnIndex=function(){return 0},p.prototype.getCellElement=function(e,t,n){if(t){var i=document.createElement("span"),r=document.createElement("span"),o=document.createElement("span");n.appendChild(i),i.appendChild(r),i.appendChild(o),t.className&&(o.className+=t.className),t.children?this.getExpandImage(n,r):r.classList.add("outlineLeafIndent");var s=document.createElement("span");if(t.labelPre||t.classNamePre){var l=document.createElement("span");s.appendChild(l),t.labelPre&&l.appendChild(document.createTextNode(t.labelPre)),t.classNamePre&&(l.className+=t.classNamePre)}if(t.label&&s.appendChild(document.createTextNode(t.label)),t.labelPost||t.classNamePost){var d=document.createElement("span");s.appendChild(d),t.labelPost&&d.appendChild(document.createTextNode(t.labelPost)),t.classNamePost&&(d.className+=t.classNamePost)}if(t.href)this._createLink(s,t.href,o);else if(t.line||t.column||t.start){var c=new a("#{,resource,params*}").expand({resource:this.title,params:t});this._createLink(s,c,o),t.outlineLink=c}else o.appendChild(s)}},p.prototype._createLink=function(e,t,n){var i=document.createElement("a");return n.appendChild(i),i.classList.add("navlinkonpage"),i.appendChild(e),this.selectionService?(i.style.cursor="pointer",i.addEventListener("click",function(e){this._followLink(e,t)}.bind(this),!1)):i.href=t,i},p.prototype.performRowAction=function(e,t){this._followLink(e,t.outlineLink)},p.prototype._followLink=function(e,t){var n=this.selectionService;n&&(i.openInNewWindow(e)?i.followLink(t,e):n.setSelections(t))},f.prototype=new o.Explorer,f.prototype.constructor=f,f.prototype.filterChanged=function(e){var t=this.getNavHandler(),n=null;if(e){var i="i";n=e.replace(/([.+^=!:${}()|\[\]\/\\])/g,"\\$1"),n=n.replace(/([*?])/g,".$1"),/[A-Z]/.test(n)&&(i=""),n=new RegExp(n,i),this._currentModifiedFilter=n,this._previousUnmodifiedFilter?0!==e.indexOf(this._previousUnmodifiedFilter)&&this.expandAll():this.expandAll()}else this.expandAll(),this._currentModifiedFilter=null;for(var r=t.getTopLevelNodes(),o=0;o<r.length;o++)this._filterRecursively(r[o],n);this._previousUnmodifiedFilter=e},f.prototype._filterRecursively=function(e,t){var n=this.getNavHandler(),i=this,r=n.getRowDiv(e),o=-1!==e.label.search(t);if(e.children&&n.isExpanded(e)){var s=!1;e.children.forEach(function(e){i._filterRecursively(e,t)&&(s=!0)}),s||this.myTree.collapse(e)}var a=!t||s||o;return t?(a?r.classList.remove("outlineRowHidden"):r.classList.add("outlineRowHidden"),o?r.classList.add("outlineRowMatchesFilter"):r.classList.remove("outlineRowMatchesFilter"),n.setIsNotSelectable(e,!o)):(r.classList.remove("outlineRowHidden"),r.classList.remove("outlineRowMatchesFilter"),n.setIsNotSelectable(e,!1)),a},f.prototype.postUserExpand=function(e){if(this._currentModifiedFilter){var t=this.getNavDict().getValue(e).model;this._expandRecursively(t),this._filterRecursively(t,this._currentModifiedFilter)}},g.prototype.constructor=g,g.prototype.getRoot=function(e){e(this.root)},g.prototype.destroy=function(){},g.prototype.getId=function(e){if(e.outlinerId)return e.outlinerId;for(var t=e.label.replace(/[\\\/\.\:\-\_\s]/g,""),i=t,r=0;this.idItemMap[i]&&this.idItemMap[i]!==e||n.node(i);)i=t+"["+r+"]",r+=1;return this.idItemMap[i]=e,e.outlinerId=i,i},g.prototype.getIdItemMap=function(){return this.idItemMap},g.prototype.getChildren=function(e,t){if(e.children){for(var n=0;n<e.children.length;n++)e.children[n].parent=e;t(e.children)}else t([])},g.prototype.doExpansions=function(e){for(var t=0;t<this.root.children.length;t++)this.root.children[t].children&&e.expand(this.root.children[t])},m.prototype={_init:function(e){var i=n.node(e.parent),r=n.node(e.toolbar);if(!i)throw new Error("no parent");if(!e.outlineService)throw new Error("no outline service");this._parent=i,this._toolbar=r,this._serviceRegistry=e.serviceRegistry,this._contentTypeRegistry=e.contentTypeRegistry,this._outlineService=e.outlineService,this._commandService=e.commandService,this._selectionService=e.selectionService,this._inputManager=e.inputManager,this._sidebar=e.sidebar;var o=this;this._inputManager.addEventListener("InputChanged",function(e){o.setContentType(e.contentType,e.location),o._editor!==e.editor&&(o._editor&&o._editor.removeEventListener("InputChanged",o._editorListener),o._editor=e.editor,o._editor&&o._editor.addEventListener("InputChanged",o._editorListener=o.generateOutline.bind(o)))}),t.when(o._outlineService,function(e){e.addEventListener("outline",function(e){o.providerId=e.providerId,o._renderOutline(e.outline,e.title)})})},generateOutline:function(){this._isActive()&&(this._providerLookup||this._outlineService.emitOutline(this._inputManager))},setSelectedProvider:function(e){this.providerId=e.getProperty("id"),this.providerName=e.getProperty("name"),this._outlineService.setProvider(e)},setOutlineProviders:function(e){var t=this.outlineProviders,n=this._isActive();this.outlineProviders=e,this._updateViewModes(t,this.outlineProviders),n&&this._selectNewProvider()},_renderOutline:function(e,t){var i=this._parent;if(n.empty(i),e=e instanceof Array?e:[e]){var r=new g(e);this.explorer=new f(this._serviceRegistry,this._selectionService,t),this.explorer.createTree(i,r,{selectionPolicy:"cursorOnly",setFocus:!1}),r.doExpansions(this.explorer.myTree)}},_selectNewProvider:function(){var e=this.outlineProviders,t=this,n=t._sidebar,i=e.every(function(e){return t.providerId!==e.getProperty("id")});if(i){var r=e[0];n.setViewMode(r?this._viewModeId(r):n.defaultViewMode)}},_viewModeId:function(e){return"outline."+e.getProperty("id")},_updateViewModes:function(e,t){var n=this;e&&e.forEach(function(e){n._sidebar.removeViewMode(n._viewModeId(e))}),t.forEach(function(e){n._sidebar.addViewMode(n._viewModeId(e),{label:e.displayName||e.getProperty("name")||e.name+e.serviceId||"undefined",create:n.createViewMode.bind(n,e),destroy:n.destroyViewMode.bind(n,e)})});var i=n._sidebar;if(this._commandService.unregisterCommandContribution(this._toolbar.id,"orion.openOutline",null),t&&t[0]){var r=n._viewModeId(t[0]),o=new s.Command({name:"Open Outliner",id:"orion.openOutline",callback:function(){var e=u.getMainSplitter();e.splitter.isClosed()&&e.splitter.toggleSidePanel(),i.getActiveViewModeId()!==r&&i.setViewMode(r),n._filterInput&&(n._previousActiveElement=document.activeElement,n._filterInput.select())}});this._commandService.addCommand(o),this._commandService.registerCommandContribution(this._toolbar.id,"orion.openOutline",1,null,!0,new h.KeyBinding("o",!0)),this._commandService.renderCommands(this._toolbar.id,this._toolbar,{},{},"tool")}i.renderViewModeMenu()},_isActive:function(){var e=this._sidebar.getActiveViewModeId();if(!e)return!1;var t=this;return this.outlineProviders&&this.outlineProviders.some(function(n){return e===t._viewModeId(n)})},createViewMode:function(e){this.setSelectedProvider(e),this._createFilterInput(),this.generateOutline()},destroyViewMode:function(){this.explorer&&(this.explorer.destroy(),this.explorer=null)},_createFilterInput:function(){var t=document.createElement("input");t.classList.add("outlineFilter"),t.placeholder=e.Filter,t.type="text",t.addEventListener("input",function(){this._filterInputTimeout&&window.clearTimeout(this._filterInputTimeout);var e=this;this._filterInputTimeout=window.setTimeout(function(){e.explorer.filterChanged(t.value),e._filterInputTimeout=null},200)}.bind(this)),t.addEventListener("keydown",function(e){var i=null,r=null;e.keyCode===n.KEY.DOWN?(t.blur(),i=this.explorer.getNavHandler(),i.focus(),i.getTopLevelNodes()&&(r=i.getTopLevelNodes()[0],i.cursorOn(r,!1,!0),r.isNotSelectable&&i.iterate(!0,!1,!1,!0)),e.preventDefault&&e.preventDefault()):e.keyCode===n.KEY.ESCAPE&&this._previousActiveElement&&this._previousActiveElement.focus()}.bind(this),!1),this._toolbar.appendChild(t),this._filterInput=t},setContentType:function(e,n){var i=this._serviceRegistry.getServiceReferences("orion.edit.outliner"),r=this,o=this.filteredProviders=i.filter(function(t){var i=t.getProperty("contentType"),o=t.getProperty("pattern");return i?i.some(function(t){return r._contentTypeRegistry.isExtensionOf(e,t)}):o&&new RegExp(o).test(n)?!0:!1});this._providerLookup=!0;var s=o.map(function(e){if(e.getProperty("nameKey")&&e.getProperty("nls")){var n=new t,i=function(e,t,n){e.displayName=n[e.getProperty("nameKey")],t.resolve()};return d.getMessageBundle(e.getProperty("nls")).then(i.bind(null,e,n),n.reject),n}return e.displayName=e.getProperty("name"),(new t).resolve()});t.all(s,function(e){return e}).then(function(){r._providerLookup=!1,r._outlineService.setOutlineProviders(o),r.setOutlineProviders(o),r.generateOutline()})}},m.prototype.constructor=m,v.prototype={setOutlineProviders:function(e){this.providers=e;var n=this;t.when(this._outlinePref,function(t){for(var i,r=0;r<e.length&&(i=e[r],t.get("outlineProvider")!==e[r].getProperty("id"));r++);i&&n.setProvider(i)})},setProvider:function(e){this._providerResolved&&(this._provider=new t),this._provider.resolve(e),this._providerResolved=!0;var n=e.getProperty("id");n&&this._outlinePref.then(function(e){e.put("outlineProvider",n)})},getProvider:function(){return this._provider.promise},emitOutline:function(n){var i=this;t.when(this.getProvider(),function(t){var r,o,s=n.getEditor(),a=s.getTitle(),l=i._serviceRegistry,h=l.getService("orion.page.progress"),u=l.getService(t);if(r=u.computeOutline){var p=n.getContentType();o=[c.getEditorContext(l),{contentType:p&&p.id}]}else(r=u.getOutline)&&(o=[s.getText(),a]);h.progress(r.apply(u,o),d.formatMessage(e.OutlineProgress,a,t.displayName)).then(function(e){e&&i.dispatchEvent({type:"outline",outline:e,title:a,providerId:t.getProperty("id")})})})}},v.prototype.constructor=v,{Outliner:m,OutlineService:v}}),define("orion/fileUtils",["require","i18n!orion/nls/messages","orion/URL-shim"],function(e){function t(e){if(!e)return e;var t=window.location.protocol+"//"+window.location.host;return 0===e.indexOf(t)?e.substring(t.length):e}function n(e){if(!e)return!1;if("/workspace"===e)return!0;var t=new URL(e,window.location.href);return 0===t.href.indexOf(i)}var i;return i=e.toUrl?new URL(e.toUrl("workspace"),window.location.href).href:new URL("/",window.location.href).href,{makeRelative:t,isAtRoot:n}}),define("orion/explorers/explorer-table",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/webui/littlelib","orion/i18nUtil","orion/fileUtils","orion/explorers/explorer","orion/EventTarget","orion/objects","orion/util"],function(e,t,n,i,r,o,s,a,l){function d(e,t,n,i,r,o){this.registry=e,this.root=t,this.fileClient=n,this.idPrefix=i||"",this.excludeFiles=!!r,this.excludeFolders=!!o}function c(e){s.attach(this),this.registry=e.serviceRegistry,this.treeRoot=e.treeRoot,this.selection=e.selection,this.fileClient=e.fileClient,this.excludeFiles=e.excludeFiles,this.excludeFolders=e.excludeFolders,this.navHandlerFactory=e.navHandlerFactory,this.parentId=e.parentId,this.renderer=e.rendererFactory(this),this.dragAndDrop=e.dragAndDrop,this.setFocus=e.setFocus,this.model=null,this.myTree=null,this.checkbox=!1,this._hookedDrag=!1;var t=e.modelEventDispatcher?e.modelEventDispatcher:new s;this.modelEventDispatcher=t;var i=this;this._modelListeners={},["copy","copyMultiple","create","delete","deleteMultiple","import","move","moveMultiple"].forEach(function(e){t.addEventListener(e,i._modelListeners[e]=i.modelHandler[e].bind(i))}),this._clickListener=function(e){if("A"===e.target.tagName){for(var t=e.target;t&&!t._item;)t=t.parentNode;t&&t._item&&i.onLinkClick({type:"linkClick",item:t._item})}};var r=n.node(this.parentId);r&&r.addEventListener("click",this._clickListener);var o=this.renderer;this.registry&&this.registry.registerService("orion.cm.managedservice",{updated:function(e){var t;t=e&&"undefined"!==e["links.newtab"]&&e["links.newtab"]?"_blank":"_self",o.setTarget&&o.setTarget(t)}},{pid:"nav.config"})}d.prototype=new o.ExplorerModel,a.mixin(d.prototype,{getRoot:function(e){e(this.root)},processParent:function(e,t){var n=e.Projects?[]:[e].concat(e.Parents||[]);if(this.excludeFiles||this.excludeFolders){var i=[];for(var r in t){var o=t[r].Directory?this.excludeFolders:this.excludeFiles;o||(i.push(t[r]),t[r].parent=e,t[r].Parents||(t[r].Parents=n))}t=i}else for(var s in t)t[s].parent=e,t[s].Parents||(t[s].Parents=n);return e.children=t,e.children.sort(this.sortChildren),t},sortChildren:function(e,t){var n=e.Directory,i=t.Directory;if(n!==i)return n?-1:1;var r=e.Name&&e.Name.toLowerCase(),o=t.Name&&t.Name.toLowerCase();return o>r?-1:r>o?1:0},getChildren:function(t,n){var i=this;if(t.children)n(t.children);else if(void 0!==t.Directory&&t.Directory===!1)n([]);else if(t.Children)n(i.processParent(t,t.Children));else if(t.Location){var r=null;this.registry&&(r=this.registry.getService("orion.page.progress")),(r?r.progress(this.fileClient.fetchChildren(t.ChildrenLocation),e["Fetching children of "]+t.Name):this.fileClient.fetchChildren(t.ChildrenLocation)).then(function(e){i.destroyed||n(i.processParent(t,e))},function(){n([])})}else n([])},hasChildren:function(){var e=!1;return this.root.Children&&(e=this.root.Children.length>0),e}}),d.prototype.constructor=d;var h,u;return c.prototype=Object.create(o.Explorer.prototype),a.mixin(c.prototype,{destroy:function(){var e=this;Object.keys(this._modelListeners).forEach(function(t){e.modelEventDispatcher.removeEventListener(t,e._modelListeners[t])});var t=n.node(this.parentId);t&&t.removeEventListener("click",this._clickListener),o.Explorer.prototype.destroy.call(this)},onLinkClick:function(e){this.dispatchEvent(e)},onModelCreate:function(e){return this.changedItem(e.parent,!0)},onModelCopy:function(e){var n=this,i={};return(e.items||[e]).forEach(function(e){var t=e.parent;t=t||n.treeRoot,i[t.Location]=t}),t.all(Object.keys(i).map(function(e){return n.changedItem(i[e],!0)}))},onModelMove:function(e){var n=this,i={};return(e.items||[e]).forEach(function(e){var r=n.treeRoot;if((r.Location||r.ContentLocation)===e.oldValue.Location){var o=n.treeRoot,s=e.newValue,a=s.ChildrenLocation?s:this.fileClient.read(s.ContentLocation,!0);return t.when(a,function(e){n.dispatchEvent({type:"rootMoved",oldValue:o,newValue:e}),n.loadResourceList(e)})}var l=e.oldValue.parent;l=l||n.treeRoot,i[l.Location]=l,l=e.parent,l=l||n.treeRoot,i[l.Location]=l,e.oldValue.Directory&&e.newValue&&n.isExpanded(e.oldValue)&&(i[e.newValue.Location]=e.newValue)}),t.all(Object.keys(i).map(function(e){return n.changedItem(i[e],!0)}))},onModelDelete:function(e){var n,i=e.items||[e],r=this,o=r.treeRoot,s=i.some(function(e){return e.oldValue.Location===(o.Location||o.ContentLocation)?(e.oldValue.Location!==(e.parent.Location||e.parent.ContentLocation)&&(n=e.parent),!0):!1});if(s)return this.loadResourceList(n);var a={};return i.forEach(function(e){var t=e.parent;a[t.Location]=t}),t.all(Object.keys(a).map(function(e){return r.changedItem(a[e],!0)}))},modelHandler:{copy:function(e){return e.count?void 0:this.onModelCopy(e)},copyMultiple:function(e){return this.onModelCopy(e)},create:function(e){return this.onModelCreate(e)},"delete":function(e){return e.count?void 0:this.onModelDelete(e)},deleteMultiple:function(e){return this.onModelDelete(e)},"import":function(e){var t=e.target;return this.changedItem(t,!0)},move:function(e){return e.count?void 0:this.onModelMove(e)},moveMultiple:function(e){return this.onModelMove(e)}},makeNewChildItemPlaceholder:function(e,n,i){var r=new t;return this.model.getChildren(e,function(t){var o=null,s=!1;if(t){t.push(n),t.sort(this.model.sortChildren);var a=t.indexOf(n),l=a+1;if(t.length>l)o=t[l];else{var d=a-1;o=d>=0?t[d]:e,s=!0}}else o=e;var c=this.makeNewItemPlaceholder(o,i,s);r.resolve(c)}.bind(this)),r},_makeDropTarget:function(o,s,a){function d(n,s,a,l,c,h){var u=!1,p=r.isAtRoot(s.Location);h?(u=!0,h.entryCount++):n.isDirectory&&(u=!0,h={entryCount:1,deferred:new t},a._makeUploadNode(s,n.name,!0).then(function(e){var t=function(){e.destroyFunction(),p?a.loadResourceList(a.treeRoot.Path,!0):a.changedItem(s)};h.deferred.then(t,t)}));var f=function(){h&&(h.entryCount--,0===h.entryCount&&h.deferred.resolve())},g=function(e){if(C){var t=null;t="string"==typeof e?{Severity:"Error",Message:e}:e&&e.error?{Severity:"Error",Message:e.error}:e,C.setProgressResult(t)}else window.console.log(e);f()};if(!s.Location&&s.fileMetadata&&(s=s.fileMetadata),n.isFile)p?g(e["You cannot copy files directly into the workspace.  Create a folder first."]):n.file(function(t){if(h){var n=t.name.indexOf(".zip")===t.name.length-4&&window.confirm(i.formatMessage(e["Unzip ${0}?"],t.name)),r={error:function(){var n=e["Uploading the following file failed: "]+t.name;C?C.setProgressResult({Severity:"Error",Message:n}):window.console.log(n)},loadend:f};l(s,t,a,n,!1,r,!0)}else a._uploadFile(o,t,!0)}.bind(this));else if(n.isDirectory){var m=n.createReader(),v=function(e){m.readEntries(function(t){for(var n=0;n<t.length;n++)d(t[n],e,a,l,c,h);f()})};p?(_?_.progress(c.createProject(s.ChildrenLocation,n.name),i.formatMessage(e["Creating ${0}"],n.name)):c.createProject(s.ChildrenLocation,n.name)).then(function(t){(_?_.progress(c.read(t.ContentLocation,!0),e["Loading "]+t.name):c.read(t.ContentLocation,!0)).then(function(e){v(e)},g)},g):(_?_.progress(c.createFolder(s.Location,n.name),i.formatMessage(e["Creating ${0}"],n.name)):c.createFolder(s.Location,n.name)).then(function(e){var t=a.modelEventDispatcher;u||t.dispatchEvent({type:"create",parent:o,newValue:e}),v(e)},g)}}if(this.dragAndDrop){var c=this,p=this.dragAndDrop,f=function(e){h=e.target};a&&(this._oldDragStart&&s.removeEventListener("dragstart",this._oldDragStart,!1),this._oldDragStart=f),s.addEventListener("dragstart",f,!1);var g=function(){h=null};a&&(this._oldDragEnd&&s.removeEventListener("dragend",this._oldDragEnd,!1),this._oldDragEnd=g),s.addEventListener("dragend",g,!1);var m=function(e){s.classList.remove("dragOver"),e.preventDefault(),e.stopPropagation()};a&&(this._oldDragLeave&&s.removeEventListener("dragleave",this._oldDragLeave,!1),this._oldDragLeave=m),s.addEventListener("dragleave",m,!1);var v=function(e){if(h){var t=l.isMac?e.altKey:e.ctrlKey;u=e.dataTransfer.dropEffect=t?"copy":"move"}else!l.isIE&&("all"===e.dataTransfer.effectAllowed||"uninitialized"===e.dataTransfer.effectAllowed||e.dataTransfer.effectAllowed.indexOf("copy")>=0)&&(e.dataTransfer.dropEffect="copy");s.classList.add("dragOver"),n.stop(e)};a&&(this._oldDragEnter&&s.removeEventListener("dragenter",this._oldDragEnter,!1),this._oldDragEnter=v),s.addEventListener("dragenter",v,!1);var y=function(e){if(h){var t=l.isMac?e.altKey:e.ctrlKey;u=e.dataTransfer.dropEffect=t?"copy":"move"}else!l.isIE&&("all"===e.dataTransfer.effectAllowed||"uninitialized"===e.dataTransfer.effectAllowed||e.dataTransfer.effectAllowed.indexOf("copy")>=0)&&(e.dataTransfer.dropEffect="copy");n.stop(e)};a&&!this._oldDragOver&&(s.addEventListener("dragover",y,!1),this._oldDragOver=y);var _=null,C=null;c.registry&&(_=c.registry.getService("orion.page.progress"),C=c.registry.getService("orion.page.message"));var w=function(e){if(C){var t=null;t="string"==typeof e?{Severity:"Error",Message:e}:e&&e.error?{Severity:"Error",Message:e.error}:e,C.setProgressResult(t)}else window.console.log(e)},b=function(t){var a,l;if(s.classList.remove("dragOver"),h){for(var f,g=c.fileClient,m=h;m;){if(m._item){f=m._item;break}m=m.parentNode}if(!f)return;var v="copy"===u,y=v?g.copyFile:g.moveFile;if(l=y.apply(g,[f.Location,o.Location,f.Name]),_){var C=i.formatMessage(e[v?"Copying ${0}":"Moving ${0}"],f.Location);l=_.showWhile(l,C)}l.then(function(e){var t=c.modelEventDispatcher;t.dispatchEvent({type:v?"copy":"move",oldValue:f,newValue:e,parent:o})},w)}else if(t.dataTransfer.items&&t.dataTransfer.items.length>0)for(a=0;a<t.dataTransfer.items.length;a++){var b=null;"function"==typeof t.dataTransfer.items[a].getAsEntry?b=t.dataTransfer.items[a].getAsEntry():"function"==typeof t.dataTransfer.items[a].webkitGetAsEntry&&(b=t.dataTransfer.items[a].webkitGetAsEntry()),b&&d(b,o,c,p,c.fileClient)}else if(t.dataTransfer.files&&t.dataTransfer.files.length>0)for(a=0;a<t.dataTransfer.files.length;a++){var x=t.dataTransfer.files[a];x.size||x.type?r.isAtRoot(o.Location)?w(e["You cannot copy files directly into the workspace.  Create a folder first."]):c._uploadFile(o,x,!0):w(i.formatMessage(e["Did not drop ${0}.  Folder drop is not supported in this browser."],x.name))}n.stop(t)};a&&(this._oldDrop&&s.removeEventListener("drop",this._oldDrop,!1),this._oldDrop=b),s.addEventListener("drop",b,!1)}},_uploadFile:function(t,n,r){var o=t;!o.Location&&o.fileMetadata&&(o=o.fileMetadata);var s=function(){this._makeUploadNode(o,n.name,!1).then(function(t){var r=t.refNode,s=t.progressBar,a=t.cancelButton,l=t.destroyFunction,d=this.registry.getService("orion.page.message"),c={progress:function(t){var n="";if(t.lengthComputable){n=Math.floor(t.loaded/t.total*100)+"%",s.style.width=n;var i=Math.round(t.loaded/1024),o=Math.round(t.total/1024);s.title=e["Upload progress: "]+n+",  "+i+"/"+o+" KB",r.title=s.title}},loadend:function(){l(),this.changedItem(o)}.bind(this),error:function(){var t=e["Uploading the following file failed: "]+n.name;d?d.setProgressResult({Severity:"Error",Message:t}):window.console.log(t)}},h=n.name.indexOf(".zip")===n.name.length-4&&window.confirm(i.formatMessage(e["Unzip ${0}?"],n.name)),u=this.dragAndDrop(o,n,this,h,!1,c,!0);a.addEventListener("click",function(){u.abort()})}.bind(this))}.bind(this);r?this.expandItem(o,!1).then(s):s()},_makeUploadNode:function(t,n,i){var r=this.getRow(t).id,o={Name:n,Directory:i};return this.makeNewChildItemPlaceholder(t,o,r).then(function(t){var r,o,s=null;if(t){s={},r=t.refNode,o=t.wrapperNode,r.classList.add("uploadNode"),s.refNode=r,s.wrapperNode=o;var a=document.createElement("span");a.classList.add("uploadNodeText"),a.appendChild(document.createTextNode(n)),r.appendChild(a);var l=document.createElement("span");l.classList.add("progressBarWrapper");var d=document.createElement("span");if(d.classList.add("progressBar"),l.appendChild(d),r.appendChild(l),s.progressBar=d,i)d.classList.add("continuous"),r.title=e["Uploading "]+n,d.title=r.title;else{var c=document.createElement("button");c.classList.add("imageSprite"),c.classList.add("core-sprite-delete"),c.classList.add("uploadCancelButton"),c.title=e["Cancel upload"],r.appendChild(c),s.cancelButton=c}s.destroyFunction=t.destroyFunction}return s}.bind(this))},createModel:function(){return new d(this.registry,this.treeRoot,this.fileClient,this.parentId,this.excludeFiles,this.excludeFolders)},changedItem:function(e,n){if(this.treeRoot&&this.treeRoot.Location===e.Location)return this.loadResourceList(this.treeRoot,n);var i=this,r=new t;return e.children=e.Children=null,this.model.getChildren(e,function(t){i.getNavHandler(),i.myTree.refresh.bind(i.myTree)(e,t,n),r.resolve(t)}),r},showItem:function(e,n){var i=new t;if(!e||!this.model||!this.myTree||!this.myTree.showRoot&&e.Location===this.treeRoot.Location)return i.reject();var r=this.getRow(e);return r?(i.resolve(r._item||e),i):e.Parents&&e.Parents.length>0?(e.Parents[0].Parents=e.Parents.slice(1),this.expandItem(e.Parents[0],n).then(function(n){var i=this.getRow(e);return i?i._item||e:this.changedItem(n,!0).then(function(){var n=this.getRow(e);return n?n._item:(new t).reject()}.bind(this))}.bind(this))):void 0===n||n?this.reroot(e):i.reject()},expandItem:function(e,n){var i=new t;return this.showItem(e,n).then(function(e){this.myTree.isExpanded(e)?i.resolve(e):this.myTree.expand(this.model.getId(e),function(){i.resolve(e)})}.bind(this),i.reject),i},reveal:function(e,t){return this.showItem(e,t).then(function(e){var t=this.getNavHandler();return t&&(t.cursorOn(e,!0),t.setSelection(e)),e}.bind(this))},reroot:function(){return(new t).reject()},isExpanded:function(e){var t=this.model.getId(e);return this.renderer.tableTree.isExpanded(t)},getNameNode:function(e){var t=this.model.getId(e);return t?n.node(t+"NameLink"):void 0},scopeUp:function(){},scopeDown:function(){},loadResourceList:function(n,i,o){if(n&&"object"==typeof n&&(n=n.ChildrenLocation||n.ContentLocation),n=r.makeRelative(n),!i&&n===this._lastPath)return(new t).resolve(this.treeRoot);this._lastPath=n;var s=this;return i||n!==this.treeRoot.Path?this.load(this.fileClient.loadWorkspace(n),e["Loading "]+n).then(function(){return s.treeRoot.Path=n,"function"==typeof o&&o(),s.dispatchEvent({type:"rootChanged",root:s.treeRoot}),(new t).resolve(s.treeRoot)},function(e){return s.treeRoot.Path=null,s.dispatchEvent({type:"rootChanged",root:s.treeRoot}),(new t).reject(e)}):(new t).resolve(s.treeRoot)},load:function(e,i,r){var o=n.node(this.parentId),s=n.node("progress");s||(s=document.createElement("div"),s.id="progress",n.empty(o),o.appendChild(s)),n.empty(s);var a=setTimeout(function(){n.empty(s),s.appendChild(document.createTextNode(i))},500),l=this;return t.when(e,function(e){if(clearTimeout(a),!l.destroyed){l.treeRoot={};for(var n in e)l.treeRoot[n]=e[n];if(l.model=l.createModel(),l.dragAndDrop)if(l._hookedDrag)l._makeDropTarget(l.treeRoot,o,!0);else{var i=o&&("draggable"in o||"ondragstart"in o&&"ondrop"in o);i=i&&!!(window.File&&window.FileList&&window.FileReader),l._hookedDrag=!0,i?l._makeDropTarget(l.treeRoot,o,!0):(l.dragAndDrop=null,window.console.log("Local file drag and drop is not supported in this browser."))}var s=new t;return l.createTree(l.parentId,l.model,{onComplete:function(e){s.resolve(e)},navHandlerFactory:l.navHandlerFactory,setFocus:"undefined"==typeof l.setFocus?!0:l.setFocus,selectionPolicy:l.renderer.selectionPolicy,onCollapse:function(e){l.getNavHandler()&&l.getNavHandler().onCollapse(e)}}),s.then(function(){if("function"==typeof r)try{r()}catch(e){l.registry&&l.registry.getService("orion.page.message").setErrorMessage(e)}return"function"==typeof l.onchange&&l.onchange(l.treeRoot),l.treeRoot})}},function(e){return clearTimeout(a),l.registry&&l.registry.getService("orion.page.message").setProgressResult(e),(new t).reject(e)})},onchange:function(){}}),c.prototype.constructor=c,{FileExplorer:c,FileModel:d}}),define("orion/widgets/browse/commitInfoRenderer",["orion/objects","orion/URITemplate","orion/webui/littlelib","orion/xhr","orion/URL-shim"],function(e,t,n,i){function r(e){var t=new Date,n=new Date(e),i=t.getTime()-n.getTime(),r=Math.floor(i/1e3/60/60/24/365);i-=1e3*r*60*60*24*365;var o=Math.floor(i/1e3/60/60/24/30);i-=1e3*o*60*60*24*30;var s=Math.floor(i/1e3/60/60/24);i-=1e3*s*60*60*24;var a=Math.floor(i/1e3/60/60);i-=1e3*a*60*60;var l=Math.floor(i/1e3/60);i-=1e3*l*60;var d=Math.floor(i/1e3);return{year:r,month:o,day:s,hour:a,minute:l,second:d}}function o(e,t,n){return e>0?1===e?t+" ":e+" "+n+" ":""}function s(e){var t=r(e),n=o(t.year,"a year","years"),i=o(t.month,"a month","months"),s=o(t.day,"a day","days"),a=o(t.hour,"an hour","hours"),l=o(t.minute,"a minute","minutes"),d="";return n?d=t.year>0?n:n+i:i?d=t.month>0?i:i+s:s?d=t.day>0?s:s+a:a?d=t.hour>0?a:a+l:l&&(d=l),d?d+"ago":"Just now"}function a(e){this._parentDomNode=n.node(e.parent),this._commitInfo=e.commitInfo}return e.mixin(a.prototype,{destroy:function(){},_simpleMessage:function(e){var t=this._commitInfo.Message?this._commitInfo.Message:"";if(t){var n=t.replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n");n&&n.length>0&&(t=n[0]),e>10&&t.length>e&&(t=t.substring(0,e-3)+"...")}return t},_generateMessageNode:function(e){var n;if(this._commitInfo.URL||this._commitInfo.SHA1){if(n=document.createElement("a"),this._commitInfo.SHA1){var i=new URL("commit",window.location.href).href;i=decodeURIComponent(i),n.href=new t(i+"{/SHA1}").expand(this._commitInfo)}else n.href=this._commitInfo.URL;n.classList.add("commitInfolink"),n.appendChild(document.createTextNode(e))}else n=document.createElement("span"),n.appendChild(document.createTextNode(e));return n},_requestPhotoURL:function(e,t){var n=this,r="/manage/service/com.ibm.team.jazzhub.common.service.IPhotoService/getContributorPhotoURI",o=new URL(r,window.location.href);o.query.set("contributorUserId",e);var s=o.href;i("GET",s,{timeout:15e3}).then(function(e){var n=JSON.parse(e.response);t.src=n.photoURI},function(){n._useOtherPhotoURL(t)})},_useOtherPhotoURL:function(e){e.src=this._commitInfo.AvatarURL?this._commitInfo.AvatarURL:"https://www.gravatar.com/avatar/?d=mm"},renderSimple:function(e){this._parentDomNode.appendChild(this._generateMessageNode(this._simpleMessage(e)))},render:function(e,t){var i=this._commitInfo.Author&&this._commitInfo.Author.Date?s(this._commitInfo.Author.Date):"",r=this._simpleMessage(-1),o=this._commitInfo.Author&&this._commitInfo.Author.Name?this._commitInfo.Author.Name:"",a=e;if(a||(a="Commit"),a="Last "+a,t){var l=document.createElement("div"),d=new Image;this._commitInfo.Author&&this._commitInfo.Author.UserId?this._requestPhotoURL(this._commitInfo.Author.UserId,d):this._useOtherPhotoURL(d),d.classList.add("commitInfoAvatar"),l.appendChild(d),this._parentDomNode.appendChild(l)}else{var c=document.createElement("div");c.classList.add("commitInfoLabelContainer"),c.appendChild(document.createTextNode(a.toUpperCase())),this._parentDomNode.appendChild(c)}var h=document.createElement("div");h.classList.add("commitInfoMessageContainer");var u=document.createElement("div");u.classList.add("commitInfoAutorContainer");var p=document.createDocumentFragment(),f=document.createElement("span");f.appendChild(document.createTextNode(o)),f.classList.add("navColumnBold");var g;if(t){var m=document.createElement("span");m.appendChild(document.createTextNode(a)),m.classList.add("navColumnBold"),p.textContent=i?"${0} by ${1} "+i+".":"${0} by ${1}.",g=[m,f]}else p.textContent=i?"by ${0} "+i+".":"by ${0}.",g=[f];n.processDOMNodes(p,g),u.appendChild(p),h.appendChild(u);var v=document.createElement("div");v.classList.add("commitInfoMessageTextContainer"),v.appendChild(this._generateMessageNode(r)),h.appendChild(v),this._parentDomNode.appendChild(h)}}),{CommitInfoRenderer:a,calculateTime:s}}),define("orion/explorers/navigatorRenderer",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/explorers/explorer","orion/explorers/navigationUtils","orion/extensionCommands","orion/objects","orion/URITemplate","orion/widgets/browse/commitInfoRenderer","orion/webui/littlelib"],function(e,t,n,i,r,o,s,a,l){function d(e){switch(e&&e.id){case"image/jpeg":case"image/png":case"image/gif":case"image/ico":case"image/tiff":case"image/svg":return!0
}return!1}function c(e,t,n,i){if(e){var r,o=e.imageClass,s=e.image;o?(r=document.createElement("span"),r.className+=o,r.classList.add("thumbnail")):s&&(r=document.createElement("img"),r.src=s,r.classList.add("thumbnail")),r&&t.replaceChild(r,i)}}function h(){return f}function u(e,n,i,a,l,h,u,p,g){n=o.clone(n);var v;if(n.Directory){v=document.createElement("a"),v.className="navlinkonpage";var y=e?new s(e+"#{,resource,params*}"):m;v.href=y.expand({resource:n.ChildrenLocation}),n.Name&&v.appendChild(document.createTextNode(n.Name))}else{l||(l=r.getOpenWithCommands(i)),v=document.createElement("a"),v.className="navlink targetSelector",h&&"object"==typeof h&&Object.keys(h).forEach(function(e){v[e]=h[e]});var _=null,C=null;_=p?p.holderDom:v,_&&(C=document.createElement("span"),C.className="core-sprite-file modelDecorationSprite thumbnail",_.appendChild(C)),n.Name&&v.appendChild(document.createTextNode(n.Name));var w=n.Location;u&&"object"==typeof u&&(n.params={},o.mixin(n.params,u));var b=r.getOpenWithCommand(i,n,l);b&&(w=b.hrefCallback({items:n})),t.when(a.getFileContentType(n),function(e){_&&c(e,_,n.Location,C),v.href=w,g&&"function"==typeof g.updateFileNode&&g.updateFileNode(n,v,d(e))})}return v.addEventListener("click",function(){f=n}.bind(this),!1),v}function p(e,t,n,i){this.explorer=t,this.commandService=n,this.contentTypeService=i,this.openWithCommands=null,this.actionScopeId=e.actionScopeId,this._init(e),this.target="_self"}var f,g=60,m=new s("#{,resource,params*}");return p.prototype=new n.SelectionRenderer,p.prototype.wrapperCallback=function(e){e.setAttribute("role","tree")},p.prototype.tableCallback=function(t){t.setAttribute("aria-label",e.Navigator),t.setAttribute("role","presentation")},p.prototype.rowCallback=function(e){e.setAttribute("role","treeitem")},p.prototype.emptyCallback=function(t){var n=document.createElement("tr"),i=document.createElement("td");i.colSpan=this.oneColumn?1:3;var r=document.createElement("div");r.classList.add("noFile"),r.textContent=e.NoFile;var o=document.createElement("span");o.appendChild(document.createTextNode(e.File)),l.processDOMNodes(r,[o]),i.appendChild(r),n.appendChild(i),t.appendChild(n)},p.prototype.getDisplayTime=function(e){return new Date(e).toLocaleString()},p.prototype.getCommitRenderer=function(e,t){return new a.CommitInfoRenderer({parent:e,commitInfo:t})},p.prototype.getCellHeaderElement=function(e){if(this.oneColumn&&0!==e)return null;switch(e){case 0:case 1:case 2:var t=document.createElement("th");t.style.height="8px"}},p.prototype.setTarget=function(e){this.target=e},p.prototype.getFolderImage=function(){if(!this.showFolderImage)return null;var e=document.createElement("span");return e.className="core-sprite-folder modelDecorationSprite",e},p.prototype.createFolderNode=function(e){var t;if(this.showFolderLinks){t=u(this.folderLink||"",e,this.commandService,this.contentTypeService);var n=this.getFolderImage(e);n&&t.insertBefore(n,t.firstChild)}else t=document.createElement("span"),t.textContent=e.Name;return t},p.prototype.updateFileNode=function(){},p.prototype.showFolderLinks=!0,p.prototype.getCellElement=function(e,t,n){var o=t.LastCommit?2:1,s=t.LastCommit?3:2,a=t.LastCommit?1:-1;switch(e){case 0:var l=document.createElement("td"),d=document.createElement("span");d.id=n.id+"MainCol",d.setAttribute("role","presentation"),l.appendChild(d),l.setAttribute("role","presentation"),d.className="mainNavColumn";var c;return t.Directory?(this.getExpandImage(n,d),c=this.createFolderNode(t),d.appendChild(c),this.explorer._makeDropTarget(t,c),this.explorer._makeDropTarget(t,n)):(this.openWithCommands||(this.openWithCommands=r.getOpenWithCommands(this.commandService)),c=u("",t,this.commandService,this.contentTypeService,this.openWithCommands,{target:this.target},null,null,this),d.appendChild(c)),c&&(c.id=n.id+"NameLink",1===c.nodeType&&(i.addNavGrid(this.explorer.getNavDict(),t,c),c.setAttribute("role","link"),c.setAttribute("tabindex","-1"))),this.actionScopeId&&this.commandService.renderCommands(this.actionScopeId,d,t,this.explorer,"tool",null,!0),l;case o:if(this.oneColumn)return null;var h=document.createElement("td");return t.LocalTimeStamp&&(h.textContent=this.getDisplayTime(t.LocalTimeStamp)),h;case s:if(this.oneColumn)return null;var p=document.createElement("td");if(!t.Directory&&"number"==typeof t.Length){var f=parseInt(t.Length,10),m=f/1024;p.textContent=Math.ceil(m).toLocaleString()+" KB"}return p.style.textAlign="right",p;case a:if(this.oneColumn||!t.LastCommit)return null;var v=document.createElement("td");return this.getCommitRenderer(v,t.LastCommit).renderSimple(g),v}},p.prototype.constructor=p,{NavigatorRenderer:p,isImage:d,getClickedItem:h,createLink:u}}),define("orion/fileDownloader",["i18n!orion/navigate/nls/messages","orion/i18nUtil","orion/URL-shim"],function(e,t){function n(){return"undefined"!=typeof s.download||"undefined"!=typeof window.navigator&&window.navigator.msSaveBlob}function i(t){var n={Severity:"Error",Message:e.noResponse};if(0===t.status)return n;if(t.responseText){var i=t.responseText;try{var r=JSON.parse(i);n.Severity=r.Severity||n.Severity,n.Message=r.Message||n.Message}catch(o){n.Message=i}}else try{n.Message=JSON.stringify(t)}catch(o){}return n}function r(e,t){return e?(t.Severity||(t=i(t)),void e.setProgressResult(t)):void window.console.log(t)}function o(e,t,n){this.fileClinet=e,this.statusService=t,this.progressService=n}var s=document.createElementNS("http://www.w3.org/1999/xhtml","a");return o.prototype={_isSupported:function(t){return t||n()?!0:(this.statusService&&this.statusService.setProgressResult&&this.statusService.setProgressResult({Message:e["Download not supported"],Severity:"Error"}),!1)},downloadFromLocation:function(n,i,o){if(this._isSupported(o)){var s=this.progressService,a=function(e,n,i){return s?s.progress(e,t.formatMessage(n,i)):e},l=function(e){var t=null;this.serviceRegistry?t=this.serviceRegistry.getService("orion.page.message"):this.statusService&&(t=this.statusService),r(t,e),this._setNoInput()}.bind(this);this.statusService&&this.statusService.setProgressResult&&this.statusService.setProgressResult({Message:e["Downloading..."]}),a(this.fileClinet.readBlob(n.Location),e["Downloading..."],n.Location).then(function(e){this.statusService&&this.statusService.setProgressMessage&&this.statusService.setProgressMessage(""),this.downloadFromBlob(e,n.Name,i,o)}.bind(this),l)}},downloadFromBlob:function(e,t,n,i,r){if(this._isSupported(i)){var o=n&&n.id?n.id:"application/octet-stream",s=new Blob([e],{type:o}),a=r?document.createElementNS("http://www.w3.org/1999/xhtml","a"):document.createElement("a");if("undefined"!=typeof a.download){var l=URL.createObjectURL(s);if(a.href=l,a.download=t,r)return a;var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(d)}else if("undefined"!=typeof window.navigator&&window.navigator.msSaveOrOpenBlob){if(r)return a.href="javascript:void(0)",a.addEventListener("click",function(){window.navigator.msSaveBlob(s,t)}),a;window.navigator.msSaveBlob(s,t)}}}},{FileDownloader:o,downloadSupported:n}}),define("orion/compare/compareUtils",["orion/URITemplate"],function(e){var t=t||{};return t.compareUtils=t.compareUtils||{},t.compareUtils.lookUpMapper=function(e,t,n){for(var i=0,r=0;r<e.length;r++){var o=e[r][t];if(0===o&&(o=1),n>=i&&i+o>n)return{mapperIndex:r,startFrom:i};if(r===e.length-1)break;i+=e[r][t]}return{mapperIndex:e.length-1,startFrom:i}},t.compareUtils.lookUpLineIndex=function(e,t,n){if(0===n)return 0;for(var i=0,r=0;n>r;r++)i+=e[r][t];return i},t.compareUtils.updateMapper=function(e,n,i,r,o){if(r!==o&&(r>0||o>0)){var s=t.compareUtils.lookUpMapper(e,n,i);if(s.mapperIndex<0)return;if(r>0)for(var a=r,l=i-s.startFrom,d=s.mapperIndex;d<e.length;d++){var c=e[d][n]-l;if(c>=a){e[d][n]-=a;break}e[d][n]-=c,a-=c,l=0}o>0&&(e[s.mapperIndex][n]+=o)}},t.compareUtils.overlapMapper=function(e,t,n,i,r){var o=n+e[t]-1;return n>o&&(o=n),i>r&&(r=i),i>o||n>r?!1:!0},t.compareUtils.findFirstDiff=function(e,n,i,r){for(var o=0,s=null,a=0;a<e.length&&!(o>r)&&(!t.compareUtils.overlapMapper(e[a],n,o,i,r)||(s={mapperIndex:a,startFrom:o},0===e[a][2]));a++)o+=e[a][n];return s},t.compareUtils.matchMapper=function(e,n,i,r){if(0===e.length)return i;var o=i+Math.round((r-i)/3),s=t.compareUtils.findFirstDiff(e,n,i,r),a=0===e[s.mapperIndex][n]?s.startFrom:s.startFrom+e[s.mapperIndex][n]-1,l=t.compareUtils.lookUpLineIndex(e,1-n,s.mapperIndex),d=s.startFrom-i;if(0===e[s.mapperIndex][2])return l-d;if(o>=s.startFrom&&a>=o)return l-Math.round((r-i)/3);if(o<s.startFrom)return l-d;var c=0===e[s.mapperIndex][1-n]?l:l+e[s.mapperIndex][1-n]-1;return c-(a-i)},t.compareUtils.getMapperLineCount=function(e){for(var t=0,n=0;n<e.length;n++)t+=Math.max(e[n][0],e[n][1]);return t},t.compareUtils.getAnnotationIndex=function(e,t){for(var n=0;n<e.length;n++)if(e[n][0]===t)return n;return-1},t.compareUtils.getAnnotationMapperIndex=function(e,t){return e[t][1]},t.compareUtils.getAnnotationIndexByMapper=function(e,t){for(var n=0;n<e.length;n++)if(e[n][1]===t)return{current:n,prev:n-1,next:n+1};return{current:-1,prev:-1,next:-1}},t.compareUtils.isMapperConflict=function(e,t){return 0>t?!1:e[t][3]?1===e[t][3]:!1},t.compareUtils.mergeDiffBlocks=function(e,t,n,i,r,o){for(var s=0;s<t.length;s++){var a=t[s][0],l=t[s][1],d=n[l];if(d[0]>0){for(var c="",h=0;h<d[0];h++){var u=i[d[2]-1+h];c=c+u.substring(r)+o}var p=e.getLineCount();if(a>=p){var f=e.getLineEnd(p-1),g=e.getLineEnd(p-1,!0);f===g?(e.setText(o,f,f),a=p):a=p-1}var m=e.getLineStart(a);e.setText(c,m,m)}}},t.compareUtils.generateCompareHref=function(t,n){var i=require.toUrl("compare/compare.html");n.conflict||(n.conflict=void 0),n.readonly||(n.readonly=void 0);var r=new e(i+"#{,resource,params*}").expand({resource:t,params:n});return r},t.compareUtils.generateCompareTreeHref=function(t,n){var i=require.toUrl("compare-tree/compare-tree.html"),r=new e(i+"#{,resource,params*}").expand({resource:t,params:n});return r},t.compareUtils}),define("orion/webui/dialogs/DirectoryPrompterDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/dialog","orion/fileUtils","orion/selection","orion/explorers/navigationUtils","orion/explorers/explorer","orion/explorers/explorer-table"],function(e,t,n,i,r,o,s,a){function l(e,t){this.explorer=t,this._init(e)}function d(e){this._init(e)}return l.prototype=new s.SelectionRenderer,l.prototype.constructor=l,l.prototype.getLabelColumnIndex=function(){return 0},l.prototype.getCellElement=function(e,t,n){var i=document.createElement("td");n.appendChild(i);var r=document.createElement("span");r.id=n.id+"navSpan",i.appendChild(r),r.className="mainNavColumn singleNavColumn",this.getExpandImage(n,r),r.appendChild(document.createTextNode(t.Name))},d.prototype=new n.Dialog,d.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="directoryTree" class="explorerTreeClass" style="width:25em; min-height: 25em; max-height:30em; height: auto; overflow-y: auto;"></div>',d.prototype._init=function(t){this.title=t.title||e["Choose a Folder"],this.modal=!0,this.buttons=[{text:e.OK,isDefault:!0,callback:this.done.bind(this)}],this.customFocus=!0,this._fileClient=t.fileClient,this._serviceRegistry=t.serviceRegistry,this._message=t.message||"",this._func=t.func,this._initialize()},d.prototype._bindToDom=function(){this.loadFolderList("/"),this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none",this.$directoryTree.focus()},d.prototype.loadFolderList=function(e){e=i.makeRelative(e),this.selection=new r.Selection(this._serviceRegistry,"orion.directoryPrompter.selection"),this.explorer=new a.FileExplorer({treeRoot:{children:[]},selection:this.selection,serviceRegistry:this._serviceRegistry,fileClient:this._fileClient,parentId:"directoryTree",excludeFiles:!0,rendererFactory:function(e){return new l({checkbox:!1,singleSelection:!0,treeTableClass:"directoryPrompter"},e)}}),this.explorer.loadResourceList(e,!0,null)},d.prototype.done=function(){this.selection.getSelection(function(e){this.hide(),this._func(e)}.bind(this))},d.prototype.constructor=d,{DirectoryPrompterDialog:d}}),define("orion/webui/popupdialog",["i18n!orion/widgets/nls/messages","require","orion/webui/littlelib","orion/webui/tooltip"],function(e,t,n,i){function r(){}return r.prototype={_initialize:function(t,r,o,s,a){this._tooltip=new i.Tooltip({node:t,hideDelay:a||0,afterShowing:this._afterShowingFunction(r).bind(this),afterHiding:o,trigger:s?s:"click"}),this.$parent=this._tooltip.contentContainer(),this.$parent.role="dialog";var l=document.createRange();l.selectNode(this.$parent);var d=l.createContextualFragment(this.TEMPLATE);this.messages&&n.processTextNodes(d,e),this.$parent.appendChild(d);var c=this._tooltip;this.$parent.addEventListener("keydown",function(e){e.keyCode===n.KEY.ESCAPE&&c.hide()},!1),this._bindElements(this.$parent),"function"==typeof this._bindToDom&&this._bindToDom(this.$parent)},_bindElements:function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];n.id&&(this["$"+n.id]=n),this._bindElements(n)}},_afterShowingFunction:function(e){return function(){if(e&&e.bind(this)(),!this.customFocus){var t=n.firstTabbable(this.$parent);t&&t.focus()}}},hide:function(){this._tooltip.hide()},show:function(){this._tooltip.show()}},r.prototype.constructor=r,{PopupDialog:r}}),define("orion/webui/dialogs/SFTPConnectionDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/popupdialog","orion/webui/dialog"],function(e,t,n,i){function r(t,n){this.messages=e,this._initialize(t),this._notify=n}function o(e){this._init(e)}if(!localStorage.getItem("orion.sftpConnections")){var s={identifier:"name",label:e.name,items:[]};localStorage.setItem("orion.sftpConnections",JSON.stringify(s))}return r.prototype=new n.PopupDialog,r.prototype.TEMPLATE='<div><label for="sftpHost">${Remote host:}</label><input id="sftpHost" /></div><div><label for="sftpPort">${Port:}</label><input id="sftpPort" /></div><div><label for="sftpPath">${Remote path:}</label><input id="sftpPath" /></div><div><label for="sftpUser">${User name:}</label><input id="sftpUser" /></div><div class="layoutBlock layoutRight"><button id="addSftpConnection" class="dropdownTrigger orionButton commandButton">${Add}</button></div>',r.prototype._bindToDom=function(){var e=this,t=function(){var e=this.$sftpUser.value+"@"+this.$sftpHost.value+":"+this.$sftpPort.value+this.$sftpPath.value;this._notify({name:e}),this.hide()};this.$addSftpConnection.addEventListener("click",t.bind(e),!1)},r.prototype.constructor=r,o.prototype=new i.Dialog,o.prototype.TEMPLATE='<div><div><label for="sftpPath">${Location:}</label></div><div><select id="sftpConnectionList" name="sftpConnectionList"></select><button id="newSftpConnection" style="margin-left: 16px;" class="dropdownTrigger orionButton commandButton">${New}<span class="dropdownArrowDown core-sprite-openarrow"></span></button></div><div><label for="sftpPassword">${Password:}</label></div><div><input id="sftpPassword" type="password" /></div><p>${If the same file exists in both the source and destination:}</p><input type="radio" name="overwriteOption" id="overwriteCancel" checked value="overwriteCancel" /><label for="overwriteCancel">${Cancel the transfer}</label><br /><input type="radio" name="overwriteOption" id="overwriteAll" value="overwriteAll" /><label for="overwriteAll">${Always overwrite destination}</label><br /><input type="radio" name="overwriteOption" id="overwriteOlder" value="overWriteOlder" /><label for="overwriteOlder">${Overwrite if source is newer}</label></div>',o.prototype._init=function(t){this.title="SFTP Transfer",this.messages=e,this.modal=!0,this.buttons=[{text:e["Start Transfer"],callback:this.done.bind(this)}],this.sftpConnectionStoreData=JSON.parse(localStorage.getItem("orion.sftpConnections")),this._func=t.func,this._initialize()},o.prototype._bindToDom=function(){this.$sftpConnectionList.style.minWidth="220px",this._popupDialog=new r(this.$newSftpConnection,this.onAddConnection.bind(this)),this._addChildDialog(this._popupDialog),this._populateSelect()},o.prototype._afterHiding=function(){this._popupDialog.hide()},o.prototype.done=function(){var e,t,n,i,r,o=this.$sftpConnectionList.value,s=o.split("@");if(2===s.length)i=s[0],r=s[1];else{if(3!==s.length)return void this.hide();i=s[0]+"@"+s[1],r=s[2]}var a=r.indexOf(":");0>=a&&(t=22);var l=r.indexOf("/");return 0>=l?void this.hide():(t?(e=r.substring(0,l),n=r.substring(l)):(e=r.substring(0,a),t=r.substring(a+1,l),n=r.substring(l)),this._func(e,t,n,i,this.$sftpPassword.value,this._computeOverwriteValue()),void this.hide())},o.prototype._computeOverwriteValue=function(){return this.$overwriteCancel.checked?"no-overwrite":this.$overwriteOlder.checked?"overwrite-older":""},o.prototype._populateSelect=function(){t.empty(this.$sftpConnectionList);for(var e=0;e<this.sftpConnectionStoreData.items.length;e++){var n=this.sftpConnectionStoreData.items[e].name,i=document.createElement("option");i.appendChild(document.createTextNode(n)),i.value=n,this.$sftpConnectionList.appendChild(i)}},o.prototype.onAddConnection=function(e){for(var t=!1,n=0;n<this.sftpConnectionStoreData.items.length;n++)if(this.sftpConnectionStoreData.items[n].name===e.name){t=!0;break}t||(this.sftpConnectionStoreData.items.unshift(e),localStorage.setItem("orion.sftpConnections",JSON.stringify(this.sftpConnectionStoreData)),this._populateSelect(),this.$sftpConnectionList.value=e.name)},o.prototype.constructor=o,{SFTPConnectionDialog:o}}),define("orion/form",[],function(){function e(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape).replace("%20","+")}return{encodeFormData:function(t){t=t||{};for(var n=Object.keys(t),i=[],r=0;r<n.length;r++){var o=n[r],s=t[o];i.push(e(o)+"="+e(s))}return i.join("&")},encodeSlug:function(e){return e.replace(/([^\u0020-\u007e]|%)+/g,encodeURIComponent)}}}),define("orion/fileCommands",["i18n!orion/navigate/nls/messages","require","orion/webui/littlelib","orion/i18nUtil","orion/uiUtils","orion/fileUtils","orion/commands","orion/fileDownloader","orion/commandRegistry","orion/extensionCommands","orion/contentTypes","orion/compare/compareUtils","orion/Deferred","orion/webui/dialogs/DirectoryPrompterDialog","orion/webui/dialogs/SFTPConnectionDialog","orion/EventTarget","orion/form"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m){function v(e){var t=k;t&&"function"==typeof t.dispatchEvent&&t.dispatchEvent(e)}function y(e){L?L.setProgressResult(e):window.console.log(e)}function _(e,t,i,o,s){var a,l,d=!0,c=!1,h=e.makeNewItemPlaceholder(t,i,!0);if(h?(a=h.refNode,d=!1,c=!0):a=n.node(i),a){var u=function(e){e&&s(e)};r.getUserText({id:i+"EditBox",refNode:a,hideRefNode:d,initialText:o,onComplete:u,onEditDestroy:h.destroyFunction,isInitialValid:!0,insertAsChild:c})}else l=window.prompt(o),l&&s(l)}function C(e){return e?(Array.isArray(e)&&(e=1===e.length?e[0]:{}),e):{}}function w(e,t,n,i,r,s){if(L=n,i){var a;a=o.isAtRoot(e.treeRoot.ChildrenLocation)?e.treeRoot:L.progress(t.loadWorkspace(e.treeRoot.Location),"Loading workspace"),u.when(a,function(e){var o=t.createProject(e.ChildrenLocation,i);s&&(o=n.showWhile(o,s)),o.then(function(e){n.progress(t.read(e.ContentLocation,!0),"Reading metadata of newly created project "+i).then(function(e){r&&r(e),v({type:"create",parent:a,newValue:e})},y)},y)},y)}}var b,x={},S=!1,L=null,E={Location:null};x.setExplorer=function(e){b=e};var k;x.getModelEventDispatcher=function(){return k||(k=new g),k},x.uploadFile=function(e,t,n,i,r,o,s){var a=new XMLHttpRequest;return o&&(o.progress&&a.upload.addEventListener("progress",o.progress,!1),o.load&&a.upload.addEventListener("load",o.load,!1),o.error&&a.upload.addEventListener("error",o.error,!1),o.abort&&a.upload.addEventListener("abort",o.abort,!1),o.loadend&&a.addEventListener("loadend",o.loadend,!1)),a.open("post",r?e.ImportLocation+(e.ImportLocation.indexOf("?")>0?"&force=true":"?force=true"):e.ImportLocation,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Slug",m.encodeSlug(t.name)),i||a.setRequestHeader("X-Xfer-Options","raw"),a.setRequestHeader("Content-Type","application/octet-stream"),a.onreadystatechange=function(){if(4===a.readyState){if(400===a.status){var r={};try{r=JSON.parse(a.responseText)}catch(l){}if(r.JsonData&&r.JsonData.ExistingFiles){var d=n&&n.serviceRegistry?n.serviceRegistry.getService("orion.page.dialog").confirm:confirm;if(d(r.Message+"\nWould you like to retry the import with force overwriting?"))return void x.uploadFile(e,t,n,i,!0,o)}}s||v({type:"create",parent:e,newValue:null})}}.bind(this),a.send(t),a},x.updateNavTools=function(e,t,i,r,o,s,a){function l(e,i){var r=Array.isArray(o)?o:[o];r.forEach(function(r){var o=n.node(r);if(o){var s=t._contributionsByScopeId[r];e=e||s&&s.localSelectionService||t.getSelectionService(),s&&e&&e.getSelections(function(e){t.destroy(o);var n=!e||Array.isArray(e)&&!e.length;a&&n?t.renderCommands(o.id,o,i,b,"button"):t.renderCommands(o.id,o,null,b,"button")})}})}if(b=i,r){var d=n.node(r);if(!d)throw new Error("could not find toolbar "+r);t.destroy(d),E.Location&&s.Location!==E.Location&&(t.closeParameterCollector(),E.Location=s.Location),t.renderCommands(d.id,d,s,b,"button")}if(o&&l(null,b?b.treeRoot:null),!S){S=!0;var c=e.getService("orion.page.selection");c.addEventListener("selectionChanged",function(){l(c,b?b.treeRoot:null)})}};var T=[],A=!1;return x.getCutBuffer=function(){return A?T:null},x.isEqualToOrChildOf=function(e,t){return e.Location===t.Location?!0:-1!==e.Location.indexOf(t.Location)?e.parent===t.parent?!1:!0:!1},x.createFileCommands=function(t,d,g){function m(e,t){return-1!==e.indexOf(t)}function S(e){e=o.makeRelative(e);var t=e.split("#"),n=t[t.length-1],i=n.indexOf("/?");return i>0&&(n=n.substring(0,i+1)),n}function E(e){return b&&b.isCommandsVisible()?(e=C(e),e.Location&&o.isAtRoot(e.Location)):!1}function k(n,r,o){n=Array.isArray(n)?n:[n];for(var s=function(e){Array.isArray(e)||(e=[e]);var t=[],n=[],i=this;e.forEach(function(r){var s=o?g.copyFile:g.moveFile;t.push(s.apply(g,[r.Location,i.path,r.Name]).then(function(t){n.push({oldValue:r,newValue:t,parent:i.item}),O({type:o?"copy":"move",oldValue:r,newValue:t,parent:i.item,count:e.length})},y))}),u.all(t).then(function(){O({type:o?"copyMultiple":"moveMultiple",items:n})})},a=function(n){var r=new p.DirectoryPrompterDialog({title:e["Choose a Folder"],serviceRegistry:t,fileClient:g,func:function(t){if(t&&t.Location){Array.isArray(n)||(n=[n]);var r=[],s=[];n.forEach(function(a){var l=t.Location,d=a.Name||null,c=o?g.copyFile:g.moveFile,h=i.formatMessage(o?e["Copying ${0}"]:e["Moving ${0}"],a.Location);if(o&&a.parent&&a.parent.Location===l&&(d=window.prompt(i.formatMessage(e["Enter a new name for '${0}'"],a.Name),i.formatMessage(e["Copy of ${0}"],a.Name)),d||(l=null)),l){var u=c.apply(g,[a.Location,t.Location,d]);r.push(L.showWhile(u,h).then(function(e){s.push({oldValue:a,newValue:e,parent:t}),O({type:o?"copy":"move",oldValue:a,newValue:e,parent:t,count:n.length})},y))}}),u.all(r).then(function(){O({type:o?"copyMultiple":"moveMultiple",items:s})})}}});r.show()},l=[],d=0;d<n.length;d++)n[d].parent&&n[d].parent.Location&&(n[d].parent.stripped=n[d].parent.stripped||S(n[d].parent.Location),m(l,n[d].parent.stripped)||l.push(n[d].parent.stripped)),n[d].Directory&&!o&&(n[d].stripped=n[d].stripped||S(n[d].Location),l.push(n[d].stripped));var c=[],h=[],f=b.treeRoot.Children||(b.treeRoot.Workspace?b.treeRoot.Workspace.Children:{});for(d=0;d<f.length;d++){var v=f[d];v.stripped=v.stripped||(v.Directory?S(v.Location):null),v.stripped&&!m(l,v.stripped)&&h.push(v)}for(h.sort(function(e,t){return e.stripped<t.stripped?-1:e.stripped>t.stripped?1:0}),d=0;d<h.length;d++){for(var _=h[d],C=_.Name,w=_.stripped.split("/").length+1,x=0;w-2>x;x++)C="  "+C;c.push({name:C,path:_.stripped,item:_,callback:s})}return h.length>0&&c.push({}),c.push({name:e["Choose folder..."],callback:a}),c}function N(e){return e.parent?{item:e,parent:e.parent}:e.Parents&&e.Parents[0]?{item:e,parent:e.Parents[0]}:g.loadWorkspace(g.fileServiceRootURL(e.Location)).then(function(t){return u.when(t.Children||g.fetchChildren(t)).then(function(n){t.Children=n;var i=t.Children.some(function(t){return t.Location===e.Location?(e=t,!0):!1});return{item:e,parent:i?t:null}})})}function M(e){var t;return Array.isArray(e)||(e=[e]),e.some(function(e){var n;if(n=e.Directory?e:e.parent,t){if(t.Location!==n.Location)return t=null,!0}else t=n;return!1}),t&&o.isAtRoot(t.Location)?null:t}function I(e){return b&&b.isCommandsVisible()?M(e):!1}function D(t,n){var r=t.Location;u.when(N(t),function(o){t=o.item;var s=o.parent;s&&s.Projects&&s.Projects.some(function(e){return e.Id===t.Id?(r=e.Location,!0):!1});var a=s.Location||s.WorkspaceLocation,l=g.moveFile(r,a,n);L.showWhile(l,i.formatMessage(e["Renaming ${0}"],r)).then(function(e){t.parent||(t.parent=s),O({type:"move",oldValue:t,newValue:e,parent:s})},y)})}function R(t,n,i){var r=function(e){for(var t=0,i=n,r=e.filter(function(e){return 0===e.Name.indexOf(n)}).map(function(e){return e.Name});-1!==r.indexOf(i);)t++,i=n.concat(" (").concat(t).concat(")");return i};if(t.children){var o=r(t.children);i(o)}else{var s=t.ChildrenLocation;L.progress(g.fetchChildren(s),e["Fetching children of "]+t.Name).then(function(e){var t=r(e);i(t)},y)}}function P(t,n,r){var o=function(t){if(t){var o=n.Location,s=r?"createFolder":"createFile",a=g[s](o,t);L.showWhile(a,i.formatMessage(e["Creating ${0}"],t)).then(function(e){O({type:"create",parent:n,newValue:e})},y)}};R(n,t,function(e){_(b,n,b.getRow(n),e,function(e){o(e)})})}L=t.getService("orion.page.progress");var O=v.bind(null),B=function(e){if(!b||!b.isCommandsVisible())return!1;var t=Array.isArray(e)?e:[e];if(0===t.length)return!1;for(var n=0;n<t.length;n++)if(e=t[n],!e.Location||e.Projects)return!1;return!0},F=function(e,t){var i=b.getNameNode(e);if(!i){if(!t)return;i=t.domParent||t.domNode}var o=i.id+"EditBox";n.node(o)||r.getUserText({id:o,refNode:i,hideRefNode:!0,initialText:e.Name,onComplete:D.bind(null,e),selectTo:e.Directory?"":"."})},V=new s.Command({name:e.Rename,tooltip:e["Rename the selected files or folders"],imageClass:"core-sprite-rename",id:"eclipse.renameResource",visibleWhen:function(e){return b&&b.isCommandsVisible()?Array.isArray(e)?1===e.length&&e[0].Name:e.Location&&!e.Projects:!1},parameters:new l.ParametersDescription(null,{},function(t){var n=Array.isArray(t.items)?t.items:[t.items],i=b.treeRoot;return n.some(function(e){return e===i})?[new l.CommandParameter("name","text",e["Name:"],i.Name)]:null}),callback:function(e){var t,n=C(e.items);e.parameters.hasParameters()&&null!==(t=e.parameters.valueFor("name"))?D(n,t):F(n,e)}});d.addCommand(V);var j=new c.ContentTypeRegistry(t),U=new s.Command({name:e["Compare with each other"],tooltip:e["Compare the selected 2 files with each other"],id:"eclipse.compareWithEachOther",visibleWhen:function(e){if(!b||!b.isCommandsVisible())return!1;if(Array.isArray(e))if(2!==e.length||e[0].Directory||e[1].Directory){if(2===e.length&&e[0].Directory&&e[1].Directory)return!0}else{var t=j.getFilenameContentType(e[0].Name),n=j.getFilenameContentType(e[1].Name);if(t&&("text/plain"===t["extends"]||"text/plain"===t.id)&&n&&("text/plain"===n["extends"]||"text/plain"===n.id))return!0}return!1},hrefCallback:function(e){return e.items[0].Directory&&e.items[1].Directory?h.generateCompareTreeHref(e.items[0].Location,{compareTo:e.items[1].Location,readonly:!0}):h.generateCompareHref(e.items[0].Location,{compareTo:e.items[1].Location,readonly:!1,readonlyRight:!1})}});d.addCommand(U);var H=new s.Command({name:e["Compare with..."],tooltip:e["Compare the selected folder with a specified folder"],id:"eclipse.compareWith",visibleWhen:function(e){return b&&b.isCommandsVisible()&&Array.isArray(e)&&1===e.length&&e[0].Directory?!0:!1},callback:function(n){var i=new p.DirectoryPrompterDialog({title:e["Choose a Folder"],serviceRegistry:t,fileClient:g,func:function(e){if(e&&e.Location){var t=h.generateCompareTreeHref(n.items[0].Location,{compareTo:e.Location,readonly:!0});window.open(t)}}});i.show()}});d.addCommand(H);var W=new s.Command({name:e.Download,tooltip:e.Download_tooltips,id:"eclipse.downloadSingleFile",visibleWhen:function(e){return b&&b.isCommandsVisible()&&Array.isArray(e)&&1===e.length&&!e[0].Directory?!0:!1},callback:function(e){var n=t.getService("orion.page.message"),i=new a.FileDownloader(g,n,L),r=Array.isArray(e.items)?e.items:[e.items],o=j.getFilenameContentType(r[0].Name);i.downloadFromLocation(r[0],o)}});d.addCommand(W);var $=new s.Command({name:e.Delete,imageClass:"core-sprite-delete",id:"eclipse.deleteFile",visibleWhen:B,callback:function(n){var r=Array.isArray(n.items)?n.items:[n.items],o=1===r.length?i.formatMessage(e["Are you sure you want to delete '${0}'?"],r[0].Name):i.formatMessage(e["Are you sure you want to delete these ${0} items?"],r.length);t.getService("orion.page.dialog").confirm(o,function(t){if(t){var n=[],o=r.map(function(t){var o=t.Location;return u.when(N(t),function(s){t=s.item;var a=s.parent;if(a&&a.Projects&&(o=null,a.Projects.some(function(e){return e.Id===t.Id?(o=e.Location,!0):!1})),"ProjectRoot"===t.type&&a.ProjectLocation&&(o=a.ProjectLocation),!o)return(new u).resolve();var l=g.deleteFile(o);return L.showWhile(l,i.formatMessage(e["Deleting ${0}"],o)).then(function(){n.push({oldValue:t,newValue:null,parent:a}),T=T.filter(function(e){return!x.isEqualToOrChildOf(e,t)}),O({type:"delete",oldValue:t,newValue:null,parent:a,count:r.length})},y)})});u.all(o).then(function(){O({type:"deleteMultiple",items:n})},y)}})}});d.addCommand($);var K=new s.Command({name:e["Export as zip"],tooltip:e["Create a zip file of the folder contents and download it"],imageClass:"core-sprite-exportzip",id:"eclipse.downloadFile",visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=C(e),e.ExportLocation&&e.Directory):!1},hrefCallback:function(e){return C(e.items).ExportLocation}});d.addCommand(K);var G=function(e){var t=M(e);return t&&t.Location||(t=b.treeRoot,t.Project&&(t=t.children[0])),t},z=new s.Command({name:e["New File"],tooltip:e["Create a new file"],imageClass:"core-sprite-new_file",id:"eclipse.newFile",callback:function(t){var n=G(t.items);P(e["New File"],n,!1)},visibleWhen:I});d.addCommand(z);var q=new s.Command({name:e["New Folder"],tooltip:e["Create a new folder"],imageClass:"core-sprite-new_folder",id:"eclipse.newFolder",callback:function(t){var n=G(t.items);P(e["New Folder"],n,!0)},visibleWhen:function(e){return I(e)&&!o.isAtRoot(e.Location)}});d.addCommand(q);var Y=new l.ParametersDescription([new l.CommandParameter("url","url",e["File URL:"],"URL"),new l.CommandParameter("unzip","boolean",e["Unzip *.zip files:"],!0)]),X=new s.Command({name:e["Import from HTTP..."],tooltip:e["Import a file from a URL and optionally unzip it"],id:"orion.importZipURL",parameters:Y,callback:function(t){var n=M(t.items),r=t.parameters&&t.parameters.valueFor("url");if(n&&r){var o=n.ImportLocation+(-1===n.ImportLocation.indexOf("?")?"?":"&")+"source="+r,s=t.parameters&&t.parameters.valueFor("unzip")&&r.indexOf(".zip")===r.length-4,a=s?"":"raw",l=g.remoteImport(o,{OptionHeader:a});L.showWhile(l,i.formatMessage(e["Importing from ${0}"],r)).then(function(){O({type:"import",target:n})})}},visibleWhen:I});d.addCommand(X);var J=new s.Command({name:e["New Folder"],imageClass:"core-sprite-new_folder",tooltip:e["Create an empty folder"],description:e["Create an empty folder on the Orion server.  You can import, upload, or create content in the editor."],id:"orion.new.project",callback:function(t){var n;if(M(t.items))q.callback(t);else{n=C(t.items);var i=e["New Folder"];R(n,i,function(e){_(b,n,b.getRow(n),e,function(e){w(b,g,L,e)})})}},visibleWhen:E});d.addCommand(J);var Z=new s.Command({name:e["Link to Server"],tooltip:e["Link to existing content on the server"],description:e["Create a folder that links to an existing folder on the server."],imageClass:"core-sprite-link",id:"orion.new.linkProject",parameters:new l.ParametersDescription([new l.CommandParameter("name","text",e["Name:"],e["New Folder"]),new l.CommandParameter("url","url",e["Server path:"],"")]),callback:function(t){var n=function(t,n){if(t&&n){var r=g.createProject(b.treeRoot.ChildrenLocation,t,n,!0);
L.showWhile(r,i.formatMessage(e["Linking to ${0}"],n)).then(function(e){v({type:"create",parent:b.treeRoot,newValue:e})},y)}};t.parameters&&t.parameters.valueFor("name")&&t.parameters.valueFor("url")?n(t.parameters.valueFor("name"),t.parameters.valueFor("url")):y(e["The name and server location were not specified."])},visibleWhen:E});d.addCommand(Z);var Q=new s.Command({name:e["Go Up"],tooltip:e["Move up to the parent folder"],imageClass:"core-sprite-go-up",id:"eclipse.upFolder",callback:function(){"function"==typeof b.scopeUp&&b.scopeUp()},visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=b.treeRoot,e.Parents||"Project"===e.type):!1}});d.addCommand(Q);var et=new s.Command({name:e["Go Into"],tooltip:e["Move into the selected folder"],imageClass:"core-sprite-go-down",id:"eclipse.downFolder",callback:function(e){"function"==typeof b.scopeDown&&b.scopeDown(e.items[0])},visibleWhen:function(e){return b&&b.isCommandsVisible()?"function"!=typeof b.scopeDown?!1:(e=C(e),e.Directory&&e.Location!==b.treeRoot.Location):!1}});d.addCommand(et);var tt=new s.Command({name:e["File or zip archive"],tooltip:e["Import a file or zip archive from your local file system"],imageClass:"core-sprite-importzip",id:"orion.import",callback:function(e){var t=M(e.items),i=n.node("fileSelectorInput"),r=i.cloneNode(),o=function(){if(i.files&&i.files.length>0)for(var e=0;e<i.files.length;e++)b._uploadFile(t,i.files.item(e),!0);i.removeEventListener("change",o)};i.addEventListener("change",o),i.click(),i.parentNode.replaceChild(r,i)},visibleWhen:I});d.addCommand(tt);var nt=new s.Command({name:e["SFTP from..."],tooltip:e["Copy files and folders from a specified SFTP connection"],imageClass:"core-sprite-transferin",id:"orion.importSFTP",callback:function(t){var n=M(t.items),r=new f.SFTPConnectionDialog({func:function(t,r,o,s,a,l){var d=l?"sftp,"+l:"sftp",c={OptionHeader:d,Host:t,Port:r,Path:o,UserName:s,Passphrase:a},h=g.remoteImport(n.ImportLocation,c);L.showWhile(h,i.formatMessage(e["Importing from ${0}"],t)).then(function(e){O({type:"import",target:n}),y(e)},y)}});r.show()},visibleWhen:I});d.addCommand(nt);var it=new s.Command({name:e["SFTP to..."],tooltip:e["Copy files and folders to a specified SFTP location"],imageClass:"core-sprite-transferout",id:"eclipse.exportSFTPCommand",callback:function(t){var n=C(t.items),r=new f.SFTPConnectionDialog({func:function(t,r,o,s,a,l){var d=l?"sftp,"+l:"sftp",c={OptionHeader:d,Host:t,Port:r,Path:o,UserName:s,Passphrase:a},h=g.remoteExport(n.ExportLocation,c);L.showWhile(h,i.formatMessage(e.Exporting,t)).then(y,y)}});r.show()},visibleWhen:function(e){return b&&b.isCommandsVisible()?(e=C(e),e.ExportLocation&&e.Directory):!1}});d.addCommand(it);var rt=new s.Command({name:e["Copy to"],tooltip:"Copy files and folders to a specified location",id:"eclipse.copyFile",choiceCallback:function(e,t){return k(e,t,!0)},visibleWhen:B});d.addCommand(rt);var ot=new s.Command({name:e["Move to"],tooltip:e["Move files and folders to a new location"],id:"eclipse.moveFile",choiceCallback:function(e,t){return k(e,t,!1)},visibleWhen:B});d.addCommand(ot);var st=function(e){var t=b.getNavHandler();A&&T.forEach(function(e){t.enableItem(e)}),A=!1,T=e.items},at=new s.Command({name:e.Cut,id:"eclipse.cut",callback:function(e){var t=b.getNavHandler();st(e),T.length&&(A=!0,T.forEach(function(e){t.disableItem(e)}))},visibleWhen:B});d.addCommand(at);var lt=new s.Command({name:e.Copy,id:"eclipse.copySelections",callback:st,visibleWhen:B});d.addCommand(lt);var dt=function(e){return b&&b.isCommandsVisible()?I(e):!1},ct=new s.Command({name:e.Paste,id:"eclipse.pasteSelections",visibleWhen:dt,callback:function(t){var n=M(t.items);if(T.length>0&&n){if(o.isAtRoot(n.Location))return void y(e["Cannot paste into the root"]);var r=A?g.moveFile:g.copyFile,s=[],a=[];T.forEach(function(t){var o=t.Location,l=t.Name||null;if(o){var d=n.Location||n.ContentLocation,c=!1;if(t.parent&&t.parent.Location===d)c=!0;else{var h=n.Children||n.children;h&&(c=h.some(function(e){return e.Name===t.Name}))}if(c&&(l=window.prompt(i.formatMessage(e["Enter a new name for '${0}'"],t.Name),i.formatMessage(e["Copy of ${0}"],t.Name)),l||(o=null)),o){var u=r.apply(g,[o,d,l]),p=A?"Moving ${0}":"Pasting ${0}",f=A?"move":"copy";a.push(L.showWhile(u,i.formatMessage(e[p],o)).then(function(e){s.push({oldValue:t,newValue:e,parent:n}),O({type:f,oldValue:t,newValue:e,parent:n,count:T.length})},y))}}}),u.all(a).then(function(){if(O({type:A?"moveMultiple":"copyMultiple",items:s}),A){var e=b.getNavHandler();T.forEach(function(t){e.enableItem(t)}),T=[],A=!1}})}}});return d.addCommand(ct),(new u).resolve()},x.createNewContentCommand=function(t,n,i,r,a,d,c){var h=i?[]:[new l.CommandParameter("folderName","text",e["Folder name:"],n),new l.CommandParameter("url","url",e["Extracted from:"],r),new l.CommandParameter("unzip","boolean",e["Unzip *.zip files:"],!0)],u=null;h.length>0&&(u=new l.ParametersDescription(h));var p=new s.Command({name:n,parameters:u,id:t,callback:function(e){if(i)window.open(i);else if(e.parameters&&e.parameters.valueFor("folderName")){var t=e.parameters.valueFor("folderName");w(a,d,c,t,function(t){e.parameters.clientCollect=!0,e.commandRegistry.runCommand("orion.importZipURL",t,a,e.parameters)})}else _(a,e.items,e.domNode.id,n,function(t){w(a,d,c,t,function(t){e.commandRegistry.runCommand("orion.importZipURL",t,a,e.parameters)})})},visibleWhen:function(e){return a&&a.isCommandsVisible()?(e=C(e),e.Location&&o.isAtRoot(e.Location)):!1}});return p},x}),define("text!orion/webui/dialogs/promptdialog.html",[],function(){return'<div>\r\n	<div class="promptDialogMessage" id="promptDialogMessage">${PromptMessage}</div>\r\n	<input type="text" id="promptDialogInput" class="promptDialogInput" />\r\n</div>'}),define("orion/webui/dialogs/PromptDialog",["i18n!orion/widgets/nls/messages","orion/webui/littlelib","orion/webui/dialog","text!orion/webui/dialogs/promptdialog.html","orion/EventTarget"],function(e,t,n,i,r){function o(e){r.attach(this),this._init(e)}return o.prototype=Object.create(n.Dialog.prototype),o.prototype.constructor=o,o.prototype.TEMPLATE=i,o.prototype._init=function(t){this.title=t.title,t.promptMessage&&(this.messages={PromptMessage:t.promptMessage}),this.modal=!0,this._boundOkPressed=this._okPressed.bind(this),this.buttons=[{id:"okButton",text:e.OK,callback:this._boundOkPressed},{id:"cancelButton",text:e.Cancel,callback:this._cancelPressed.bind(this)}],this._initialize(),t.promptMessage||(this.$promptDialogMessage.style.display="none")},o.prototype._bindToDom=function(){this.$promptDialogInput.addEventListener("keydown",function(e){e.keyCode===t.KEY.ENTER?(this._boundOkPressed(),t.stop(e)):e.keyCode===t.KEY.ESCAPE&&(this.$cancelButton.focus(),t.stop(e))}.bind(this),!1)},o.prototype._okPressed=function(){this.dispatchEvent({type:"ok",value:this.$promptDialogInput.value}),this.hide()},o.prototype._cancelPressed=function(){this.dispatchEvent({type:"cancel"}),this.hide()},{PromptDialog:o}}),define("orion/widgets/projects/ProjectOptionalParametersDialog",["orion/webui/littlelib","orion/webui/dialog"],function(e,t){function n(e){this._init(e)}return n.prototype=new t.Dialog,n.prototype.TEMPLATE='<div id="message" style="width: 25em; padding-bottom: 5px;"></div><div id="paramsArea"><table id="paramsTable"></table></div>',n.prototype._init=function(e){this.title=e.title,this._data=e.data,this._idPrefix="ParamInput_",this.modal=!0,this.buttons=[{text:"OK",isDefault:!0,callback:this.done.bind(this)}],this.customFocus=!0,this._func=e.func,this._initialize()},n.prototype._bindToDom=function(){this._message?this.$message.appendChild(document.createTextNode(this._message)):this.$message.style.display="none";var e=!0;if(this._data.parameters)for(var t in this._data.parameters.parameterTable){var n=this._data.parameters.parameterNamed(t),i=document.createElement("tr"),r=document.createElement("td"),o=document.createElement("label");o["for"]=t,o.appendChild(document.createTextNode(n.label)),r.appendChild(o),i.appendChild(r),r=document.createElement("td");var s;"textarea"===n.type?s=document.createElement("textarea"):(s=document.createElement("input"),s.type=n.type),s.value=this._data.parameters.valueFor(t),s.id=this._idPrefix+t,r.appendChild(s),i.appendChild(r),this.$paramsTable.appendChild(i),e&&(s.focus(),e=!1)}if(this._data.parameters._options.optionalParams)for(var a=0;a<this._data.parameters._options.optionalParams.length;a++){var n=this._data.parameters._options.optionalParams[a],i=document.createElement("tr"),r=document.createElement("td"),o=document.createElement("label");o["for"]=this._idPrefix+n.id,o.appendChild(document.createTextNode(n.name)),r.appendChild(o),i.appendChild(r),r=document.createElement("td");var s;"textarea"===n.type?s=document.createElement("textarea"):(s=document.createElement("input"),s.type=n.type),n.value&&(s.value=n.value),s.id=this._idPrefix+n.id,r.appendChild(s),i.appendChild(r),this.$paramsTable.appendChild(i)}},n.prototype.done=function(){if(this._data.parameters)for(var t in this._data.parameters.parameterTable)this._data.parameters.setValue(t,e.node(this._idPrefix+t).value);if(this._data.parameters._options.optionalParams)for(var n=0;n<this._data.parameters._options.optionalParams.length;n++){var i=this._data.parameters._options.optionalParams[n];i.value=e.node(this._idPrefix+i.id).value}this.hide(),e.empty(this.$paramsTable),this._func()},n.prototype.constructor=n,{ProjectOptionalParametersDialog:n}}),define("orion/editor/i18n",{load:function(e,t,n){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+e],function(e){n(e)}):t(["orion/editor/config"],function(e){n(e&&e.languages||{})})}}),define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toogle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",nothingReplaced:"Nothing replaced",notFound:"Not found"}),define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(e,t){var n={root:t};for(var i in e)e.hasOwnProperty(i)&&"undefined"==typeof n[i]&&(n[i]=e[i]);return n}),define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(e,t){function n(){}function i(e,t,n){this.start=e,this.end=t,this._projectionModel=n,this.html=this._expandedHTML,this.style=this._expandedStyle,this.expanded=!0}function r(t,i){var r=t.lastIndexOf("."),o=t.substring(r+1),s={title:e[o],style:{styleClass:"annotation "+o},html:"<div class='annotationHTML "+o+"'></div>",overviewStyle:{styleClass:"annotationOverview "+o}};i?s.lineStyle={styleClass:"annotationLine "+o}:s.rangeStyle={styleClass:"annotationRange "+o},n.registerType(t,s)}function o(){}function s(e,t,n,i,r){var o;for(void 0===i&&(i=-1),void 0===r&&(r=e.length);r-i>1;)if(o=Math.floor((r+i)/2),t<=e[o].start)r=o;else{if(n&&t<e[o].end){r=o;break}i=o}return r}function a(e){this._annotations=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)}},this.setTextModel(e)}function l(e,t){this._view=e,this._annotationModel=t;var n=this;this._listener={onDestroy:function(e){n._onDestroy(e)},onLineStyle:function(e){n._onLineStyle(e)},onChanged:function(e){n._onAnnotationModelChanged(e)}},e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("postLineStyle",this._listener.onLineStyle),t.addEventListener("Changed",this._listener.onChanged)}i.prototype={_expandedHTML:"<div class='annotationHTML expanded'></div>",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"<div class='annotationHTML collapsed'></div>",_collapsedStyle:{styleClass:"annotation collapsed"},_collapse:function(){return this.expanded?(this.expanded=!1,this.html=this._collapsedHTML,this.style=this._collapsedStyle,this._annotationModel&&this._annotationModel.modifyAnnotation(this),!0):!1},_expand:function(){return this.expanded?!1:(this.expanded=!0,this.html=this._expandedHTML,this.style=this._expandedStyle,this._annotationModel&&this._annotationModel.modifyAnnotation(this),!0)},_collapseImpl:function(e){if(this._collapse()){e&&this._forEachOverlaping(function(e){e.expanded||(e._expandImpl(!1),e._recollapse=!0)});var t=this._projectionModel,n=t.getBaseModel();this._projection={annotation:this,start:n.getLineStart(n.getLineAtOffset(this.start)+1),end:n.getLineEnd(n.getLineAtOffset(this.end),!0)},t.addProjection(this._projection)}},_expandImpl:function(e){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),e&&this._forEachOverlaping(function(e){e._recollapse&&(e._collapseImpl(!1),e._recollapse=!1)}))},_forEachOverlaping:function(e){if(this._annotationModel)for(var t=this._annotationModel.getAnnotations(this.start,this.end);t.hasNext();){var i=t.next();i!==this&&i.type===n.ANNOTATION_FOLDING&&e.call(this,i)}},collapse:function(){this._recollapse=!1,this._collapseImpl(!0)},expand:function(){this._recollapse=!1,this._expandImpl(!0)}},n.ANNOTATION_ERROR="orion.annotation.error",n.ANNOTATION_WARNING="orion.annotation.warning",n.ANNOTATION_TASK="orion.annotation.task",n.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint",n.ANNOTATION_BOOKMARK="orion.annotation.bookmark",n.ANNOTATION_FOLDING="orion.annotation.folding",n.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket",n.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket",n.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine",n.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch",n.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch",n.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence",n.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence",n.ANNOTATION_SELECTED_LINKED_GROUP="orion.annotation.selectedLinkedGroup",n.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup",n.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup",n.ANNOTATION_BLAME="orion.annotation.blame",n.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var d={};return n.registerType=function(e,t){var n=t;return"function"!=typeof n&&(n=function(e,t,n){this.start=e,this.end=t,void 0!==n&&(this.title=n)},n.prototype=t),n.prototype.type=e,d[e]=n,e},n.createAnnotation=function(e,t,n,i){return new(this.getType(e))(t,n,i)},n.getType=function(e){return d[e]},r(n.ANNOTATION_ERROR),r(n.ANNOTATION_WARNING),r(n.ANNOTATION_TASK),r(n.ANNOTATION_BREAKPOINT),r(n.ANNOTATION_BOOKMARK),r(n.ANNOTATION_CURRENT_BRACKET),r(n.ANNOTATION_MATCHING_BRACKET),r(n.ANNOTATION_CURRENT_SEARCH),r(n.ANNOTATION_MATCHING_SEARCH),r(n.ANNOTATION_READ_OCCURRENCE),r(n.ANNOTATION_WRITE_OCCURRENCE),r(n.ANNOTATION_SELECTED_LINKED_GROUP),r(n.ANNOTATION_CURRENT_LINKED_GROUP),r(n.ANNOTATION_LINKED_GROUP),r(n.ANNOTATION_CURRENT_LINE,!0),r(n.ANNOTATION_BLAME,!0),r(n.ANNOTATION_CURRENT_BLAME,!0),n.registerType(n.ANNOTATION_FOLDING,i),o.addMixin=function(e){var t=o.prototype;for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},o.prototype={addAnnotationType:function(e,t){this._annotationTypes||(this._annotationTypes=[]);var n=t-1;void 0!=t&&n>=0&&n<this._annotationTypes.length?this._annotationTypes.splice(n,0,e):this._annotationTypes.push(e)},getAnnotationTypePriority:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e)return t+1;return 0},getAnnotationsByType:function(e,t,n){for(var i,r=e.getAnnotations(t,n),o=[];r.hasNext();){i=r.next();var s=this.getAnnotationTypePriority(i.type);0!==s&&o.push(i)}var a=this;return o.sort(function(e,t){return a.getAnnotationTypePriority(e.type)-a.getAnnotationTypePriority(t.type)}),o},isAnnotationTypeVisible:function(e){return 0!==this.getAnnotationTypePriority(e)},removeAnnotationType:function(e){if(this._annotationTypes)for(var t=0;t<this._annotationTypes.length;t++)if(this._annotationTypes[t]===e){this._annotationTypes.splice(t,1);break}}},a.prototype={addAnnotation:function(e){if(e){var t=this._annotations,n=s(t,e.start);t.splice(n,0,e),e._annotationModel=this;var i={type:"Changed",added:[e],removed:[],changed:[]};this.onChanged(i)}},getTextModel:function(){return this._model},getAnnotations:function(e,t){var n,i,r=this._annotations,o=0;return i=void 0===e&&void 0===t?function(){return o<r.length?r[o++]:null}:function(){for(;o<r.length;){var n=r[o++];if(e===n.start||(e>n.start?e<n.end:n.start<t))return n;if(n.start>=t)break}return null},n=i(),{next:function(){var e=n;return e&&(n=i()),e},hasNext:function(){return null!==n}}},modifyAnnotation:function(e){if(e){var t=this._getAnnotationIndex(e);if(!(0>t)){var n={type:"Changed",added:[],removed:[],changed:[e]};this.onChanged(n)}}},onChanged:function(e){return this.dispatchEvent(e)},removeAnnotations:function(e){var t,n,i=this._annotations;if(e)for(t=[],n=i.length-1;n>=0;n--){var r=i[n];r.type===e&&(i.splice(n,1),t.splice(0,0,r),r._annotationModel=null)}else t=i,i=[];var o={type:"Changed",removed:t,added:[],changed:[]};this.onChanged(o)},removeAnnotation:function(e){if(e){var t=this._getAnnotationIndex(e);if(!(0>t)){e._annotationModel=null;var n={type:"Changed",removed:this._annotations.splice(t,1),added:[],changed:[]};this.onChanged(n)}}},replaceAnnotations:function(e,t){var n,i,r,o=this._annotations,a=[];if(e)for(n=e.length-1;n>=0;n--)r=e[n],i=this._getAnnotationIndex(r),0>i||(r._annotationModel=null,o.splice(i,1),a.splice(0,0,r));for(t||(t=[]),n=0;n<t.length;n++)r=t[n],i=s(o,r.start),r._annotationModel=this,o.splice(i,0,r);var l={type:"Changed",removed:a,added:t,changed:[]};this.onChanged(l)},setTextModel:function(e){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged),this._model=e,this._model&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(e){for(var t=this._annotations,n=s(t,e.start);n<t.length&&t[n].start===e.start;){if(t[n]===e)return n;n++}return-1},_onChanged:function(e){var t=e.start,n=e.addedCharCount,i=e.removedCharCount,r=this._annotations,o=t+i,s=0;if(s>=0&&s<r.length){var a,l={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:e},d=n-i;for(a=s;a<r.length;a++){var c=r[a];c.start>=o?(c._oldStart=c.start,c._oldEnd=c.end,c.start+=d,c.end+=d,l.changed.push(c)):c.end<=t||(c.start<t&&o<c.end?(c._oldStart=c.start,c._oldEnd=c.end,c.end+=d,l.changed.push(c)):(r.splice(a,1),l.removed.push(c),c._annotationModel=null,c.expand&&c.expand(),a--))}(l.added.length>0||l.removed.length>0||l.changed.length>0)&&this.onChanged(l)}}},t.EventTarget.addMixin(a.prototype),l.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);var t=this._annotationModel;t&&(t.removeEventListener("Changed",this._listener.onChanged),t=null)},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.tagName&&(e.tagName||(e.tagName=t.tagName)),t.style){e.style||(e.style={});for(n in t.style)e.style[n]||(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)e.attributes[n]||(e.attributes[n]=t.attributes[n])}}return e},_mergeStyleRanges:function(e,t){e||(e=[]);for(var n,i=s(e,t.start,!0);i<e.length&&t;i++){var r=e[i];if(t.end<=r.start)break;if(!(t.start>=r.end)){n=this._mergeStyle({},r.style),n=this._mergeStyle(n,t.style);var o=[];o.push(i,1),t.start<r.start&&o.push({start:t.start,end:r.start,style:t.style}),t.start>r.start&&o.push({start:r.start,end:t.start,style:r.style}),o.push({start:Math.max(r.start,t.start),end:Math.min(r.end,t.end),style:n}),t.end<r.end&&o.push({start:t.end,end:r.end,style:r.style}),t=t.end>r.end?{start:r.end,end:t.end,style:t.style}:null,Array.prototype.splice.apply(e,o)}}return t&&(n=this._mergeStyle({},t.style),e.splice(i,0,{start:t.start,end:t.end,style:n})),e},_onAnnotationModelChanged:function(e){function t(e,t){o.getBaseModel&&(e=o.mapOffset(e,!0),t=o.mapOffset(t,!0)),-1!==e&&-1!==t&&i.redrawRange(e,t)}function n(e,n){for(var i=0;i<e.length;i++)if(r.isAnnotationTypeVisible(e[i].type)){var o=e[i];t(o.start,o.end),n&&void 0!==o._oldStart&&o._oldEnd&&t(o._oldStart,o._oldEnd)}}var i=this._view;if(i){var r=this,o=i.getModel();n(e.added),n(e.removed),n(e.changed,!0)}},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){var t=this._annotationModel,n=e.textView.getModel(),i=t.getTextModel(),r=e.lineStart,o=e.lineStart+e.lineText.length;i!==n&&(r=n.mapOffset(r),o=n.mapOffset(o));for(var s=t.getAnnotations(r,o);s.hasNext();){var a=s.next();if(this.isAnnotationTypeVisible(a.type)){if(a.rangeStyle){var l=a.start,d=a.end;i!==n&&(l=n.mapOffset(l,!0),d=n.mapOffset(d,!0)),e.ranges=this._mergeStyleRanges(e.ranges,{start:l,end:d,style:a.rangeStyle})}a.lineStyle&&(e.style=this._mergeStyle({},e.style),e.style=this._mergeStyle(e.style,a.lineStyle))}}}},o.addMixin(l.prototype),{FoldingAnnotation:i,AnnotationType:n,AnnotationTypeList:o,AnnotationModel:a,AnnotationStyler:l}}),define("orion/blamer",["orion/extensionCommands","orion/PageLinks","orion/URITemplate","orion/edit/editorContext"],function(e,t,n,i){function r(t,n){for(var i=n.getFileMetadata(),r=t.getServiceReferences("orion.edit.blamer"),o=0;o<r.length;o++){var s=r[o],a={};a.validationProperties=s.getProperty("validationProperties"),a.forceSingleItem=!0;var l=e._makeValidator(a,t);if(l.validationFunction.bind(l)(i))return t.getService(s)}return null}function o(e,t){return!!r(e,t)&&!!e.getService("orion.core.blame")}function s(e,o){var s=r(e,o);if(s){var a=function(i){for(var r=t.getOrionHome(),o=0;o<i.length;o++){var s=i[o],a=new n(s.CommitLink),l={};l.OrionHome=r,s.CommitLink=a.expand(l)}e.getService("orion.core.blame")._setAnnotations(i)};if(s.computeBlame){var l={metadata:o.getFileMetadata()};s.computeBlame(i.getEditorContext(e),l).then(a)}else s.doBlame(o.getInput()).then(a)}}return{isVisible:o,getBlame:s}}),define("orion/editorCommands",["i18n!orion/edit/nls/messages","orion/i18nUtil","orion/webui/littlelib","orion/webui/dialogs/OpenResourceDialog","orion/widgets/input/DropDownMenu","orion/Deferred","orion/URITemplate","orion/commands","orion/keyBinding","orion/commandRegistry","orion/extensionCommands","orion/contentTypes","orion/searchUtils","orion/PageUtil","orion/PageLinks","orion/editor/annotations","orion/blamer","orion/regex","orion/util","orion/edit/editorContext"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m,v,y,_){function C(e){var t=new s(e.uriTemplate),n=e.params||{};n.OrionHome=n.OrionHome||f.getOrionHome();var i=t.expand(n),r=document.createElement("div"),o=document.createElement("iframe");return o.id=e.id,o.name=e.id,o.type="text/html",o.sandbox="allow-scripts allow-same-origin",o.frameborder=void 0!==e.border?e.border:1,o.src=i,o.className="delegatedUI",e.width&&(r.style.width=e.width,o.style.width=e.width),e.height&&(r.style.height=e.height,o.style.height=e.height),o.style.visibility="hidden",null!==e.parent&&(e.parent||window.document.body).appendChild(r),r.appendChild(o),o.style.left=e.left||(window.innerWidth-parseInt(o.clientWidth,10))/2+"px",o.style.top=e.top||(window.innerHeight-parseInt(o.clientHeight,10))/2+"px",o.style.visibility="",window.addEventListener("message",function a(t){if(t.source===o.contentWindow&&"string"==typeof t.data){var n=JSON.parse(t.data);"orion.page.delegatedUI"===n.pageService&&n.source===e.id&&(n.cancelled?e.cancelled&&e.cancelled():n.result?e.done&&e.done(n.result):(n.Status||n.status)&&e.status&&e.status(n.Status||n.status),window.removeEventListener("message",a,!1),r.parentNode&&r.parentNode.removeChild(r))}},!1),r}function w(e){this.serviceRegistry=e.serviceRegistry,this.commandService=e.commandRegistry,this.fileClient=e.fileClient,this.inputManager=e.inputManager,this.toolbarId=e.toolbarId,this.saveToolbarId=e.saveToolbarId,this.editToolbarId=e.editToolbarId,this.pageNavId=e.navToolbarId,this.isReadOnly=e.readonly,this._localSearcher=e.textSearcher,this._searcher=e.searcher,this.editorSettings=e.editorSettings,this.localSettings=e.localSettings}var b={},x=null;return b.createDelegatedUI=C,w.prototype={generateSimpleEditorCommands:function(e,t){this.isReadOnly||(this._generateUndoStackCommands(e),this._generateSaveCommand(e,t)),this._generateSearchFilesCommand(e),this._generateGotoLineCommnand(e),this._generateFindCommnand(e)},generateEditorCommands:function(e){this.generateBaseEditorCommands(e),this.generateExtraEditorCommands(e)},generateBaseEditorCommands:function(e){this.isReadOnly||(this._generateUndoStackCommands(e),this._generateSaveCommand(e),this._generateEditCommands(e))},generateExtraEditorCommands:function(e){this._generateSettingsCommand(e),this._generateSearchFilesCommand(e),this._generateGotoLineCommnand(e),this._generateFindCommnand(e),this._generateBlame(e)},_generateSettingsCommand:function(t){var n=this,i=new a.Command({imageClass:"core-sprite-wrench",tooltip:e.LocalEditorSettings,id:"orion.edit.settings",visibleWhen:function(){return t.installed},callback:function(e){var o=i.settingsDropDown;if(!o||o.isDestroyed()){o=i.settingsDropDown=new r(e.domNode.parentNode,e.domNode,{noClick:!0,selectionClass:"dropdownSelection",onShow:function(){o.focus()},onHide:function(){t.focus()}}),o.updateContent=n.localSettings.show.bind(n.localSettings);var s=o.getContentNode();s.tabIndex=s.style.marginTop=0}o.click()}});this.commandService.addCommand(i),this.commandService.registerCommandContribution("settingsActions","orion.edit.settings",1,null,!1,new l.KeyBinding("s",!0,!0))},_generateUndoStackCommands:function(t){var n=new a.Command({name:e.Undo,id:"orion.undo",visibleWhen:function(){return t.installed},callback:function(){t.getUndoStack().undo()}});this.commandService.addCommand(n),this.commandService.registerCommandContribution(this.editToolbarId||this.toolbarId,"orion.undo",400,this.editToolbarId?"orion.menuBarEditGroup/orion.undoGroup":null,!this.editToolbarId,new l.KeyBinding("z",!0));var i=new a.Command({name:e.Redo,id:"orion.redo",visibleWhen:function(){return t.installed},callback:function(){t.getUndoStack().redo()}});this.commandService.addCommand(i),this.commandService.registerCommandContribution(this.editToolbarId||this.toolbarId,"orion.redo",401,this.editToolbarId?"orion.menuBarEditGroup/orion.undoGroup":null,!this.editToolbarId,y.isMac?new l.KeyBinding("z",!0,!0):new l.KeyBinding("y",!0))},_generateSearchFilesCommand:function(t){var r=this;if(r._searcher){var o=!1,s=new a.Command({name:e.searchFiles,tooltip:e.searchFiles,id:"orion.searchFiles",visibleWhen:function(){return t.installed},callback:function(){if(!o){var s=t.getSelection(),a=t.getText(s.start,s.end),l=r.serviceRegistry,d=l.getService("orion.page.progress"),c=new i.OpenResourceDialog({searcher:r._searcher,progress:d,searchRenderer:r._searcher.defaultRenderer,nameSearch:!1,title:e.searchFiles,message:e.searchTerm,initialText:a,onHide:function(){o=!1,t.focus()}});window.setTimeout(function(){o=!0,c.show(n.node(r.toolbarId))},0)}}});this.commandService.addCommand(s),this.commandService.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.searchFiles",1,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new l.KeyBinding("h",!0))
}},_generateSaveCommand:function(t,n){var i=this,r=n?n:"orion.save",o=new a.Command({name:e.Save,tooltip:e.saveFile,id:r,visibleWhen:function(){return!t.installed||i.inputManager.getReadOnly()?!1:!0},callback:function(){return i.inputManager.save(),!0}});this.commandService.addCommand(o),this.commandService.registerCommandContribution(this.saveToolbarId||this.toolbarId,r,1,this.saveToolbarId?"orion.menuBarFileGroup/orion.saveGroup":null,!1,new l.KeyBinding("s",!0)),t.getTextView&&t.getTextView()&&(t.getTextView().setKeyBinding(new l.KeyBinding("s",!0),"save"),t.getTextView().setAction("save",o.callback,o))},_generateGotoLineCommnand:function(t){var n=this,i=new d.ParametersDescription([new d.CommandParameter("line","number","Line:")],{hasOptionalParameters:!1},function(){var e=t.getModel().getLineAtOffset(t.getCaretOffset())+1;return[new d.CommandParameter("line","number","Line:",e.toString())]}),r=new a.Command({name:e.gotoLine,tooltip:e.gotoLineTooltip,id:"orion.gotoLine",visibleWhen:function(){return t.installed},parameters:i,callback:function(n){var i,r=t.getModel();n.parameters&&n.parameters.valueFor("line")?i=n.parameters.valueFor("line"):(i=r.getLineAtOffset(t.getCaretOffset()),i=prompt(e.gotoLinePrompt,i+1),i&&(i=parseInt(i,10))),i&&t.onGotoLine(i-1,0)}});this.commandService.addCommand(r),this.commandService.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.gotoLine",3,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new l.KeyBinding("l",!y.isMac,!1,!1,y.isMac),new d.URLBinding("gotoLine","line")),t.getTextView&&t.getTextView()&&t.getTextView().setAction("gotoLine",function(e){return e?(t.onGotoLine(e.line-1,0,void 0,e.callback),!0):(n.commandService.runCommand("orion.gotoLine"),!0)},r)},_generateFindCommnand:function(t){var n=this,i=new d.ParametersDescription([new d.CommandParameter("find","text","Find:")],{clientCollect:!0},function(){var e=t.getSelection(),i="";if(e.end>e.start){var r=t.getModel();i=r.getText(e.start,e.end),n._localSearcher&&n._localSearcher.getOptions().regex&&(i=v.escape(i))}return[new d.CommandParameter("find","text","Find:",i)]}),r=new a.Command({name:e.Find,tooltip:e.Find,id:"orion.editor.find",visibleWhen:function(){return t.installed},parameters:i,callback:function(e){if(n._localSearcher){var i="",r=null,o=t.getSelection();if(o.end>o.start&&e.parameters.valueFor("useEditorSelection")){var s=t.getModel();i=s.getText(o.start,o.end),n._localSearcher.getOptions().regex&&(i=v.escape(i))}else e.parameters&&e.parameters.valueFor("find")&&(i=e.parameters.valueFor("find"),r=p.matchResourceParameters(),u.convertFindURLBinding(r));if(r){n._localSearcher.setOptions({regex:r.regEx,caseInsensitive:!r.caseSensitive});var a={};r.atLine&&(a.start=t.getModel().getLineStart(r.atLine-1)),n._localSearcher.show({findString:i,replaceString:r.replaceWith}),n._localSearcher.find(!0,a)}else n._localSearcher.show({findString:i});return!0}return!1}});this.commandService.addCommand(r),this.commandService.registerCommandContribution(this.editToolbarId||this.pageNavId,"orion.editor.find",0,this.editToolbarId?"orion.menuBarEditGroup/orion.findGroup":null,!this.editToolbarId,new l.KeyBinding("f",!0),new d.URLBinding("find","find")),t.getTextView&&t.getTextView()&&t.getTextView().setAction("find",function(e){return e?(n._localSearcher.show(e),!0):(n.commandService.runCommand("orion.editor.find",null,null,new d.ParametersDescription([new d.CommandParameter("useEditorSelection","text","","true")],{clientCollect:!0})),!0)},r)},_generateBlame:function(t){var n=this,i=new a.Command({name:e.Blame,tooltip:e.BlameTooltip,id:"orion.edit.blame",parameters:new d.ParametersDescription([new d.CommandParameter("blame","boolean")],{clientCollect:!0}),visibleWhen:function(){return t.installed?m.isVisible(n.serviceRegistry,n.inputManager):!1},callback:function(e){for(var i=!1,r=t.getAnnotationModel().getAnnotations();r.hasNext();){var o=r.next();if(o.type===g.AnnotationType.ANNOTATION_BLAME){i=!0;break}}i=!i,e.parameters&&e.parameters.valueFor("blame")&&(i="true"===e.parameters.valueFor("blame")),i?m.getBlame(n.serviceRegistry,n.inputManager):t.showBlame([])}});this.commandService.addCommand(i),this.commandService.registerCommandContribution(this.toolbarId,"orion.edit.blame",1,"orion.menuBarToolsGroup",!1,new l.KeyBinding("b",!0,!0),new d.URLBinding("blame","blame"))},_generateEditCommands:function(i){function r(e){if(x)return x;var t=e.getService("orion.core.contentTypeRegistry");return t||(t=new h.ContentTypeRegistry(e),t=e.getService("orion.core.contentTypeRegistry")),t.getContentTypes().then(function(e){return x=e})}function s(e){if(!e)return null;var t=new l.KeyBinding;return l.KeyBinding.apply(t,e),t}function d(e,t){!t&&e&&"undefined"!=typeof e.HTML&&delete e.HTML;var n=u.serviceRegistry.getService("orion.page.message");n?n.setProgressResult(e):window.console.log(e)}var u=this,p=this.toolbarId,f=this.serviceRegistry,g=f.getServiceReferences("orion.edit.command"),m=this.inputManager,v=f.getService("orion.page.progress"),y=function(n,r,o){var s=o.visibleWhen;return o.visibleWhen=function(e){return!i.installed||u.inputManager.getReadOnly()?!1:!s||s(e)},o.callback=function(){i=this;var o,s,a=i.getSelection?i.getSelection():{start:0,end:0},l=i.getModel(),c=function(e){"object"==typeof e&&e?(e.text&&i.setText(e.text),e.selection&&(i.setSelection&&i.setSelection(e.selection.start,e.selection.end,!0),i.focus())):"string"==typeof e&&(i.setText(e,a.start,a.end,!0),i.setSelection&&i.setSelection(a.start,a.start+e.length),i.focus())};if(r.execute){var h={contentType:m.getContentType(),input:m.getInput()},u=_.getEditorContext(f);u.openDelegatedUI=C,u.setStatus=d,o=r.execute(u,h),s=null}else o=r.run(l.getText(a.start,a.end),l.getText(),a,m.getInput()),s=function(e){if(e&&e.uriTemplate){var t={};t.uriTemplate=e.uriTemplate,t.params=m.getFileMetadata(),t.id=n.id,t.width=e.width,t.height=e.height,t.done=c,t.status=d,C(t)}else e&&(e.Status||e.status)?d(e.Status||e.status):c(e)};return v.showWhile(o,t.formatMessage(e.running,n.name)).then(s),!0},o.callback=o.callback.bind(i),new a.Command(o)};o.when(r(this.serviceRegistry),function(){var e=[],t=100;g.forEach(function(n){var r=n.getProperty("editor");if(!r||!i.id||r===i.id){for(var o=u.serviceRegistry.getService(n),a={},l=n.getPropertyKeys(),d=0;d<l.length;d++)a[l[d]]=n.getProperty(l[d]);a.forceSingleItem=!0;var h=c._createCommandOptions(a,n,u.serviceRegistry,x,!1,function(){return m.getFileMetadata()});e.push(h),h.then(function(e){var n=y(a,o,e);u.commandService.addCommand(n),u.commandService.registerCommandContribution(u.toolbarId,n.id,t,"orion.menuBarToolsGroup",a.bindingOnly,s(a.key))}),t++}}),o.all(e,function(e){return{_error:e}}).then(function(){var e;if(e=m.getFileMetadata()){var t=n.node(p);t&&(u.commandService.destroy(t),u.commandService.renderCommands(t.id,t,e,i,"button")),t=n.node("pageNavigationActions"),t&&(u.commandService.destroy(t),u.commandService.renderCommands(t.id,t,i,i,"button"))}})})}},b.EditorCommandFactory=w,b}),define("orion/projectCommands",["require","i18n!orion/navigate/nls/messages","orion/webui/littlelib","orion/commands","orion/Deferred","orion/webui/dialogs/DirectoryPrompterDialog","orion/commandRegistry","orion/i18nUtil","orion/webui/dialogs/PromptDialog","orion/widgets/projects/ProjectOptionalParametersDialog","orion/fileCommands","orion/editorCommands","orion/EventTarget","orion/URITemplate","orion/PageLinks","orion/objects","orion/preferences"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m){function v(e){return e?(Array.isArray(e)&&(e=1===e.length?e[0]:{}),e):{}}function y(e,t){if(!e)return null;for(var n=[],i=0;i<e.length;i++)n.push(new s.CommandParameter(e[i].id,e[i].type,e[i].name));return new s.ParametersDescription(n,{hasOptionalParameters:!!t,optionalParams:t})}function _(e,t,n){if(t.parameters&&t.parameters.optionsRequested){var i=new d.ProjectOptionalParametersDialog({title:n,data:t,func:function(){t.parameters.optionsRequested=!1,e(t)}.bind(this)});return void i.show()}var r=t.oldParams||{};if(t.parameters)for(var o in t.parameters.parameterTable)r[o]=t.parameters.valueFor(o);if(t.parameters&&t.parameters._options.optionalParams)for(var s=0;s<t.parameters._options.optionalParams.length;s++){var o=t.parameters._options.optionalParams[s];r[o.id]=o.value}return r}function C(e,t,n){!t&&e&&"undefined"!=typeof e.HTML&&delete e.HTML,e.Retry&&e.Retry.parameters?(e.forceShowMessage&&L.setProgressResult(e),n.data.parameters=y(e.Retry.parameters,e.Retry.optionalParameters),n.data.oldParams=n.oldParams,n.commandService.collectParameters(n.data)):(b(n.project.Name,n.deployService,n.launchConfiguration),L.setProgressResult(e)),e.ToSave?L.showWhile(n.projectClient.saveProjectLaunchConfiguration(n.project,e.ToSave.ConfigurationName,n.deployService.id,e.ToSave.Parameters,e.ToSave.Url,e.ToSave.ManageUrl,e.ToSave.Path,e.ToSave.UrlTitle,e.ToSave.Type),"Saving configuration").then(function(t){b(n.project.Name,n.deployService,t),k&&k.dispatchEvent({type:"create",newValue:t}),w(L,e,n)},n.errorHandler):w(L,e,n)}function w(t,n,i){var r=[];r.Severity="Info",n.Message?(r.HTML=!1,r.Message=n.Message):(r.HTML=!0,r.Message='Use <a href="'+e.toUrl("edit/edit.html#"+i.project.ContentLocation)+'">Project</a> page to view and manage the application.'),t.setProgressResult(r)}function b(e,t,n){var i;E&&(i=n?"orion.launchConfiguration.deploy."+n.ServiceId+n.Name:"orion.project.deploy."+t.id,E.put(e,i)),k&&k.dispatchEvent({type:"changedDefault",newValue:i})}function x(e,t){function n(n){L.showWhile(t.deployService.deploy(t.project,e),n,!0).then(function(n){if(n){if(n.UriTemplate){var i={};return i.uriTemplate=n.UriTemplate,i.width=n.Width,i.height=n.Height,i.id=n.UriTemplateId||t.deployService.id,t.oldParams=e.Params,i.done=function(e){C(e,null,t)},i.status=function(e){C(e,null,t)},void h.createDelegatedUI(i)}t.launchConfiguration&&(n.State||n.CheckState)&&(t.launchConfiguration.status=n,k&&k.dispatchEvent({type:"changeState",newValue:t.launchConfiguration})),n.ToSave?L.showWhile(t.projectClient.saveProjectLaunchConfiguration(t.project,n.ToSave.ConfigurationName,t.deployService.id,n.ToSave.Parameters,n.ToSave.Url,n.ToSave.ManageUrl,n.ToSave.Path,n.ToSave.UrlTitle,n.ToSave.Type),"Saving configuration").then(function(e){b(t.project.Name,t.deployService,e),k&&k.dispatchEvent({type:"create",newValue:e}),w(L,n,t)},t.errorHandler):b(t.project.Name,t.deployService,t.launchConfiguration),w(L,n,t)}},function(n){n.Retry&&n.Retry.parameters?(n.forceShowMessage&&t.errorHandler(n),t.data.parameters=y(n.Retry.parameters,n.Retry.optionalParameters),t.data.oldParams=e.Params,t.commandService.collectParameters(t.data)):(t.errorHandler(n),b(t.project.Name,t.deployService,t.launchConfiguration))})}k&&t.launchConfiguration&&(t.launchConfiguration.status={State:"PROGRESS"},k.dispatchEvent({type:"changeState",newValue:t.launchConfiguration})),t.deployService.getDeployProgressMessage?t.deployService.getDeployProgressMessage(t.project,e).then(function(e){n(e)}.bind(this),function(){n(t.deployService.name+" in progress")}.bind(this)):n(t.deployService.name+" in progress")}function S(e,t,n,i,r,o,s,a){var l;l=i.actionComment?a?i.actionComment.replace(/\$\{([^\}]+)\}/g,function(e,t){return a[t]}):i.actionComment:"Getting content from "+i.type,L.showWhile(i.initDependency(r,a,o),l).then(function(t){e.addProjectDependency(o,t).then(function(){A&&A.dispatchEvent({type:"create",newValue:t,project:o})},n)},function(e){e.Retry&&e.Retry.addParameters&&(s.parameters=y(e.Retry.addParameters,e.Retry.optionalParameters),s.oldParams=a,t.collectParameters(s)),n(e)})}var L,E,k,T={};T.getLaunchConfigurationDispatcher=function(){return k||(k=new u),k},T.getDefaultLaunchCommand=function(e){return E?E.get(e):void 0};var A;T.getDependencyDispatcher=function(){return A||(A=new u),A},T.updateProjectNavCommands=function(e,t,n,r,o){function s(e){L?L.setProgressResult(e):window.console.log(e)}for(var a=0;a<t.length;a++)!function(t){var a=new i.Command({name:"Deploy to "+t.Name,tooltip:"Deploy to "+t.Name,id:"orion.launchConfiguration.deploy."+t.ServiceId+t.Name,imageClass:"core-sprite-deploy",callback:function(i){var a=v(i.items);i.oldParams||(i.oldParams=t.Params);var l=arguments.callee,d=_(l,i,"Deploy "+a.Name);if(d){var c=g.clone(t);c.Params=d,r.getProjectDelpoyService(t.ServiceId,t.Type).then(function(l){l&&l.deploy&&o.loadWorkspace(a.Project.ContentLocation).then(function(){x(c,{project:e.Project,deployService:l,data:i,errorHandler:s,projectClient:r,commandService:n,launchConfiguration:t})})})}},visibleWhen:function(t){if(void 0!=a.showCommand&&!a.showCommand)return!1;var n=v(t);return n.Project===e.Project}});a.isLaunchProject=!0,n.addCommand(a)}(t[a])},T.createDependencyCommands=function(e,t,n,r,o){function s(e){L?L.setProgressResult(e):window.console.log(e)}function l(e){var n=new i.Command({name:e?"Start":"Stop",tooltip:e?"Start application":"Stop application",id:e?"orion.launchConfiguration.startApp":"orion.launchConfiguration.stopApp",imageClass:e?"core-sprite-start":"core-sprite-stop",callback:function(n){var i=v(n.items);n.oldParams=i.Params;var o=arguments.callee,a=_(o,n,e?"Start application":"Stop application");a&&r.getProjectDelpoyService(i.ServiceId,i.Type).then(function(o){o&&(e?o.start:o.stop)&&(k&&(i.status={State:"PROGRESS"},k.dispatchEvent({type:"changeState",newValue:i})),(e?o.start:o.stop)(a).then(function(e){i.status=e,k&&k.dispatchEvent({type:"changeState",newValue:i}),e.ToSave&&L.showWhile(r.saveProjectLaunchConfiguration(i.project,e.ToSave.ConfigurationName,o.id,e.ToSave.Parameters,e.ToSave.Url,e.ToSave.ManageUrl,e.ToSave.Path,e.ToSave.UrlTitle,e.ToSave.Type),"Saving configuration").then(function(e){b(i.project.Name,o,e),k&&k.dispatchEvent({type:"create",newValue:e})},s)},function(e){e.Retry?(n.parameters=y(e.Retry.parameters,e.Retry.optionalParameters),n.oldParams=a,t.collectParameters(n)):s(e)}))})},visibleWhen:function(t){var n=v(t);return n.ServiceId&&n.Name&&n.status&&(e?"STOPPED"===n.status.State:"STARTED"===n.status.State)}});t.addCommand(n)}L=e.getService("orion.page.progress");var d=new i.Command({name:"Connect",tooltip:"Fetch content",id:"orion.project.dependency.connect",callback:function(e){var n=v(e.items),i=arguments.callee,o=_(i,e,"Fetch content of "+n.Dependency.Name);if(o){var a=r.getProjectHandler(n.Dependency.Type);a.then?a.then(function(i){S(r,t,s,i,n.Dependency,n.Project,e,o)}):S(r,t,s,a,n.Dependency,n.Project,e,o)}},visibleWhen:function(e){if(!(e.Dependency&&e.Project&&e.disconnected))return!1;if(o)for(var t=0;t<o.length;t++)if(o[t]===e.Dependency.Type)return!0;return!1}});t.addCommand(d);var c=new i.Command({name:"Disconnect from project",tooltip:"Do not treat this folder as a part of the project",imageClass:"core-sprite-delete",id:"orion.project.dependency.disconnect",callback:function(e){var t=v(e.items);L.progress(r.removeProjectDependency(t.Project,t.Dependency),a.formatMessage("Removing ${0} from project ${1}",t.Dependency.Name,t.Project.Name)).then(function(){A&&A.dispatchEvent({type:"delete",oldValue:t.Dependency,project:t.Project})})},visibleWhen:function(e){return e.Dependency&&e.Project?!0:!1}});t.addCommand(c);var h=new i.Command({name:"Check status",tooltip:"Check application status",id:"orion.launchConfiguration.checkStatus",callback:function(e){var n=v(e.items);if(!e.parameters)return e.parameters=y(n.parametersRequested,n.optionalParameters),e.oldParams=n.Params,void t.collectParameters(e);var i=arguments.callee,o=_(i,e,"Check application state");o&&r.getProjectDelpoyService(n.ServiceId,n.Type).then(function(i){k&&(n.status={State:"PROGRESS"},k.dispatchEvent({type:"changeState",newValue:n})),i&&i.getState&&i.getState(o).then(function(e){n.status=e,k&&k.dispatchEvent({type:"changeState",newValue:n}),n.project&&n.project.children&&n.project.children.forEach(function(e){n.ServiceId&&n.Name&&n.parametersRequested&&e.ServiceId===n.ServiceId&&e.Name!==n.Name&&k&&(e.status={CheckState:!0},k.dispatchEvent({type:"changeState",newValue:e}))})},function(i){i.Retry?(e.parameters=y(i.Retry.parameters,i.Retry.optionalParameters),e.oldParams=o,t.collectParameters(e)):(s(i),n.status={error:i},k&&k.dispatchEvent({type:"changeState",newValue:n}))})})},visibleWhen:function(e){var t=v(e);return t.ServiceId&&t.Name&&t.parametersRequested}});t.addCommand(h),l(!0),l(!1);var u=new i.Command({name:"Manage",tooltip:"Manage this application on remote server",id:"orion.launchConfiguration.manage",hrefCallback:function(e){var t=v(e.items);if(t.ManageUrl){var n=new p(t.ManageUrl),i=g.clone(t.Params);i.OrionHome=f.getOrionHome();var r=n.expand(i);return r.indexOf("://")||(r="http://"+r),r}},visibleWhen:function(e){var t=v(e);return t.ManageUrl}});t.addCommand(u);var m=new i.Command({name:"Deploy",tooltip:"Deploy this application again",id:"orion.launchConfiguration.deploy",imageClass:"core-sprite-deploy",callback:function(e){var i=v(e.items);e.oldParams||(e.oldParams=i.Params);var o=arguments.callee,a=_(o,e,"Deploy "+i.Name);if(a){var l=g.clone(i);l.Params=a,r.getProjectDelpoyService(i.ServiceId,i.Type).then(function(o){o&&o.deploy&&n.loadWorkspace(i.project.ContentLocation).then(function(){x(l,{project:i.project,deployService:o,data:e,errorHandler:s,projectClient:r,commandService:t,launchConfiguration:i})})})}},visibleWhen:function(e){var t=v(e);return t.ServiceId&&t.Name}});t.addCommand(m)},T.getAddDependencyCommands=function(e){var t=[];for(var n in e._commandList){var i=e._commandList[n];i.isAddDependency&&t.push(i)}return t},T.getCreateProjectCommands=function(e){var t=[];for(var n in e._commandList){var i=e._commandList[n];i.isCreateProject&&t.push(i)}return t},T.getDeployProjectCommands=function(e){var t=[];for(var n in e._commandList){var i=e._commandList[n];i.isDeployProject&&t.push(i)}return t},T.getLaunchProjectCommands=function(e){var t=[];for(var n in e._commandList){var i=e._commandList[n];i.isLaunchProject&&t.push(i)}return t};var N;return T.setExplorer=function(e){N=e},T.createProjectCommands=function(e,d,h,u,p,f){function g(e){L?L.setProgressResult(e):window.console.log(e)}function C(e,t){var n=c.getModelEventDispatcher();t.ContentLocation?h.read(t.ContentLocation,!0).then(function(t){n.dispatchEvent({type:"create",parent:e,newValue:t})},function(){n.dispatchEvent({type:"create",parent:e,newValue:null})}):n.dispatchEvent({type:"create",parent:e,newValue:null})}function w(e){return u.getProjectHandler(e).then(function(t){if(t.initDependency){var n={name:t.addDependencyName,id:"orion.project.adddependency."+e,tooltip:t.addDependencyTooltip,callback:function(e){var n=v(e.items).Project,i=arguments.callee,o=_(i,e,t.addDependencyTooltip);if(o){var s=new r;t.paramsToDependencyDescription(o).then(function(e){e&&e.Location?h.loadWorkspace(n.WorkspaceLocation).then(function(n){for(var i=[],o=!1,a=0;a<n.Children.length&&o!==!0;a++){var l=t.getDependencyDescription(n.Children[a]);i.push(l),function(t,n){n.then(function(t){t&&t.Location===e.Location&&(o=!0,s.resolve(t))})}(a,l)}r.all(i).then(function(){o||s.resolve()})},s.reject):s.resolve()},g),L.showWhile(s,"Searching your workspace for matching content").then(function(i){i?u.addProjectDependency(n,i).then(function(){A&&A.dispatchEvent({type:"create",newValue:i,project:n})},g):S(u,d,g,t,{},n,e,o)})}},visibleWhen:function(e){return N&&N.isCommandsVisible()?"Project"===e.type||"Project"===N.treeRoot.type:!1}};n.parameters=y(t.addParameters,t.optionalParameters);var o=new i.Command(n);o.isAddDependency=!0,d.addCommand(o)}})}function b(e){return u.getProjectHandler(e).then(function(t){if(t.initProject){var n={name:t.addProjectName,id:"orion.project.createproject."+e,tooltip:t.addProjectTooltip,callback:function(e){var n=arguments.callee,i=v(e.items),r=_(n,e,t.addProjectTooltip);if(r){var o;o=t.actionComment?r?t.actionComment.replace(/\$\{([^\}]+)\}/g,function(e,t){return r[t]}):t.actionComment:"Getting content from "+t.type,L.showWhile(t.initProject(r,{WorkspaceLocation:i.Location}),o).then(function(e){C(i,e)},function(t){t.Retry&&t.Retry.addParameters&&(e.parameters=y(t.Retry.addParameters,t.Retry.optionalParameters),e.oldParams=r,d.collectParameters(e)),g(t)})}},visibleWhen:function(e){return N&&N.isCommandsVisible()?(e=v(e),e.Location):!1}};n.parameters=y(t.addParameters,t.optionalParameters);var r=new i.Command(n);r.isCreateProject=!0,d.addCommand(r)}})}function k(e){var t,n={name:e.name,tootlip:e.tooltip,id:"orion.project.deploy."+e.id,callback:function(t){var n,i=N.selection.getSelections(),r=i&&i.length>0?v(i):N.treeRoot,o=r.Project;n=r.Location?r.Location.replace(o.ContentLocation,""):"";var s=arguments.callee,a=_(s,t,e.tooltip);a&&x({Params:a,Path:n},{project:o,deployService:e,data:t,errorHandler:g,projectClient:u,commandService:d})},visibleWhen:function(n){return void 0==t.showCommand||t.showCommand?(n=N.treeRoot,n.Project&&n.children&&0!==n.children.length?u.matchesDeployService(n.children[0],e):!1):!1}};n.parameters=y(e.parameters,e.optionalParameters),t=new i.Command(n),t.isDeployProject=!0,d.addCommand(t)}if(!E){var M=new m.PreferencesService(e);M.getPreferences("/deploy/project").then(function(e){E=e})}L=e.getService("orion.page.progress"),p=p||[];var I=new i.Command({name:"Associated Folder",tooltip:"Associate a folder from the workspace with this project.",id:"orion.project.addFolder",callback:function(n){var i=v(n.items).Project,s=new o.DirectoryPrompterDialog({title:t["Choose a Folder"],serviceRegistry:e,fileClient:h,func:function(e){h.read(e.Location,!0).then(function(e){function t(){var t="",n=e.Name;if(e.Parents&&e.Parents.length>0){for(var r=e.Parents.length-1;r>=0;r--)t+=e.Parents[r].Name,t+="/";n+=" ("+e.Parents[e.Parents.length-1].Name+")"}t+=e.Name;var o={Name:n,Type:"file",Location:t};u.addProjectDependency(i,{Name:n,Type:"file",Location:t}).then(function(){A&&A.dispatchEvent({type:"create",newValue:o,project:i})},g)}if(!e.Parents||0===e.Parents.length){for(var n=[],o=!1,s=0;s<p.length;s++){if(o)return;var a=u.getProjectHandler(p[s]).then(function(t){return t.getDependencyDescription(e)});n.push(a),a.then(function(e){e&&(o=!0,u.addProjectDependency(i,e).then(function(){A&&A.dispatchEvent({type:"create",newValue:e,project:i})},g))})}return void r.all(n).then(function(){o||t()})}t()},g)}});s.show()},visibleWhen:function(e){return N&&N.isCommandsVisible()?"Project"===e.type||"Project"===N.treeRoot.type:!1}});I.isAddDependency=!0,d.addCommand(I);var D=new i.Command({name:"Convert to project",tooltip:"Convert this folder into a project",id:"orion.project.initProject",callback:function(e){var t=v(e.items);if(t){var n=function(){u.initProject(t.Location).then(function(e){h.read(t.Location,!0).then(function(){N.changedItem(t,!0)},g),C(t,e)},g)};u.readProject(t).then(function(e){e?(L.setProgressResult({Message:"This folder is a project already.",Severity:"Warning"}),N.changedItem(t,!0)):n()},n)}},visibleWhen:function(e){if(!N||!N.isCommandsVisible())return!1;var t=v(e);if(t&&(t.parent&&t.parent.Projects||t.Parents&&0===t.Parents.length)){if(t.children)for(var n=0;n<t.children.length;n++)if(t.children[n].Name&&!t.children[n].Directory&&"project.json"===t.children[n].Name.toLowerCase())return!1;return!0}return!1}});d.addCommand(D);for(var R=[],P=0;P<p.length;P++){var O=p[P];R.push(w(O)),R.push(b(O))}var B="README.md",F=new i.Command({name:"Readme File",tooltip:"Create a README.md file in this project",id:"orion.project.create.readme",callback:function(e){var t=v(e.items);L.progress(h.createFile(t.Project.ContentLocation,B),a.formatMessage("Creating ${0}",B)).then(function(e){function n(){var n=c.getModelEventDispatcher();n.dispatchEvent({type:"create",parent:t.Project.fileMetadata,newValue:e})}t.Project?L.progress(h.write(e.Location,"# "+t.Project.Name),"Writing sample readme").then(function(){n()}):n()},g)},visibleWhen:function(e){if(!N||!N.isCommandsVisible())return!1;if(e=v(e),!(e.Project&&e.Project.fileMetadata&&e.Project.fileMetadata.children&&e.Project.ContentLocation))return!1;var t=e.Project.fileMetadata.children,n=t.some(function(e){return e.Name&&e.Name.toLowerCase()===B.toLowerCase()?!0:!1});return!n}});d.addCommand(F);var V=new i.Command({name:"Basic",tooltip:"Create an empty project.",id:"orion.project.create.basic",parameters:new s.ParametersDescription([new s.CommandParameter("name","text","Name: ")]),callback:function(e){var n=e.parameters.valueFor("name");if(n){var i=v(e.items);h.loadWorkspace(h.fileServiceRootURL(i.Location)).then(function(e){L.progress(u.createProject(e.ChildrenLocation,{Name:n}),t["Creating project "]+n).then(function(t){C(e,t)})})}},visibleWhen:function(e){return N&&N.isCommandsVisible()?(e=v(e),!!e.Location):!1}});V.isCreateProject=!0,d.addCommand(V);var j=new i.Command({name:"Zip archive",tooltip:"Create a project from a local zip archive.",id:"orion.project.create.fromfile",callback:function(e){var i=v(e.items),r=n.node("fileSelectorInput"),o=r.cloneNode(),s=new l.PromptDialog({title:t["Enter project name:"]});s.addEventListener("ok",function(e){var n=e.value;h.loadWorkspace(h.fileServiceRootURL(i.Location)).then(function(e){L.progress(u.createProject(e.ChildrenLocation,{Name:n}),t["Creating project "]+n).then(function(t){L.progress(h.read(t.ContentLocation,!0)).then(function(t){N.changedItem(e,!0).then(function(e){var n=e.Children,i=null;if(n.some(function(e){return e.Location===t.Location?(i=e,!0):!1}),i&&r.files&&r.files.length>0)for(var o=0;o<r.files.length;o++)N._uploadFile(i,r.files.item(o),!0)})},g)},g)},g)});var a=function(){r.files&&r.files.length>0&&s.show(),r.removeEventListener("change",a)};r.addEventListener("change",a),r.click(),r.parentNode.replaceChild(o,r)},visibleWhen:function(e){return N&&N.isCommandsVisible()?(e=v(e),!!e.Location):!1}});j.isCreateProject=!0,d.addCommand(j);var U=new i.Command({name:"SFTP",tooltip:"Create a project from an SFTP site.",id:"orion.project.create.sftp",parameters:new s.ParametersDescription([new s.CommandParameter("name","text","Name:"),new s.CommandParameter("url","url","Url:")]),callback:function(e){var n=e.parameters.valueFor("name");if(n){var i=e.parameters.valueFor("url");if(i){var r=v(e.items);h.loadWorkspace(h.fileServiceRootURL(r.Location)).then(function(e){L.progress(u.createProject(e.ChildrenLocation,{Name:n,ContentLocation:i}),t["Creating project "]+n).then(function(t){C(e,t)})})}}},visibleWhen:function(e){return N&&N.isCommandsVisible()?(e=v(e),!!e.Location):!1}});if(U.isCreateProject=!0,d.addCommand(U),T.createDependencyCommands(e,d,h,u,p),f)for(var H=0;H<f.length;H++){var W=f[H],$=new r;R.push($),function(e){u.getProjectDelpoyService(W).then(function(t){k(t),e.resolve()})}($)}return r.all(R)},T}),define("orion/webui/contextmenu",["orion/webui/littlelib","orion/webui/dropdown","orion/objects"],function(e,t,n){function i(e){e.skipTriggerEventListeners=!0,r.call(this,e),this._initialize()}var r=t.Dropdown;return i.prototype=Object.create(r.prototype),n.mixin(i.prototype,{_initialize:function(){this._dropdownNode.dropdown||(this._dropdownNode.dropdown=this),this._boundcontextmenuEventHandler=this._contextmenuEventHandler.bind(this),this._boundContextMenuCloser=this._contextMenuCloser.bind(this),this._triggerNode.addEventListener("contextmenu",this._boundcontextmenuEventHandler,!0),window.addEventListener("contextmenu",this._boundContextMenuCloser,!1),this._triggerNode.addEventListener("click",this._boundContextMenuCloser,!1)},_contextMenuCloser:function(e){this.close(e)},_contextmenuEventHandler:function(t){this.open(t)?e.stop(t):this.close()}}),i.prototype.constructor=i,i.prototype._positionDropdown=function(t){if(t){var n=t.clientX,i=t.clientY;this._dropdownNode.style.position="fixed",this._dropdownNode.style.left=n+"px",this._dropdownNode.style.top=i+"px";var o=e.bounds(this._dropdownNode),s=o.width,a=o.height,l=e.bounds(document.body),d=n+s-(l.left+l.width);d>0&&(this._dropdownNode.style.left=Math.floor(n-d)+"px");var c=i+a-(l.top+l.height);c>0&&(this._dropdownNode.style.top=Math.floor(i-c)+"px")}else r.prototype._positionDropdown.call(this)},i.prototype.destroy=function(){this._triggerNode.removeEventListener("contextmenu",this._boundcontextmenuEventHandler,!0),this._triggerNode.removeEventListener("click",this._boundContextMenuCloser,!1),window.removeEventListener("contextmenu",this._boundContextMenuCloser,!1),this._dropdownNode.dropdown=null,r.prototype.destroy.call(this)},{ContextMenu:i}}),define("orion/widgets/nav/common-nav",["i18n!orion/edit/nls/messages","orion/objects","orion/webui/littlelib","orion/explorers/explorer-table","orion/explorers/navigatorRenderer","orion/explorers/explorerNavHandler","orion/keyBinding","orion/fileCommands","orion/projectCommands","orion/extensionCommands","orion/globalCommands","orion/selection","orion/URITemplate","orion/PageUtil","orion/Deferred","orion/webui/contextmenu"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g){function m(e){e.setFocus=!1,e.cachePrefix=null,e.modelEventDispatcher=a.getModelEventDispatcher(),e.dragAndDrop=a.uploadFile,y.apply(this,arguments),this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.editorInputManager=e.editorInputManager,this.progressService=e.progressService,this.sidebar=e.sidebar;var t=this.sidebarNavInputManager=e.sidebarNavInputManager;this.toolbarNode=e.toolbarNode,this.fileActionsScope="fileActions",this.editActionsScope="editActions",this.viewActionsScope="viewActions",this.toolsActionsScope="toolsActions",this.additionalActionsScope="extraActions",this._parentNode=n.node(this.parentId),this._sidebarContextMenuNode=document.createElement("ul"),this._sidebarContextMenuNode.className="dropdownMenu",this._sidebarContextMenuNode.setAttribute("role","menu"),this._sidebarContextMenuNode.id=this.parentId+"ContextMenu",this._parentNode.parentNode.insertBefore(this._sidebarContextMenuNode,this._parentNode),this.contextMenuActionsScope=this._sidebarContextMenuNode.id+"commonNavContextMenu",this.treeRoot={};var i=this;this.editorInputListener=function(e){i.reveal(e.metadata)},this.editorInputManager.addEventListener("InputChanged",this.editorInputListener),t&&(t.reveal=function(e){i.reveal(e)});var r=this.modelEventDispatcher,o=this._modelListener=this.onFileModelChange.bind(this);["move","delete"].forEach(function(e){r.addEventListener(e,o)}),this.selection=new h.Selection(this.registry,"commonNavFileSelection"),this._selectionListener=function(e){i.updateCommands(e.selections),t&&i.sidebarNavInputManager.dispatchEvent(e)},this.selection.addEventListener("selectionChanged",this._selectionListener),c.getMainSplitter().splitter.addEventListener("toggle",this._splitterToggleListener=function(){this.updateCommands()}.bind(this)),this.commandsRegistered=this.registerCommands(),this._createContextMenu()}function v(){C.apply(this,arguments)}var y=i.FileExplorer,_=s.KeyBinding,C=r.NavigatorRenderer,w=new u("#{,resource,params*}");return m.prototype=Object.create(y.prototype),t.mixin(m.prototype,{onLinkClick:function(e){y.prototype.onLinkClick.call(this,e),this.sidebarNavInputManager.dispatchEvent(e);var t=this.getNavHandler();if(t&&e.item.Directory){var n=e.item;t.cursorOn(n),t.setSelection(n,!1);var i=t._modelIterator.cursor();t.isExpandable(i)&&(t.isExpanded(i)?this.myTree.collapse(i):this.myTree.expand(i))}},onModelCreate:function(e){return y.prototype.onModelCreate.call(this,e).then(function(){this.sidebarNavInputManager.dispatchEvent(e)}.bind(this))},onFileModelChange:function(e){var t=e.oldValue,n=e.newValue,i=this.editorInputManager.getFileMetadata();if(i){var r;if([i].concat(i.Parents||[]).some(function(e){return t.Location===e.Location?(r=t,!0):!1}),r){var o;o=r.Location===i.Location?n&&n.ChildrenLocation||n&&n.ContentLocation||n&&n.Location||null:null,this.sidebarNavInputManager.dispatchEvent({type:"editorInputMoved",parent:t.parent.Location,newInput:o})}}},createActionSections:function(){var e=this;[].forEach(function(t){if(!e[t]){var n=document.createElement("ul");n.id=t,n.classList.add("commandList"),n.classList.add("layoutLeft"),n.classList.add("pageActions"),e.toolbarNode.appendChild(n),e[t]=n
}})},destroy:function(){var e=this,t=this.modelEventDispatcher;["move","delete"].forEach(function(n){t.removeEventListener(n,e._modelListener)}),y.prototype.destroy.call(this),[].forEach(function(t){delete e[t]}),this.editorInputManager.removeEventListener("InputChanged",this.editorInputListener),this.selection.removeEventListener("selectionChanged",this._selectionListener);var n=c.getMainSplitter();n&&n.splitter.removeEventListener("toggle",this._splitterToggleListener),this._contextMenu&&(this._contextMenu.destroy(),this._contextMenu=null),this._sidebarContextMenuNode&&(this._parentNode.parentNode.removeChild(this._sidebarContextMenuNode),this._sidebarContextMenuNode=null)},display:function(e,t){return this.loadRoot(e,t).then(function(){return this.updateCommands(),this.reveal(this.editorInputManager.getFileMetadata())}.bind(this))},loadRoot:function(e,t){return e=e&&e.ChildrenLocation||e||"",this.commandsRegistered.then(function(){return e&&"object"==typeof e?this.load(e):this.loadResourceList(e,t)}.bind(this))},scope:function(e){e=e&&e.ChildrenLocation||e||"";var t=p.matchResourceParameters(),n=t.resource;if(delete t.resource,e){if(t.navigate===e)return;t.navigate=e}else delete t.navigate;window.location.href=w.expand({resource:n,params:t})},scopeUp:function(){var e,t=this.treeRoot,n=t.Parents&&t.Parents[0];e=n?n.ChildrenLocation:this.fileClient.fileServiceRootURL(t.Location),this.scope(e)},scopeDown:function(e){this.scope(e.ChildrenLocation)},expandItem:function(e,t){return i.FileExplorer.prototype.expandItem.call(this,e,t).then(function(e){return this.sidebarNavInputManager.dispatchEvent({type:"itemExpanded",item:e}),e}.bind(this))},isCommandsVisible:function(){var e=c.getMainSplitter();return e?!e.splitter.isClosed():!this.destroyed},registerCommands:function(){var t=this.commandRegistry,n=this.fileActionsScope,i=this.editActionsScope,r=this.viewActionsScope,o=this.contextMenuActionsScope,s=new _(113),a=new _(46),c=new _("x",!0),h=new _("c",!0),u=new _("v",!0),p=new _(38,!1,!1,!0),f=new _(40,!1,!1,!0);return f.domScope=p.domScope=u.domScope=h.domScope=c.domScope=a.domScope=s.domScope="sidebar",f.scopeName=p.scopeName=u.scopeName=h.scopeName=c.scopeName=a.scopeName=s.scopeName=e.Navigator,t.registerCommandContribution(n,"eclipse.newFile",1,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(n,"eclipse.newFolder",2,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default",!1,null),t.registerCommandContribution(n,"orion.new.project",3,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(n,"orion.new.linkProject",4,"orion.menuBarFileGroup/orion.newContentGroup/orion.new.default"),t.registerCommandContribution(n,"orion.import",1,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(n,"orion.importZipURL",2,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(n,"orion.importSFTP",3,"orion.menuBarFileGroup/orion.importGroup"),t.registerCommandContribution(n,"eclipse.downloadSingleFile",1,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(n,"eclipse.downloadFile",2,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(n,"eclipse.exportSFTPCommand",3,"orion.menuBarFileGroup/orion.exportGroup"),t.registerCommandContribution(i,"eclipse.renameResource",1,"orion.menuBarEditGroup/orion.renameGroup",!1,s),t.registerCommandContribution(i,"eclipse.cut",2,"orion.menuBarEditGroup/orion.clipboardGroup",!1,c),t.registerCommandContribution(i,"eclipse.copySelections",3,"orion.menuBarEditGroup/orion.clipboardGroup",!1,h),t.registerCommandContribution(i,"eclipse.pasteSelections",4,"orion.menuBarEditGroup/orion.clipboardGroup",!1,u),t.registerCommandContribution(i,"eclipse.deleteFile",5,"orion.menuBarEditGroup/orion.deleteGroup",!1,a),t.registerCommandContribution(i,"eclipse.compareWith",6,"orion.menuBarEditGroup/orion.compareGroup"),t.registerCommandContribution(i,"eclipse.compareWithEachOther",7,"orion.menuBarEditGroup/orion.compareGroup"),t.registerCommandContribution(r,"eclipse.downFolder",1,"orion.menuBarViewGroup",!1,f),t.registerCommandContribution(r,"eclipse.upFolder",0,"orion.menuBarViewGroup",!1,p),t.addCommandGroup(o,"orion.commonNavContextMenuEditGroup",100,null,null,null,null,null,"dropdownSelection"),t.addCommandGroup(o,"orion.New",0,e.New,"orion.commonNavContextMenuEditGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(o,"orion.OpenWith",1001,e.OpenWith,"orion.commonNavContextMenuEditGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(o,"orion.Extensions",1002,e.OpenRelated,"orion.commonNavContextMenuEditGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(o,"orion.ImportGroup",1003,e.Import,"orion.commonNavContextMenuEditGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(o,"orion.ExportGroup",1004,e.Export,"orion.commonNavContextMenuEditGroup",null,null,null,"dropdownSelection"),t.registerCommandContribution(o,"eclipse.newFile",1,"orion.commonNavContextMenuEditGroup/orion.New"),t.registerCommandContribution(o,"eclipse.newFolder",2,"orion.commonNavContextMenuEditGroup/orion.New",!1,null),t.registerCommandContribution(o,"orion.new.project",3,"orion.commonNavContextMenuEditGroup/orion.New"),t.registerCommandContribution(o,"orion.new.linkProject",4,"orion.commonNavContextMenuEditGroup/orion.New"),t.registerCommandContribution(o,"eclipse.renameResource",1,"orion.commonNavContextMenuEditGroup",!1),t.registerCommandContribution(o,"eclipse.cut",2,"orion.commonNavContextMenuEditGroup",!1),t.registerCommandContribution(o,"eclipse.copySelections",3,"orion.commonNavContextMenuEditGroup",!1),t.registerCommandContribution(o,"eclipse.pasteSelections",4,"orion.commonNavContextMenuEditGroup",!1),t.registerCommandContribution(o,"eclipse.deleteFile",5,"orion.commonNavContextMenuEditGroup",!1),t.registerCommandContribution(o,"eclipse.compareWith",6,"orion.commonNavContextMenuEditGroup"),t.registerCommandContribution(o,"eclipse.compareWithEachOther",7,"orion.commonNavContextMenuEditGroup"),t.registerCommandContribution(o,"orion.import",1,"orion.commonNavContextMenuEditGroup/orion.ImportGroup"),t.registerCommandContribution(o,"orion.importZipURL",2,"orion.commonNavContextMenuEditGroup/orion.ImportGroup"),t.registerCommandContribution(o,"orion.importSFTP",3,"orion.commonNavContextMenuEditGroup/orion.ImportGroup"),t.registerCommandContribution(o,"eclipse.downloadSingleFile",1,"orion.commonNavContextMenuEditGroup/orion.ExportGroup"),t.registerCommandContribution(o,"eclipse.downloadFile",2,"orion.commonNavContextMenuEditGroup/orion.ExportGroup"),t.registerCommandContribution(o,"eclipse.exportSFTPCommand",3,"orion.commonNavContextMenuEditGroup/orion.ExportGroup"),t.addCommandGroup(r,"eclipse.openWith",1e3,e.OpenWith,"orion.menuBarViewGroup",null,null,null,"dropdownSelection"),t.addCommandGroup(r,"eclipse.fileCommandExtensions",1e3,e.OpenRelated,"orion.menuBarViewGroup"),d.getOpenWithCommands(t).forEach(function(e){t.registerCommandContribution(r,e.id,1,"orion.menuBarViewGroup/eclipse.openWith"),t.registerCommandContribution(o,e.id,1,"orion.commonNavContextMenuEditGroup/orion.OpenWith")}),d.getFileCommandIds().forEach(function(e){t.registerCommandContribution(r,e,1,"orion.menuBarViewGroup/eclipse.fileCommandExtensions"),t.registerCommandContribution(o,e,1,"orion.commonNavContextMenuEditGroup/orion.Extensions")}),this.preferences.getPreferences("/common-nav").then(function(r){var s=r.get("showNewProjectCommands");if(void 0===s||s){t.addCommandGroup(n,"orion.projectsNewGroup",100,e.Project,"orion.menuBarFileGroup/orion.newContentGroup"),t.addCommandGroup(o,"orion.projectsNewGroup",100,e.Project,"orion.commonNavContextMenuEditGroup/orion.New");var a=0;l.getCreateProjectCommands(t).forEach(function(e){t.registerCommandContribution(n,e.id,a,"orion.menuBarFileGroup/orion.newContentGroup/orion.projectsNewGroup"),t.registerCommandContribution(o,e.id,a,"orion.commonNavContextMenuEditGroup/orion.New/orion.projectsNewGroup"),a++}),t.registerCommandContribution(i,"orion.project.initProject",0,"orion.menuBarEditGroup")}})},updateCommands:function(){var e=this.isCommandsVisible();this.createActionSections();var t=this.commandRegistry,n=this.sidebar.menuBar;n.setActiveExplorer(this),n.updateCommands(),t.registerSelectionService(this.contextMenuActionsScope,e?this.selection:null),this._sidebarContextMenuNode&&this._populateContextMenu(this._sidebarContextMenuNode)},_populateContextMenu:function(e){var t=this.selection,n=t.getSelections(),i=null;this.commandRegistry.destroy(e),(!n||Array.isArray(n)&&!n.length)&&(i=this.treeRoot),this.commandRegistry.renderCommands(this.contextMenuActionsScope,e,i,this,"menu")},_createContextMenu:function(){var e=function(e){var t=this.getNavHandler(),n=this.getNavDict(),i=e.event,r=null;if(i.target){for(var o=i.target;this._parentNode.contains(o);){if("TR"===o.nodeName){var s=o.id;r=n.getValue(s);break}o=o.parentNode}if(r&&!t.isDisabled(r.rowDomNode)){var a=t.getSelection();-1===a.indexOf(r.model)&&(t.cursorOn(r.model,!0,!1,!0),t.setSelection(r.model,!1,!0))}else{var l=void 0===i.offsetX?i.layerX:i.offsetX;l>0&&(this.selection.setSelections(null),t.refreshSelection(!0,!0))}}}.bind(this),t=new g.ContextMenu({dropdown:this._sidebarContextMenuNode,triggerNode:this._parentNode});t.addEventListener("triggered",e),this._contextMenu=t}}),v.prototype=Object.create(C.prototype),t.mixin(v.prototype,{showFolderLinks:!0,oneColumn:!0,createFolderNode:function(e){var t=C.prototype.createFolderNode.call(this,e);return this.showFolderLinks&&"A"===t.tagName?(t.href=w.expand({resource:e.Location}),t.classList.add("commonNavFolder")):t.classList.add("nav_fakelink"),t},rowCallback:function(e,t){C.prototype.rowCallback.call(this,e,t);var n=a.getCutBuffer();if(n){var i=n.some(function(e){return a.isEqualToOrChildOf(t,e)});if(i){var r=this.explorer.getNavHandler();r.disableItem(t)}}},emptyCallback:function(){}}),{CommonNavExplorer:m,CommonNavRenderer:v}}),define("orion/widgets/filesystem/filesystemSwitcher",["i18n!orion/edit/nls/messages","orion/objects","orion/webui/littlelib","orion/i18nUtil","orion/commands","orion/URL-shim"],function(e,t,n,i,r){function o(e){this.commandRegistry=e.commandRegistry,this.rootChangeListener=e.rootChangeListener,this.filesystemChangeDispatcher=e.filesystemChangeDispatcher,this.fileClient=e.fileClient,this.node=e.node,this.serviceRegistry=e.serviceRegistry;var t=this;this.listener=function(e){t.refresh(e.root)},this.rootChangeListener&&this.rootChangeListener.addEventListener("rootChanged",this.listener),this.render()}return t.mixin(o.prototype,{destroy:function(){this.rootChangeListener&&this.rootChangeListener.removeEventListener("rootChanged",this.listener),this.commandRegistry.destroy(this.node),n.empty(this.node),this.rootChangeListener=this.filesystemChangeDispatcher=this.listener=this.node=null},registerCommands:function(){if(!this.commandsRegistered){this.commandsRegistered=!0;var t=this.commandRegistry,n=this.serviceRegistry,i=new r.Command({name:e.ChooseFS,imageClass:"core-sprite-openarrow",selectionClass:"dropdownSelection",tooltip:e.ChooseFSTooltip,id:"orion.nav.switchfs",visibleWhen:function(){return n.getServiceReferences("orion.core.file").length>1},choiceCallback:this._switchFsMenuCallback.bind(this)});t.addCommand(i),t.registerCommandContribution("orion.mininav","orion.nav.switchfs",1)}},_switchFsMenuCallback:function(){var e=this.serviceRegistry,t=this;return e.getServiceReferences("orion.core.file").map(function(e){var n=e.getProperty("top"),i=t._fileServiceLabel(n,!0);return{checked:t.fileSystem===i,name:i,callback:t.setActiveFilesystem.bind(t,n)}})},render:function(){this.fsName=document.createElement("div"),this.fsName.classList.add("filesystemName"),this.fsName.classList.add("layoutLeft"),this.menu=document.createElement("ul"),this.menu.classList.add("filesystemSwitcher"),this.menu.classList.add("commandList"),this.menu.classList.add("layoutRight"),this.menu.classList.add("pageActions"),this.node.appendChild(this.fsName),this.node.appendChild(this.menu),this.registerCommands(),this.fsName.addEventListener("click",this._openMenu.bind(this))},_openMenu:function(){var e=n.$(".dropdownTrigger",this.menu);if(e){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}},_fileServiceHostname:function(e){var t=this.fileClient.fileServiceRootURL(e);0===t.indexOf("filesystem:")&&(t=t.substr("filesystem:".length));var n=t;try{n=new URL(t,window.location.href).hostname}catch(i){}return n},_fileServiceLabel:function(t,r){var o=this.fileClient.fileServiceName(t),s=this._fileServiceHostname(t);if(r)return i.formatMessage(e.FSTitle,o,s);var a=document.createDocumentFragment();return a.textContent=e.FSTitle,n.processDOMNodes(a,[document.createTextNode(o),document.createTextNode(s)]),a},refresh:function(e){var t=e;e.ChildrenLocation&&(t=e.ChildrenLocation),n.empty(this.fsName),this.fileSystem=this._fileServiceLabel(t,!0),this.fsName.appendChild(this._fileServiceLabel(t)),this.commandRegistry.destroy(this.menu),this.commandRegistry.renderCommands("orion.mininav",this.menu,{},"menu")},setActiveFilesystem:function(e){var t=e;e.ChildrenLocation&&(t=e.ChildrenLocation);var n=this.fileClient.fileServiceRootURL(t);this.filesystemChangeDispatcher&&this.filesystemChangeDispatcher.dispatchEvent({type:"filesystemChanged",newInput:n})}}),{FilesystemSwitcher:o}}),define("orion/widgets/nav/mini-nav",["i18n!orion/edit/nls/messages","orion/objects","orion/webui/littlelib","orion/widgets/nav/common-nav","orion/fileCommands","orion/PageUtil","orion/Deferred","orion/widgets/filesystem/filesystemSwitcher","orion/URL-shim"],function(e,t,n,i,r,o,s,a){function l(){h.apply(this,arguments);var e=this.sidebarNavInputManager;if(e){var t=this;this.addEventListener("rootChanged",function(e){t.sidebarNavInputManager.dispatchEvent(e),t.sidebarNavInputManager.dispatchEvent({type:"InputChanged",input:e.root.ChildrenLocation})}),e.setInput=function(e){t.treeRoot&&t.treeRoot.ChildrenLocation!==e&&t.loadRoot(e).then(function(){t.updateCommands();var e=t.editorInputManager.getFileMetadata();t.reveal(e,!1)})}}}function d(){u.apply(this,arguments)}function c(e){this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.parentNode=e.parentNode,this.sidebar=e.sidebar,this.sidebarNavInputManager=e.sidebarNavInputManager,this.toolbarNode=e.toolbarNode,this.serviceRegistry=e.serviceRegistry,this.fsToolbar=null,this.explorer=null,this.lastRoot=null;var t=this;this.sidebarNavInputManager.addEventListener("InputChanged",function(e){t.lastRoot=e.input})}var h=i.CommonNavExplorer,u=i.CommonNavRenderer;return l.prototype=Object.create(h.prototype),t.mixin(l.prototype,{reroot:function(e){return this.scope(""),this.loadRoot(this.fileClient.fileServiceRootURL(e.Location)).then(function(){return this.showItem(e,!1)}.bind(this))}}),d.prototype=Object.create(u.prototype),t.mixin(c.prototype,{label:e.Navigator,create:function(){var e=this;this.explorer=new l({preferences:this.preferences,commandRegistry:this.commandRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,sidebar:this.sidebar,sidebarNavInputManager:this.sidebarNavInputManager,parentId:this.parentNode.id,rendererFactory:function(t){return new d({checkbox:!1,treeTableClass:"miniNavTreeTable",cachePrefix:"MiniNav"},t,e.commandRegistry,e.contentTypeRegistry)},serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode}),this.fsSwitcher=new a.FilesystemSwitcher({commandRegistry:this.commandRegistry,rootChangeListener:this.explorer,filesystemChangeDispatcher:this.explorer.sidebarNavInputManager,fileClient:this.fileClient,node:this.toolbarNode,serviceRegistry:this.serviceRegistry});var t=o.matchResourceParameters(),n=t.navigate,i=t.resource,r=n||this.lastRoot||this.fileClient.fileServiceRootURL(i||"");this.explorer.display(r)},destroy:function(){this.explorer&&(this.explorer.destroy(),this.explorer=null),this.fsSwitcher&&this.fsSwitcher.destroy()}}),c}),define("orion/projectClient",["i18n!orion/navigate/nls/messages","orion/Deferred","orion/extensionCommands"],function(e,t,n){function i(e){try{return e?JSON.parse(e):{}}catch(t){return{__TEXT__:String(e)}}}function r(e,t){this.serviceRegistry=e,this.fileClient=t,this.allProjectHandlersReferences=e.getServiceReferences("orion.project.handler"),this.allProjectDeployReferences=e.getServiceReferences("orion.project.deploy"),this._serviceRegistration=e.registerService("orion.project.client",this),this._launchConfigurationsDir="launchConfigurations"}return r.prototype={_getProjectJsonData:function(e,n,r){for(var o=new t,s=0;s<n.length;s++)if("project.json"===n[s].Name)return this.fileClient.read(n[s].Location).then(function(t){var a=i(t);a.Name=a.Name||e.Name,a.ContentLocation=e.Location,a.WorkspaceLocation=r.Location;var l;r.Children.some(function(t){return t.Location===e.Location?(l=t.Id,!0):!1}),r.Projects&&r.Projects.some(function(e){return e.Id===l?(a.ProjectLocation=e.Location,!0):!1}),a.ProjectJsonLocation=n[s].Location,o.resolve(a)},function(e){o.reject(e)},function(e){o.progress(e)}),o;return o.resolve(null),o},readAllProjects:function(e){var n=new t;if(!e.Children)return n.resolve([]),n;for(var i=[],r=[],o=0;o<e.Children.length;o++){var s=new t;this.readProject(e.Children[o],e).then(s.resolve,function(){this.resolve(null)}.bind(s)),r.push(s),s.then(function(e){e&&i.push(e)})}return t.all(r).then(function(){n.resolve(i)}),n},readProject:function(e,n){function i(e,t,n){if(e.Parents&&e.Parents.length>0){var i=e.Parents[e.Parents.length-1];return i.Children?r._getProjectJsonData.bind(r)(i,i.Children,t).then(n.resolve,n.reject,n.progress):i.ChildrenLocation?this.fileClient.fetchChildren(i.ChildrenLocation).then(function(e){r._getProjectJsonData.bind(r)(i,e,t).then(n.resolve,n.reject,n.progress)},n.reject,n.progress):n.resolve(null),n}return e.Children?(r._getProjectJsonData.bind(r)(e,e.Children,t).then(n.resolve,n.reject,n.progress),n):e.ChildrenLocation?(this.fileClient.fetchChildren(e.ChildrenLocation).then(function(i){r._getProjectJsonData.bind(r)(e,i,t).then(n.resolve,n.reject,n.progress)},n.reject,n.progress),n):(n.resolve(null),n)}var r=this,o=new t;return n?i.call(r,e,n,o):this.fileClient.loadWorkspace().then(function(t){i.call(r,e,t,o)}),o},initProject:function(e,n){var i=this,r=new t;return this.fileClient.createFile(e,"project.json").then(function(t){n?i.fileClient.write(t.Location,JSON.stringify(n)).then(function(){r.resolve({ContentLocation:e,projectMetadata:n})},r.reject,r.progress):r.resolve({fileMetadata:t})},r.reject,r.progress),r},createProject:function(e,n){var i=new t;return this.fileClient.createProject(e,n.Name,n.ContentLocation,!0).then(function(e){delete n.Name,i.resolve(this.initProject(e.ContentLocation,n))}.bind(this),function(e){i.reject(e)},function(e){i.progress(e)}),i},getDependencyFileMetadata:function(e,i){function r(t,n){this.fileClient.fetchChildren(t).then(function(t){for(var i=0;i<t.length;i++)if(t[i].Name===n[0])return void(1===n.length?o.resolve(t[i]):r.bind(s)(t[i].ChildrenLocation,n.splice(1,n.length-1)));o.reject(e.Location+" could not be found in your workspace")},function(e){o.reject(e)})}var o=new t,s=this;if("file"===e.Type){var a=e.Location.split("/");this.fileClient.loadWorkspace(i).then(function(t){for(var n=0;n<t.Children.length;n++)if(t.Children[n].Name===a[0])return void(1===a.length?o.resolve(t.Children[n]):r.bind(s)(t.Children[n].ChildrenLocation,a.splice(1,a.length-1)));o.reject(e.Location+" could not be found in your workspace")},function(e){o.reject(e)})}else{var l=this.getProjectHandler(e.Type);if(null===l)return o.reject(e.Type+" is not supported."),o;var d;l.validationProperties&&(d=n._makeValidator(l,this.serviceRegistry,[])),this.fileClient.loadWorkspace(i).then(function(n){for(var i=[],r=!1,s=0;s<n.Children.length&&r!==!0;s++)if(d&&d.validationFunction(n.Children[s])){var a=l.getDependencyDescription(n.Children[s]);i.push(a),function(t,i){i.then(function(i){i&&i.Location===e.Location&&(r=!0,o.resolve(n.Children[t]))})}(s,a)}t.all(i).then(function(){r||o.reject(e.Name+" could not be found in your workspace")})},o.reject)}return o},addProjectDependency:function(e,n){var r=new t;return this.fileClient.fetchChildren(e.ContentLocation).then(function(t){for(var o=0;o<t.length;o++)if("project.json"===t[o].Name)return void this.fileClient.read(t[o].Location).then(function(s){try{var a=i(s);a.Dependencies||(a.Dependencies=[]);for(var l=0;l<a.Dependencies.length;l++)if(a.Dependencies[l].Location===n.Location)return void r.resolve(a);a.Dependencies.push(n),this.fileClient.write(t[o].Location,JSON.stringify(a)).then(function(){a.ContentLocation=e.ContentLocation,a.Name=e.Name,r.resolve(a)},r.reject),r.resolve(a)}catch(d){r.reject(d)}}.bind(this),r.reject,r.progress)}.bind(this),r.reject),r},removeProjectDependency:function(e,n){var r=new t;return this.fileClient.fetchChildren(e.ContentLocation).then(function(t){for(var o=0;o<t.length;o++)if("project.json"===t[o].Name)return void this.fileClient.read(t[o].Location).then(function(s){try{var a=i(s);a.Dependencies||(a.Dependencies=[]);for(var l=a.Dependencies.length-1;l>=0;l--)a.Dependencies[l].Location===n.Location&&a.Dependencies[l].Type===n.Type&&a.Dependencies.splice(l,1);this.fileClient.write(t[o].Location,JSON.stringify(a)).then(function(){a.ContentLocation=e.ContentLocation,a.Name=e.Name,r.resolve(a)},r.reject)}catch(d){r.reject(d)}}.bind(this),r.reject,r.progress)}.bind(this),r.reject),r},changeProjectProperties:function(e,n){function r(t){this.fileClient.read(t).then(function(r){try{var s=i(r);for(var a in n)s[a]=n[a];this.fileClient.write(t,JSON.stringify(s)).then(function(){s.ContentLocation=e.ContentLocation,s.ProjectJsonLocation=t,s.Name=e.Name,o.resolve(s)},o.reject)}catch(l){o.reject(l)}}.bind(this),o.reject)}if(n){var o=new t;return e.ProjectJsonLocation&&r.bind(this)(e.ProjectJsonLocation),o}},getProjectHandlerTypes:function(){for(var e=[],t=0;t<this.allProjectHandlersReferences.length;t++)e.push(this.allProjectHandlersReferences[t].getProperty("type"));return e},_getProjectDeployService:function(e){var t=this.serviceRegistry.getService(e);return t.id=e.getProperty("id"),t.name=e.getProperty("name"),t.tooltip=e.getProperty("tooltip"),t.parameters=e.getProperty("parameters"),t.optionalParameters=e.getProperty("optionalParameters"),t.validationProperties=e.getProperty("validationProperties"),t.logLocationTemplate=e.getProperty("logLocationTemplate"),t},matchesDeployService:function(e,t){var i=n._makeValidator(t,this.serviceRegistry,[]);return i.validationFunction(e)},getProjectDeployTypes:function(){function e(e,t){var n=e.getProperty("priorityForDefault")||0,i=t.getProperty("priorityForDefault")||0;return n>i?-1:i>n?1:0}for(var t=this.allProjectDeployReferences.sort(e),n=[],i=0;i<t.length;i++)n.push(t[i].getProperty("id"));return n},getProjectDelpoyService:function(e,t){for(var n=0;n<this.allProjectDeployReferences.length;n++)if(this.allProjectDeployReferences[n].getProperty("id")===e)return this._getProjectDeployService(this.allProjectDeployReferences[n]);if(t)for(var n=0;n<this.allProjectDeployReferences.length;n++){var i=this.allProjectDeployReferences[n].getProperty("deployTypes");if(i&&i.some(function(e){return t===e}))return this._getProjectDeployService(this.allProjectDeployReferences[n])}},_getProjectHandlerService:function(e){var t=this.serviceRegistry.getService(e);return t.id=e.getProperty("id"),t.addParameters=e.getProperty("addParameters")||e.getProperty("addParamethers"),t.optionalParameters=e.getProperty("optionalParameters")||e.getProperty("optionalParamethers"),t.addDependencyName=e.getProperty("addDependencyName"),t.addDependencyTooltip=e.getProperty("addDependencyTooltip"),t.type=e.getProperty("type"),t.actionComment=e.getProperty("actionComment"),t.addProjectName=e.getProperty("addProjectName"),t.addProjectTooltip=e.getProperty("addProjectTooltip"),t.validationProperties=e.getProperty("validationProperties"),t},getProjectHandler:function(e){for(var t=0;t<this.allProjectHandlersReferences.length;t++)if(this.allProjectHandlersReferences[t].getProperty("type")===e)return this._getProjectHandlerService(this.allProjectHandlersReferences[t])},getMatchingProjectHandlers:function(e){for(var t=[],i=0;i<this.allProjectHandlersReferences.length;i++){var r=this.allProjectHandlersReferences[i]._properties,o=n._makeValidator(r,this.serviceRegistry,[]);o.validationFunction(e)&&t.push(this._getProjectHandlerService(this.allProjectHandlersReferences[i]))}return t},_getLaunchConfigurationsDir:function(e,n){var i=new t;return e.ContentLocation?this.fileClient.fetchChildren(e.ContentLocation).then(function(t){for(var r=0;r<t.length;r++)if(t[r].Name&&t[r].Name===this._launchConfigurationsDir)return i.resolve(t[r]),i;n?this.fileClient.createFolder(e.ContentLocation,this._launchConfigurationsDir).then(i.resolve,i.reject):i.resolve(null)}.bind(this),i.reject):i.reject(),i},getProjectLaunchConfigurations:function(e){var n=new t;return this._getLaunchConfigurationsDir(e).then(function(i){if(!i)return n.resolve([]),n;if(i.Children){for(var r=[],o=0;o<i.Children.length;o++){var s=new t;r.push(s),function(t){this.fileClient.read(i.Children[o].Location).then(function(n){try{n=JSON.parse(n),n.Name=n.Name||i.Name.replace(".launch",""),n.project=e,t.resolve(n)}catch(r){console.error(r),t.resolve()}}.bind(this),function(e){console.error(e),t.resolve()})}.bind(this)(s)}t.all(r).then(function(e){if(!e||!e.length)return void n.resolve([]);for(var t=e.length-1;t>=0;t--)e[t]||e.splice(t,1);n.resolve(e)},n.reject)}else{var a=arguments.callee.bind(this);this.fileClient.fetchChildren(i.ChildrenLocation).then(function(e){i.Children=e,a(i)}.bind(this),n.reject)}}.bind(this),n.reject),n},saveProjectLaunchConfiguration:function(e,n,i,r,o,s,a,l,d){var c=new t,h=n;h=h.replace(/\ /g," "),h=h.replace(/[^\w\d\s]/g,""),h.indexOf(".launch")<0&&(h+=".launch");var u={Name:n,ServiceId:i,Params:r,Url:o,ManageUrl:s,Path:a};return l&&(u.UrlTitle=l),d&&(u.Type=d),this._getLaunchConfigurationsDir(e,!0).then(function(e){if(e.Children){for(var t=0;t<e.Children.length;t++)if(e.Children[t].Name===h)return void this.fileClient.write(e.Children[t].Location,JSON.stringify(u)).then(function(){c.resolve(u)},c.reject);this.fileClient.createFile(e.Location,h).then(function(e){this.fileClient.write(e.Location,JSON.stringify(u)).then(function(){c.resolve(u)},c.reject)}.bind(this),c.reject)}else{var n=arguments.callee.bind(this);this.fileClient.fetchChildren(e.ChildrenLocation).then(function(t){e.Children=t,n(e)}.bind(this),c.reject)}}.bind(this)),c}},r.prototype.constructor=r,{ProjectClient:r}}),define("orion/widgets/nav/project-nav",["i18n!orion/edit/nls/messages","orion/commands","orion/objects","orion/webui/littlelib","orion/explorers/explorer-table","orion/widgets/nav/common-nav","orion/projectCommands","orion/PageUtil","orion/URITemplate","orion/Deferred","orion/projectClient"],function(e,t,n,i,r,o,s,a,l,d){function c(e,t,n,i,r,o,s,a){this.projectClient=s,this.project=t,this.fileMetadata=a,m.apply(this,arguments)}function h(e){this.projectClient=e.projectClient,f.apply(this,arguments);var t=this;this.dependenciesDisplatcher=s.getDependencyDispatcher(),this.dependneciesListener=function(){t.changedItem.call(t)},this._dependenciesEventTypes=["create","delete"],this._dependenciesEventTypes.forEach(function(e){t.dependenciesDisplatcher.addEventListener(e,t.dependneciesListener)})}function u(){g.apply(this,arguments)}function p(e){function t(e){n.lastCheckedLocation!==e.Location&&(n.lastCheckedLocation=e.Location,e&&e.Directory&&(e.parent&&e.parent.Projects||e.Parents&&0===e.Parents.length)&&n.getProjectJson(e).then(function(t){t&&(n.showViewMode(!0),i.getActiveViewModeId()===n.id?n.explorer.display(e):(n.project=e,i.setViewMode(n.id)))}))}this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.parentNode=e.parentNode,this.sidebarNavInputManager=e.sidebarNavInputManager,this.toolbarNode=e.toolbarNode,this.serviceRegistry=e.serviceRegistry,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.sidebar=e.sidebar,this.explorer=null;var n=this,i=this.sidebar;this.editorInputManager.addEventListener("InputChanged",function(e){t(e.metadata)}),this.sidebarNavInputManager.addEventListener("linkClick",function(e){t(e.item)}),this.sidebarNavInputManager.addEventListener("itemExpanded",function(e){t(e.item)}),this.sidebarNavInputManager.addEventListener("selectionChanged",function(e){if(i.getActiveViewModeId()!==n.id){n.project=null;var t=e.selections&&e.selections.length>0?e.selections[0]:null;if(t){for(;t.parent&&t.parent.parent;)t=t.parent;n.getProjectJson(t).then(function(e){n.project=t,n.showViewMode(!!e)})}else n.showViewMode(!1)}})}var f=o.CommonNavExplorer,g=o.CommonNavRenderer,m=r.FileModel,v=new l("#{,resource,params*}");return c.prototype=Object.create(m.prototype),n.mixin(c.prototype,{processParent:function(e,t){var n=m.prototype.processParent.call(this,e,t);e.Project||(e.Project=this.project);for(var i=0;i<t.length;i++)t[i].Project=this.project;return n},getChildren:function(e,t){if(e.children)return void t(this.processParent(e,e.children));if("Project"===e.type){var i=[];return this.fileMetadata.type="ProjectRoot",i.push(this.fileMetadata),void d.all((e.Dependencies||[]).map(function(t){var r={Dependency:t,Project:e};return i.push(r),this.projectClient.getDependencyFileMetadata(t,e.WorkspaceLocation).then(function(e){n.mixin(r,e)},function(){r.Directory=r.disconnected=!0})}.bind(this))).then(function(){this.processParent(e,i),i.splice(i.indexOf(this.fileMetadata),1),i.splice(0,0,this.fileMetadata),t(i)}.bind(this))}return m.prototype.getChildren.call(this,e,t)},getId:function(e){return"Project"===e.type?e={Location:e.ContentLocation}:e.Dependency&&e.disconnected&&(e=e.Dependency),m.prototype.getId.call(this,e)},hasChildren:function(){return!0}}),h.prototype=Object.create(f.prototype),n.mixin(h.prototype,{onFileModelChange:function(e){var t=e.oldValue,n=e.newValue;return t.ChildrenLocation===this.treeRoot.ContentLocation?void this.sidebarNavInputManager.dispatchEvent({type:"editorInputMoved",parent:n?n.ChildrenLocation||n.ContentLocation:null,newInput:n?n.ChildrenLocation||n.ContentLocation:null}):void f.prototype.onFileModelChange.call(this,e)},display:function(e,t){if(e){this.fileMetadata=e;var n;if(e&&e.Parents&&0===e.Parents.length?n=e:e&&e.Parents&&(n=e.Parents[e.Parents.length-1]),t||!n||n.Location!==this.projectLocation)return this.projectClient.readProject(e).then(function(i){return this.projectLocation=n?n.Location:null,i.type="Project",i.Directory=!0,i.fileMetadata=e,f.prototype.display.call(this,i,t).then(function(){return this.expandItem(e)}.bind(this))}.bind(this))}},loadResourceList:function(e){e&&"object"==typeof e&&(e=e.ChildrenLocation||e.ContentLocation),this.treeRoot&&e===this.treeRoot.ContentLocation?this.display(this.fileMetadata,!0):this.scopeUp()},createModel:function(){return new c(this.registry,this.treeRoot,this.fileClient,this.parentId,this.excludeFiles,this.excludeFolders,this.projectClient,this.fileMetadata)},reroot:function(e){return this.scopeUp(e.Location),(new d).reject()},createDefaultDeployCommand:function(){var n=this;this.deployCommand=new t.Command({name:e.Deploy,tooltip:n.defaultDeployCommand?n.defaultDeployCommand.tooltip?n.defaultDeployCommand.tooltip:n.defaultDeployCommand.name:e.Deploy,id:"orion.project.deploy.default",visibleWhen:function(){return n.defaultDeployCommand&&n.defaultDeployCommand.visibleWhen.apply(n.defaultDeployCommand,arguments)},callback:function(e){return n.defaultDeployCommand.callback(e)}});var i=this.commandRegistry;i.addCommand(this.deployCommand),i.registerCommandContribution(this.additionalActionsScope,this.deployCommand.id,0)
},registerCommands:function(){return f.prototype.registerCommands.call(this).then(function(){var t=this.commandRegistry,n=this.fileActionsScope,i=this.additionalActionsScope;t.registerCommandContribution("dependencyCommands","orion.project.dependency.connect",1),t.registerCommandContribution("dependencyCommands","orion.project.dependency.disconnect",2),t.registerCommandContribution(n,"orion.project.create.readme",5,"orion.menuBarFileGroup/orion.newContentGroup");var r=0;t.addCommandGroup(n,"orion.newDependency",6,e.Dependency,"orion.menuBarFileGroup/orion.newContentGroup"),s.getAddDependencyCommands(t).forEach(function(e){t.registerCommandContribution(n,e.id,r++,"orion.menuBarFileGroup/orion.newContentGroup/orion.newDependency")}),t.addCommandGroup(i,"orion.deployNavGroup",1e3,e["Deploy As"],null,null,null,e["Deploy As"],"dropdownSelection"),this.deployCommands=s.getDeployProjectCommands(t),this.deployCommands&&this.deployCommands.length>0&&(this.defaultDeployCommand=this.deployCommands[0],r=0,this.deployCommands.forEach(function(e){t.registerCommandContribution(i,e.id,r++,"orion.deployNavGroup")})),this.createDefaultDeployCommand()}.bind(this))},updateCommands:function(e){function t(e,t){var n;if(this.launchCommands)for(n=0;n<this.launchCommands.length;n++)this.commandRegistry.unregisterCommandContribution(this.additionalActionsScope,this.launchCommands[n]);this.treeRoot.Project.launchConfigurations=e,this.launchCommands=[],s.updateProjectNavCommands(this.treeRoot,e,this.commandRegistry,this.projectClient,this.fileClient);var i;for(n=0;n<e.length;n++)i="orion.launchConfiguration.deploy."+e[n].ServiceId+e[n].Name,this.launchCommands.push(i),this.commandRegistry.registerCommandContribution(this.additionalActionsScope,i,n+1,"orion.deployNavGroup/orion.deployLaunchConfigurationGroup");var r=s.getDefaultLaunchCommand(this.treeRoot.Project.Name);r&&(this.defaultDeployCommand=this.commandRegistry.findCommand(r)||this.deployCommands[0],this.deployCommand.tooltip=this.defaultDeployCommand.tooltip?this.defaultDeployCommand.tooltip:this.defaultDeployCommand.name),f.prototype.updateCommands.apply(this,t)}this.treeRoot&&this.treeRoot.Project&&"undefined"==typeof this.treeRoot.Project.launchConfigurations?(this.treeRoot.Project.launchConfigurations=[],this.projectClient.getProjectLaunchConfigurations(this.treeRoot.Project).then(function(n){if(t.apply(this,[n,e]),!this.launchConfigurationListener){var i=this;this.launchConfigurationDispatcher=s.getLaunchConfigurationDispatcher(),this.launchConfigurationListener=function(n){if("changedDefault"===n.type){var r=s.getDefaultLaunchCommand(i.treeRoot.Project.Name);return void(r&&(i.defaultDeployCommand=i.commandRegistry.findCommand(r),i.deployCommand.tooltip=i.defaultDeployCommand.tooltip?i.defaultDeployCommand.tooltip:i.defaultDeployCommand.name,f.prototype.updateCommands.apply(i,e)))}i.selection.getSelections(function(e){if(n.oldValue)for(var r=0;r<i.treeRoot.Project.launchConfigurations.length;r++){var o=i.treeRoot.Project.launchConfigurations[r];if(o.Name===n.oldValue.Name&&o.ServiceId===n.oldValue.ServiceId){if(n.newValue)return i.treeRoot.Project.launchConfigurations[r]=n.newValue,void t.apply(i,[i.treeRoot.Project.launchConfigurations,e]);i.treeRoot.Project.launchConfigurations[r].splice(r,1);break}}n.newValue&&i.treeRoot.Project.launchConfigurations.push(n.newValue),t.apply(i,[i.treeRoot.Project.launchConfigurations])})},this._launchConfigurationEventTypes=["create","delete","changedDefault"],this._launchConfigurationEventTypes.forEach(function(e){i.launchConfigurationDispatcher.addEventListener(e,i.launchConfigurationListener)})}}.bind(this),function(t){console.error(t),f.prototype.updateCommands.apply(this,e)}.bind(this))):f.prototype.updateCommands.apply(this,e)},scopeDown:!1,scopeUp:function(){var e=a.matchResourceParameters(),t=e.resource;delete e.navigate,delete e.resource,window.location.href=v.expand({resource:t,params:e}),this.sidebar.setViewMode("nav")},changedItem:function(e,t){return e&&this.model?e.Projects?(new d).resolve():f.prototype.changedItem.call(this,e,t):this.display(this.fileMetadata,!0)},destroy:function(){if(this.launchCommands)for(var e=0;e<this.launchCommands.length;e++)this.commandRegistry.unregisterCommandContribution(this.additionalActionsScope,this.launchCommands[e],"orion.deployNavGroup/orion.deployLaunchConfigurationGroup");var t=this;this._dependenciesEventTypes.forEach(function(e){t.dependenciesDisplatcher.removeEventListener(e,t.dependneciesListener)}),t.launchConfigurationListener&&this._launchConfigurationEventTypes.forEach(function(e){t.launchConfigurationDispatcher.removeEventListener(e,t.launchConfigurationListener)}),f.prototype.destroy.call(this)}}),u.prototype=Object.create(g.prototype),n.mixin(u.prototype,{getCellElement:function(t,n,r){var o=g.prototype.getCellElement.call(this,t,n,r);if((n.Dependency||"ProjectRoot"===n.type)&&0===t){o.className="ProjectRoot"===n.type?"projectNavColumn projectPrimaryNavColumn":"projectNavColumn";var s=i.$(".mainNavColumn",o);s.classList.add("projectInformationNode");var a=n.Dependency?n.Dependency.Name:n.Project?n.Project.Name:n.Name,l=i.$("a",o);if(n.disconnected&&(a+=" "+e.disconnected,l.removeAttribute("href")),i.empty(l),l.appendChild(document.createTextNode(a)),n.Dependency){var d=document.createElement("span");d.className="mainNavColumn",d.style.cssFloat="right",this.explorer.commandRegistry.renderCommands("dependencyCommands",d,n,this,"tool"),o.appendChild(d)}return o}return o}}),n.mixin(p.prototype,{label:e.Project,id:"project",create:function(){var e=this;this.explorer=new h({preferences:this.preferences,commandRegistry:this.commandRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,sidebar:this.sidebar,sidebarNavInputManager:this.sidebarNavInputManager,parentId:this.parentNode.id,projectClient:this.projectClient,rendererFactory:function(t){return new u({checkbox:!1,treeTableClass:"miniNavTreeTable",cachePrefix:"ProjectNav"},t,e.commandRegistry,e.contentTypeRegistry)},serviceRegistry:this.serviceRegistry,toolbarNode:this.toolbarNode}),this.explorer.display(this.project),this.sidebar.hideToolbar()},destroy:function(){this.explorer&&this.explorer.destroy(),this.explorer=null,this.sidebar.showToolbar()},getProjectJson:function(e){function t(e){for(var t=0;t<e.length;t++)if(!e[t].Directory&&"project.json"===e[t].Name)return e[t];return null}var n=new d;return e.Children||e.children?n.resolve(t(e.Children||e.children)):e.ChildrenLocation&&this.fileClient.fetchChildren(e.ChildrenLocation).then(function(i){e.Children=i,n.resolve(t(i))}),n},showViewMode:function(e){var t=this.sidebar,n=!!t.getViewMode(this.id);n!==e&&(e?(t.addViewMode(this.id,this),t.renderViewModeMenu()):(t.removeViewMode(this.id),t.renderViewModeMenu()))}}),p}),define("orion/sidebar",["orion/Deferred","orion/objects","orion/commands","orion/outliner","orion/webui/littlelib","orion/PageUtil","orion/widgets/nav/mini-nav","orion/widgets/nav/project-nav","orion/globalCommands","i18n!orion/edit/nls/messages"],function(e,t,n,i,r,o,s,a,l,d){function c(e){this.params=e,this.preferences=e.preferences,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.fileClient=e.fileClient,this.editorInputManager=e.editorInputManager,this.outlineService=e.outlineService,this.parentNode=r.node(e.parent),this.toolbarNode=r.node(e.toolbar),this.selection=e.selection,this.serviceRegistry=e.serviceRegistry,this.sidebarNavInputManager=e.sidebarNavInputManager,this.menuBar=e.menuBar,this.viewModes={},this.activeViewMode=null,this.switcherScope=e.switcherScope,this.switcherNode=null}return t.mixin(c.prototype,{defaultViewMode:"nav",show:function(){if(!this.created){this.created=!0;var e=this.commandRegistry,t=this.contentTypeRegistry,o=this.fileClient,c=this.editorInputManager,h=this.outlineService,u=this.parentNode,p=this.progressService,f=this.selection,g=this.serviceRegistry,m=this.toolbarNode,v=this.switcherNode=r.node(this.switcherScope),y=new n.Command({name:d.SidePanel,imageClass:"core-sprite-outline",selectionClass:"dropdownSelection",tooltip:d.SidePanelTooltip,id:"orion.sidebar.viewmode",visibleWhen:function(){var e=l.getMainSplitter();return e?!e.splitter.isClosed():!0},choiceCallback:this.viewModeMenuCallback.bind(this)});e.addCommand(y),e.registerCommandContribution(v.id,"orion.sidebar.viewmode",2,"orion.menuBarViewGroup"),this.addViewMode("nav",new s({commandRegistry:e,contentTypeRegistry:t,preferences:this.preferences,fileClient:o,editorInputManager:c,parentNode:u,sidebarNavInputManager:this.sidebarNavInputManager,serviceRegistry:g,toolbarNode:m,sidebar:this})),this.projectViewMode=new a({commandRegistry:e,contentTypeRegistry:t,preferences:this.preferences,fileClient:o,editorInputManager:c,parentNode:u,sidebarNavInputManager:this.sidebarNavInputManager,serviceRegistry:g,toolbarNode:m,sidebar:this}),this.outliner=new i.Outliner({parent:u,toolbar:m,serviceRegistry:g,contentTypeRegistry:t,preferences:this.preferences,outlineService:h,commandService:e,selectionService:f,inputManager:c,progressService:p,sidebar:this}),this.setViewMode(this.defaultViewMode)}},showToolbar:function(){this.toolbarNode.style.display="block",this.parentNode.classList.remove("toolbarTarget-toolbarHidden")},hideToolbar:function(){this.toolbarNode.style.display="none",this.parentNode.classList.add("toolbarTarget-toolbarHidden")},viewModeMenuCallback:function(){var e=this,t=this.getActiveViewModeId();return Object.keys(this.viewModes).map(function(n){var i=e.getViewMode(n);return{checked:n===t,name:i.label||n,callback:e.setViewMode.bind(e,n)}})},getActiveViewModeId:function(){return this.activeViewModeId},addViewMode:function(e,t){if(!e)throw new Error("Invalid id: "+e);if(!t||"object"!=typeof t)throw new Error("Invalid mode: "+t);Object.prototype.hasOwnProperty.call(this.viewModes,e)||(this.viewModes[e]=t)},removeViewMode:function(e){var t=this.getViewMode(e);t&&"function"==typeof t.destroy&&t.destroy(),delete this.viewModes[e]},getViewMode:function(e){return Object.prototype.hasOwnProperty.call(this.viewModes,e)?this.viewModes[e]:null},setViewMode:function(e){var t=this.activeViewMode;t&&"function"==typeof t.destroy&&t.destroy(),this.toolbarNode&&this.commandRegistry.destroy(this.toolbarNode),r.empty(this.parentNode),t=this.activeViewMode=this.getViewMode(e),this.activeViewModeId=t?e:null,t&&"function"==typeof t.create&&t.create()},renderViewModeMenu:function(){var e=this.switcherNode;this.commandRegistry.destroy(e),this.commandRegistry.renderCommands(e.id,e,null,this,"button")}}),c}),define("orion/inputManager",["i18n!orion/edit/nls/messages","orion/explorers/navigatorRenderer","orion/i18nUtil","orion/Deferred","orion/EventTarget","orion/objects","orion/PageUtil"],function(e,t,n,i,r,o,s){function a(e){this._document=e.document||document,this._timeout=e.timeout;for(var t=["keypress","keydown","keyup"],n=function(){this._resetTimer()}.bind(this),i=0;i<t.length;i++){var o=t[i];this._document.addEventListener(o,n,!0)}r.attach(this)}function l(t){var n={Severity:"Error",Message:e.noResponse};if(0===t.status)return n;if(t.responseText){var i=t.responseText;try{var r=JSON.parse(i);n.Severity=r.Severity||n.Severity,n.Message=r.Message||n.Message}catch(o){n.Message=i}}else try{n.Message=JSON.stringify(t)}catch(o){}return n}function d(e,t){return e?(t.Severity||(t=l(t)),void e.setProgressResult(t)):void window.console.log(t)}function c(e){r.attach(this),this.serviceRegistry=e.serviceRegistry,this.statusService=e.statusService,this.fileClient=e.fileClient,this.progressService=e.progressService,this.contentTypeRegistry=e.contentTypeRegistry,this.selection=e.selection,this._input=this._title="",this.dispatcher=null,this._unsavedChanges=[]}return a.prototype={_resetTimer:function(){var e=this._document.defaultView||this._document.parentWindow;this._timer&&(e.clearTimeout(this._timer),this._timer=null),-1!==this._timeout&&(this._timer=e.setTimeout(function(){this.onIdle({type:"Idle"}),this._timer=null,this._resetTimer()}.bind(this),this._timeout))},onIdle:function(e){return this.dispatchEvent(e)},setTimeout:function(e){this._timeout=e,this._resetTimer()}},o.mixin(c.prototype,{_maybeLoadWorkspace:function(e){var t=this.fileClient;return e===t.fileServiceRootURL(e)?t.loadWorkspace(e).then(function(e){return e.Location}):(new i).resolve(e)},_read:function(e){var n=this.cachedMetadata||t.getClickedItem();if(n&&n.Location===e&&n.Parents&&n.Attributes&&n.ETag)return(new i).resolve(n);var r=this.fileClient,o=Array.prototype.slice.call(arguments,1);return this._maybeLoadWorkspace(e).then(function(e){return r.read.apply(r,[e].concat(o))})},load:function(){var t=this.getInput();if(t){var r=this.fileClient,o=this._parsedLocation.resource,s=this.progressService,a=function(e,t,i){return s?s.progress(e,n.formatMessage(t,i)):e},l=this.getEditor();if(this._fileMetadata)this._saving||this._fileMetadata.Directory||this._readonly||a(r.read(o,!0),e.ReadingMetadata,t).then(function(n){this._fileMetadata&&this._fileMetadata.Location===n.Location&&this._fileMetadata.ETag!==n.ETag&&(this._fileMetadata=n,(!l.isDirty()||window.confirm(e.loadOutOfSync))&&a(r.read(o),e.Reading,t).then(function(e){l.setInput(t,null,e),this._unsavedChanges=[]}.bind(this)))}.bind(this));else{var c=o;if(0===c.indexOf("/gitapi/commit/")){var h=c.indexOf("/file"),u=c.indexOf("?",h);-1===u&&(u=c.length),c=c.substring(h,u),this._readonly=!0}var p=window.setTimeout(function(){p=null,this.reportStatus(n.formatMessage(e.Fetching,t))}.bind(this),800),f=function(){this.reportStatus(""),p&&window.clearTimeout(p)}.bind(this),g=function(e){f();var t=null;this.serviceRegistry?t=this.serviceRegistry.getService("orion.page.message"):this.statusService&&(t=this.statusService),d(t,e),this._setNoInput()}.bind(this);this._acceptPatch=null,a(this._read(c,!0),e.ReadingMetadata,c).then(function(s){s?s.Directory?i.when(s.Children||a(r.fetchChildren(s.ChildrenLocation),e.Reading,t),function(e){f(),s.Children=e,this._setInputContents(this._parsedLocation,t,e,s)}.bind(this),g):this._isText(s)?a(r.read(o,!1,!0),e.Reading,t).then(function(e){f(),"string"!=typeof e&&(this._acceptPatch=e.acceptPatch,e=e.result),this._setInputContents(this._parsedLocation,t,e,s)}.bind(this),g):a(r._getService(o).readBlob(o),e.Reading,t).then(function(e){f(),this._setInputContents(this._parsedLocation,t,e,s)}.bind(this),g):g({responseText:n.formatMessage(e.ReadingMetadataError,c)})}.bind(this),g)}}},processParameters:function(e){var t=this.getEditor();t&&t.processParameters&&t.processParameters(e)},getAutoLoadEnabled:function(){return this._autoLoadEnabled},getAutoSaveEnabled:function(){return this._autoSaveEnabled},getEditor:function(){return this.editor},getInput:function(){return this._input},getTitle:function(){return this._title},getFileMetadata:function(){return this._fileMetadata},getReadOnly:function(){var e=this._fileMetadata;return this._readonly||!e||e.Attributes&&e.Attributes.ReadOnly},getContentType:function(){return this._contentType},onFocus:function(){return this._autoSaveEnabled&&this._errorSaving?void this.save():void(this._autoLoadEnabled&&this.load())},onChanging:function(e){if(this._getSaveDiffsEnabled()){var t=this._unsavedChanges.length,n=e.addedCharCount,i=e.removedCharCount,r=e.start,o=e.start+i,s=0;if(0===n?s=-1:0===i&&(s=1),t>0&&s===this.previousChangeType){var a=this._unsavedChanges[t-1];if(0===i&&r===a.end+a.text.length)return void(a.text+=e.text);if(0===e.addedCharCount&&o===a.start)return void(a.start=r)}this.previousChangeType=s,this._unsavedChanges.push({start:r,end:o,text:e.text})}},reportStatus:function(e){this.statusReporter?this.statusReporter(e):this.editor&&this.editor.reportStatus(e)},save:function(){function t(t){s===_.getInput()&&(_.getFileMetadata().ETag=t.ETag,r.setInput(s,null,a,!0)),_.reportStatus(""),o&&y&&y.setProgressResult({Message:e.Saved,Severity:"Normal"}),_.afterSave&&_.afterSave(),_._saving=!1}function i(e){_.reportStatus(""),d(y,e),_._saving=!1,_._errorSaving=!0}if(!this._saving){var r=this.getEditor();if(r&&r.isDirty()&&!this.getReadOnly()){var o=this._errorSaving;this._saving=!0;var s=this.getInput();this.reportStatus(e["Saving..."]),this.dispatchEvent({type:"Saving",inputManager:this}),r.markClean();var a=r.getText(),l=a;if(this._getSaveDiffsEnabled()&&!this._errorSaving){for(var c=this._unsavedChanges,h=0,u=0;u<c.length;u++)h+=c[u].text.length;a.length>h&&(l={diff:c})}this._unsavedChanges=[],this._errorSaving=!1;var p=this.getFileMetadata().ETag,f={ETag:p},g=this._parsedLocation.resource,m=this.fileClient.write(g,l,f),v=this.progressService,y=null;this.serviceRegistry&&(y=this.serviceRegistry.getService("orion.page.message")),v&&(m=v.progress(m,n.formatMessage(e.savingFile,s)));var _=this;m.then(t,function(r){if(412===r.status){var o=window.confirm(e.saveOutOfSync);if(o){var l=_.fileClient.write(g,a);v&&(l=v.progress(l,n.formatMessage(e.savingFile,s))),l.then(t,i)}else _._saving=!1}else i(r)})}}},setAutoLoadEnabled:function(e){this._autoLoadEnabled=e},setAutoSaveTimeout:function(e){if(this._autoSaveEnabled=-1!==e,this._idle)this._idle.setTimeout(e);else{var t={document:document,timeout:e};this._idle=new a(t),this._idle.addEventListener("Idle",function(){this._errorSaving||this.save()}.bind(this))}},setContentType:function(e){this._contentType=e},setInput:function(t){if(!this._ignoreInput&&(t||(t=s.hash()),"string"==typeof t)){var n=this.getEditor();t&&"#"!==t[0]&&(t="#"+t);var i=s.matchResourceParameters(t),r=this._parsedLocation||{};if(n&&n.isDirty()){var o=this._location,a=r.resource,l=i.resource;if(a!==l)if(this._autoSaveEnabled)this.save();else if(!window.confirm(e.confirmUnsavedChanges))return void(window.location.hash=o)}var d=n&&r.editor!==i.editor;this._location=t,this._parsedLocation=i,this._ignoreInput=!0,this.selection&&this.selection.setSelections(t),this._ignoreInput=!1;var c=i.resource;c?c===this._input?d?(this.reportStatus(""),this._setInputContents(i,c,null,this._fileMetadata,this._isText(this._fileMetadata))):this.processParameters(i):(this._input=c,this._readonly=!1,this._fileMetadata=null,this.load()):this._setNoInput(!0)}},setTitle:function(e){var t=e.lastIndexOf("/"),n=e;-1!==t&&(n=n.substring(t+1)),this._title=n},setSaveDiffsEnabled:function(e){this._saveDiffsEnabled=e},_getSaveDiffsEnabled:function(){return this._saveDiffsEnabled&&null!==this._acceptPatch&&-1!==this._acceptPatch.indexOf("application/json-patch")},_unknownContentTypeAsText:function(){return!0},_isText:function(e){var t=this.contentTypeRegistry.getFileContentType(e);if(!t)return this._unknownContentTypeAsText();var n=this.contentTypeRegistry.getContentType("text/plain");return this.contentTypeRegistry.isExtensionOf(t,n)},_setNoInput:function(e){return e?void this.fileClient.loadWorkspace("").then(function(e){this._input=e.ChildrenLocation,this._setInputContents(e.ChildrenLocation,null,e,e)}.bind(this)):(this._input=this._title=this._fileMetadata=null,this.setContentType(null),void this.dispatchEvent({type:"InputChanged",input:null}))},_setInputContents:function(e,t,n,i,r){var o,s=!1;i?(this._fileMetadata=i,this.setTitle(i.Location||String(i)),this.setContentType(this.contentTypeRegistry.getFileContentType(i)),o=i.Name,s=i.Directory):(this._fileMetadata=null,this.setTitle(t),this.setContentType(this.contentTypeRegistry.getFilenameContentType(this.getTitle())),o=this.getTitle());var a=this.getEditor();this._focusListener&&(a&&a.getTextView&&a.getTextView()&&a.getTextView().removeEventListener("Focus",this._focusListener),this._focusListener=null),this._changingListener&&(a&&a.getModel&&a.getModel()&&a.getModel().removeEventListener("Changing",this._changingListener),this._changingListener=null);var l={type:"InputChanged",input:e,name:o,title:t,contentType:this.getContentType(),metadata:i,location:window.location,contents:n};this.dispatchEvent(l),this.editor=a=l.editor,s||(a&&a.getModel&&a.getModel()&&a.getModel().addEventListener("Changing",this._changingListener=this.onChanging.bind(this)),r||a.setInput(t,null,n),a&&a.getTextView&&a.getTextView()&&a.getTextView().addEventListener("Focus",this._focusListener=this.onFocus.bind(this)),this._unsavedChanges=[],this.processParameters(e))}}),{handleError:d,InputManager:c}}),define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(e,t,n){function i(e,t){this._lastLineIndex=-1,this._text=[""],this._lineOffsets=[0],this.setText(e),this.setLineDelimiter(t)}return i.prototype={destroy:function(){},find:function(e){this._text.length>1&&(this._text=[this._text.join("")]);var n=e.string,i=e.regex,r=n,o="",s=e.caseInsensitive;if(r)if(i){var a=t.parse(r);a&&(r=a.pattern,o=a.flags)}else r=n.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$&"),s&&(r=r.replace(/[iI\u0130\u0131]/g,"[Iiİı]"));var l,d=null;if(r){var c=e.reverse,h=e.wrap,u=e.wholeWord,p=e.start||0,f=e.end,g=null!==f&&void 0!==f;-1===o.indexOf("g")&&(o+="g"),-1===o.indexOf("m")&&(o+="m"),s&&-1===o.indexOf("i")&&(o+="i"),u&&(r="\\b"+r+"\\b");var m,v,y=this._text[0],_=0;if(g){var C=f>p?p:f,w=f>p?f:p;y=y.substring(C,w),_=C}var b=new RegExp(r,o);c?l=function(){var e=null;for(b.lastIndex=0;;){if(v=b.lastIndex,m=b.exec(y),v===b.lastIndex)return null;if(!m)break;if(m.index+_<p)e={start:m.index+_,end:b.lastIndex+_};else{if(!h||e)break;p=y.length+_,e={start:m.index+_,end:b.lastIndex+_}}}return e&&(p=e.start),e}:(g||(b.lastIndex=p),l=function(){for(;;){if(v=b.lastIndex,m=b.exec(y),v===b.lastIndex)return null;if(m)return{start:m.index+_,end:b.lastIndex+_};if(0===v||!h)break}return null}),d=l()}return{next:function(){var e=d;return e&&(d=l()),e},hasNext:function(){return null!==d}}},getCharCount:function(){for(var e=0,t=0;t<this._text.length;t++)e+=this._text[t].length;return e},getLine:function(e,t){var n=this.getLineCount();if(!(e>=0&&n>e))return null;var i=this._lineOffsets[e];if(n>e+1){var r=this.getText(i,this._lineOffsets[e+1]);if(t)return r;for(var o,s=r.length;10===(o=r.charCodeAt(s-1))||13===o;)s--;return r.substring(0,s)}return this.getText(i)},getLineAtOffset:function(e){var t=this.getCharCount();if(!(e>=0&&t>=e))return-1;var n=this.getLineCount();if(e===t)return n-1;var i,r,o=this._lastLineIndex;if(o>=0&&n>o&&(i=this._lineOffsets[o],r=n>o+1?this._lineOffsets[o+1]:t,e>=i&&r>e))return o;for(var s=n,a=-1;s-a>1;)if(o=Math.floor((s+a)/2),i=this._lineOffsets[o],r=n>o+1?this._lineOffsets[o+1]:t,i>=e)s=o;else{if(r>e){s=o;break}a=o}return this._lastLineIndex=s,s},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(e,t){var n=this.getLineCount();if(!(e>=0&&n>e))return-1;if(n>e+1){var i=this._lineOffsets[e+1];if(t)return i;for(var r,o=this.getText(Math.max(this._lineOffsets[e],i-2),i),s=o.length;10===(r=o.charCodeAt(s-1))||13===r;)s--;return i-(o.length-s)}return this.getCharCount()},getLineStart:function(e){return e>=0&&e<this.getLineCount()?this._lineOffsets[e]:-1},getText:function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=this.getCharCount()),e===t)return"";for(var n,i=0,r=0;r<this._text.length&&(n=this._text[r].length,!(i+n>=e));)i+=n,r++;for(var o=i,s=r;r<this._text.length&&(n=this._text[r].length,!(i+n>=t));)i+=n,r++;var a=i,l=r;if(s===l)return this._text[s].substring(e-o,t-a);var d=this._text[s].substring(e-o),c=this._text[l].substring(0,t-a);return d+this._text.slice(s+1,l).join("")+c},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e,t){if("auto"===e&&(e=void 0,this.getLineCount()>1&&(e=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0)))),this._lineDelimiter=e?e:n.platformDelimiter,t){var i=this.getLineCount();if(i>1){for(var r=new Array(i),o=0;i>o;o++)r[o]=this.getLine(o);this.setText(r.join(this._lineDelimiter))}}},setText:function(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=this.getCharCount()),t!==n||""!==e){for(var i=this.getLineAtOffset(t),r=this.getLineAtOffset(n),o=t,s=n-t,a=r-i,l=e.length,d=0,c=this.getLineCount(),h=0,u=0,p=0,f=[];;){if(-1!==h&&p>=h&&(h=e.indexOf("\r",p)),-1!==u&&p>=u&&(u=e.indexOf("\n",p)),-1===u&&-1===h)break;p=-1!==h&&-1!==u?h+1===u?u+1:(u>h?h:u)+1:-1!==h?h+1:u+1,f.push(t+p),d++}var g={type:"Changing",text:e,start:o,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:d};if(this.onChanging(g),0===f.length){var m,v=this.getLineStart(i);m=c>r+1?this.getLineStart(r+1):this.getCharCount(),t!==v&&(e=this.getText(v,t)+e,t=v),n!==m&&(e+=this.getText(n,m),n=m)}for(var y=l-s,_=i+a+1;c>_;_++)this._lineOffsets[_]+=y;var C,w=5e4,b=w;if(f.length<b)C=[i+1,a].concat(f),Array.prototype.splice.apply(this._lineOffsets,C);else{p=i+1,this._lineOffsets.splice(p,a);for(var x=0;x<f.length;x+=b)C=[p,0].concat(f.slice(x,Math.min(f.length,x+b))),Array.prototype.splice.apply(this._lineOffsets,C),p+=b}for(var S,L=0,E=0;E<this._text.length&&(S=this._text[E].length,!(L+S>=t));)L+=S,E++;for(var k=L,T=E;E<this._text.length&&(S=this._text[E].length,!(L+S>=n));)L+=S,E++;var A=L,N=E,M=this._text[T],I=this._text[N],D=M.substring(0,t-k),R=I.substring(n-A),P=[T,N-T+1];D&&P.push(D),e&&P.push(e),R&&P.push(R),Array.prototype.splice.apply(this._text,P),0===this._text.length&&(this._text=[""]);var O={type:"Changed",start:o,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:d};this.onChanged(O)}}},e.EventTarget.addMixin(i.prototype),{TextModel:i}}),define("orion/editor/undoStack",[],function(){function e(e,t,n,i,r){this.model=e,this.offset=t,this.text=n,this.previousText=i,this.type=r}function t(e){this.owner=e,this.changes=[]}function n(e,t){this.size=void 0!==t?t:100,this.reset();var n=this;if(this._listener={onChanging:function(e){n._onChanging(e)},onDestroy:function(e){n._onDestroy(e)}},e.getModel){var i=e.getModel();i.getBaseModel&&(i=i.getBaseModel()),this.model=i,this.setView(e)}else this.shared=!0,this.model=e;this.model.addEventListener("Changing",this._listener.onChanging)}return e.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(e,t){return this._doUndoRedo(this.offset,this.previousText,this.text,e,t),!0},redo:function(e,t){return this._doUndoRedo(this.offset,this.text,this.previousText,e,t),!0},merge:function(e,t,n,i,r){if(i===this.type){if(1===i&&e===this.offset+this.text.length)return this.text+=t,!0;if(-1===i&&r===this.offset)return this.offset=e,this.previousText=n+this.previousText,!0;if(-1===i&&e===this.offset)return this.previousText=this.previousText+n,!0}return!1},_doUndoRedo:function(e,t,n,i,r){if(this.model.setText(t,e,e+n.length),r&&i){var o=i.getModel();o!==this.model&&(e=o.mapOffset(e,!0)),i.setSelection(e,e+t.length)}}},t.prototype={getRedoChanges:function(){for(var e=[],t=0;t<this.changes.length;t++)e=e.concat(this.changes[t].getRedoChanges());return e},getUndoChanges:function(){for(var e=[],t=this.changes.length-1;t>=0;t--)e=e.concat(this.changes[t].getUndoChanges());return e},add:function(e){this.changes.push(e)},end:function(e){e&&(this.endSelection=e.getSelection(),this.endCaret=e.getCaretOffset());var t=this.owner;t&&t.end&&t.end()},undo:function(e,t){this.changes.length>1&&e&&e.setRedraw(!1);for(var n=this.changes.length-1;n>=0;n--)this.changes[n].undo(e,!1);if(this.changes.length>1&&e&&e.setRedraw(!0),t&&e){var i=this.startSelection.start,r=this.startSelection.end;e.setSelection(this.startCaret?i:r,this.startCaret?r:i)}var o=this.owner;return o&&o.undo&&o.undo(),this.changes.length>0},redo:function(e,t){this.changes.length>1&&e&&e.setRedraw(!1);for(var n=0;n<this.changes.length;n++)this.changes[n].redo(e,!1);if(this.changes.length>1,e&&e.setRedraw(!0),t&&e){var i=this.endSelection.start,r=this.endSelection.end;e.setSelection(this.endCaret?i:r,this.endCaret?r:i)}var o=this.owner;return o&&o.redo&&o.redo(),this.changes.length>0},merge:function(e,t,n,i,r){var o=this.changes.length;return o>0?this.changes[o-1].merge(e,t,n,i,r):!1},start:function(e){e&&(this.startSelection=e.getSelection(),this.startCaret=e.getCaretOffset());var t=this.owner;t&&t.start&&t.start()}},n.prototype={destroy:function(){this._onDestroy()},add:function(e){if(this.compoundChange)this.compoundChange.add(e);else{var t=this.stack.length;this.stack.splice(this.index,t-this.index,e),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--)}},markClean:function(){this._commitUndo(),this.cleanChange=this.stack[this.index-1],this.cleanChange&&(this.cleanChange.type=2)},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return this.index>0},canRedo:function(){return this.stack.length-this.index>0},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view),this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var e=[],t=this.index;t<this.stack.length;t++)e=e.concat(this.stack[t].getRedoChanges());return e},getUndoChanges:function(){this._commitUndo();for(var e=[],t=this.index;t>=0;t--)e=e.concat(this.stack[t].getUndoChanges());return e},undo:function(){this._commitUndo();var e,t=!1;this._ignoreUndo=!0;do{if(this.index<=0)break;e=this.stack[--this.index]}while(!(t=e.undo(this.view,!0)));return this._ignoreUndo=!1,t},redo:function(){this._commitUndo();var e,t=!1;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;e=this.stack[this.index++]}while(!(t=e.redo(this.view,!0)));return this._ignoreUndo=!1,!0},reset:function(){this.index=0,this.cleanChange=void 0,this.stack=[],this._ignoreUndo=!1,this._compoundChange=void 0},setView:function(e){this.view!==e&&(this.view&&e.removeEventListener("Destroy",this._listener.onDestroy),this.view=e,this.view&&e.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(e){this._commitUndo();var n=new t(e);return this.add(n),this.compoundChange=n,this.compoundChange.start(this.view),this.compoundChange},_commitUndo:function(){this.endCompoundChange()},_onDestroy:function(e){e&&this.shared||this.model.removeEventListener("Changing",this._listener.onChanging),this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(t){if(!this._ignoreUndo){var n=t.text,i=t.start,r=t.addedCharCount,o=t.removedCharCount,s=i+o,a=0;0===r&&1===o?a=-1:1===r&&0===o&&(a=1);var l=this.stack.length,d=this.model.getText(i,s);if(l>0&&this.index===l){var c=this.stack[l-1];if(c.merge(i,n,d,a,s))return}this.add(new e(this.model,i,n,d,a))}}},{UndoStack:n}}),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||l.defaults,this.rules=d.normal,this.options.gfm&&(this.rules=this.options.tables?d.tables:d.gfm)}function t(e,t){if(this.options=t||l.defaults,this.links=e,this.rules=c.normal,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.rules=this.options.breaks?c.breaks:c.gfm:this.options.pedantic&&(this.rules=c.pedantic)}function n(e){try{var t=e.replace(/&([#\w]+);/g,function(e,t){if(t=t.toLowerCase(),"colon"===t)return":";if("#"===t.charAt(0)){var n="x"===t.charAt(1)?parseInt(t.substring(2),16):parseInt(t.substring(1),10);return String.fromCharCode(n)}return""}),n=decodeURIComponent(t).replace(/[^\w:]/g,"").toLowerCase();if(0===n.indexOf("javascript:"))return""}catch(i){return""}return e}function i(e){this.tokens=[],this.token=null,this.options=e||l.defaults}function r(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function o(e,t){return e=e.source,t=t||"",function n(i,r){return i?(r=r.source||r,r=r.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(i,r),n):new RegExp(e,t)}}function s(){}function a(e){for(var t,n,i=1;i<arguments.length;i++){t=arguments[i];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])
}return e}function l(t,n,o){if(o||"function"==typeof n){o||(o=n,n=null),n&&(n=a({},l.defaults,n));var s,d,c=n.highlight,h=0;try{s=e.lex(t,n)}catch(u){return o(u)}d=s.length;var p=function(e){var t,r;e!==!0&&delete n.highlight;try{t=i.parse(s,n)}catch(a){r=a}return n.highlight=c,r?o(r):o(null,t)};if(!c||c.length<3)return p(!0);if(!d)return p();for(;h<s.length;h++)!function(e){return"code"!==e.type?--d||p():c(e.text,e.lang,function(t,n){return null==n||n===e.text?--d||p():(e.text=n,e.escaped=!0,void(--d||p()))})}(s[h])}else try{return n&&(n=a({},l.defaults,n)),i.parse(e.lex(t,n),n)}catch(u){if(u.message+="\nPlease report this to https://github.com/chjj/marked.",(n||l.defaults).silent)return"<p>An error occured:</p><pre>"+r(u.message+"",!0)+"</pre>";throw u}}var d={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:s,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:s,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:s,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};d.bullet=/(?:[*+-]|\d+\.)/,d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,d.item=o(d.item,"gm")(/bull/g,d.bullet)(),d.list=o(d.list)(/bull/g,d.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",d.html=o(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)(),d.paragraph=o(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)(),d.normal=a({},d),d.gfm=a({},d.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),d.gfm.paragraph=o(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|")(),d.tables=a({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=d,e.lex=function(t,n){var i=new e(n);return i.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t){for(var n,i,r,o,s,a,l,c,h,e=e.replace(/^ +$/gm,"");e;)if((r=this.rules.newline.exec(e))&&(e=e.substring(r[0].length),r[0].length>1&&this.tokens.push({type:"space"})),r=this.rules.code.exec(e))e=e.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?r:r.replace(/\n+$/,"")});else if(r=this.rules.fences.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"code",lang:r[2],text:r[3]});else if(r=this.rules.heading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:r[1].length,text:r[2],style:"atx"});else if(t&&(r=this.rules.nptable.exec(e))){for(e=e.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].split(/ *\| */);this.tokens.push(a)}else if(r=this.rules.lheading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:"="===r[2]?1:2,text:r[1],style:"setext"});else if(r=this.rules.hr.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"hr"});else if(r=this.rules.blockquote.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,t),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(e)){for(e=e.substring(r[0].length),o=r[2],this.tokens.push({type:"list_start",ordered:o.length>1}),r=r[0].match(this.rules.item),n=!1,h=r.length,c=0;h>c;c++)a=r[c],l=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(l-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&c!==h-1&&(s=d.bullet.exec(r[c+1])[0],o===s||o.length>1&&s.length>1||(e=r.slice(c+1).join("\n")+e,c=h-1)),i=n||/\n\n(?!\s*$)/.test(a),c!==h-1&&(n="\n"===a[a.length-1],i||(i=n)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(r=this.rules.html.exec(e))e=e.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===r[1]||"script"===r[1],text:r[0]});else if(t&&(r=this.rules.def.exec(e)))e=e.substring(r[0].length),this.tokens.links[r[1].toLowerCase()]={href:r[2],title:r[3]};else if(t&&(r=this.rules.table.exec(e))){for(e=e.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<a.align.length;c++)a.align[c]=/^ *-+: *$/.test(a.align[c])?"right":/^ *:-+: *$/.test(a.align[c])?"center":/^ *:-+ *$/.test(a.align[c])?"left":null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a)}else if(t&&(r=this.rules.paragraph.exec(e)))e=e.substring(r[0].length),this.tokens.push({type:"paragraph",text:"\n"===r[1][r[1].length-1]?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"text",text:r[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var c={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:s,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:s,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};c._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/,c._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,c.link=o(c.link)("inside",c._inside)("href",c._href)(),c.reflink=o(c.reflink)("inside",c._inside)(),c.normal=a({},c),c.pedantic=a({},c.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),c.gfm=a({},c.normal,{escape:o(c.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:o(c.text)("]|","~]|")("|","|https?://|")()}),c.breaks=a({},c.gfm,{br:o(c.br)("{2,}","*")(),text:o(c.gfm.text)("{2,}","*")()}),t.rules=c,t.output=function(e,n,i){var r=new t(n,i);return r.output(e)},t.prototype.output=function(e){for(var t,i,o,s,a="";e;)if(s=this.rules.escape.exec(e))e=e.substring(s[0].length),a+=s[1];else if(s=this.rules.autolink.exec(e))e=e.substring(s[0].length),"@"===s[2]?(i=this.mangle(":"===s[1][6]?s[1].substring(7):s[1]),o=this.mangle("mailto:")+i):(i=r(s[1]),o=i),a+='<a href="'+o+'">'+i+"</a>";else if(s=this.rules.url.exec(e))e=e.substring(s[0].length),i=r(s[1]),o=i,a+=n(o);else if(s=this.rules.tag.exec(e))e=e.substring(s[0].length),a+=this.options.sanitize?r(s[0]):s[0];else if(s=this.rules.link.exec(e))e=e.substring(s[0].length),a+=this.outputLink(s,{href:this.options.sanitize?n(s[2]):s[2],title:s[3]});else if((s=this.rules.reflink.exec(e))||(s=this.rules.nolink.exec(e))){if(e=e.substring(s[0].length),t=(s[2]||s[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){a+=s[0][0],e=s[0].substring(1)+e;continue}this.options.sanitize&&(t.href=n(t.href)),a+=this.outputLink(s,t)}else if(s=this.rules.strong.exec(e))e=e.substring(s[0].length),a+="<strong>"+this.output(s[2]||s[1])+"</strong>";else if(s=this.rules.em.exec(e))e=e.substring(s[0].length),a+="<em>"+this.output(s[2]||s[1])+"</em>";else if(s=this.rules.code.exec(e))e=e.substring(s[0].length),a+="<code>"+r(s[2],!0)+"</code>";else if(s=this.rules.br.exec(e))e=e.substring(s[0].length),a+="<br>";else if(s=this.rules.del.exec(e))e=e.substring(s[0].length),a+="<del>"+this.output(s[1])+"</del>";else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),a+=r(this.smartypants(s[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return a},t.prototype.outputLink=function(e,t){return"!"!==e[0][0]?'<a href="'+r(t.href)+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"+this.output(e[1])+"</a>":'<img src="'+r(t.href)+'" alt="'+r(e[1])+'"'+(t.title?' title="'+r(t.title)+'"':"")+">"},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/'([^']*)'/g,"‘$1’").replace(/"([^"]*)"/g,"“$1”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t,n="",i=e.length,r=0;i>r;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},i.parse=function(e,t){var n=new i(t);return n.parse(e)},i.prototype.parse=function(e){this.inline=new t(e.links,this.options),this.tokens=e.reverse();for(var n="";this.next();)n+=this.tok();return n},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var e=this.options.highlight(this.token.text,this.token.lang);null!=e&&e!==this.token.text&&(this.token.escaped=!0,this.token.text=e)}return this.token.escaped||(this.token.text=r(this.token.text,!0)),"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+r(this.token.lang)+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var t,n,i,o,s,a="";for(a+="<thead>\n<tr>\n",n=0;n<this.token.header.length;n++)t=this.inline.output(this.token.header[n]),a+=this.token.align[n]?'<th align="'+this.token.align[n]+'">'+t+"</th>\n":"<th>"+t+"</th>\n";for(a+="</tr>\n</thead>\n",a+="<tbody>\n",n=0;n<this.token.cells.length;n++){for(i=this.token.cells[n],a+="<tr>\n",s=0;s<i.length;s++)o=this.inline.output(i[s]),a+=this.token.align[s]?'<td align="'+this.token.align[s]+'">'+o+"</td>\n":"<td>"+o+"</td>\n";a+="</tr>\n"}return a+="</tbody>\n","<table>\n"+a+"</table>\n";case"blockquote_start":for(var a="";"blockquote_end"!==this.next().type;)a+=this.tok();return"<blockquote>\n"+a+"</blockquote>\n";case"list_start":for(var l=this.token.ordered?"ol":"ul",a="";"list_end"!==this.next().type;)a+=this.tok();return"<"+l+">\n"+a+"</"+l+">\n";case"list_item_start":for(var a="";"list_item_end"!==this.next().type;)a+="text"===this.token.type?this.parseText():this.tok();return"<li>"+a+"</li>\n";case"loose_item_start":for(var a="";"list_item_end"!==this.next().type;)a+=this.tok();return"<li>"+a+"</li>\n";case"html":return this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}},s.exec=s,l.options=l.setOptions=function(e){return a(l.defaults,e),l},l.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1},l.Parser=i,l.parser=i.parse,l.Lexer=e,l.lexer=e.lex,l.InlineLexer=t,l.inlineLexer=t.output,l.parse=l,"object"==typeof exports?module.exports=l:"function"==typeof define&&define.amd?define("marked/marked",[],function(){return l}):this.marked=l}.call(function(){return this||("undefined"!=typeof window?window:global)}()),define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(e,t){function n(e){e&&(this._view=e,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function i(e){n.call(this,e)}return n.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(e){for(var t=[],n=this._keyBindings,i=0;i<n.length;i++)n[i].actionID===e&&t.push(n[i].keyBinding);return t},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(e){if("keydown"===e.type)switch(e.keyCode){case 16:case 17:case 18:case 91:return void 0}for(var t=this._keyBindingIndex,n=this._matchingKeyBindings||this._keyBindings,i=[],r=0;r<n.length;r++){var o=n[r],s=o.keyBinding,a=s.match(e,t);if(a===!0)return this._keyBindingIndex=0,this._matchingKeyBindings=null,o.actionID;"number"==typeof a&&i.push(o)}return 0!==i.length?(this._keyBindingIndex++,this._matchingKeyBindings=i,"noop"):(this._keyBindingIndex=0,void(this._matchingKeyBindings=null))},setKeyBinding:function(e,t){for(var n=this._keyBindings,i=0;i<n.length;i++){var r=n[i];if(r.keyBinding.equals(e))return void(t?r.actionID=t:r.predefined?r.actionID="noop":n.splice(i,1))}t&&n.push({keyBinding:e,actionID:t})},setView:function(e){this._view=e}},i.prototype=new n,i.prototype.createKeyBindings=function(){var n=e.KeyBinding,i=[];if(i.push({actionID:"lineUp",keyBinding:new n(38),predefined:!0}),i.push({actionID:"lineDown",keyBinding:new n(40),predefined:!0}),i.push({actionID:"charPrevious",keyBinding:new n(37),predefined:!0}),i.push({actionID:"charNext",keyBinding:new n(39),predefined:!0}),t.isMac?(i.push({actionID:"scrollPageUp",keyBinding:new n(33),predefined:!0}),i.push({actionID:"scrollPageDown",keyBinding:new n(34),predefined:!0}),i.push({actionID:"pageUp",keyBinding:new n(33,null,null,!0),predefined:!0}),i.push({actionID:"pageDown",keyBinding:new n(34,null,null,!0),predefined:!0}),i.push({actionID:"lineStart",keyBinding:new n(37,!0),predefined:!0}),i.push({actionID:"lineEnd",keyBinding:new n(39,!0),predefined:!0}),i.push({actionID:"wordPrevious",keyBinding:new n(37,null,null,!0),predefined:!0}),i.push({actionID:"wordNext",keyBinding:new n(39,null,null,!0),predefined:!0}),i.push({actionID:"scrollTextStart",keyBinding:new n(36),predefined:!0}),i.push({actionID:"scrollTextEnd",keyBinding:new n(35),predefined:!0}),i.push({actionID:"textStart",keyBinding:new n(38,!0),predefined:!0}),i.push({actionID:"textEnd",keyBinding:new n(40,!0),predefined:!0}),i.push({actionID:"scrollPageUp",keyBinding:new n(38,null,null,null,!0),predefined:!0}),i.push({actionID:"scrollPageDown",keyBinding:new n(40,null,null,null,!0),predefined:!0}),i.push({actionID:"lineStart",keyBinding:new n(37,null,null,null,!0),predefined:!0}),i.push({actionID:"lineEnd",keyBinding:new n(39,null,null,null,!0),predefined:!0}),i.push({actionID:"lineStart",keyBinding:new n(38,null,null,!0),predefined:!0}),i.push({actionID:"lineEnd",keyBinding:new n(40,null,null,!0),predefined:!0})):(i.push({actionID:"pageUp",keyBinding:new n(33),predefined:!0}),i.push({actionID:"pageDown",keyBinding:new n(34),predefined:!0}),i.push({actionID:"lineStart",keyBinding:new n(36),predefined:!0}),i.push({actionID:"lineEnd",keyBinding:new n(35),predefined:!0}),i.push({actionID:"wordPrevious",keyBinding:new n(37,!0),predefined:!0}),i.push({actionID:"wordNext",keyBinding:new n(39,!0),predefined:!0}),i.push({actionID:"textStart",keyBinding:new n(36,!0),predefined:!0}),i.push({actionID:"textEnd",keyBinding:new n(35,!0),predefined:!0})),t.isFirefox&&t.isLinux&&(i.push({actionID:"lineUp",keyBinding:new n(38,!0),predefined:!0}),i.push({actionID:"lineDown",keyBinding:new n(40,!0),predefined:!0})),t.isWindows&&(i.push({actionID:"scrollLineUp",keyBinding:new n(38,!0),predefined:!0}),i.push({actionID:"scrollLineDown",keyBinding:new n(40,!0),predefined:!0})),i.push({actionID:"selectLineUp",keyBinding:new n(38,null,!0),predefined:!0}),i.push({actionID:"selectLineDown",keyBinding:new n(40,null,!0),predefined:!0}),i.push({actionID:"selectCharPrevious",keyBinding:new n(37,null,!0),predefined:!0}),i.push({actionID:"selectCharNext",keyBinding:new n(39,null,!0),predefined:!0}),i.push({actionID:"selectPageUp",keyBinding:new n(33,null,!0),predefined:!0}),i.push({actionID:"selectPageDown",keyBinding:new n(34,null,!0),predefined:!0}),t.isMac?(i.push({actionID:"selectLineStart",keyBinding:new n(37,!0,!0),predefined:!0}),i.push({actionID:"selectLineEnd",keyBinding:new n(39,!0,!0),predefined:!0}),i.push({actionID:"selectWordPrevious",keyBinding:new n(37,null,!0,!0),predefined:!0}),i.push({actionID:"selectWordNext",keyBinding:new n(39,null,!0,!0),predefined:!0}),i.push({actionID:"selectTextStart",keyBinding:new n(36,null,!0),predefined:!0}),i.push({actionID:"selectTextEnd",keyBinding:new n(35,null,!0),predefined:!0}),i.push({actionID:"selectTextStart",keyBinding:new n(38,!0,!0),predefined:!0}),i.push({actionID:"selectTextEnd",keyBinding:new n(40,!0,!0),predefined:!0}),i.push({actionID:"selectLineStart",keyBinding:new n(37,null,!0,null,!0),predefined:!0}),i.push({actionID:"selectLineEnd",keyBinding:new n(39,null,!0,null,!0),predefined:!0}),i.push({actionID:"selectLineStart",keyBinding:new n(38,null,!0,!0),predefined:!0}),i.push({actionID:"selectLineEnd",keyBinding:new n(40,null,!0,!0),predefined:!0})):(t.isLinux&&(i.push({actionID:"selectWholeLineUp",keyBinding:new n(38,!0,!0),predefined:!0}),i.push({actionID:"selectWholeLineDown",keyBinding:new n(40,!0,!0),predefined:!0})),i.push({actionID:"selectLineStart",keyBinding:new n(36,null,!0),predefined:!0}),i.push({actionID:"selectLineEnd",keyBinding:new n(35,null,!0),predefined:!0}),i.push({actionID:"selectWordPrevious",keyBinding:new n(37,!0,!0),predefined:!0}),i.push({actionID:"selectWordNext",keyBinding:new n(39,!0,!0),predefined:!0}),i.push({actionID:"selectTextStart",keyBinding:new n(36,!0,!0),predefined:!0}),i.push({actionID:"selectTextEnd",keyBinding:new n(35,!0,!0),predefined:!0})),i.push({actionID:"undo",keyBinding:new e.KeyBinding("z",!0),predefined:!0}),i.push(t.isMac?{actionID:"redo",keyBinding:new e.KeyBinding("z",!0,!0),predefined:!0}:{actionID:"redo",keyBinding:new e.KeyBinding("y",!0),predefined:!0}),i.push({actionID:"deletePrevious",keyBinding:new n(8),predefined:!0}),i.push({actionID:"deletePrevious",keyBinding:new n(8,null,!0),predefined:!0}),i.push({actionID:"deleteNext",keyBinding:new n(46),predefined:!0}),i.push({actionID:"deleteWordPrevious",keyBinding:new n(8,!0),predefined:!0}),i.push({actionID:"deleteWordPrevious",keyBinding:new n(8,!0,!0),predefined:!0}),i.push({actionID:"deleteWordNext",keyBinding:new n(46,!0),predefined:!0}),i.push({actionID:"tab",keyBinding:new n(9),predefined:!0}),i.push({actionID:"shiftTab",keyBinding:new n(9,null,!0),predefined:!0}),i.push({actionID:"enter",keyBinding:new n(13),predefined:!0}),i.push({actionID:"enter",keyBinding:new n(13,null,!0),predefined:!0}),i.push({actionID:"selectAll",keyBinding:new n("a",!0),predefined:!0}),i.push({actionID:"toggleTabMode",keyBinding:new n("m",!0),predefined:!0}),t.isMac&&(i.push({actionID:"deleteNext",keyBinding:new n(46,null,!0),predefined:!0}),i.push({actionID:"deleteWordPrevious",keyBinding:new n(8,null,null,!0),predefined:!0}),i.push({actionID:"deleteWordNext",keyBinding:new n(46,null,null,!0),predefined:!0})),i.push({actionID:"toggleWrapMode",keyBinding:new e.KeyBinding("w",!0,!1,!0)}),i.push({actionID:"toggleOverwriteMode",keyBinding:new e.KeyBinding(45)}),!t.isFirefox){var r=t.isMac&&t.isChrome;i.push({actionID:"noop",keyBinding:new n("u",!r,!1,!1,r),predefined:!0}),i.push({actionID:"noop",keyBinding:new n("i",!r,!1,!1,r),predefined:!0}),i.push({actionID:"noop",keyBinding:new n("b",!r,!1,!1,r),predefined:!0})}return t.isFirefox&&(i.push({actionID:"copy",keyBinding:new n(45,!0),predefined:!0}),i.push({actionID:"paste",keyBinding:new n(45,null,!0),predefined:!0}),i.push({actionID:"cut",keyBinding:new n(46,null,!0),predefined:!0})),t.isMac&&(i.push({actionID:"lineStart",keyBinding:new n("a",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"lineEnd",keyBinding:new n("e",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"lineUp",keyBinding:new n("p",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"lineDown",keyBinding:new n("n",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"charPrevious",keyBinding:new n("b",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"charNext",keyBinding:new n("f",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"deletePrevious",keyBinding:new n("h",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"deleteNext",keyBinding:new n("d",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"deleteLineEnd",keyBinding:new n("k",!1,!1,!1,!0),predefined:!0}),t.isFirefox?(i.push({actionID:"scrollPageDown",keyBinding:new n("v",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"deleteLineStart",keyBinding:new n("u",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"deleteWordPrevious",keyBinding:new n("w",!1,!1,!1,!0),predefined:!0})):(i.push({actionID:"pageDown",keyBinding:new n("v",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"centerLine",keyBinding:new n("l",!1,!1,!1,!0),predefined:!0}),i.push({actionID:"enterNoCursor",keyBinding:new n("o",!1,!1,!1,!0),predefined:!0}))),i},{KeyMode:n,DefaultKeyMode:i}}),define("orion/editor/util",[],function(){function e(e,t,n,i){"function"==typeof e.addEventListener?e.addEventListener(t,n,i===!0):e.attachEvent("on"+t,n)}function t(e,t,n,i){"function"==typeof e.removeEventListener?e.removeEventListener(t,n,i===!0):e.detachEvent("on"+t,n)}function n(e,t){if(!t)return!1;if(!e.compareDocumentPosition){for(var n=t;n;){if(e===n)return!0;n=n.parentNode}return!1}return e===t||0!==(16&e.compareDocumentPosition(t))}var i=function(){function e(e){this.options=e}return e.prototype.play=function(){function e(){d=-1===d?(new Date).getTime():d;var e=(new Date).getTime(),i=(e-d)/n;if(1>i){var h=r(i);t=s+h*l,o(t)}else o(a),c.stop()}var t,n="number"==typeof this.options.duration?this.options.duration:350,i="number"==typeof this.options.rate?this.options.rate:20,r=this.options.easing||this.defaultEasing,o=this.options.onAnimate||function(){},s=this.options.curve[0],a=this.options.curve[1],l=a-s,d=-1,c=this;this.interval=this.options.window.setInterval(e,i)},e.prototype.stop=function(){this.options.window.clearInterval(this.interval);var e=this.options.onEnd||function(){};e()},e.prototype.defaultEasing=function(e){return Math.sin(e*(Math.PI/2))},e}();return{contains:n,addEventListener:e,removeEventListener:t,Animation:i}}),define("orion/editor/textView",["i18n!orion/editor/nls/messages","orion/editor/textModel","orion/editor/keyModes","orion/editor/eventTarget","orion/editor/textTheme","orion/editor/util","orion/util"],function(e,t,n,i,r,o,s){function a(e){return e.defaultView||e.parentWindow}function l(e,t,n){if(n){t.className="";for(var i=t.attributes,r=i.length;r-->0;)(!s.isIE||s.isIE>=9||s.isIE<9&&i[r].specified)&&t.removeAttribute(i[r].name)}if(e){e.styleClass&&(t.className=e.styleClass);var o=e.style;if(o)for(var a in o)o.hasOwnProperty(a)&&(t.style[a]=o[a]);var l=e.attributes;if(l)for(var d in l)l.hasOwnProperty(d)&&t.setAttribute(d,l[d])}}function d(e){return e instanceof Array?e.slice(0):e}function h(e,t){if(!e)return t;if(!t)return e;for(var n in t)t.hasOwnProperty(n)&&(e.hasOwnProperty(n)||(e[n]=t[n]));return e}function u(e,t){if(e===t)return!0;if(e&&!t||!e&&t)return!1;if(e&&e.constructor===String||t&&t.constructor===String)return!1;if(e instanceof Array||t instanceof Array){if(!(e instanceof Array&&t instanceof Array))return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!u(e[n],t[n]))return!1;return!0}if(!(e instanceof Object&&t instanceof Object))return!1;var i;for(i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i))return!1;if(!u(e[i],t[i]))return!1}for(i in t)if(!e.hasOwnProperty(i))return!1;return!0}function p(e,t,n){for(var i=0,r=0,o=0,s=e.length;s>o;){-1!==i&&o>=i&&(i=e.indexOf("\r",o)),-1!==r&&o>=r&&(r=e.indexOf("\n",o));var a,l=o;if(-1===r&&-1===i){t(e.substring(o));break}-1!==i&&-1!==r?i+1===r?(a=i,o=r+1):(a=r>i?i:r,o=(r>i?i:r)+1):-1!==i?(a=i,o=i+1):(a=r,o=r+1),t(e.substring(l,a)),n()}}function f(e){var t,n,i,r,o=a(e.ownerDocument);if(o.getComputedStyle){var s=o.getComputedStyle(e,null);t=s.getPropertyValue("border-left-width"),n=s.getPropertyValue("border-top-width"),i=s.getPropertyValue("border-right-width"),r=s.getPropertyValue("border-bottom-width")}else e.currentStyle&&(t=e.currentStyle.borderLeftWidth,n=e.currentStyle.borderTopWidth,i=e.currentStyle.borderRightWidth,r=e.currentStyle.borderBottomWidth);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(i,10)||0,bottom:parseInt(r,10)||0}}function g(e){var t,n,i,r,o=a(e.ownerDocument);if(o.getComputedStyle){var s=o.getComputedStyle(e,null);t=s.getPropertyValue("padding-left"),n=s.getPropertyValue("padding-top"),i=s.getPropertyValue("padding-right"),r=s.getPropertyValue("padding-bottom")}else e.currentStyle&&(t=e.currentStyle.paddingLeft,n=e.currentStyle.paddingTop,i=e.currentStyle.paddingRight,r=e.currentStyle.paddingBottom);return{left:parseInt(t,10)||0,top:parseInt(n,10)||0,right:parseInt(i,10)||0,bottom:parseInt(r,10)||0}}function m(e){var t=e._trim;if(!t){t=g(e);var n=f(e);t.left+=n.left,t.top+=n.top,t.right+=n.right,t.bottom+=n.bottom,e._trim=t}return t}function v(e,t,n,i){function r(t){if(t.animationName===l){var n=t.target;"function"==typeof n.__DOMReady&&a(e).setTimeout(function(){n.__DOMReady()},0)}}function o(e,t){for(var n=["","-webkit-","-moz-","-ms-","-o-"],i="",r="body ."+e+" {\n",o=0;o<n.length;o++)i+="@"+n[o]+"keyframes "+t+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",r+=n[o]+"animation-duration: 0.001s;\n"+n[o]+"animation-name: "+t+";\n";return r+="}",i+r}n="_"+n+"DOMReady",t.className=t.className?t.className+" "+n:n,t.__DOMReady=i;var s=n+"Style";if(!e.getElementById(s)){var l=n+"Animation";b(e,"animationstart",r,!1),b(e,"MSAnimationStart",r,!1),b(e,"webkitAnimationStart",r,!1);var d=e.createElement("style");d.id=s;var c=e.getElementsByTagName("head")[0]||e.documentElement;d.appendChild(e.createTextNode(o(n,l))),c.insertBefore(d,c.firstChild)}}function y(e,t,n){this.start=e,this.end=t,this.caret=n}function _(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom}function C(e,t,n){this.view=e,this.lineIndex=t,this._lineDiv=n}function w(e){this._init(e||{})}var b=o.addEventListener,x=o.removeEventListener,S=o.Animation;return y.prototype={clone:function(){return new y(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(e){if(this.caret?this.start=e:this.end=e,this.start>this.end){var t=this.start;this.start=this.end,this.end=t,this.caret=!this.caret}},setCaret:function(e){this.start=e,this.end=e,this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start="+this.start+" end="+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(e){return this.caret===e.caret&&this.start===e.start&&this.end===e.end}},_.prototype={toString:function(){return"{l="+this.left+", t="+this.top+", r="+this.right+", b="+this.bottom+"}"}},C.prototype={create:function(e,t){if(!this._lineDiv){var n=this._lineDiv=this._createLine(e,t,this.lineIndex);return n._line=this,n}},_createLine:function(e,t,n){var i=this.view,r=i._model,o=r.getLine(n),a=r.getLineStart(n),d={type:"LineStyle",textView:i,lineIndex:n,lineText:o,lineStart:a};i.onLineStyle(d);var c=e.ownerDocument,h=t||s.createElement(c,"div");if(t&&u(t.viewStyle,d.style)||(l(d.style,h,t),t&&(t._trim=null),h.viewStyle=d.style,h.setAttribute("role","presentation")),h.lineIndex=n,t&&h.viewLineText===o&&u(d.ranges,h.viewRanges))return h;h.viewRanges=d.ranges,h.viewLineText=o;var p=[],f={tabOffset:0,ranges:p};this._createRanges(d.ranges,o,0,o.length,a,f);var g=" ";!i._fullSelection&&s.isIE<9&&(g="﻿");var m={text:g,style:i._metrics.largestFontStyle,ignoreChars:1};0!==p.length&&p[p.length-1].style&&"div"===p[p.length-1].style.tagName?p.splice(p.length-1,0,m):p.push(m);var v,y,_,C,w,b,x,S,L=0,E=0;if(s.isFirefox&&o.length>2e3){t&&(h.innerHTML="",t.lineWidth=void 0);var k=c.createDocumentFragment();for(S=0;S<p.length;S++)m=p[S],w=m.text,y=m.style,v=this._createSpan(h,w,y,m.ignoreChars),k.appendChild(v);h.appendChild(k)}else{var T,A;if(t){var N=t.modelChangedEvent;N&&(0===N.removedLineCount&&0===N.addedLineCount?(A=N.start-a,T=N.addedCharCount-N.removedCharCount):A=-1,t.modelChangedEvent=void 0),_=t.firstChild}for(S=0;S<p.length;S++){if(m=p[S],w=m.text,L+=w.length,y=m.style,_){if(b=_.firstChild.data,C=_.viewStyle,b===w&&u(y,C)){E+=b.length,_._rectsCache=void 0,v=_=_.nextSibling;continue}for(;_;){if(-1!==A){var M=L;M>=A&&(M-=T);var I=_.firstChild.data,D=I?I.length:0;if(E+D>M)break;E+=D}x=_.nextSibling,h.removeChild(_),_=x}}v=this._createSpan(h,w,y,m.ignoreChars),_?h.insertBefore(v,_):h.appendChild(v),t&&(t.lineWidth=void 0)}if(t)for(var R=v?v.nextSibling:null;R;)x=R.nextSibling,t.removeChild(R),R=x}return h.parentNode||e.appendChild(h),h},_createRanges:function(e,t,n,i,r,o){if(!(n>i)){if(e)for(var s=0;s<e.length;s++){var a=e[s];if(!(a.end<r+n)){var l=Math.max(r+n,a.start)-r;if(l>i)break;var d=Math.min(r+i,a.end)-r;if(d>=l){if(l=Math.max(n,l),d=Math.min(i,d),l>n&&this._createRange(t,n,l,null,o),!a.style||!a.style.unmergeable)for(;s+1<e.length&&e[s+1].start-r===d&&u(a.style,e[s+1].style);)a=e[s+1],d=Math.min(r+i,a.end)-r,s++;this._createRange(t,l,d,a.style,o),n=d}}}i>n&&this._createRange(t,n,i,null,o)}},_createRange:function(e,t,n,i,r){if(!(t>n)){var o,s=this.view._customTabSize;if(s&&8!==s)for(var a=e.indexOf("	",t);-1!==a&&n>a;){a>t&&(o={text:e.substring(t,a),style:i},r.ranges.push(o),r.tabOffset+=o.text.length);var l=s-r.tabOffset%s;if(l>0){for(var d=" ",c=1;l>c;c++)d+=" ";o={text:d,style:i,ignoreChars:l-1},r.ranges.push(o),r.tabOffset+=o.text.length}if(t=a+1,t===n)return;a=e.indexOf("	",t)}n>=t&&(o={text:e.substring(t,n),style:i},r.ranges.push(o),r.tabOffset+=o.text.length)}},_createSpan:function(e,t,n,i){var r=this.view,o="span";n&&n.tagName&&(o=n.tagName.toLowerCase());var a="a"===o;a&&(this.hasLink=!0),a&&!r._linksVisible&&(o="span");var d=e.ownerDocument,c=s.createElement(e.ownerDocument,o);if(c.appendChild(d.createTextNode(n&&n.text?n.text:t)),n&&n.html?(c.innerHTML=n.html,c.ignore=!0):n&&n.node&&(c.appendChild(n.node),c.ignore=!0),l(n,c),"a"===o){var h=r._getWindow();b(c,"click",function(e){return r._handleLinkClick(e?e:h.event)},!1)}return c.viewStyle=n,i&&(c.ignoreChars=i),c},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(e,t){var n=this._ensureCreated(),i=this.view;if(void 0===e)return this._getLineBoundingClientRect(n,!0);var r=i._model,o=n.ownerDocument,l=this.lineIndex,d=null;if(e<r.getLineEnd(l)){var c=r.getLineStart(l);this.forEach(function(t){var r=t.firstChild,l=this._nodeLength(t);if(c+l>e){var h,u=e-c;if(1===r.length)d=new _(t.getBoundingClientRect());else if(i._isRangeRects)h=o.createRange(),h.setStart(r,u),h.setEnd(r,u+1),d=new _(h.getBoundingClientRect());else if(s.isIE){h=o.body.createTextRange(),h.moveToElementText(t),h.collapse();var p=0===u&&8===s.isIE;p&&(u=1),h.moveEnd("character",u+1),h.moveStart("character",u),d=new _(h.getBoundingClientRect()),p&&(d.left=t.getClientRects()[0].left)}else{var f=r.data;t.removeChild(r),t.appendChild(o.createTextNode(f.substring(0,u)));var g=s.createElement(o,"span");if(g.appendChild(o.createTextNode(f.substring(u,u+1))),t.appendChild(g),t.appendChild(o.createTextNode(f.substring(u+1))),d=new _(g.getBoundingClientRect()),t.innerHTML="",t.appendChild(r),!this._createdDiv){var m=i._getSelection();(c<=m.start&&m.start<c+l||c<=m.end&&m.end<c+l)&&i._updateDOMSelection()}}if(s.isIE){var v=a(n.ownerDocument),y=v.screen.logicalXDPI/v.screen.deviceXDPI,C=v.screen.logicalYDPI/v.screen.deviceYDPI;
d.left=d.left*y,d.right=d.right*y,d.top=d.top*C,d.bottom=d.bottom*C}return!1}return c+=l,!0})}var h=this.getBoundingClientRect();if(!d)if(i._wrapMode){var u=this.getClientRects();d=u[u.length-1],d.left=d.right,d.left+=h.left,d.top+=h.top,d.right+=h.left,d.bottom+=h.top}else d=new _(h),d.left=d.right;return(t||void 0===t)&&(d.left-=h.left,d.top-=h.top,d.right-=h.left,d.bottom-=h.top),d},forEach:function(e){for(var t=this._ensureCreated(),n=t.firstChild;n;){var i=n.nextSibling;if(!n.ignore&&!e.call(this,n))break;n=i}},_getClientRects:function(e,t){var n,i,r,o;if(!e._rectsCache){for(n=e.getClientRects(),i=new Array(n.length),o=0;o<n.length;o++)r=i[o]=new _(n[o]),r.left-=t.left,r.top-=t.top,r.right-=t.left,r.bottom-=t.top;e._rectsCache=i}for(n=e._rectsCache,i=[n.length],o=0;o<n.length;o++)i[o]=new _(n[o]);return i},getClientRects:function(e){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var t=this._ensureCreated(),n=[],i=t.getBoundingClientRect();return this.forEach(function(e){for(var t=this._getClientRects(e,i),r=0;r<t.length;r++){var o,s,a=t[r];if(a.top!==a.bottom){var l=a.top+(a.bottom-a.top)/2;for(o=0;o<n.length&&(s=n[o],!(s.top<=l&&l<s.bottom));o++);o===n.length?n.push(a):(a.left<s.left&&(s.left=a.left),a.top<s.top&&(s.top=a.top),a.right>s.right&&(s.right=a.right),a.bottom>s.bottom&&(s.bottom=a.bottom))}}return!0}),void 0!==e?n[e]:n},_getLineBoundingClientRect:function(e,t){var n=new _(e.getBoundingClientRect());if(this.view._wrapMode);else{n.right=n.left;for(var i=e.lastChild;i&&i.ignoreChars===i.firstChild.length;)i=i.previousSibling;if(i){var r=i.getBoundingClientRect();n.right=r.right+m(e).right}}if(t){var o=m(e);n.left=n.left+o.left,n.right=n.right-o.right}return n},getLineCount:function(){return this.view._wrapMode?this.getClientRects().length:1},getLineIndex:function(e){if(!this.view._wrapMode)return 0;for(var t=this.getClientRects(),n=this.getBoundingClientRect(e),i=n.top+(n.bottom-n.top)/2,r=0;r<t.length;r++)if(t[r].top<=i&&i<t[r].bottom)return r;return t.length-1},getLineStart:function(e){if(!this.view._wrapMode||0===e)return this.view._model.getLineStart(this.lineIndex);var t=this.getClientRects();return this.getOffset(t[e].left+1,t[e].top+1)},_nodeLength:function(e){if(!e||e.ignore)return 0;var t=e.firstChild.length;return e.ignoreChars&&(t-=e.ignoreChars),t},getModelOffset:function(e,t){if(!e)return 0;var n=0;return this.forEach(function(i){var r=i.firstChild;return r===e?(i.ignoreChars&&(n-=i.ignoreChars),n+=t,!1):(i.ignoreChars&&(n-=i.ignoreChars),n+=r.data.length,!0)}),Math.max(0,n)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(e){var t,n,i=0,r=this.view._model,o=r.getLineStart(this.lineIndex),s=e-o,a=r.getLineEnd(this.lineIndex)-o;return this.forEach(function(e){var r=e.firstChild,o=this._nodeLength(e);return o+i>s||i+o>=a?(t=r,n=s-i,e.ignoreChars&&o>0&&n===o&&(n+=e.ignoreChars),!1):(i+=o,!0)}),{node:t,offset:n}},getText:function(e){var t="",n=0;return this.forEach(function(i){var r;if(i.ignoreChars){r=i.lastChild;for(var o=0,s=[],a=-1;r;){var l=r.data;if(l)for(var d=l.length-1;d>=0;d--){var c=l.substring(d,d+1);o<i.ignoreChars&&(" "===c||"﻿"===c)?o++:s.push(" "===c?"	":c)}e===r&&(a=s.length),r=r.previousSibling}s=s.reverse().join(""),-1!==a&&(n=t.length+s.length-a),t+=s}else for(r=i.firstChild;r;)e===r&&(n=t.length),t+=r.data,r=r.nextSibling;return!0}),{text:t,offset:n}},getOffset:function(e,t){function n(n,i,c){var h,u,m,v,y,_,C,w,b,x=n.firstChild,S=g._nodeLength(n),L=p.ownerDocument,E=a(L),k=s.isIE?E.screen.logicalXDPI/E.screen.deviceXDPI:1,T=s.isIE?E.screen.logicalYDPI/E.screen.deviceYDPI:1,A=c.left+f.left;if(s.isIE||r._isRangeRects){y=r._isRangeRects?L.createRange():L.body.createTextRange();for(var N=S,M=-1;N-M>1;){var I=Math.floor((N+M)/2);_=M+1,C=I===S-1&&n.ignoreChars?x.length:I+1,w=0===_&&8===s.isIE,r._isRangeRects?(y.setStart(x,_),y.setEnd(x,C)):(w&&(_=1),y.moveToElementText(n),y.move("character",_),y.moveEnd("character",C-_)),b=y.getClientRects();for(var D=!1,R=0;R<b.length;R++)if(c=b[R],h=(w?A:c.left)*k-f.left,m=c.right*k-f.left,u=c.top*T-f.top,v=c.bottom*T-f.top,e>=h&&m>e&&(!r._wrapMode||t>=u&&v>t)){D=!0;break}D?N=I:M=I}i+=N,_=N,C=N===S-1&&n.ignoreChars?x.length:Math.min(N+1,x.length),r._isRangeRects?(y.setStart(x,_),y.setEnd(x,C)):(y.moveToElementText(n),y.move("character",_),y.moveEnd("character",C-_)),b=y.getClientRects();var P=!1;b.length>0&&(c=b[0],h=(w?A:c.left)*k-f.left,m=c.right*k-f.left,P=e>h+(m-h)/2);var O=i-d,B=o.getLine(l),F=B.charCodeAt(O);F>=55296&&56319>=F&&P?O<B.length&&(F=B.charCodeAt(O+1),F>=56320&&57343>=F&&(i+=1)):F>=56320&&57343>=F&&!P&&O>0&&(F=B.charCodeAt(O-1),F>=55296&&56319>=F&&(i-=1)),P&&i++}else{for(var V=[],j=0;S>j;j++)V.push("<span>"),V.push(j===S-1?x.data.substring(j):x.data.substring(j,j+1)),V.push("</span>");n.innerHTML=V.join("");for(var U=n.firstChild;U;){if(c=U.getBoundingClientRect(),h=c.left-f.left,m=c.right-f.left,e>=h&&m>e){e>h+(m-h)/2&&i++;break}i++,U=U.nextSibling}if(!g._createdDiv){n.innerHTML="",n.appendChild(x);var H=r._getSelection();(i<=H.start&&H.start<i+S||i<=H.end&&H.end<i+S)&&r._updateDOMSelection()}}return i}function i(n){if(n.ignore)return null;for(var i=g._getClientRects(n,f),o=0;o<i.length;o++){var s=i[o];if(s.left<=e&&e<s.right&&(!r._wrapMode||s.top<=t&&t<s.bottom))return s}return null}var r=this.view,o=r._model,l=this.lineIndex,d=o.getLineStart(l),c=o.getLineEnd(l);if(d===c)return d;var h,u,p=this._ensureCreated(),f=this.getBoundingClientRect(),g=this;if(r._wrapMode){h=this.getClientRects(),t<h[0].top&&(t=h[0].top);for(var m=0;m<h.length&&(u=h[m],!(u.top<=t&&t<u.bottom));m++);e<u.left&&(e=u.left),e>u.right&&(e=u.right-1)}else 0>e&&(e=0),e>f.right-f.left&&(e=f.right-f.left);var v,y;if(this._lastHitChild&&this._lastHitChild.parentNode){if(v=this._lastHitOffset,y=this._lastHitChild,u=i(y),!u)for(var _=v,C=v+this._nodeLength(y),w=y.previousSibling,b=y.nextSibling;w||b;){if(w){if(_-=this._nodeLength(w),u=i(w)){y=w,v=_;break}w=w.previousSibling}if(b){if(u=i(b)){y=b,v=C;break}C+=this._nodeLength(b),b=b.nextSibling}}}else v=d,this.forEach(function(e){return y=e,(u=i(y))?!1:(v+=this._nodeLength(y),!0)});return y&&u&&(this._lastHitChild=y,this._lastHitOffset=v,v=n(y,v,u)),Math.min(c,Math.max(d,v))},getNextOffset:function(e,t){if("line"===t.unit){var n=this.view,i=n._model,r=i.getLineAtOffset(e);return t.count>0?(t.count--,i.getLineEnd(r)):(t.count++,i.getLineStart(r))}return"wordend"===t.unit||"wordWS"===t.unit||"wordendWS"===t.unit?this._getNextOffset_W3C(e,t):s.isIE?this._getNextOffset_IE(e,t):this._getNextOffset_W3C(e,t)},_getNextOffset_W3C:function(e,t){function n(e){return e>=33&&47>=e||e>=58&&64>=e||e>=91&&94>=e||96===e||e>=123&&126>=e}function i(e){return 32===e||9===e}var r,o=this.view,s=o._model,a=s.getLineAtOffset(e),l=s.getLine(a),d=s.getLineStart(a),c=s.getLineEnd(a),h=l.length,u=e-d,p=t.count<0?-1:1;if("word"===t.unit||"wordend"===t.unit||"wordWS"===t.unit||"wordendWS"===t.unit)for(var f,g,m,v;0!==t.count;){if(t.count>0){if(u===h)return c;for(r=l.charCodeAt(u),f=n(r),g=!f&&!i(r),u++;h>u;){if(r=l.charCodeAt(u),"wordWS"!==t.unit&&"wordendWS"!==t.unit){if(m=n(r),"wordend"===t.unit){if(!m&&f)break}else if(m&&!f)break;v=!m&&!i(r)}else v=!i(r);if("wordend"===t.unit||"wordendWS"===t.unit){if(!v&&g)break}else if(v&&!g)break;g=v,f=m,u++}}else{if(0===u)return d;for(u--,r=l.charCodeAt(u),f=n(r),g=!f&&!i(r);u>0;){if(r=l.charCodeAt(u-1),"wordWS"!==t.unit&&"wordendWS"!==t.unit){if(m=n(r),"wordend"===t.unit){if(m&&!f)break}else if(!m&&f)break;v=!m&&!i(r)}else v=!i(r);if("wordend"===t.unit||"wordendWS"===t.unit){if(v&&!g)break}else if(!v&&g)break;g=v,f=m,u--}}t.count-=p}else for(;0!==t.count&&u+p>=0&&h>=u+p;)u+=p,r=l.charCodeAt(u),r>=56320&&57343>=r&&u>0&&(r=l.charCodeAt(u-1),r>=55296&&56319>=r&&(u+=p)),t.count-=p;return d+u},_getNextOffset_IE:function(e,t){var n,i,r,o=this._ensureCreated(),s=this.view,a=s._model,l=this.lineIndex,d=0,h=a.getLineStart(l),u=a.getLine(l),p=a.getLineStart(l),f=o.ownerDocument,g=t.count<0?-1:1;if(e===a.getLineEnd(l)){for(r=o.lastChild;r&&r.ignoreChars===r.firstChild.length;)r=r.previousSibling;if(!r)return h;n=f.body.createTextRange(),n.moveToElementText(r),i=n.text.length,n.moveEnd(t.unit,g),d=e+n.text.length-i}else if(e===h&&t.count<0)d=h;else for(r=o.firstChild;r;){var m=this._nodeLength(r);if(h+m>e){if(n=f.body.createTextRange(),e===h&&t.count<0){for(var v=r.previousSibling;v&&(!v.firstChild||!v.firstChild.length);)v=v.previousSibling;n.moveToElementText(v?v:r.previousSibling)}else n.moveToElementText(r),n.collapse(),n.moveEnd("character",e-h);i=n.text.length,n.moveEnd(t.unit,g),d=e+n.text.length-i;break}h=m+h,r=r.nextSibling}var y=d-p;return c=u.charCodeAt(y),c>=56320&&57343>=c&&y>0&&(c=u.charCodeAt(y-1),c>=55296&&56319>=c&&(y+=g)),d=y+p,t.count-=g,d},updateLinks:function(){var e=this._ensureCreated();if(this.hasLink){var t=this;this.forEach(function(n){var i=n.viewStyle;return i&&i.tagName&&"a"===i.tagName.toLowerCase()&&e.replaceChild(t._createSpan(e,n.firstChild.data,i),n),!0})}},destroy:function(){var e=this._createdDiv;e&&(e.parentNode.removeChild(e),this._createdDiv=null)}},w.prototype={addKeyMode:function(e,t){var n=this._keyModes;void 0!==t?n.splice(t,0,e):n.push(e),e._modeAdded&&e._modeAdded()},addRuler:function(e,t){e.setView(this);var n=this._rulers;if(void 0!==t){var i,r;for(i=0,r=0;i<n.length&&t>r;i++)e.getLocation()===n[i].getLocation()&&r++;n.splice(r,0,e),t=r}else n.push(e);this._createRuler(e,t),this._update()},computeSize:function(){var e=0,t=0,n=this._model,i=this._clientDiv;if(!i)return{width:e,height:t};var r=i.style.width;s.isWebkit&&(i.style.width="0x7fffffffpx");for(var o=n.getLineCount(),a=0;o>a;a++){var l=this._getLine(a),d=l.getBoundingClientRect();e=Math.max(e,d.right-d.left),t+=d.bottom-d.top,l.destroy()}s.isWebkit&&(i.style.width=r);var c=this._getViewPadding();return e+=c.right+c.left+this._metrics.scrollWidth,t+=c.bottom+c.top+this._metrics.scrollWidth,{width:e,height:t}},convert:function(e,t,n){if(this._clientDiv){var i=this._getScroll(),r=this._getViewPadding(),o=this._viewDiv.getBoundingClientRect();return"document"===t&&(void 0!==e.x&&(e.x+=-i.x+o.left+r.left),void 0!==e.y&&(e.y+=-i.y+o.top+r.top)),"document"===n&&(void 0!==e.x&&(e.x+=i.x-o.left-r.left),void 0!==e.y&&(e.y+=i.y-o.top-r.top)),e}},destroy:function(){for(var e=0;e<this._rulers.length;e++)this._rulers[e].setView(null);this.rulers=null,this._destroyView();var t={type:"Destroy"};this.onDestroy(t),this._parent=null,this._model&&this._model.destroy&&this._model.destroy(),this._model=null,this._theme=null,this._selection=null,this._doubleClickSelection=null,this._keyModes=null,this._actions=null},focus:function(){this._clientDiv&&(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(e){var t=this._actions[e];return t?t.actionDescription:void 0},getActions:function(e){var t=[],n=this._actions;for(var i in n)if(n.hasOwnProperty(i)){if(!e&&n[i].defaultHandler)continue;t.push(i)}return t},getBottomIndex:function(e){return this._clientDiv?this._getBottomIndex(e):0},getBottomPixel:function(){return this._clientDiv?this._getScroll().y+this._getClientHeight():0},getCaretOffset:function(){var e=this._getSelection();return e.getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var e=this._getScroll();return{x:e.x,y:e.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return this._clientDiv?this._getScroll().x:0},getKeyBindings:function(e){for(var t=[],n=this._keyModes,i=0;i<n.length;i++)t=t.concat(n[i].getKeyBindings(e));return t},getKeyModes:function(){return this._keyModes.slice(0)},getLineHeight:function(e){return this._clientDiv?this._getLineHeight(e):0},getLineIndex:function(e){return this._clientDiv?this._getLineIndex(e):0},getLinePixel:function(e){return this._clientDiv?this._getLinePixel(e):0},getLocationAtOffset:function(e){if(!this._clientDiv)return{x:0,y:0};var t=this._model;e=Math.min(Math.max(0,e),t.getCharCount());var n=t.getLineAtOffset(e),i=this._getLine(n),r=i.getBoundingClientRect(e);i.destroy();var o=r.left,s=this._getLinePixel(n)+r.top;return{x:o,y:s}},getNextOffset:function(e,t){var n=new y(e,e,!1);return this._doMove(t,n),n.getCaret()},getOptions:function(){var e;if(0===arguments.length)e=this._defaultOptions();else if(1===arguments.length){var t=arguments[0];if("string"==typeof t)return d(this["_"+t]);e=t}else{e={};for(var n in arguments)arguments.hasOwnProperty(n)&&(e[arguments[n]]=void 0)}for(var i in e)e.hasOwnProperty(i)&&(e[i]=d(this["_"+i]));return e},getModel:function(){return this._model},getOffsetAtLocation:function(e,t){if(!this._clientDiv)return 0;var n=this._getLineIndex(t),i=this._getLine(n),r=i.getOffset(e,t-this._getLinePixel(n));return i.destroy(),r},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(e)},getLineStart:function(e){this.getModel().getLineStart(e)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var e=this._getSelection();return{start:e.start,end:e.end}},getText:function(e,t){var n=this._model;return n.getText(e,t)},getTopIndex:function(e){return this._clientDiv?this._getTopIndex(e):0},getTopPixel:function(){return this._clientDiv?this._getScroll().y:0},invokeAction:function(e,t,n){if(this._clientDiv){var i=this._actions[e];if(i){if(!t&&i.handler&&i.handler(n))return!0;if(i.defaultHandler)return"boolean"==typeof i.defaultHandler(n)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(e){return this.dispatchEvent(e)},onDragStart:function(e){return this.dispatchEvent(e)},onDrag:function(e){return this.dispatchEvent(e)},onDragEnd:function(e){return this.dispatchEvent(e)},onDragEnter:function(e){return this.dispatchEvent(e)},onDragOver:function(e){return this.dispatchEvent(e)},onDragLeave:function(e){return this.dispatchEvent(e)},onDrop:function(e){return this.dispatchEvent(e)},onDestroy:function(e){return this.dispatchEvent(e)},onLineStyle:function(e){return this.dispatchEvent(e)},onKeyDown:function(e){return this.dispatchEvent(e)},onKeyPress:function(e){return this.dispatchEvent(e)},onKeyUp:function(e){return this.dispatchEvent(e)},onModelChanged:function(e){return this.dispatchEvent(e)},onModelChanging:function(e){return this.dispatchEvent(e)},onModify:function(e){return this.dispatchEvent(e)},onMouseDown:function(e){return this.dispatchEvent(e)},onMouseUp:function(e){return this.dispatchEvent(e)},onMouseMove:function(e){return this.dispatchEvent(e)},onMouseOver:function(e){return this.dispatchEvent(e)},onMouseOut:function(e){return this.dispatchEvent(e)},onSelection:function(e){return this.dispatchEvent(e)},onScroll:function(e){return this.dispatchEvent(e)},onVerify:function(e){return this.dispatchEvent(e)},onFocus:function(e){return this.dispatchEvent(e)},onBlur:function(e){return this.dispatchEvent(e)},redraw:function(){if(!(this._redrawCount>0)){var e=this._model.getLineCount();this.redrawRulers(0,e),this.redrawLines(0,e)}},redrawRulers:function(e,t){if(!(this._redrawCount>0))for(var n=this.getRulers(),i=0;i<n.length;i++)this.redrawLines(e,t,n[i])},redrawLines:function(e,t,n){if(!(this._redrawCount>0)&&(void 0===e&&(e=0),void 0===t&&(t=this._model.getLineCount()),e!==t)){var i=this._clientDiv;if(i){if(n){var r=this._getRulerParent(n);for(i=r.firstChild;i&&i._ruler!==n;)i=i.nextSibling}if(n?i.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(e,t),!n||"page"===n.getOverview())for(var o=i.firstChild;o;){var s=o.lineIndex;s>=e&&t>s&&(o.lineChanged=!0),o=o.nextSibling}n||this._wrapMode||e<=this._maxLineIndex&&this._maxLineIndex<t&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._queueUpdate()}}},redrawRange:function(e,t){if(!(this._redrawCount>0)){var n=this._model;void 0===e&&(e=0),void 0===t&&(t=n.getCharCount());var i=n.getLineAtOffset(e),r=n.getLineAtOffset(Math.max(e,t-1))+1;this.redrawLines(i,r)}},removeKeyMode:function(e){for(var t=this._keyModes,n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1);break}e._modeRemoved&&e._modeRemoved()},removeRuler:function(e){for(var t=this._rulers,n=0;n<t.length;n++)if(t[n]===e){t.splice(n,1),e.setView(null),this._destroyRuler(e),this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(e,t,n){if(e){var i=this._actions,r=i[e];r||(r=i[e]={}),r.handler=t,void 0!==n&&(r.actionDescription=n)}},setKeyBinding:function(e,t){this._keyModes[0].setKeyBinding(e,t)},setCaretOffset:function(e,t,n){var i=this._model.getCharCount();e=Math.max(0,Math.min(e,i));var r=new y(e,e,!1);this._setSelection(r,void 0===t||t,!0,n)},setHorizontalPixel:function(e){this._clientDiv&&(e=Math.max(0,e),this._scrollView(e-this._getScroll().x,0))},setRedraw:function(e){e?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(e){if(e&&e!==this._model){this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged);var t=this._model.getLineCount(),n=this._model.getCharCount(),i=e.getLineCount(),r=e.getCharCount(),o=e.getText(),s={type:"ModelChanging",text:o,start:0,removedCharCount:n,addedCharCount:r,removedLineCount:t,addedLineCount:i};this.onModelChanging(s),this._model=e,s={type:"ModelChanged",start:0,removedCharCount:n,addedCharCount:r,removedLineCount:t,addedLineCount:i},this.onModelChanged(s),this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._reset(),this._update()}},setOptions:function(e){var t=this._defaultOptions();for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],r=this["_"+n];if(u(r,i))continue;var o=t[n]?t[n].update:null;if(o){o.call(this,i);continue}this["_"+n]=d(i)}},setSelection:function(e,t,n,i){var r=e>t;if(r){var o=e;e=t,t=o}var s=this._model.getCharCount();e=Math.max(0,Math.min(e,s)),t=Math.max(0,Math.min(t,s));var a=new y(e,t,r);this._setSelection(a,void 0===n||n,!0,i)},setText:function(e,t,n){var i=void 0===t&&void 0===n;void 0===t&&(t=0),void 0===n&&(n=this._model.getCharCount()),i&&(this._variableLineHeight=!1),this._modifyContent({text:e,start:t,end:n,_code:!0},!i),i&&(this._columnX=-1,this._setSelection(new y(0,0,!1),!0),s.isFirefox<13&&this._fixCaret())},setTopIndex:function(e){this._clientDiv&&this._scrollView(0,this._getLinePixel(Math.max(0,e))-this._getScroll().y)},setTopPixel:function(e){this._clientDiv&&this._scrollView(0,Math.max(0,e)-this._getScroll().y)},showSelection:function(e,t){return this._showCaret(e?!1:!0,t,e)},update:function(e,t){this._clientDiv&&((e||this._metrics.invalid)&&this._updateStyle(),void 0===t||t?this._update():this._queueUpdate())},_handleRootMouseDown:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)){s.isFirefox<13&&1===e.which&&(this._clientDiv.contentEditable=!1,(this._overlayDiv||this._clientDiv).draggable=!0,this._ignoreBlur=!0);var t=this._overlayDiv||this._clientDiv;s.isIE<9&&(t=this._viewDiv);for(var n=e.target?e.target:e.srcElement;n;){if(t===n)return;if(n.className&&-1!==n.className.indexOf("textViewFind"))return;n=n.parentNode}if(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!this._isW3CEvents){var i=this,r=this._getWindow();r.setTimeout(function(){i._clientDiv.focus()},0)}}},_handleRootMouseUp:function(e){this._ignoreEvent(e)||s.isFirefox<13&&1===e.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1,this._fixCaret(),this._ignoreBlur=!1)},_handleBlur:function(){if(this._cancelCheckSelection(),!this._ignoreBlur){if(this._commitIME(),this._hasFocus=!1,s.isIE<9&&!this._getSelection().isEmpty()){var e=this._rootDiv,t=s.createElement(e.ownerDocument,"div");e.appendChild(t),e.removeChild(t)}if(this._cursorDiv&&(this._cursorDiv.style.display="none"),this._selDiv1){var n="lightgray";this._selDiv1.style.background=n,this._selDiv2.style.background=n,this._selDiv3.style.background=n;var i,r=this._getWindow(),o=this._selDiv1.ownerDocument;if(r.getSelection){var a=r.getSelection();for(i=a.anchorNode;i;){if(i===this._clientDiv){a.rangeCount>0&&a.removeAllRanges();break}i=i.parentNode}}else if(o.selection){for(this._ignoreSelect=!1,i=o.selection.createRange().parentElement();i;){if(i===this._clientDiv){o.selection.empty();break}i=i.parentNode}this._ignoreSelect=!0}}this._ignoreFocus||this.onBlur({type:"Blur"})}},_handleCompositionStart:function(e){this._ignoreEvent(e)||(this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(e){this._ignoreEvent(e)||this._commitIME(e.data)},_handleContextMenu:function(e){if(!this._ignoreEvent(e)){s.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var t=!1;if(this.isListening("ContextMenu")){var n=this._createMouseEvent("ContextMenu",e);n.screenX=e.screenX,n.screenY=e.screenY,this.onContextMenu(n),t=n.defaultPrevented}else s.isMac&&s.isFirefox&&0===e.button&&(t=!0);return t?(e.preventDefault&&e.preventDefault(),!1):(this._contextMenuOpen=!0,void(s.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))))}},_handleCopy:function(e){return this._cancelCheckSelection(),this._ignoreEvent(e)||this._ignoreCopy?void 0:this._doCopy(e)?(e.preventDefault&&e.preventDefault(),!1):void 0},_handleCut:function(e){return this._cancelCheckSelection(),this._ignoreEvent(e)?void 0:this._doCut(e)?(e.preventDefault&&e.preventDefault(),!1):void 0},_handleDataModified:function(e){this._ignoreEvent(e)||this._startIME()},_handleDblclick:function(e){if(!this._ignoreEvent(e)){var t=e.timeStamp?e.timeStamp:(new Date).getTime();this._lastMouseTime=t,2!==this._clickCount&&(this._clickCount=2,this._handleMouse(e))}},_handleDragStart:function(e){if(!this._ignoreEvent(e)){if(s.isFirefox<13){var t=this,n=this._getWindow();n.setTimeout(function(){t._clientDiv.contentEditable=!0,t._clientDiv.draggable=!1,t._ignoreBlur=!1},0)}return this.isListening("DragStart")&&-1!==this._dragOffset?(this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",e)),this._dragOffset=-1,void 0):(e.preventDefault&&e.preventDefault(),!1)}},_handleDrag:function(e){this._ignoreEvent(e)||this.isListening("Drag")&&this.onDrag(this._createMouseEvent("Drag",e))},_handleDragEnd:function(e){this._ignoreEvent(e)||(this._dropTarget=!1,this._dragOffset=-1,this.isListening("DragEnd")&&this.onDragEnd(this._createMouseEvent("DragEnd",e)),s.isFirefox<13&&(this._fixCaret(),"none"!==e.dataTransfer.dropEffect||e.dataTransfer.mozUserCancelled||this._fixCaret()))},_handleDragEnter:function(e){if(!this._ignoreEvent(e)){var t=!0;return this._dropTarget=!0,this.isListening("DragEnter")&&(t=!1,this.onDragEnter(this._createMouseEvent("DragEnter",e))),s.isWebkit||t?(e.preventDefault&&e.preventDefault(),!1):void 0}},_handleDragOver:function(e){if(!this._ignoreEvent(e)){var t=!0;return this.isListening("DragOver")&&(t=!1,this.onDragOver(this._createMouseEvent("DragOver",e))),s.isWebkit||t?(t&&(e.dataTransfer.dropEffect="none"),e.preventDefault&&e.preventDefault(),!1):void 0}},_handleDragLeave:function(e){this._ignoreEvent(e)||(this._dropTarget=!1,this.isListening("DragLeave")&&this.onDragLeave(this._createMouseEvent("DragLeave",e)))},_handleDrop:function(e){return this._ignoreEvent(e)?void 0:(this._dropTarget=!1,this.isListening("Drop")&&this.onDrop(this._createMouseEvent("Drop",e)),e.preventDefault&&e.preventDefault(),!1)},_handleFocus:function(){if(this._hasFocus=!0,s.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection(),this._cursorDiv&&(this._cursorDiv.style.display="block"),this._selDiv1){var e=this._highlightRGB;this._selDiv1.style.background=e,this._selDiv2.style.background=e,this._selDiv3.style.background=e}this._ignoreFocus||this.onFocus({type:"Focus"})},_handleKeyDown:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)){if(this.isListening("KeyDown")){var t=this._createKeyEvent("KeyDown",e);if(this.onKeyDown(t),t.defaultPrevented)return s.isFirefox&&(this._keyDownPrevented=!0),void e.preventDefault()}var n=!1;switch(e.keyCode){case 16:case 17:case 18:case 91:n=!0;break;default:this._setLinksVisible(!1)}if(229===e.keyCode){if(this._readonly)return e.preventDefault&&e.preventDefault(),!1;var i=!0;s.isSafari&&s.isMac&&e.ctrlKey&&(i=!1,e.keyCode=129),i&&this._startIME()}else n||this._commitIME();return(s.isMac||s.isLinux)&&s.isFirefox<4||s.isOpera<12.16?(this._keyDownEvent=e,!0):this._doAction(e)?(e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1):void 0}},_handleKeyPress:function(e){if(!this._ignoreEvent(e)){if(this._keyDownPrevented)return e.preventDefault&&(e.preventDefault(),e.stopPropagation()),void(this._keyDownPrevented=void 0);if(s.isMac&&s.isWebkit&&(63232<=e.keyCode&&e.keyCode<=63487||13===e.keyCode||8===e.keyCode))return e.preventDefault&&e.preventDefault(),!1;if(((s.isMac||s.isLinux)&&s.isFirefox<4||s.isOpera<12.16)&&this._doAction(this._keyDownEvent))return e.preventDefault&&e.preventDefault(),!1;var t=s.isMac?e.metaKey:e.ctrlKey;if(void 0!==e.charCode&&t)switch(e.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")){var n=this._createKeyEvent("KeyPress",e);if(this.onKeyPress(n),n.defaultPrevented)return void e.preventDefault()}if(this._doAction(e))return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1,e.keyCode=0),!1;var i=!1;if(s.isMac?(e.ctrlKey||e.metaKey)&&(i=!0):s.isFirefox?(e.ctrlKey||e.altKey)&&(i=!0):e.ctrlKey^e.altKey&&(i=!0),!i){var r=s.isOpera?e.which:void 0!==e.charCode?e.charCode:e.keyCode;if(r>31)return this._doContent(String.fromCharCode(r)),e.preventDefault&&e.preventDefault(),!1}}},_handleDocKeyUp:function(e){var t=s.isMac?e.metaKey:e.ctrlKey;t||this._setLinksVisible(!1)},_handleKeyUp:function(e){if(!this._ignoreEvent(e)){if(this.isListening("KeyUp")){var t=this._createKeyEvent("KeyUp",e);if(this.onKeyUp(t),t.defaultPrevented)return void e.preventDefault()}this._handleDocKeyUp(e),13===e.keyCode&&this._commitIME()}},_handleLinkClick:function(e){var t=s.isMac?e.metaKey:e.ctrlKey;return t?void 0:(e.preventDefault&&e.preventDefault(),!1)},_handleMouse:function(e){var t=this._getWindow(),n=!0,i=t;if((s.isIE||s.isFirefox&&!this._overlayDiv)&&(i=this._clientDiv),this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var r=this;t.setTimeout(function(){r.focus(),r._ignoreFocus=!1},0)}return 1===this._clickCount?(n=this._setSelectionTo(e.clientX,e.clientY,e.shiftKey,(!s.isOpera||s.isOpera>=12.16)&&this._hasFocus&&this.isListening("DragStart")),n&&this._setGrab(i)):(this._isW3CEvents&&this._setGrab(i),this._doubleClickSelection=null,this._setSelectionTo(e.clientX,e.clientY,e.shiftKey),this._doubleClickSelection=this._getSelection()),n},_handleMouseDown:function(e){if(!this._ignoreEvent(e)){if(this._linksVisible){var t=e.target||e.srcElement;if("A"===t.tagName)return;this._setLinksVisible(!1)}this._commitIME();var n=e.which;n||(4===e.button&&(n=2),2===e.button&&(n=3),1===e.button&&(n=1));var i=2!==n&&e.timeStamp?e.timeStamp:(new Date).getTime(),r=i-this._lastMouseTime,o=Math.abs(this._lastMouseX-e.clientX),a=Math.abs(this._lastMouseY-e.clientY),l=this._lastMouseButton===n;if(this._lastMouseX=e.clientX,this._lastMouseY=e.clientY,this._lastMouseTime=i,this._lastMouseButton=n,1===n&&(this._isMouseDown=!0,l&&r<=this._clickTime&&o<=this._clickDist&&a<=this._clickDist?this._clickCount++:this._clickCount=1),this.isListening("MouseDown")){var d=this._createMouseEvent("MouseDown",e);if(this.onMouseDown(d),d.defaultPrevented)return void e.preventDefault()}1===n&&this._handleMouse(e)&&(s.isIE>=9||s.isOpera||s.isChrome||s.isSafari||s.isFirefox&&!this._overlayDiv)&&(this._hasFocus||this.focus(),e.preventDefault()),s.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(e){this._ignoreEvent(e)||this._animation||this.isListening("MouseOver")&&this.onMouseOver(this._createMouseEvent("MouseOver",e))},_handleMouseOut:function(e){this._ignoreEvent(e)||this._animation||this.isListening("MouseOut")&&this.onMouseOut(this._createMouseEvent("MouseOut",e))},_handleMouseMove:function(e){if(!this._animation){var t=this._isClientDiv(e);if(this.isListening("MouseMove")&&t&&this.onMouseMove(this._createMouseEvent("MouseMove",e)),!this._dropTarget){var n=this._linksVisible||this._lastMouseMoveX!==e.clientX||this._lastMouseMoveY!==e.clientY;if(this._lastMouseMoveX=e.clientX,this._lastMouseMoveY=e.clientY,this._setLinksVisible(n&&!this._isMouseDown&&(s.isMac?e.metaKey:e.ctrlKey)),this._checkOverlayScroll(),!this._isW3CEvents){if(0===e.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===e.button&&0!==(1&this._clickCount)&&t)return this._clickCount=2,this._handleMouse(e,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){var i=e.clientX,r=e.clientY,o=this._getViewPadding(),a=this._viewDiv.getBoundingClientRect(),l=this._getClientWidth(),d=this._getClientHeight(),c=a.left+o.left,h=a.top+o.top,u=a.left+o.left+l,p=a.top+o.top+d;h>r?this._doAutoScroll("up",i,r-h):r>p?this._doAutoScroll("down",i,r-p):c>i&&!this._wrapMode?this._doAutoScroll("left",i-c,r):i>u&&!this._wrapMode?this._doAutoScroll("right",i-u,r):(this._endAutoScroll(),this._setSelectionTo(i,r,!0))}}}},_isClientDiv:function(e){for(var t=this._overlayDiv||this._clientDiv,n=e.target?e.target:e.srcElement;n;){if(t===n)return!0;n=n.parentNode}return!1},_createKeyEvent:function(e,t){return{type:e,event:t,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(e,t){var n=this.convert({x:t.clientX,y:t.clientY},"page","document");return{type:e,event:t,clickCount:this._clickCount,x:n.x,y:n.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(e){var t=e.which?0===e.button:1===e.button;if(this.isListening("MouseUp")&&(this._isClientDiv(e)||t&&this._isMouseDown)&&this.onMouseUp(this._createMouseEvent("MouseUp",e)),!this._linksVisible){if(t&&this._isMouseDown){if(-1!==this._dragOffset){var n=this._getSelection();n.extend(this._dragOffset),n.collapse(),this._setSelection(n,!0,!0),this._dragOffset=-1}this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null)}t&&s.isFirefox&&(this._updateDOMSelection(),e.preventDefault())}},_handleMouseWheel:function(e){var t=this._getLineHeight(),n=0,i=0;if(s.isIE||s.isOpera)i=-e.wheelDelta/40*t;else if(s.isFirefox){var r=256;if("wheel"===e.type)e.deltaMode?(n=Math.max(-r,Math.min(r,e.deltaX))*t,i=Math.max(-r,Math.min(r,e.deltaY))*t):(n=e.deltaX,i=e.deltaY);else{var o;o=s.isMac?3*e.detail:Math.max(-r,Math.min(r,e.detail))*t,e.axis===e.HORIZONTAL_AXIS?n=o:i=o}}else if(s.isMac){var a,l,d=e.timeStamp-this._wheelTimeStamp;this._wheelTimeStamp=e.timeStamp,a=e.wheelDeltaX%120!==0?1:40>d?40/(40-d):40,l=e.wheelDeltaY%120!==0?1:40>d?40/(40-d):40,n=Math.ceil(-e.wheelDeltaX/a),n>-1&&0>n&&(n=-1),n>0&&1>n&&(n=1),i=Math.ceil(-e.wheelDeltaY/l),i>-1&&0>i&&(i=-1),i>0&&1>i&&(i=1)}else{n=-e.wheelDeltaX;var c=8;i=-e.wheelDeltaY/120*c*t}if(s.isSafari||s.isChrome&&s.isMac){for(var h=e.target;h&&void 0===h.lineIndex;)h=h.parentNode;this._mouseWheelLine=h}var u=this._getScroll();this._scrollView(n,i);var p=this._getScroll();return u.x!==p.x||u.y!==p.y?(e.preventDefault&&e.preventDefault(),!1):void 0},_handlePaste:function(e){if(this._cancelCheckSelection(),!this._ignoreEvent(e)&&!this._ignorePaste&&this._doPaste(e)){if(s.isIE){var t=this;this._ignoreFocus=!0;var n=this._getWindow();n.setTimeout(function(){t._updateDOMSelection(),t._ignoreFocus=!1},0)}return e.preventDefault&&e.preventDefault(),!1}},_handleResize:function(){var e=this._rootDiv.clientWidth,t=this._rootDiv.clientHeight;if(this._rootWidth!==e||this._rootHeight!==t){this._rootWidth!==e&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=e,this._rootHeight=t;var n=s.isIE<9,i=this._calculateMetrics();
u(i,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=i,n=!0),n?this._queueUpdate():this._update()}},_handleRulerEvent:function(e){for(var t=e.target?e.target:e.srcElement,n=t.lineIndex,i=t;i&&!i._ruler;)void 0===n&&void 0!==i.lineIndex&&(n=i.lineIndex),i=i.parentNode;var r=i?i._ruler:null;if(void 0===n&&r&&"document"===r.getOverview()){var o=this._getClientHeight(),s=this._model.getLineCount(),a=this._getViewPadding(),l=this._viewDiv.getBoundingClientRect(),d=o+a.top+a.bottom-2*this._metrics.scrollWidth;n=Math.floor((e.clientY-l.top-this._metrics.scrollWidth)*s/d),n>=0&&s>n||(n=void 0)}if(r)switch(e.type){case"click":r.onClick&&r.onClick(n,e);break;case"dblclick":r.onDblClick&&r.onDblClick(n,e);break;case"mousemove":r.onMouseMove&&r.onMouseMove(n,e);break;case"mouseover":r.onMouseOver&&r.onMouseOver(n,e);break;case"mouseout":if(r.onMouseOut){for(var c=e.relatedTarget;c&&c!==this._rootDiv;){if(c===i)return;c=c.parentNode}r.onMouseOut(n,e)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var e=this._getScroll(!1),t=this._hScroll,n=this._vScroll;if(t!==e.x||n!==e.y){this._hScroll=e.x,this._vScroll=e.y,this._commitIME(),this._update(n===e.y);var i={type:"Scroll",oldValue:{x:t,y:n},newValue:e};this.onScroll(i)}},_handleSelectStart:function(e){var t=this._contextMenuOpen;return this._contextMenuOpen=!1,t?void(this._checkSelectionChange=!0):this._ignoreSelect?(e&&e.preventDefault&&e.preventDefault(),!1):void 0},_getModelOffset:function(e,t){if(e){var n;return n="DIV"===e.tagName?e:e.parentNode.parentNode,n._line?n._line.getModelOffset(e,t):0}},_updateSelectionFromDOM:function(){if(!(s.isIOS||s.isAndroid||this._checkSelectionChange))return!1;var e=this._getWindow(),t=e.getSelection(),n=this._getModelOffset(t.anchorNode,t.anchorOffset),i=this._getModelOffset(t.focusNode,t.focusOffset),r=this._getSelection();if(void 0===n||void 0===i||r.start===n&&r.end===i)return!1;if(this._checkSelectionChange){var o=this._getLineNext(),a=this._getLinePrevious();if(t.anchorNode===o.firstChild.firstChild&&0===t.anchorOffset&&t.focusNode===a.firstChild.firstChild&&0===t.focusOffset)return!1;(t.anchorNode===o.firstChild.firstChild&&0===t.anchorOffset&&t.focusNode===a.lastChild.firstChild||t.anchorNode===this._clientDiv&&t.focusNode===this._clientDiv)&&(n=0,i=this.getModel().getCharCount())}return this._setSelection(new y(n,i),!1,!1),this._checkSelectionChange=!1,!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){if(this._selPollTimer){var e=this._getWindow();e.clearTimeout(this._selPollTimer),this._selPollTimer=null}},_pollSelectionChange:function(e){var t=this,n=this._getWindow();this._cancelPollSelectionChange(),this._selPollTimer=n.setTimeout(function(){if(t._selPollTimer=null,t._clientDiv){var n=t._updateSelectionFromDOM();!n&&e&&t._pollSelectionChange(e)}},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(s.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(e){if(!this._ignoreEvent(e)){this._imeOffset=-1;var t=this._getWindow().getSelection();if(t.anchorNode!==this._anchorNode||t.focusNode!==this._focusNode||t.anchorOffset!==this._anchorOffset||t.focusOffset!==this._focusOffset){for(var n=t.anchorNode;n&&void 0===n.lineIndex;)n=n.parentNode;if(n){var i=this._model,r=n.lineIndex,o=i.getLine(r),a=o,l=0,d=i.getLineStart(r);if(t.rangeCount>0){t.getRangeAt(0).deleteContents();var c=n.ownerDocument.createTextNode(e.data);t.getRangeAt(0).insertNode(c);var h=this._getDOMText(n,c);a=h.text,l=h.offset,c.parentNode.removeChild(c)}n.lineRemoved=!0;for(var u=0;o.charCodeAt(u)===a.charCodeAt(u)&&l>u;)u++;for(var p=o.length-1,f=a.length-o.length;o.charCodeAt(p)===a.charCodeAt(p+f)&&p+f>=l+e.data.length;)p--;p++;var g=a.substring(u,p+f);u+=d,p+=d,this._ignoreQueueUpdate=s.isSafari,this._modifyContent({text:g,start:u,end:p,_ignoreDOMSelection:!0,_ignoreDOMSelection1:s.isChrome},!0),this._ignoreQueueUpdate=!1}}else this._doContent(e.data);e.preventDefault()}},_handleTouchStart:function(e){this._commitIME();var t=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",t.clearInterval(this._touchScrollTimer),this._touchScrollTimer=null);var n=e.touches;if(1===n.length){var i=n[0],r=i.clientX,o=i.clientY;this._touchStartX=r,this._touchStartY=o,s.isAndroid&&(o<i.pageY-t.pageYOffset||r<i.pageX-t.pageXOffset)&&(r=i.pageX-t.pageXOffset,o=i.pageY-t.pageYOffset);var a=this.convert({x:r,y:o},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(a.x,a.y),this._touchStartTime=e.timeStamp,this._touching=!0}},_handleTouchMove:function(e){var t=e.touches;if(1===t.length){var n=t[0];this._touchCurrentX=n.clientX,this._touchCurrentY=n.clientY;var i=10;if(!this._touchScrollTimer&&e.timeStamp-this._touchStartTime<20*i){this._vScrollDiv.style.display="block",this._wrapMode||(this._hScrollDiv.style.display="block");var r=this,o=this._getWindow();this._touchScrollTimer=o.setInterval(function(){var e=0,t=0;if(r._touching)e=r._touchStartX-r._touchCurrentX,t=r._touchStartY-r._touchCurrentY,r._touchSpeedX=e/i,r._touchSpeedY=t/i,r._touchStartX=r._touchCurrentX,r._touchStartY=r._touchCurrentY;else{if(Math.abs(r._touchSpeedX)<.1&&Math.abs(r._touchSpeedY)<.1)return r._vScrollDiv.style.display="none",r._hScrollDiv.style.display="none",o.clearInterval(r._touchScrollTimer),void(r._touchScrollTimer=null);e=r._touchSpeedX*i,t=r._touchSpeedY*i,r._touchSpeedX*=.95,r._touchSpeedY*=.95}r._scrollView(e,t)},i)}this._touchScrollTimer&&e.preventDefault()}},_handleTouchEnd:function(e){var t=e.touches;0===t.length&&(this._touching=!1)},_doAction:function(e){var t,n,i=this._keyModes;for(n=i.length-1;n>=0;n--)if(t=i[n],"function"==typeof t.match){var r=t.match(e);if(void 0!==r)return this.invokeAction(r)}return!1},_doMove:function(e,t){var n=this._model,i=t.getCaret(),r=n.getLineAtOffset(i);for(e.count||(e.count=1);0!==e.count;){var o=n.getLineStart(r);if(e.count<0&&i===o){if(!(r>0))break;"character"===e.unit&&e.count++,r--,t.extend(n.getLineEnd(r))}else if(e.count>0&&i===n.getLineEnd(r)){if(!(r+1<n.getLineCount()))break;"character"===e.unit&&e.count--,r++,t.extend(n.getLineStart(r))}else{var s=!1;if(e.expandTab&&"character"===e.unit&&(i-o)%this._tabSize===0){var a=n.getText(o,i);s=!/[^ ]/.test(a)}if(s)t.extend(i-this._tabSize),e.count+=e.count<0?1:-1;else{var l=this._getLine(r);t.extend(l.getNextOffset(i,e)),l.destroy()}}i=t.getCaret()}return t},_doBackspace:function(e){var t=this._getSelection();return t.isEmpty()&&(e.count||(e.count=1),e.count*=-1,e.expandTab=this._expandTab,this._doMove(e,t)),this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doCase:function(e){var t=this._getSelection();this._doMove(e,t);var n=this.getText(t.start,t.end);switch(this._setSelection(t,!0),e.type){case"lower":n=n.toLowerCase();break;case"capitalize":n=n.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});break;case"reverse":for(var i="",r=0;r<n.length;r++){var o=n[r],s=o.toLowerCase();o=s!==o?s:o.toUpperCase(),i+=o}n=i;break;default:n=n.toUpperCase()}return this._doContent(n),!0},_doContent:function(e){var t=this._getSelection();if(this._overwriteMode&&t.isEmpty()){var n=this._model,i=n.getLineAtOffset(t.end);if(t.end<n.getLineEnd(i)){var r=this._getLine(i);t.extend(r.getNextOffset(t.getCaret(),{unit:"character",count:1})),r.destroy()}}return this._modifyContent({text:e,start:t.start,end:t.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._setClipboardText(n,e)}return!0},_doCursorNext:function(e){var t=this._getSelection();return t.isEmpty()||e.select?this._doMove(e,t):t.start=t.end,e.select||t.collapse(),this._setSelection(t,!0),!0},_doCursorPrevious:function(e){var t=this._getSelection();return t.isEmpty()||e.select?(e.count||(e.count=1),e.count*=-1,this._doMove(e,t)):t.end=t.start,e.select||t.collapse(),this._setSelection(t,!0),!0},_doCut:function(e){var t=this._getSelection();if(!t.isEmpty()){var n=this._getBaseText(t.start,t.end);return this._doContent(""),this._setClipboardText(n,e)}return!0},_doDelete:function(e){var t=this._getSelection();return t.isEmpty()&&this._doMove(e,t),this._modifyContent({text:"",start:t.start,end:t.end},!0),!0},_doEnd:function(e){var t,n=this._getSelection(),i=this._model;if(e.ctrl)n.extend(i.getCharCount()),t=function(){};else{var r=n.getCaret(),o=i.getLineAtOffset(r);if(this._wrapMode){var s=this._getLine(o),a=s.getLineIndex(r);r=a===s.getLineCount()-1?i.getLineEnd(o):s.getLineStart(a+1)-1,s.destroy()}else e.count&&e.count>0&&(o=Math.min(o+e.count-1,i.getLineCount()-1)),r=i.getLineEnd(o);n.extend(r)}return e.select||n.collapse(),this._setSelection(n,!0,!0,t),!0},_doEnter:function(e){var t=this._model,n=this._getSelection();return this._doContent(t.getLineDelimiter()),e&&e.noCursor&&(n.end=n.start,this._setSelection(n,!0)),!0},_doHome:function(e){var t,n=this._getSelection(),i=this._model;if(e.ctrl)n.extend(0),t=function(){};else{var r=n.getCaret(),o=i.getLineAtOffset(r);if(this._wrapMode){var s=this._getLine(o),a=s.getLineIndex(r);r=s.getLineStart(a),s.destroy()}else r=i.getLineStart(o);n.extend(r)}return e.select||n.collapse(),this._setSelection(n,!0,!0,t),!0},_doLineDown:function(e){var t,n=this._model,i=this._getSelection(),r=i.getCaret(),o=n.getLineAtOffset(r),a=this._getLine(o),l=this._columnX,d=1,c=!1;if(-1===l||e.wholeLine||e.select&&s.isIE){var h=e.wholeLine?n.getLineEnd(o+1):r;l=a.getBoundingClientRect(h).left}if((t=a.getLineIndex(r))<a.getLineCount()-1)d=a.getClientRects(t+1).top+1;else{var u=n.getLineCount()-1;c=o===u,e.count&&e.count>0?o=Math.min(o+e.count,u):o++}var p=!1;return c?(e.select||s.isMac||s.isLinux)&&(i.extend(n.getCharCount()),p=!0):(a.lineIndex!==o&&(a.destroy(),a=this._getLine(o)),i.extend(a.getOffset(l,d)),p=!0),p&&(e.select||i.collapse(),this._setSelection(i,!0,!0)),this._columnX=l,a.destroy(),!0},_doLineUp:function(e){var t,n,i=this._model,r=this._getSelection(),o=r.getCaret(),a=i.getLineAtOffset(o),l=this._getLine(a),d=this._columnX,c=!1;if(-1===d||e.wholeLine||e.select&&s.isIE){var h=e.wholeLine?i.getLineStart(a-1):o;d=l.getBoundingClientRect(h).left}(t=l.getLineIndex(o))>0?n=l.getClientRects(t-1).top+1:(c=0===a,c||(e.count&&e.count>0?a=Math.max(a-e.count,0):a--,n=this._getLineHeight(a)-1));var u=!1;return c?(e.select||s.isMac||s.isLinux)&&(r.extend(0),u=!0):(l.lineIndex!==a&&(l.destroy(),l=this._getLine(a)),r.extend(l.getOffset(d,n)),u=!0),u&&(e.select||r.collapse(),this._setSelection(r,!0,!0)),this._columnX=d,l.destroy(),!0},_doNoop:function(){return!0},_doPageDown:function(e){var t,n,i=this,r=this._model,o=this._getSelection(),a=o.getCaret(),l=r.getLineAtOffset(a),d=r.getLineCount(),c=this._getScroll(),h=this._getClientHeight();if(this._lineHeight){t=this._columnX;var u=this._getBoundsAtOffset(a);(-1===t||e.select&&s.isIE)&&(t=u.left);var p=this._getLineIndex(u.top+h);n=this._getLine(p);var f=this._getLinePixel(p),g=u.top+h-f;a=n.getOffset(t,g);var m=n.getBoundingClientRect(a);return n.destroy(),o.extend(a),e.select||o.collapse(),this._setSelection(o,!0,!0,function(){i._columnX=t},m.top+f-u.top),!0}if(d-1>l){var v=this._getLineHeight(),y=Math.floor(h/v),_=Math.min(d-l-1,y);_=Math.max(1,_),t=this._columnX,(-1===t||e.select&&s.isIE)&&(n=this._getLine(l),t=n.getBoundingClientRect(a).left,n.destroy()),n=this._getLine(l+_),o.extend(n.getOffset(t,0)),n.destroy(),e.select||o.collapse();var C=d*v,w=c.y+_*v;w+h>C&&(w=C-h),this._setSelection(o,!0,!0,function(){i._columnX=t},w-c.y)}return!0},_doPageUp:function(e){var t,n,i=this,r=this._model,o=this._getSelection(),a=o.getCaret(),l=r.getLineAtOffset(a),d=this._getScroll(),c=this._getClientHeight();if(this._lineHeight){t=this._columnX;var h=this._getBoundsAtOffset(a);(-1===t||e.select&&s.isIE)&&(t=h.left);var u=this._getLineIndex(h.bottom-c);n=this._getLine(u);var p=this._getLinePixel(u),f=h.bottom-c-p;a=n.getOffset(t,f);var g=n.getBoundingClientRect(a);return n.destroy(),o.extend(a),e.select||o.collapse(),this._setSelection(o,!0,!0,function(){i._columnX=t},g.top+p-h.top),!0}if(l>0){var m=this._getLineHeight(),v=Math.floor(c/m),y=Math.max(1,Math.min(l,v));t=this._columnX,(-1===t||e.select&&s.isIE)&&(n=this._getLine(l),t=n.getBoundingClientRect(a).left,n.destroy()),n=this._getLine(l-y),o.extend(n.getOffset(t,this._getLineHeight(l-y)-1)),n.destroy(),e.select||o.collapse();var _=Math.max(0,d.y-y*m);this._setSelection(o,!0,!0,function(){i._columnX=t},_-d.y)}return!0},_doPaste:function(e){var t=this,n=this._getClipboardText(e,function(e){if(e){if(s.isLinux&&2===t._lastMouseButton){var n=(new Date).getTime()-t._lastMouseTime;n<=t._clickTime&&t._setSelectionTo(t._lastMouseX,t._lastMouseY)}t._doContent(e)}});return null!==n},_doScroll:function(e){var t,n=e.type,i=this._model,r=i.getLineCount(),o=this._getClientHeight(),s=this._getLineHeight(),a=r*s,l=this._getScroll().y;switch(n){case"textStart":t=0;break;case"textEnd":t=a-o;break;case"pageDown":t=l+o;break;case"pageUp":t=l-o;break;case"lineDown":t=l+s;break;case"lineUp":t=l-s;break;case"centerLine":var d=this._getSelection(),c=i.getLineAtOffset(d.start),h=i.getLineAtOffset(d.end),u=(h-c+1)*s;t=c*s-o/2+u/2}return void 0!==t&&(t=Math.min(Math.max(0,t),a-o),this._scrollViewAnimated(0,t-l,function(){})),!0},_doSelectAll:function(){var e=this._model,t=this._getSelection();return t.setCaret(0),t.extend(e.getCharCount()),this._setSelection(t,!1),!0},_doTab:function(){if(this._tabMode&&!this._readonly){var e="	";if(this._expandTab){var t=this._model,n=this._getSelection().getCaret(),i=t.getLineAtOffset(n),r=t.getLineStart(i),o=this._tabSize-(n-r)%this._tabSize;e=new Array(o+1).join(" ")}return this._doContent(e),!0}},_doShiftTab:function(){return this._tabMode&&!this._readonly?!0:void 0},_doOverwriteMode:function(){return this._readonly?void 0:(this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0)},_doTabMode:function(){return this._tabMode=!this._tabMode,!0},_doWrapMode:function(){return this.setOptions({wrapMode:!this.getOptions("wrapMode")}),!0},_autoScroll:function(){var e,t,n=this._model,i=this._getSelection(),r=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),o=i.getCaret(),a=n.getLineCount(),l=n.getLineAtOffset(o);if("up"===this._autoScrollDir||"down"===this._autoScrollDir){var d=this._autoScrollY/this._getLineHeight();d=0>d?Math.floor(d):Math.ceil(d),e=l,e=Math.max(0,Math.min(a-1,e+d))}else("left"===this._autoScrollDir||"right"===this._autoScrollDir)&&(e=this._getLineIndex(r.y),t=this._getLine(l),r.x+=t.getBoundingClientRect(o,!1).left,t.destroy());0===e&&(s.isMac||s.isLinux)?i.extend(0):e===a-1&&(s.isMac||s.isLinux)?i.extend(n.getCharCount()):(t=this._getLine(e),i.extend(t.getOffset(r.x,r.y-this._getLinePixel(e))),t.destroy()),this._setSelection(i,!0)},_autoScrollTimer:function(){this._autoScroll();var e=this,t=this._getWindow();this._autoScrollTimerID=t.setTimeout(function(){e._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(e){if(this._lineHeight&&!this._calculateLHTimer){var t=this._model.getLineCount(),n=0;if(e){for(var i=0,r=100,o=(new Date).getTime(),s=0;t>n&&(this._lineHeight[n]||(i++,s||(s=n),this._lineHeight[n]=this._calculateLineHeight(n)),n++,!((new Date).getTime()-o>r)););this.redrawRulers(0,t),this._queueUpdate()}var a=this._getWindow();if(n!==t){var l=this;return void(this._calculateLHTimer=a.setTimeout(function(){l._calculateLHTimer=null,l._calculateLineHeightTimer(!0)},0))}this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(e){var t=this._getLine(e),n=t.getBoundingClientRect();return t.destroy(),Math.max(1,n.bottom-n.top)},_calculateMetrics:function(){var e=this._clientDiv,t=e.ownerDocument,n=" ",i=s.createElement(t,"div");i.style.lineHeight="normal";var r=this._model,o=r.getLine(0),a={type:"LineStyle",textView:this,0:0,lineText:o,lineStart:0};this.onLineStyle(a),l(a.style,i),i.style.position="fixed",i.style.left="-1000px";var d=s.createElement(t,"span");d.appendChild(t.createTextNode(n)),i.appendChild(d);var c=s.createElement(t,"span");c.style.fontStyle="italic",c.appendChild(t.createTextNode(n)),i.appendChild(c);var h=s.createElement(t,"span");h.style.fontWeight="bold",h.appendChild(t.createTextNode(n)),i.appendChild(h);var u=s.createElement(t,"span");u.style.fontWeight="bold",u.style.fontStyle="italic",u.appendChild(t.createTextNode(n)),i.appendChild(u),e.appendChild(i);var p=i.getBoundingClientRect(),f=d.getBoundingClientRect(),v=c.getBoundingClientRect(),y=h.getBoundingClientRect(),_=u.getBoundingClientRect(),C=f.bottom-f.top,w=v.bottom-v.top,b=y.bottom-y.top,x=_.bottom-_.top,S=0,L=p.bottom-p.top<=0,E=Math.max(1,p.bottom-p.top);w>C&&(S=1),b>w&&(S=2),x>b&&(S=3);var k;0!==S&&(k={style:{}},0!==(1&S)&&(k.style.fontStyle="italic"),0!==(2&S)&&(k.style.fontWeight="bold"));var T=m(i);e.removeChild(i);var A=g(this._viewDiv),N=s.createElement(t,"div");N.style.position="fixed",N.style.left="-1000px",N.style.paddingLeft=A.left+"px",N.style.paddingTop=A.top+"px",N.style.paddingRight=A.right+"px",N.style.paddingBottom=A.bottom+"px",N.style.width="100px",N.style.height="100px";var M=s.createElement(t,"div");M.style.width="100%",M.style.height="100%",N.appendChild(M),e.appendChild(N);var I=N.getBoundingClientRect(),D=M.getBoundingClientRect(),R=0;if(!this._singleMode){N.style.overflow="hidden",M.style.height="200px";var P=N.clientWidth;N.style.overflow="scroll";var O=N.clientWidth;R=P-O}e.removeChild(N),A={left:D.left-I.left,top:D.top-I.top,right:I.right-D.right,bottom:I.bottom-D.bottom};var B=0,F=0;return L||(this._wrapOffset||this._marginOffset)&&(N=s.createElement(t,"div"),N.style.position="fixed",N.style.left="-1000px",N.innerHTML=new Array(this._wrapOffset+1+(s.isWebkit?0:1)).join(" "),e.appendChild(N),I=N.getBoundingClientRect(),B=Math.ceil(I.right-I.left),N.innerHTML=new Array(this._marginOffset+1).join(" "),D=N.getBoundingClientRect(),F=Math.ceil(D.right-D.left),e.removeChild(N)),{lineHeight:E,largestFontStyle:k,lineTrim:T,viewPadding:A,scrollWidth:R,wrapWidth:B,marginWidth:F,invalid:L}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(e){var t=this._getSelection();return t.isEmpty()?!1:("next"===e?t.start=t.end:t.end=t.start,this._setSelection(t,!0),!0)},_commitIME:function(e){if(-1!==this._imeOffset){var t=this._model,n=t.getLineAtOffset(this._imeOffset),i=t.getLineStart(n),r=this._getLineNode(n);if(!e){this._scrollDiv.focus(),this._clientDiv.focus();var o=this._getDOMText(r).text,a=t.getLine(n),l=this._imeOffset-i,d=l+o.length-a.length;l!==d&&(e=o.substring(l,d))}e&&(this._doContent(e)||s.isWebkit||(r.lineRemoved=!0,this._queueUpdate())),this._imeOffset=-1}},_createActions:function(){this.addKeyMode(new n.DefaultKeyMode(this));var t=this;this._actions={noop:{defaultHandler:function(){return t._doNoop()}},lineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:!1}))},actionDescription:{name:e.lineUp}},lineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:!1}))},actionDescription:{name:e.lineDown}},lineStart:{defaultHandler:function(e){return t._doHome(h(e,{select:!1,ctrl:!1}))},actionDescription:{name:e.lineStart}},lineEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:!1,ctrl:!1}))},actionDescription:{name:e.lineEnd}},charPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:!1,unit:"character"}))},actionDescription:{name:e.charPrevious}},charNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:!1,unit:"character"}))},actionDescription:{name:e.charNext}},pageUp:{defaultHandler:function(e){return t._doPageUp(h(e,{select:!1}))},actionDescription:{name:e.pageUp}},pageDown:{defaultHandler:function(e){return t._doPageDown(h(e,{select:!1}))},actionDescription:{name:e.pageDown}},scrollPageUp:{defaultHandler:function(e){return t._doScroll(h(e,{type:"pageUp"}))},actionDescription:{name:e.scrollPageUp}},scrollPageDown:{defaultHandler:function(e){return t._doScroll(h(e,{type:"pageDown"}))},actionDescription:{name:e.scrollPageDown}},scrollLineUp:{defaultHandler:function(e){return t._doScroll(h(e,{type:"lineUp"}))},actionDescription:{name:e.scrollLineUp}},scrollLineDown:{defaultHandler:function(e){return t._doScroll(h(e,{type:"lineDown"}))},actionDescription:{name:e.scrollLineDown}},wordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:!1,unit:"word"}))},actionDescription:{name:e.wordPrevious}},wordNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:!1,unit:"word"}))},actionDescription:{name:e.wordNext}},textStart:{defaultHandler:function(e){return t._doHome(h(e,{select:!1,ctrl:!0}))},actionDescription:{name:e.textStart}},textEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:!1,ctrl:!0}))},actionDescription:{name:e.textEnd}},scrollTextStart:{defaultHandler:function(e){return t._doScroll(h(e,{type:"textStart"}))},actionDescription:{name:e.scrollTextStart}},scrollTextEnd:{defaultHandler:function(e){return t._doScroll(h(e,{type:"textEnd"}))},actionDescription:{name:e.scrollTextEnd}},centerLine:{defaultHandler:function(e){return t._doScroll(h(e,{type:"centerLine"}))},actionDescription:{name:e.centerLine}},selectLineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:!0}))},actionDescription:{name:e.selectLineUp}},selectLineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:!0}))},actionDescription:{name:e.selectLineDown}},selectWholeLineUp:{defaultHandler:function(e){return t._doLineUp(h(e,{select:!0,wholeLine:!0}))},actionDescription:{name:e.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(e){return t._doLineDown(h(e,{select:!0,wholeLine:!0}))},actionDescription:{name:e.selectWholeLineDown}},selectLineStart:{defaultHandler:function(e){return t._doHome(h(e,{select:!0,ctrl:!1}))},actionDescription:{name:e.selectLineStart}},selectLineEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:!0,ctrl:!1}))},actionDescription:{name:e.selectLineEnd}},selectCharPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:!0,unit:"character"}))},actionDescription:{name:e.selectCharPrevious}},selectCharNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:!0,unit:"character"}))},actionDescription:{name:e.selectCharNext}},selectPageUp:{defaultHandler:function(e){return t._doPageUp(h(e,{select:!0}))},actionDescription:{name:e.selectPageUp}},selectPageDown:{defaultHandler:function(e){return t._doPageDown(h(e,{select:!0}))},actionDescription:{name:e.selectPageDown}},selectWordPrevious:{defaultHandler:function(e){return t._doCursorPrevious(h(e,{select:!0,unit:"word"}))},actionDescription:{name:e.selectWordPrevious}},selectWordNext:{defaultHandler:function(e){return t._doCursorNext(h(e,{select:!0,unit:"word"}))},actionDescription:{name:e.selectWordNext}},selectTextStart:{defaultHandler:function(e){return t._doHome(h(e,{select:!0,ctrl:!0}))},actionDescription:{name:e.selectTextStart}},selectTextEnd:{defaultHandler:function(e){return t._doEnd(h(e,{select:!0,ctrl:!0}))},actionDescription:{name:e.selectTextEnd}},deletePrevious:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"character"}))},actionDescription:{name:e.deletePrevious}},deleteNext:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"character"}))},actionDescription:{name:e.deleteNext}},deleteWordPrevious:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"word"}))},actionDescription:{name:e.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"word"}))},actionDescription:{name:e.deleteWordNext}},deleteLineStart:{defaultHandler:function(e){return t._doBackspace(h(e,{unit:"line"}))},actionDescription:{name:e.deleteLineStart}},deleteLineEnd:{defaultHandler:function(e){return t._doDelete(h(e,{unit:"line"}))},actionDescription:{name:e.deleteLineEnd}},tab:{defaultHandler:function(){return t._doTab()},actionDescription:{name:e.tab}},shiftTab:{defaultHandler:function(){return t._doShiftTab()},actionDescription:{name:e.shiftTab}},enter:{defaultHandler:function(){return t._doEnter()},actionDescription:{name:e.enter}},enterNoCursor:{defaultHandler:function(e){return t._doEnter(h(e,{noCursor:!0}))},actionDescription:{name:e.enterNoCursor}},selectAll:{defaultHandler:function(){return t._doSelectAll()},actionDescription:{name:e.selectAll}},copy:{defaultHandler:function(){return t._doCopy()},actionDescription:{name:e.copy}},cut:{defaultHandler:function(){return t._doCut()},actionDescription:{name:e.cut}},paste:{defaultHandler:function(){return t._doPaste()},actionDescription:{name:e.paste}},uppercase:{defaultHandler:function(e){return t._doCase(h(e,{type:"upper"}))},actionDescription:{name:e.uppercase}},lowercase:{defaultHandler:function(e){return t._doCase(h(e,{type:"lower"}))},actionDescription:{name:e.lowercase}},capitalize:{defaultHandler:function(e){return t._doCase(h(e,{unit:"word",type:"capitalize"}))},actionDescription:{name:e.capitalize}},reversecase:{defaultHandler:function(e){return t._doCase(h(e,{type:"reverse"}))},actionDescription:{name:e.reversecase}},toggleOverwriteMode:{defaultHandler:function(){return t._doOverwriteMode()},actionDescription:{name:e.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(){return t._doTabMode()},actionDescription:{name:e.toggleTabMode}},toggleWrapMode:{defaultHandler:function(){return t._doWrapMode()},actionDescription:{name:e.toggleWrapMode}}}},_createRulerParent:function(e,t){var n=s.createElement(e,"div");return n.className=t,n.tabIndex=-1,n.style.overflow="hidden",n.style.MozUserSelect="none",n.style.WebkitUserSelect="none",n.style.position="absolute",n.style.top="0px",n.style.bottom="0px",n.style.cursor="default",n.style.display="none",n.setAttribute("aria-hidden","true"),this._rootDiv.appendChild(n),n},_createRuler:function(e,t){if(this._clientDiv){var n=this._getRulerParent(e);if(n){(n!==this._marginDiv||this._marginOffset)&&(n.style.display="block");var i=s.createElement(n.ownerDocument,"div");if(i._ruler=e,i.rulerChanged=!0,i.style.position="relative",i.style.cssFloat="left",i.style.styleFloat="left",i.style.outline="none",void 0===t||0>t||t>=n.children.length)n.appendChild(i);else{for(var r=n.firstChild;r&&t-->0;)r=r.nextSibling;n.insertBefore(i,r)}}}},_createView:function(){function e(){_._rootDiv&&(_.update(!0),_._metrics.invalid&&_._getWindow().setTimeout(function(){e()},100))}if(!this._clientDiv){for(var t=this._parent;t.hasChildNodes();)t.removeChild(t.lastChild);var n=t.ownerDocument,i=s.createElement(n,"div");this._rootDiv=i,i.tabIndex=-1,i.style.position="relative",i.style.overflow="hidden",i.style.width="100%",i.style.height="100%",i.style.overflow="hidden",i.style.WebkitTextSizeAdjust="100%",i.setAttribute("role","application"),t.appendChild(i);var r=this._createRulerParent(n,"textviewLeftRuler");this._leftDiv=r;var o=s.createElement(n,"div");o.className="textviewScroll",this._viewDiv=o,o.tabIndex=-1,o.style.position="absolute",o.style.top="0px",o.style.bottom="0px",o.style.borderWidth="0px",o.style.margin="0px",o.style.outline="none",o.style.background="transparent",i.appendChild(o);var a=this._createRulerParent(n,"textviewRightRuler");this._rightDiv=a,a.style.right="0px";var l=s.createElement(n,"div");this._scrollDiv=l,l.style.margin="0px",l.style.borderWidth="0px",l.style.padding="0px",o.appendChild(l);var d=this._marginDiv=this._createRulerParent(n,"textviewMarginRuler");if(d.style.zIndex="4",!s.isIE&&!s.isIOS){var c=s.createElement(n,"div");this._clipDiv=c,c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",c.style.background="transparent",i.appendChild(c);var h=s.createElement(n,"div");this._clipScrollDiv=h,h.style.position="absolute",h.style.height="1px",h.style.top="-1000px",h.style.background="transparent",c.appendChild(h)}this._setFullSelection(this._fullSelection,!0);var u=s.createElement(n,"div");if(u.className="textviewContent",this._clientDiv=u,u.tabIndex=0,u.style.position="absolute",u.style.borderWidth="0px",u.style.margin="0px",u.style.padding="0px",u.style.outline="none",u.style.zIndex="1",u.style.WebkitUserSelect="text",u.setAttribute("spellcheck","false"),(s.isIOS||s.isAndroid)&&(u.style.WebkitTapHighlightColor="transparent"),(this._clipDiv||i).appendChild(u),s.isIOS||s.isAndroid){var p=s.createElement(n,"div");this._vScrollDiv=p,p.style.position="absolute",p.style.borderWidth="1px",p.style.borderColor="white",p.style.borderStyle="solid",p.style.borderRadius="4px",p.style.backgroundColor="black",p.style.opacity="0.5",p.style.margin="0px",p.style.padding="0px",p.style.outline="none",p.style.zIndex="3",p.style.width="8px",p.style.display="none",i.appendChild(p);var f=s.createElement(n,"div");this._hScrollDiv=f,f.style.position="absolute",f.style.borderWidth="1px",f.style.borderColor="white",f.style.borderStyle="solid",f.style.borderRadius="4px",f.style.backgroundColor="black",f.style.opacity="0.5",f.style.margin="0px",f.style.padding="0px",f.style.outline="none",f.style.zIndex="3",f.style.height="8px",f.style.display="none",i.appendChild(f)}if(s.isFirefox&&!u.setCapture){var g=s.createElement(n,"div");this._overlayDiv=g,g.style.position=u.style.position,g.style.borderWidth=u.style.borderWidth,g.style.margin=u.style.margin,g.style.padding=u.style.padding,g.style.cursor="text",g.style.zIndex="2",(this._clipDiv||i).appendChild(g)}u.contentEditable="true",u.setAttribute("role","textbox"),u.setAttribute("aria-multiline","true"),this._setWrapMode(this._wrapMode,!0),this._setReadOnly(this._readonly),this._setThemeClass(this._themeClass,!0),this._setTabSize(this._tabSize,!0),this._setMarginOffset(this._marginOffset,!0),this._hookEvents();for(var m=this._rulers,y=0;y<m.length;y++)this._createRuler(m[y]);this._update();var _=this;v(n,i,"textview",e)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:r.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(e){var t=this._getRulerParent(e);if(t)for(var n=t.firstChild;n;){if(n._ruler===e){n._ruler=void 0,t.removeChild(n),0!==t.children.length||t===this._marginDiv&&this._marginOffset||(t.style.display="none");break}n=n.nextSibling}},_destroyView:function(){var e=this._clientDiv;if(e){this._setGrab(null),this._unhookEvents();var t=this._getWindow();this._autoScrollTimerID&&(t.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null),this._updateTimer&&(t.clearTimeout(this._updateTimer),this._updateTimer=null);var n=this._rootDiv;n.parentNode.removeChild(n),this._selDiv1=null,this._selDiv2=null,this._selDiv3=null,this._clipboardDiv=null,this._rootDiv=null,this._scrollDiv=null,this._viewDiv=null,this._clipDiv=null,this._clipScrollDiv=null,this._clientDiv=null,this._overlayDiv=null,this._leftDiv=null,this._rightDiv=null,this._marginDiv=null,this._cursorDiv=null,this._vScrollDiv=null,this._hScrollDiv=null}},_doAutoScroll:function(e,t,n){this._autoScrollDir=e,this._autoScrollX=t,this._autoScrollY=n,this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){if(this._autoScrollTimerID){var e=this._getWindow();
e.clearTimeout(this._autoScrollTimerID)}this._autoScrollDir=void 0,this._autoScrollTimerID=void 0},_fixCaret:function(){var e=this._clientDiv;if(e){var t=this._hasFocus;this._ignoreFocus=!0,t&&e.blur(),e.contentEditable=!1,e.contentEditable=!0,t&&e.focus(),this._ignoreFocus=!1}},_getBaseText:function(e,t){var n=this._model;return n.getBaseModel&&(e=n.mapOffset(e),t=n.mapOffset(t),n=n.getBaseModel()),n.getText(e,t)},_getBottomIndex:function(e){var t=this._bottomChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),i=this._clientDiv.getBoundingClientRect();n.bottom>i.bottom&&(t=this._getLinePrevious(t)||t)}return t.lineIndex},_getBoundsAtOffset:function(e){var t=this._model,n=this._getLine(t.getLineAtOffset(e)),i=n.getBoundingClientRect(e),r=this._getLinePixel(n.lineIndex);return i.top+=r,i.bottom+=r,n.destroy(),i},_getClientHeight:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-e.top-e.bottom)},_getClientWidth:function(){var e=this._getViewPadding();return Math.max(0,this._viewDiv.clientWidth-e.left-e.right)},_getClipboardText:function(e,t){var n,i,r=this._model.getLineDelimiter(),o=this._getWindow(),a=o.clipboardData;if(!a&&e&&(a=e.clipboardData),a)return n=[],i=a.getData(s.isIE?"Text":"text/plain"),p(i,function(e){n.push(e)},function(){n.push(r)}),i=n.join(""),t&&t(i),i;if(s.isFirefox){this._ignoreFocus=!0;var l=this._clipboardDiv,d=this._rootDiv.ownerDocument;l||(l=s.createElement(d,"div"),this._clipboardDiv=l,l.style.position="fixed",l.style.whiteSpace="pre",l.style.left="-1000px",this._rootDiv.appendChild(l)),l.innerHTML="<pre contenteditable=''></pre>",l.firstChild.focus();var c=this,h=function(){var e=c._getTextFromElement(l);return l.innerHTML="",n=[],p(e,function(e){n.push(e)},function(){n.push(r)}),n.join("")},u=!1;if(this._ignorePaste=!0,!s.isLinux||2!==this._lastMouseButton)try{u=d.execCommand("paste",!1,null)}catch(f){u=l.childNodes.length>1||l.firstChild&&l.firstChild.childNodes.length>0}return this._ignorePaste=!1,u?(this.focus(),this._ignoreFocus=!1,i=h(),i&&t&&t(i),i):e?(o.setTimeout(function(){c.focus(),i=h(),i&&t&&t(i),c._ignoreFocus=!1},0),null):(this.focus(),this._ignoreFocus=!1,"")}return""},_getDOMText:function(e,t){return e._line.getText(t)},_getTextFromElement:function(e){var t=e.ownerDocument,n=t.defaultView;if(!n.getSelection)return e.innerText||e.textContent;var i=t.createRange();i.selectNode(e);var r,o=n.getSelection(),s=[];for(r=0;r<o.rangeCount;r++)s.push(o.getRangeAt(r));this._ignoreSelect=!0,o.removeAllRanges(),o.addRange(i);var a=o.toString();for(o.removeAllRanges(),r=0;r<s.length;r++)o.addRange(s[r]);return this._ignoreSelect=!1,a},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(e){var t=this._getLineNode(e);return!t||t.lineChanged||t.lineRemoved?new C(this,e):t._line},_getLineHeight:function(e,t){if(void 0!==e&&this._lineHeight){var n=this._lineHeight[e];if(n)return n;if(t||void 0===t){var i=this._lineHeight[e]=this._calculateLineHeight(e);return i}}return this._metrics.lineHeight},_getLineNode:function(e){for(var t=this._clientDiv,n=t.firstChild;n;){if(e===n.lineIndex)return n;n=n.nextSibling}return void 0},_getLineNext:function(e){for(var t=e?e.nextSibling:this._clientDiv.firstChild;t&&(-1===t.lineIndex||!t._line);)t=t.nextSibling;return t},_getLinePrevious:function(e){for(var t=e?e.previousSibling:this._clientDiv.lastChild;t&&(-1===t.lineIndex||!t._line);)t=t.previousSibling;return t},_getLinePixel:function(e){if(e=Math.min(Math.max(0,e),this._model.getLineCount()),this._lineHeight){var t,n=this._getTopIndex(),i=-this._topIndexY+this._getScroll().y;if(e>n)for(t=n;e>t;t++)i+=this._getLineHeight(t);else for(t=n-1;t>=e;t--)i-=this._getLineHeight(t);return i}var r=this._getLineHeight();return r*e},_getLineIndex:function(e){var t,n=0,i=this._model.getLineCount();if(this._lineHeight){n=this._getTopIndex();var r=-this._topIndexY+this._getScroll().y;if(e!==r)if(r>e)for(;r>e&&n>0;)e+=this._getLineHeight(--n);else for(t=this._getLineHeight(n);e-t>=r&&i-1>n;)e-=t,t=this._getLineHeight(++n)}else t=this._getLineHeight(),n=Math.floor(e/t);return Math.max(0,Math.min(i-1,n))},_getRulerParent:function(e){switch(e.getLocation()){case"left":return this._leftDiv;case"right":return this._rightDiv;case"margin":return this._marginDiv}return null},_getScroll:function(e){(void 0===e||e)&&this._cancelAnimation();var t=this._viewDiv;return{x:t.scrollLeft,y:t.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(e){var t=this._topChild;if(e&&this._getClientHeight()>this._getLineHeight()){var n=t.getBoundingClientRect(),i=this._getViewPadding(),r=this._viewDiv.getBoundingClientRect();n.top<r.top+i.top&&(t=this._getLineNext(t)||t)}return t.lineIndex},_hookEvents:function(){var e=this;this._modelListener={onChanging:function(t){e._onModelChanging(t)},onChanged:function(t){e._onModelChanged(t)}},this._model.addEventListener("preChanging",this._modelListener.onChanging),this._model.addEventListener("postChanged",this._modelListener.onChanged),this._themeListener={onChanged:function(){e._setThemeClass(e._themeClass)}},this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var t=this._handlers=[],n=this._clientDiv,i=this._viewDiv,r=this._rootDiv,o=this._overlayDiv||n,a=n.ownerDocument,l=this._getWindow(),d=s.isIE?a:l;if(t.push({target:l,type:"resize",handler:function(t){return e._handleResize(t?t:l.event)}}),t.push({target:n,type:"blur",handler:function(t){return e._handleBlur(t?t:l.event)}}),t.push({target:n,type:"focus",handler:function(t){return e._handleFocus(t?t:l.event)}}),t.push({target:i,type:"focus",handler:function(){n.focus()}}),t.push({target:i,type:"scroll",handler:function(t){return e._handleScroll(t?t:l.event)}}),t.push({target:n,type:"textInput",handler:function(t){return e._handleTextInput(t?t:l.event)}}),t.push({target:n,type:"keydown",handler:function(t){return e._handleKeyDown(t?t:l.event)}}),t.push({target:n,type:"keypress",handler:function(t){return e._handleKeyPress(t?t:l.event)}}),t.push({target:n,type:"keyup",handler:function(t){return e._handleKeyUp(t?t:l.event)}}),s.isIE&&t.push({target:a,type:"keyup",handler:function(t){return e._handleDocKeyUp(t?t:l.event)}}),t.push({target:n,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:l.event)}}),t.push({target:n,type:"copy",handler:function(t){return e._handleCopy(t?t:l.event)}}),t.push({target:n,type:"cut",handler:function(t){return e._handleCut(t?t:l.event)}}),t.push({target:n,type:"paste",handler:function(t){return e._handlePaste(t?t:l.event)}}),t.push({target:a,type:"selectionchange",handler:function(t){return e._handleSelectionChange(t?t:l.event)}}),s.isIOS||s.isAndroid)t.push({target:n,type:"touchstart",handler:function(t){return e._handleTouchStart(t?t:l.event)}}),t.push({target:n,type:"touchmove",handler:function(t){return e._handleTouchMove(t?t:l.event)}}),t.push({target:n,type:"touchend",handler:function(t){return e._handleTouchEnd(t?t:l.event)}});else{if(t.push({target:n,type:"selectstart",handler:function(t){return e._handleSelectStart(t?t:l.event)}}),t.push({target:n,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:l.event)}}),t.push({target:n,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:l.event)}}),t.push({target:n,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:l.event)}}),t.push({target:d,type:"mouseup",handler:function(t){return e._handleMouseUp(t?t:l.event)}}),t.push({target:d,type:"mousemove",handler:function(t){return e._handleMouseMove(t?t:l.event)}}),t.push({target:r,type:"mousedown",handler:function(t){return e._handleRootMouseDown(t?t:l.event)}}),t.push({target:r,type:"mouseup",handler:function(t){return e._handleRootMouseUp(t?t:l.event)}}),t.push({target:o,type:"dragstart",handler:function(t){return e._handleDragStart(t?t:l.event)}}),t.push({target:o,type:"drag",handler:function(t){return e._handleDrag(t?t:l.event)}}),t.push({target:o,type:"dragend",handler:function(t){return e._handleDragEnd(t?t:l.event)}}),t.push({target:o,type:"dragenter",handler:function(t){return e._handleDragEnter(t?t:l.event)}}),t.push({target:o,type:"dragover",handler:function(t){return e._handleDragOver(t?t:l.event)}}),t.push({target:o,type:"dragleave",handler:function(t){return e._handleDragLeave(t?t:l.event)}}),t.push({target:o,type:"drop",handler:function(t){return e._handleDrop(t?t:l.event)}}),t.push({target:this._clientDiv,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:l.event)}}),this._clipDiv&&t.push({target:this._clipDiv,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(t){return e._handleMouseWheel(t?t:l.event)}}),s.isFirefox&&(!s.isWindows||s.isFirefox>=15)){var c=l.MutationObserver||l.MozMutationObserver;c?(this._mutationObserver=new c(function(t){e._handleDataModified(t)}),this._mutationObserver.observe(n,{subtree:!0,characterData:!0})):t.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(t){return e._handleDataModified(t?t:l.event)}})}(s.isFirefox&&(!s.isWindows||s.isFirefox>=15)||s.isIE)&&(t.push({target:this._clientDiv,type:"compositionstart",handler:function(t){return e._handleCompositionStart(t?t:l.event)}}),t.push({target:this._clientDiv,type:"compositionend",handler:function(t){return e._handleCompositionEnd(t?t:l.event)}})),this._overlayDiv&&(t.push({target:this._overlayDiv,type:"mousedown",handler:function(t){return e._handleMouseDown(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"mouseover",handler:function(t){return e._handleMouseOver(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"mouseout",handler:function(t){return e._handleMouseOut(t?t:l.event)}}),t.push({target:this._overlayDiv,type:"contextmenu",handler:function(t){return e._handleContextMenu(t?t:l.event)}})),this._isW3CEvents||t.push({target:this._clientDiv,type:"dblclick",handler:function(t){return e._handleDblclick(t?t:l.event)}})}this._hookRulerEvents(this._leftDiv,t),this._hookRulerEvents(this._rightDiv,t),this._hookRulerEvents(this._marginDiv,t);for(var h=0;h<t.length;h++){var u=t[h];b(u.target,u.type,u.handler,u.capture)}},_hookRulerEvents:function(e,t){if(e){var n=this,i=this._getWindow();s.isIE&&t.push({target:e,type:"selectstart",handler:function(){return!1}}),t.push({target:e,type:s.isFirefox>26?"wheel":s.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(e){return n._handleMouseWheel(e?e:i.event)}}),t.push({target:e,type:"click",handler:function(e){n._handleRulerEvent(e?e:i.event)}}),t.push({target:e,type:"dblclick",handler:function(e){n._handleRulerEvent(e?e:i.event)}}),t.push({target:e,type:"mousemove",handler:function(e){n._handleRulerEvent(e?e:i.event)}}),t.push({target:e,type:"mouseover",handler:function(e){n._handleRulerEvent(e?e:i.event)}}),t.push({target:e,type:"mouseout",handler:function(e){n._handleRulerEvent(e?e:i.event)}})}},_getWindow:function(){return a(this._parent.ownerDocument)},_ignoreEvent:function(e){for(var t=e.target;t&&t!==this._clientDiv;){if(t.ignore)return!0;t=t.parentNode}return!1},_init:function(e){var n=e.parent;if("string"==typeof n&&(n=(e.document||document).getElementById(n)),!n)throw"no parent";e.parent=n,e.model=e.model||new t.TextModel;var i=this._defaultOptions();for(var r in i)if(i.hasOwnProperty(r)){var o;o=void 0!==e[r]?e[r]:i[r].value,this["_"+r]=o}this._keyModes=[],this._rulers=[],this._selection=new y(0,0,!1),this._linksVisible=!1,this._redrawCount=0,this._maxLineWidth=0,this._maxLineIndex=-1,this._ignoreSelect=!0,this._ignoreFocus=!1,this._hasFocus=!1,this._columnX=-1,this._dragOffset=-1,this._isRangeRects=(!s.isIE||s.isIE>=9)&&"function"==typeof n.ownerDocument.createRange().getBoundingClientRect,this._isW3CEvents=n.addEventListener,this._autoScrollX=null,this._autoScrollY=null,this._autoScrollTimerID=null,this._AUTO_SCROLL_RATE=50,this._grabControl=null,this._moseMoveClosure=null,this._mouseUpClosure=null,this._lastMouseX=0,this._lastMouseY=0,this._lastMouseTime=0,this._clickCount=0,this._clickTime=250,this._clickDist=5,this._isMouseDown=!1,this._doubleClickSelection=null,this._hScroll=0,this._vScroll=0,this._imeOffset=-1,this._createActions(),this._createView()},_checkOverlayScroll:function(){if(s.isMac&&s.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var e=this._viewDiv,t=this._isOverOverlayScroll();e.style.pointerEvents=t.vertical||t.horizontal?"":"none"}},_isOverOverlayScroll:function(){var e=(new Date).getTime()-this._lastScrollTime<200;if(!e)return{};var t=this._viewDiv.getBoundingClientRect(),n=this._lastMouseMoveX,i=this._lastMouseMoveY,r=15;return{vertical:t.top<=i&&i<t.bottom&&t.right-r<=n&&n<t.right,horizontal:t.bottom-r<=i&&i<t.bottom&&t.left<=n&&n<t.right}},_modifyContent:function(e,t){if(this._readonly&&!e._code)return!1;if(e.type="Verify",this.onVerify(e),null===e.text||void 0===e.text)return!1;var n=this._model;try{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),n.setText(e.text,e.start,e.end)}finally{e._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(t){var i=this._getSelection();i.setCaret(e.start+e.text.length);try{e._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(i,!0)}finally{e._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}}return this.onModify({type:"Modify"}),!0},_onModelChanged:function(e){e.type="ModelChanged",this.onModelChanged(e),e.type="Changed";var t=e.start,n=e.addedCharCount,i=e.removedCharCount,r=e.addedLineCount,o=e.removedLineCount,s=this._getSelection();s.end>t&&(s.end>t&&s.start<t+i?s.setCaret(t+n):(s.start+=n-i,s.end+=n-i),this._setSelection(s,!1,!1));for(var a=this._model,l=a.getLineAtOffset(t),d=this._getLineNext();d;){var c=d.lineIndex;c>=l&&l+o>=c&&(l!==c||d.modelChangedEvent||d.lineRemoved?(d.lineRemoved=!0,d.lineChanged=!1,d.modelChangedEvent=null):(d.modelChangedEvent=e,d.lineChanged=!0)),c>l+o&&(d.lineIndex=c+r-o,d._line.lineIndex=d.lineIndex),d=this._getLineNext(d)}if(this._lineHeight){var h=[l,o].concat(new Array(r));Array.prototype.splice.apply(this._lineHeight,h)}this._wrapMode||l<=this._maxLineIndex&&this._maxLineIndex<=l+o&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0),this._update()},_onModelChanging:function(e){e.type="ModelChanging",this.onModelChanging(e),e.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var e=this,t=this._getWindow();this._updateTimer=t.setTimeout(function(){e._updateTimer=null,e._update()},0)}},_resetLineHeight:function(e,t){if(this._wrapMode||this._variableLineHeight){if(void 0!==e&&void 0!==t)for(var n=e;t>n;n++)this._lineHeight[n]=void 0;else this._lineHeight=new Array(this._model.getLineCount());this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var e=this._clientDiv;if(e)for(var t=e.firstChild;t;)t.lineWidth=void 0,t=t.nextSibling},_reset:function(){this._maxLineIndex=-1,this._maxLineWidth=0,this._columnX=-1,this._topChild=null,this._bottomChild=null,this._topIndexY=0,this._variableLineHeight=!1,this._resetLineHeight(),this._setSelection(new y(0,0,!1),!1,!1),this._viewDiv&&(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var e=this._clientDiv;if(e){for(var t=e.firstChild;t;)t.lineRemoved=!0,t=t.nextSibling;s.isFirefox<13&&this._fixCaret()}},_scrollViewAnimated:function(e,t,n){var i=this._getWindow();if(n&&this._scrollAnimation){var r=this;this._animation=new S({window:i,duration:this._scrollAnimation,curve:[t,0],onAnimate:function(e){var n=t-Math.floor(e);r._scrollView(0,n),t-=n},onEnd:function(){r._animation=null,r._scrollView(e,t),n&&i.setTimeout(n,0)}}),this._animation.play()}else this._scrollView(e,t),n&&i.setTimeout(n,0)},_scrollView:function(e,t){this._ensureCaretVisible=!1;var n=this._viewDiv;e&&(n.scrollLeft+=e),t&&(n.scrollTop+=t)},_setClipboardText:function(e,t){var n,i=this._getWindow(),r=i.clipboardData;if(!r&&t&&(r=t.clipboardData),r){n=[],p(e,function(e){n.push(e)},function(){n.push(s.platformDelimiter)});var o=r.setData(s.isIE?"Text":"text/plain",n.join(""));if(o||s.isFirefox>21)return!0}var a=this._parent.ownerDocument,l=s.createElement(a,"pre");l.style.position="fixed",l.style.left="-1000px",p(e,function(e){l.appendChild(a.createTextNode(e))},function(){l.appendChild(s.createElement(a,"br"))}),l.appendChild(a.createTextNode(" ")),this._clientDiv.appendChild(l);var d=a.createRange();d.setStart(l.firstChild,0),d.setEndBefore(l.lastChild);var c=i.getSelection();c.rangeCount>0&&c.removeAllRanges(),c.addRange(d);var h=this,u=function(){l&&l.parentNode===h._clientDiv&&h._clientDiv.removeChild(l),h._updateDOMSelection()},f=!1;this._ignoreCopy=!0;try{f=a.execCommand("copy",!1,null)}catch(g){}return this._ignoreCopy=!1,!f&&t?(i.setTimeout(u,0),!1):(u(),!0)},_setDOMSelection:function(e,t,n,i,r){this._setDOMFullSelection(e,t,n,i);var o,a=e._line.getNodeOffset(t),l=n._line.getNodeOffset(i),d=this._getWindow(),c=this._parent.ownerDocument;if(d.getSelection){var h=d.getSelection();if(o=c.createRange(),o.setStart(a.node,a.offset),o.setEnd(l.node,l.offset),!this._hasFocus||h.anchorNode===a.node&&h.anchorOffset===a.offset&&h.focusNode===l.node&&h.focusOffset===l.offset&&h.anchorNode===l.node&&h.anchorOffset===l.offset&&h.focusNode===a.node&&h.focusOffset===a.offset||(this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=l.node,this._focusOffset=l.offset,this._ignoreSelect=!1,h.rangeCount>0&&h.removeAllRanges(),h.addRange(o),this._ignoreSelect=!0),this._cursorDiv){o=c.createRange(),r?(o.setStart(a.node,a.offset),o.setEnd(a.node,a.offset)):(o.setStart(l.node,l.offset),o.setEnd(l.node,l.offset));var u=o.getClientRects()[0],p=this._cursorDiv.parentNode,f=p.getBoundingClientRect();u&&f&&(this._cursorDiv.style.top=u.top-f.top+p.scrollTop+"px",this._cursorDiv.style.left=u.left-f.left+p.scrollLeft+"px")}}else if(c.selection){if(!this._hasFocus)return;var g=c.body,m=s.createElement(c,"div");g.appendChild(m),g.removeChild(m),o=g.createTextRange(),o.moveToElementText(a.node.parentNode),o.moveStart("character",a.offset);var v=g.createTextRange();v.moveToElementText(l.node.parentNode),v.moveStart("character",l.offset),o.setEndPoint("EndToStart",v),this._ignoreSelect=!1,o.select(),this._ignoreSelect=!0}},_setDOMFullSelection:function(e,t,n,i){if(this._selDiv1){var r=this._selDiv1;if(r.style.width="0px",r.style.height="0px",r=this._selDiv2,r.style.width="0px",r.style.height="0px",r=this._selDiv3,r.style.width="0px",r.style.height="0px",e!==n||t!==i){var o=this._getViewPadding(),s=this._clientDiv.getBoundingClientRect(),a=this._viewDiv.getBoundingClientRect(),l=a.left+o.left,d=s.right,c=a.top+o.top,h=s.bottom,u=0,p=0;if(this._clipDiv){var f=this._clipDiv.getBoundingClientRect();u=f.left-this._clipDiv.scrollLeft,p=f.top}else{var g=this._rootDiv.getBoundingClientRect();u=g.left,p=g.top}this._ignoreDOMSelection=!0;var m=new C(this,e.lineIndex,e),v=m.getBoundingClientRect(t,!1),y=v.left,_=new C(this,n.lineIndex,n),w=_.getBoundingClientRect(i,!1),b=w.left;this._ignoreDOMSelection=!1;var x=this._selDiv1,S=Math.min(d,Math.max(l,y)),L=Math.min(h,Math.max(c,v.top)),E=d,k=Math.min(h,Math.max(c,v.bottom));if(x.style.left=S-u+"px",x.style.top=L-p+"px",x.style.width=Math.max(0,E-S)+"px",x.style.height=Math.max(0,k-L)+"px",e.lineIndex===n.lineIndex)E=Math.min(b,d),x.style.width=Math.max(0,E-S)+"px";else{var T=l,A=Math.min(h,Math.max(c,w.top)),N=Math.min(d,Math.max(l,b)),M=Math.min(h,Math.max(c,w.bottom)),I=this._selDiv3;if(I.style.left=T-u+"px",I.style.top=A-p+"px",I.style.width=Math.max(0,N-T)+"px",I.style.height=Math.max(0,M-A)+"px",Math.abs(e.lineIndex-n.lineIndex)>1){var D=this._selDiv2;D.style.left=l-u+"px",D.style.top=k-p+"px",D.style.width=Math.max(0,d-l)+"px",D.style.height=Math.max(0,A-k)+"px"}}}}},_setGrab:function(e){e!==this._grabControl&&(e?(e.setCapture&&e.setCapture(),this._grabControl=e):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(e){if(this._linksVisible!==e){this._linksVisible=e,s.isIE&&e&&(this._hadFocus=this._hasFocus);var t=this._clientDiv;t.contentEditable=!e,this._hadFocus&&!e&&t.focus(),this._overlayDiv&&(this._overlayDiv.style.zIndex=e?"-1":"1");for(var n=this._getLineNext();n;)n._line.updateLinks(),n=this._getLineNext(n);this._updateDOMSelection()}},_setSelection:function(e,t,n,i,r){if(e){this._columnX=-1,void 0===n&&(n=!0);var o=this._selection;if(this._selection=e,t!==!1&&this._showCaret(!1,i,t,r),n&&this._updateDOMSelection(),!o.equals(e)){var s={type:"Selection",oldValue:{start:o.start,end:o.end},newValue:{start:e.start,end:e.end}};this.onSelection(s)}}},_setSelectionTo:function(e,t,n,i){var r,o,s=this._model,a=this._getSelection(),l=this.convert({x:e,y:t},"page","document"),d=this._getLineIndex(l.y);if(1===this._clickCount){if(o=this._getLine(d),r=o.getOffset(l.x,l.y-this._getLinePixel(d)),o.destroy(),i&&!n&&a.start<=r&&r<a.end)return this._dragOffset=r,!1;a.extend(r),n||a.collapse()}else{var c,h,u=0===(1&this._clickCount);if(u)o=this._getLine(d),r=o.getOffset(l.x,l.y-this._getLinePixel(d)),this._doubleClickSelection?r>=this._doubleClickSelection.start?(c=this._doubleClickSelection.start,h=o.getNextOffset(r,{unit:"wordend",count:1})):(c=o.getNextOffset(r,{unit:"word",count:-1}),h=this._doubleClickSelection.end):(c=o.getNextOffset(r,{unit:"word",count:-1}),h=o.getNextOffset(c,{unit:"wordend",count:1})),o.destroy();else if(this._doubleClickSelection){var p=s.getLineAtOffset(this._doubleClickSelection.start);d>=p?(c=s.getLineStart(p),h=s.getLineEnd(d)):(c=s.getLineStart(d),h=s.getLineEnd(p))}else c=s.getLineStart(d),h=s.getLineEnd(d);a.setCaret(c),a.extend(h)}return this._setSelection(a,!0,!0),!0},_setFullSelection:function(e,t){this._fullSelection=e,s.isWebkit&&(this._fullSelection=!0);var n=this._clipDiv||this._rootDiv;if(n){if(!this._fullSelection)return this._selDiv1&&(n.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(n.removeChild(this._selDiv2),this._selDiv2=null),void(this._selDiv3&&(n.removeChild(this._selDiv3),this._selDiv3=null));if(!this._selDiv1&&this._fullSelection&&!s.isIOS){var i=n.ownerDocument;this._highlightRGB=s.isWebkit?"transparent":"Highlight";var r=s.createElement(i,"div");this._selDiv1=r,r.style.position="absolute",r.style.borderWidth="0px",r.style.margin="0px",r.style.padding="0px",r.style.outline="none",r.style.background=this._highlightRGB,r.style.width="0px",r.style.height="0px",r.style.zIndex="0",n.appendChild(r);var o=s.createElement(i,"div");this._selDiv2=o,o.style.position="absolute",o.style.borderWidth="0px",o.style.margin="0px",o.style.padding="0px",o.style.outline="none",o.style.background=this._highlightRGB,o.style.width="0px",o.style.height="0px",o.style.zIndex="0",n.appendChild(o);var a=s.createElement(i,"div");if(this._selDiv3=a,a.style.position="absolute",a.style.borderWidth="0px",a.style.margin="0px",a.style.padding="0px",a.style.outline="none",a.style.background=this._highlightRGB,a.style.width="0px",a.style.height="0px",a.style.zIndex="0",n.appendChild(a),s.isFirefox&&s.isMac){var l=this._getWindow(),d=l.getComputedStyle(a,null),c=d.getPropertyValue("background-color");switch(c){case"rgb(119, 141, 168)":c="rgb(199, 208, 218)";break;case"rgb(127, 127, 127)":c="rgb(198, 198, 198)";break;case"rgb(255, 193, 31)":c="rgb(250, 236, 115)";break;case"rgb(243, 70, 72)":c="rgb(255, 176, 139)";break;case"rgb(255, 138, 34)":c="rgb(255, 209, 129)";break;case"rgb(102, 197, 71)":c="rgb(194, 249, 144)";break;case"rgb(140, 78, 184)":c="rgb(232, 184, 255)";break;default:c="rgb(180, 213, 255)"}this._highlightRGB=c,r.style.background=c,o.style.background=c,a.style.background=c}t||this._updateDOMSelection()}}},_setBlockCursor:function(e){this._blockCursorVisible=e,this._updateBlockCursorVisible()},_setOverwriteMode:function(e){this._overwriteMode=e,this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var e=this._viewDiv,t=s.createElement(e.ownerDocument,"div");t.className="textviewBlockCursor",this._cursorDiv=t,t.tabIndex=-1,t.style.zIndex="2",t.style.color="transparent",t.style.position="absolute",t.style.pointerEvents="none",t.innerHTML="&nbsp;",e.appendChild(t),this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(e,t){this._marginOffset=e,this._marginDiv.style.display=e?"block":"none",t||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setWrapOffset:function(e,t){this._wrapOffset=e,t||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(e){this._readonly=e,this._clientDiv.setAttribute("aria-readonly",e?"true":"false")},_setSingleMode:function(e,t){this._singleMode=e,this._updateOverflow(),this._updateStyle(t)},_setTabSize:function(e,t){this._tabSize=e,this._customTabSize=void 0;var n=this._clientDiv;s.isOpera?n&&(n.style.OTabSize=this._tabSize+""):s.isWebkit>=537.1?n&&(n.style.tabSize=this._tabSize+""):s.isFirefox>=4?n&&(n.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize),t||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(e){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._theme=e,this._theme&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged),this._setThemeClass(this._themeClass)},_setThemeClass:function(e,t){this._themeClass=e;var n="textview",i=this._theme.getThemeClass();i&&(n+=" "+i),this._themeClass&&i!==this._themeClass&&(n+=" "+this._themeClass),this._rootDiv.className=n,this._updateStyle(t)},_setWrapMode:function(e,t){this._wrapMode=e&&this._wrappable;var n=this._clientDiv;this._wrapMode?(n.style.whiteSpace="pre-wrap",n.style.wordWrap="break-word"):(n.style.whiteSpace="pre",n.style.wordWrap="normal"),this._updateOverflow(),t||(this.redraw(),this._resetLineWidth()),this._resetLineHeight()},_showCaret:function(e,t,n,i){if(this._clientDiv&&!(this._redrawCount>0||this._ignoreDOMSelection)){var r=this._model,o=this._getSelection(),s=this._getScroll(),a=o.getCaret(),l=o.start,d=o.end,c=r.getLineAtOffset(l),h=r.getLineAtOffset(d),u=Math.max(Math.max(l,r.getLineStart(h)),d-1),p=this._getClientWidth(),f=this._getClientHeight(),g=p/4,m=this._getBoundsAtOffset(a===l?l:u),v=m.left,y=m.right,_=m.top,C=m.bottom,w=0,b="object"==typeof n;!e&&!b||o.isEmpty()||(m=this._getBoundsAtOffset(a===d?l:u),w=(m.bottom>C?m.bottom:C)-(m.top<_?m.top:_),e&&(m.top===_?a===l?y=v+Math.min(m.right-v,p):v=y-Math.min(y-m.left,p):a===l?C=_+Math.min(m.bottom-_,f):_=C-Math.min(C-m.top,f)));var x=0;v<s.x&&(x=Math.min(v-s.x,-g)),y>s.x+p&&(x=Math.max(y-s.x-p,g));var S=0;_<s.y?S=_-s.y:C>s.y+f&&(S=C-s.y-f),i&&(i>0?S>0&&(S=Math.max(S,i)):0>S&&(S=Math.min(S,i)));var L=b&&"always"===n.scrollPolicy;if(0!==x||0!==S||L){if(b){var E=S>0;0===S&&(S=_-s.y);var k=n.viewAnchor,T=n.selectionAnchor,A=Math.min(Math.max(0,n.viewAnchorOffset||0));S+=Math.floor("top"===k?E?(1-A)*f:-A*f:"bottom"===k?E?A*f:-(1-A)*f:"center"===k?E?f/2+A*f:f/2-(1-A)*f:E?A*f:-A*f),c!==h&&("top"===T&&a!==l?S+=Math.floor(-w):"bottom"===T&&a!==d?S+=Math.floor(w):"center"===T&&(S+=Math.floor(w/2)))}else 0!==S&&"number"==typeof n&&(0>n&&(n=0),n>1&&(n=1),S+=Math.floor(S>0?n*f:-n*f));return this._scrollViewAnimated(x,S,t),f!==this._getClientHeight()||p!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0}return t&&t(),!1}},_startIME:function(){if(-1===this._imeOffset){var e=this._getSelection();e.isEmpty()||this._modifyContent({text:"",start:e.start,end:e.end},!0),this._imeOffset=e.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging),this._model.removeEventListener("postChanged",this._modelListener.onChanged),this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged),this._modelListener=null;for(var e=0;e<this._handlers.length;e++){var t=this._handlers[e];x(t.target,t.type,t.handler)}this._handlers=null,this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(this._redrawCount>0)&&!this._ignoreDOMSelection&&this._clientDiv){var e=this._getSelection(),t=this._model,n=t.getLineAtOffset(e.start),i=t.getLineAtOffset(e.end),r=this._getLineNext();if(r){var o,s,a,l,d=this._getLinePrevious();n<r.lineIndex?(o=r,a=t.getLineStart(r.lineIndex)):n>d.lineIndex?(o=d,a=t.getLineStart(d.lineIndex)):(o=this._getLineNode(n),a=e.start),i<r.lineIndex?(s=r,l=t.getLineStart(r.lineIndex)):i>d.lineIndex?(s=d,l=t.getLineStart(d.lineIndex)):(s=this._getLineNode(i),l=e.end),this._setDOMSelection(o,a,s,l,e.caret)}}},_update:function(e){if(!(this._redrawCount>0)){if(this._updateTimer){var t=this._getWindow();t.clearTimeout(this._updateTimer),this._updateTimer=null,e=!1}var n=this._clientDiv,i=this._viewDiv;if(n){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var r=this._model,o=this._getScroll(!1),a=this._getViewPadding(),l=r.getLineCount(),d=this._getLineHeight(),c=!1,h=!1,u=!1,p=this._metrics.scrollWidth;this._wrapMode&&(n.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var f,g,m,v,y,_,w,b,x,S,L,E=0,k=0;if(this._lineHeight){for(;l>k&&(L=this._getLineHeight(k),!(E+L>o.y));)E+=L,k++;f=k,g=Math.max(0,f-1),v=m=o.y-E,f>0&&(m+=this._getLineHeight(f-1))}else{var T=Math.max(0,o.y)/d;f=Math.floor(T),g=Math.max(0,f-1),m=Math.round((T-g)*d),v=Math.round((T-f)*d),S=l*d}this._topIndexY=v;var A=this._rootDiv,N=A.clientWidth,M=A.clientHeight;if(e){for(y=0,this._leftDiv&&(_=this._leftDiv.getBoundingClientRect(),y=_.right-_.left),w=this._getClientWidth(),b=this._getClientHeight(),x=w,this._wrapMode?this._metrics.wrapWidth&&(x=this._metrics.wrapWidth):x=Math.max(this._maxLineWidth,x);l>k;)L=this._getLineHeight(k,!1),E+=L,k++;S=E}else{b=this._getClientHeight();for(var I,D,R=Math.floor((b+v)/d),P=Math.min(f+R,l-1),O=Math.min(P+1,l-1),B=n.firstChild;B;){I=B.lineIndex;var F=B.nextSibling;I>=g&&O>=I&&!B.lineRemoved&&-1!==B.lineIndex||(this._mouseWheelLine===B?(B.style.display="none",B.lineIndex=-1):n.removeChild(B)),B=F}B=this._getLineNext();var V=i.ownerDocument,j=V.createDocumentFragment();for(I=g;O>=I;I++)!B||B.lineIndex>I?new C(this,I).create(j,null):(j.firstChild&&(n.insertBefore(j,B),j=V.createDocumentFragment()),B&&B.lineChanged&&(B=new C(this,I).create(j,B),B.lineChanged=!1),B=this._getLineNext(B));j.firstChild&&n.insertBefore(j,B),s.isWebkit&&!this._wrapMode&&(n.style.width="0x7fffffffpx");var U;B=this._getLineNext();for(var H=b+m,W=!1;B;){if(D=B.lineWidth,void 0===D){U=B._line.getBoundingClientRect(),D=B.lineWidth=Math.ceil(U.right-U.left);var $=U.bottom-U.top;this._lineHeight?this._lineHeight[B.lineIndex]=$:0!==d&&0!==$&&Math.ceil(d)!==Math.ceil($)&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[B.lineIndex]=$)}this._lineHeight&&!W&&(H-=this._lineHeight[B.lineIndex],0>H&&(P=B.lineIndex,W=!0)),this._wrapMode||(D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=B.lineIndex),this._checkMaxLineIndex===B.lineIndex&&(this._checkMaxLineIndex=-1)),B.lineIndex===f&&(this._topChild=B),B.lineIndex===P&&(this._bottomChild=B),B=this._getLineNext(B)}if(-1!==this._checkMaxLineIndex&&(I=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,I>=0&&l>I)){var K=new C(this,I);U=K.getBoundingClientRect(),D=U.right-U.left,D>=this._maxLineWidth&&(this._maxLineWidth=D,this._maxLineIndex=I),K.destroy()}for(;l>k;)L=this._getLineHeight(k,P>=k),E+=L,k++;S=E,this._updateRuler(this._leftDiv,f,O,M),this._updateRuler(this._rightDiv,f,O,M),this._updateRuler(this._marginDiv,f,O,M),y=0,this._leftDiv&&(_=this._leftDiv.getBoundingClientRect(),y=_.right-_.left);var G=0;if(this._rightDiv){var z=this._rightDiv.getBoundingClientRect();G=z.right-z.left}i.style.left=y+"px",i.style.right=G+"px";var q=this._scrollDiv;if(q.style.height=S+"px",w=this._getClientWidth(),!this._singleMode&&!this._wrapMode){var Y=b,X=b,J="scroll"===i.style.overflowX;
J?Y+=p:X-=p;var Z=w,Q=w,et="scroll"===i.style.overflowY;et?Z+=p:Q-=p,b=Y,w=Z,S>b&&(u=!0,w=Q),this._maxLineWidth>w&&(h=!0,b=X,S>b&&(u=!0,w=Q)),J!==h&&(i.style.overflowX=h?"scroll":"hidden"),et!==u&&(i.style.overflowY=u?"scroll":"hidden"),c=J!==h||et!==u}var tt=w;this._wrapMode?this._metrics.wrapWidth&&(tt=this._metrics.wrapWidth):tt=Math.max(this._maxLineWidth,tt),x=tt,(!s.isIE||s.isIE>=9)&&this._maxLineWidth>w&&(tt+=a.right+a.left),q.style.width=tt+"px",this._clipScrollDiv&&(this._clipScrollDiv.style.width=tt+"px"),o=this._getScroll(!1)}if(this._vScrollDiv){var nt=b-8,it=Math.max(15,Math.ceil(Math.min(1,nt/(S+a.top+a.bottom))*nt));this._vScrollDiv.style.left=y+w-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,o.y*nt/S))+"px",this._vScrollDiv.style.height=it+"px"}if(!this._wrapMode&&this._hScrollDiv){var rt=w-8,ot=Math.max(15,Math.ceil(Math.min(1,rt/(this._maxLineWidth+a.left+a.right))*rt));this._hScrollDiv.style.left=y+Math.floor(Math.max(0,Math.floor(o.x*rt/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=b-9+"px",this._hScrollDiv.style.width=ot+"px"}var st,at,lt=o.x,dt=this._clipDiv,ct=this._overlayDiv,ht=this._marginDiv;if(ht&&(ht.style.left=-lt+y+this._metrics.marginWidth+a.left+"px",ht.style.bottom=("scroll"===i.style.overflowX?p:0)+"px"),dt){dt.scrollLeft=lt,dt.scrollTop=0,st=y+a.left,at=a.top;var ut=w,pt=b,ft=0,gt=-m;0===o.x&&(st-=a.left,ut+=a.left,ft=a.left),o.x+w===x&&(ut+=a.right),0===o.y&&(at-=a.top,pt+=a.top,gt+=a.top),o.y+b===S&&(pt+=a.bottom),dt.style.left=st+"px",dt.style.top=at+"px",dt.style.right=N-ut-st+"px",dt.style.bottom=M-pt-at+"px",n.style.left=ft+"px",n.style.top=gt+"px",n.style.width=x+"px",n.style.height=b+m+"px",ct&&(ct.style.left=n.style.left,ct.style.top=n.style.top,ct.style.width=n.style.width,ct.style.height=n.style.height)}else{st=lt,at=m;var mt=lt+w,vt=m+b;0===st&&(st-=a.left),0===at&&(at-=a.top),mt===x&&(mt+=a.right),o.y+b===S&&(vt+=a.bottom),n.style.clip="rect("+at+"px,"+mt+"px,"+vt+"px,"+st+"px)",n.style.left=-lt+y+a.left+"px",n.style.width=(this._wrapMode||s.isWebkit?x:w+lt)+"px",e||(n.style.top=-m+a.top+"px",n.style.height=b+m+"px"),ct&&(ct.style.clip=n.style.clip,ct.style.left=n.style.left,ct.style.width=n.style.width,e||(ct.style.top=n.style.top,ct.style.height=n.style.height))}if(this._updateDOMSelection(),c){var yt=this._ensureCaretVisible;this._ensureCaretVisible=!1,yt&&this._showCaret(),this._queueUpdate()}}}},_updateOverflow:function(){var e=this._viewDiv;this._wrapMode?(e.style.overflowX="hidden",e.style.overflowY="scroll"):e.style.overflow="hidden"},_updateRuler:function(e,t,n,i){if(e)for(var r=this._parent.ownerDocument,o=this._getLineHeight(),a=this._getViewPadding(),d=e.firstChild;d;){var c=d._ruler,h=o,u=c.getOverview();"page"===u&&(h+=this._topIndexY),d.style.top=-h+"px",d.style.height=i+h+"px",d.rulerChanged&&l(c.getRulerStyle(),d);var p,f=d.firstChild;f?(p=f,f=f.nextSibling):(p=s.createElement(r,"div"),p.style.visibility="hidden",d.appendChild(p));var g,m;d.rulerChanged&&p&&(g=-1,m=c.getWidestAnnotation(),m&&(l(m.style,p),m.html&&(p.innerHTML=m.html)),p.lineIndex=g,p.style.height=o+a.top+"px");var v,y,_;if("page"===u){for(_=c.getAnnotations(t,n+1);f;){g=f.lineIndex;var C=f.nextSibling;g>=t&&n>=g&&!f.lineChanged||d.removeChild(f),f=C}for(f=d.firstChild.nextSibling,y=r.createDocumentFragment(),g=t;n>=g;g++)!f||f.lineIndex>g?(v=s.createElement(r,"div"),m=_[g],m&&(l(m.style,v),m.html&&(v.innerHTML=m.html),v.annotation=m),v.lineIndex=g,v.style.height=this._getLineHeight(g)+"px",y.appendChild(v)):(y.firstChild&&(d.insertBefore(y,f),y=r.createDocumentFragment()),f&&(f=f.nextSibling));y.firstChild&&d.insertBefore(y,f)}else{var w,b=this._getClientHeight(),x=this._model.getLineCount(),S=o*x,L=b+a.top+a.bottom-2*this._metrics.scrollWidth;if(w=L>S?o:L/x,d.rulerChanged){for(var E=d.childNodes.length;E>1;)d.removeChild(d.lastChild),E--;_=c.getAnnotations(0,x),y=r.createDocumentFragment();for(var k in _)g=k>>>0,0>g||(v=s.createElement(r,"div"),m=_[k],l(m.style,v),v.style.position="absolute",v.style.top=this._metrics.scrollWidth+o+Math.floor(g*w)+"px",m.html&&(v.innerHTML=m.html),v.annotation=m,v.lineIndex=g,y.appendChild(v));d.appendChild(y)}else if(d._oldTrackHeight!==L)for(v=d.firstChild?d.firstChild.nextSibling:null;v;)v.style.top=this._metrics.scrollWidth+o+Math.floor(v.lineIndex*w)+"px",v=v.nextSibling;d._oldTrackHeight=L}d.rulerChanged=!1,d=d.nextSibling}},_updateStyleSheet:function(){var e="";if(s.isWebkit&&this._metrics.scrollWidth>0&&(e+="\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}"),s.isFirefox&&s.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB&&(e+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}"),e){var t=this._clientDiv.ownerDocument,n=t.getElementById("_textviewStyle");if(n)n.removeChild(n.firstChild),n.appendChild(t.createTextNode(e));else{n=s.createElement(t,"style"),n.id="_textviewStyle";var i=t.getElementsByTagName("head")[0]||t.documentElement;n.appendChild(t.createTextNode(e)),i.insertBefore(n,i.firstChild)}}},_updateStyle:function(e){!e&&s.isIE&&(this._rootDiv.style.lineHeight="normal");var t=this._metrics=this._calculateMetrics();if(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._rootDiv.style.lineHeight=s.isIE?t.lineHeight-(t.lineTrim.top+t.lineTrim.bottom)+"px":"normal",this._updateStyleSheet(),s.isMac&&s.isWebkit){var n=this._viewDiv;t.invalid||0!==t.scrollWidth?(n.style.pointerEvents="",n.style.zIndex=""):(n.style.pointerEvents="none",n.style.zIndex="2")}e||(this.redraw(),this._resetLineWidth())}},i.EventTarget.addMixin(w.prototype),{TextView:w}}),define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(e,t){function n(e){this._model=e,this._projections=[];var t=this;this._listener={onChanged:function(e){t._onChanged(e)},onChanging:function(e){t._onChanging(e)}},e.addEventListener("postChanged",this._listener.onChanged),e.addEventListener("preChanging",this._listener.onChanging)}return n.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(t){if(t){var n=this._model,i=this._projections;t._lineIndex=n.getLineAtOffset(t.start),t._lineCount=n.getLineAtOffset(t.end)-t._lineIndex;var r=t.text;r||(r=""),t._model="string"==typeof r?new e.TextModel(r,n.getLineDelimiter()):r;var o=this.mapOffset(t.start,!0),s=t.end-t.start,a=t._lineCount,l=t._model.getCharCount(),d=t._model.getLineCount()-1,c={type:"Changing",text:t._model.getText(),start:o,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:d};this.onChanging(c);var h=this._binarySearch(i,t.start);i.splice(h,0,t);var u={type:"Changed",start:o,removedCharCount:s,addedCharCount:l,removedLineCount:a,addedLineCount:d};this.onChanged(u)}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(e,t){var n,i,r=this._projections,o=0;if(t){for(n=0;n<r.length&&(i=r[n],!(i.start>e));n++){if(i.end>e)return-1;o+=i._model.getCharCount()-(i.end-i.start)}return e+o}for(n=0;n<r.length&&(i=r[n],!(i.start>e-o));n++){var s=i._model.getCharCount();if(i.start+s>e-o)return-1;o+=s-(i.end-i.start)}return e-o},removeProjection:function(e){this._removeProjection(e)},_removeProjection:function(e,t){var n,i=0;for(n=0;n<this._projections.length;n++){var r=this._projections[n];if(r===e){e=r;break}i+=r._model.getCharCount()-(r.end-r.start)}if(n<this._projections.length){var o=this._model,s=e.start+i,a=e.end-e.start,l=e._lineCount,d=e._model.getCharCount(),c=e._model.getLineCount()-1;if(!t){var h={type:"Changing",text:o.getText(e.start,e.end),start:s,removedCharCount:d,addedCharCount:a,removedLineCount:c,addedLineCount:l};this.onChanging(h)}if(this._projections.splice(n,1),!t){var u={type:"Changed",start:s,removedCharCount:d,addedCharCount:a,removedLineCount:c,addedLineCount:l};this.onChanged(u)}}},_binarySearch:function(e,t){for(var n,i=e.length,r=-1;i-r>1;)n=Math.floor((i+r)/2),t<=e[n].start?i=n:r=n;return i},getCharCount:function(){for(var e=this._model.getCharCount(),t=this._projections,n=0;n<t.length;n++){var i=t[n];e+=i._model.getCharCount()-(i.end-i.start)}return e},getLine:function(e,t){if(0>e)return null;var n,i,r,o=this._model,s=this._projections,a=0,l=[],d=0;for(n=0;n<s.length&&(r=s[n],!(r._lineIndex>=e-a));n++){if(i=r._model.getLineCount()-1,r._lineIndex+i>=e-a){var c=e-(r._lineIndex+a);if(i>c)return r._model.getLine(c,t);l.push(r._model.getLine(i))}d=r.end,a+=i-r._lineCount}for(d=Math.max(d,o.getLineStart(e-a));n<s.length&&(r=s[n],!(r._lineIndex>e-a));n++){if(l.push(o.getText(d,r.start)),i=r._model.getLineCount()-1,r._lineIndex+i>e-a)return l.push(r._model.getLine(0,t)),l.join("");l.push(r._model.getText()),d=r.end,a+=i-r._lineCount}var h=o.getLineEnd(e-a,t);return h>d&&l.push(o.getText(d,h)),l.join("")},getLineAtOffset:function(e){for(var t=this._model,n=this._projections,i=0,r=0,o=0;o<n.length;o++){var s=n[o];if(s.start>e-i)break;var a=s._model.getCharCount();if(s.start+a>e-i){var l=e-(s.start+i);r+=s._model.getLineAtOffset(l),i+=l;break}r+=s._model.getLineCount()-1-s._lineCount,i+=a-(s.end-s.start)}return t.getLineAtOffset(e-i)+r},getLineCount:function(){for(var e=this._model,t=this._projections,n=e.getLineCount(),i=0;i<t.length;i++){var r=t[i];n+=r._model.getLineCount()-1-r._lineCount}return n},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(e,t){if(0>e)return-1;for(var n=this._model,i=this._projections,r=0,o=0,s=0;s<i.length;s++){var a=i[s];if(a._lineIndex>e-r)break;var l=a._model.getLineCount()-1;if(a._lineIndex+l>e-r){var d=e-(a._lineIndex+r);return a._model.getLineEnd(d,t)+a.start+o}o+=a._model.getCharCount()-(a.end-a.start),r+=l-a._lineCount}return n.getLineEnd(e-r,t)+o},getLineStart:function(e){if(0>e)return-1;for(var t=this._model,n=this._projections,i=0,r=0,o=0;o<n.length;o++){var s=n[o];if(s._lineIndex>=e-i)break;var a=s._model.getLineCount()-1;if(s._lineIndex+a>=e-i){var l=e-(s._lineIndex+i);return s._model.getLineStart(l)+s.start+r}r+=s._model.getCharCount()-(s.end-s.start),i+=a-s._lineCount}return t.getLineStart(e-i)+r},getText:function(e,t){void 0===e&&(e=0);var n,i,r,o=this._model,s=this._projections,a=0,l=[];for(n=0;n<s.length&&(i=s[n],!(i.start>e-a));n++){if(r=i._model.getCharCount(),i.start+r>e-a){if(void 0!==t&&i.start+r>t-a)return i._model.getText(e-(i.start+a),t-(i.start+a));l.push(i._model.getText(e-(i.start+a))),e=i.end+a+r-(i.end-i.start)}a+=r-(i.end-i.start)}var d=e-a;if(void 0!==t){for(;n<s.length&&(i=s[n],!(i.start>t-a));n++){if(l.push(o.getText(d,i.start)),r=i._model.getCharCount(),i.start+r>t-a)return l.push(i._model.getText(0,t-(i.start+a))),l.join("");l.push(i._model.getText()),d=i.end,a+=r-(i.end-i.start)}l.push(o.getText(d,t-a))}else{for(;n<s.length;n++)i=s[n],l.push(o.getText(d,i.start)),l.push(i._model.getText()),d=i.end;l.push(o.getText(d))}return l.join("")},_onChanged:function(){var e,t,n=this._change,i=n.baseStart,r=n.baseEnd,o=this._projections;for(e=0;e<o.length&&(t=o[e],!(t.end>i));e++);var s=e;for(e=0;e<o.length&&(t=o[e],!(t.start>=r));e++);var a=e,l=this._model,d=n.baseText.length-(r-i);for(e=a;e<o.length;e++)t=o[e],t.start+=d,t.end+=d,t._lineIndex=l.getLineAtOffset(t.start);var c=o.splice(s,a-s);for(e=0;e<c.length;e++)c[e].annotation&&c[e].annotation._expand();var h={type:"Changed",start:n.start,removedCharCount:n.removedCharCount,addedCharCount:n.addedCharCount,removedLineCount:n.removedLineCount,addedLineCount:n.addedLineCount};this.onChanged(h),this._change=void 0},_onChanging:function(e){function t(e){for(a=0,s=0;a<d.length&&(l=d[a],!(l.start>e));a++){if(l.end>e)return-1;s+=l._model.getCharCount()-(l.end-l.start)}return e+s}var n=!!this._change,i=this._change||{},r=e.start,o=r+e.removedCharCount;if(i.baseStart=r,i.baseEnd=o,i.baseText=e.text,i.addedLineCount=e.addedLineCount,!n){this._change=i,i.text=e.text;var s,a,l,d=this._projections;i.start=t(r),-1===i.start&&(i.text=this._model.getText(l.start,r)+i.text,i.addedLineCount+=this._model.getLineAtOffset(r)-this._model.getLineAtOffset(l.start),i.start=l.start+s),i.end=t(o),-1===i.end&&(i.text+=this._model.getText(o,l.end),i.addedLineCount+=this._model.getLineAtOffset(l.end)-this._model.getLineAtOffset(o),i.end=l.start+s)}i.addedCharCount=i.text.length,i.removedCharCount=i.end-i.start,i.removedLineCount=this.getLineAtOffset(i.end)-this.getLineAtOffset(i.start);var c={type:"Changing",text:i.text,start:i.start,removedCharCount:i.removedCharCount,addedCharCount:i.addedCharCount,removedLineCount:i.removedLineCount,addedLineCount:i.addedLineCount};this.onChanging(c)},onChanging:function(e){return this.dispatchEvent(e)},onChanged:function(e){return this.dispatchEvent(e)},setLineDelimiter:function(e){this._model.setLineDelimiter(e)},setText:function(e,t,n){function i(e){for(o=0,r=0;o<d.length&&(s=d[o],!(s.start>e-r));o++){var t=s._model.getCharCount();if(s.start+t>e-r)return-1;r+=t-(s.end-s.start)}return e-r}this._change={text:e||"",start:t||0,end:void 0===n?this.getCharCount():n};var r,o,s,a,l,d=this._projections,c=i(this._change.start);-1===c&&(a={projection:s,start:this._change.start-(s.start+r)},c=s.end);var h=i(this._change.end);-1===h&&(l={projection:s,end:this._change.end-(s.start+r)},h=s.start),a&&l&&a.projection===l.projection?s._model.setText(this._change.text,a.start,l.end):(this._model.setText(this._change.text,c,h),a&&(s=a.projection,s._model.setText("",a.start)),l&&(s=l.projection,s._model.setText("",0,l.end),s.start=s.end,s._lineCount=0)),this._change=void 0}},t.EventTarget.addMixin(n.prototype),{ProjectionTextModel:n}}),define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/util","orion/util"],function(e,t,n,i,r,o){function s(e){this._view=e,this._fadeDelay=500,this._hideDelay=200,this._showDelay=500,this._autoHideDelay=5e3,this._create(e.getOptions("parent").ownerDocument)}return s.getTooltip=function(e){return e._tooltip||(e._tooltip=new s(e)),e._tooltip},s.prototype={_create:function(e){if(!this._tooltipDiv){var t=this._tooltipDiv=o.createElement(e,"div");t.tabIndex=0,t.className="textviewTooltip",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true");var n=this._tooltipContents=o.createElement(e,"div");t.appendChild(n),e.body.appendChild(t);var i=this;r.addEventListener(t,"mouseover",function(){if(i._hideDelay){var e=i._getWindow();i._delayedHideTimeout&&(e.clearTimeout(i._delayedHideTimeout),i._delayedHideTimeout=null),i._hideTimeout&&(e.clearTimeout(i._hideTimeout),i._hideTimeout=null),i._nextTarget=null}},!1),r.addEventListener(t,"mouseout",function(e){var n=e.relatedTarget||e.toElement;n===t||i._hasFocus()||n&&r.contains(t,n)||i._hide()},!1),r.addEventListener(t,"keydown",function(e){27===e.keyCode&&i._hide()},!1),r.addEventListener(e,"mousedown",this._mouseDownHandler=function(e){i.isVisible()&&(r.contains(t,e.target||e.srcElement)||i._hide())},!0),this._view.addEventListener("Destroy",function(){i.destroy()}),this._hide()}},_getWindow:function(){var e=this._tooltipDiv.ownerDocument;return e.defaultView||e.parentWindow},destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);var t=this._tooltipDiv.ownerDocument;r.removeEventListener(t,"mousedown",this._mouseDownHandler,!0),this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;if(!e)return!1;var t=e.ownerDocument;return r.contains(e,t.activeElement)},hide:function(e){void 0===e&&(e=this._hideDelay);var t=this._getWindow();this._delayedHideTimeout&&(t.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null);var n=this;e?n._delayedHideTimeout=t.setTimeout(function(){n._delayedHideTimeout=null,n._hide(),n.setTarget(n._nextTarget,0)},e):(n._hide(),n.setTarget(n._nextTarget,0))},_hide:function(){var e=this._tooltipDiv;if(e){this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),e.style.visibility="hidden";var t=this._getWindow();this._showTimeout&&(t.clearTimeout(this._showTimeout),this._showTimeout=null),this._delayedHideTimeout&&(t.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(t.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(t.clearInterval(this._fadeTimeout),this._fadeTimeout=null)}},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(e,t,n){var i=this.isVisible();if(i){if(this._hasFocus())return;this._nextTarget=e,this.hide(n)}else if(this._target=e,e){var r=this,o=r._getWindow();r._showTimeout&&(o.clearTimeout(r._showTimeout),r._showTimeout=null),0===t?r.show(!0):r._showTimeout=o.setTimeout(function(){r._showTimeout=null,r.show(!0)},t?t:r._showDelay)}},show:function(e){if(this._target){var n=this._target.getTooltipInfo();if(n){var r=this._tooltipDiv,o=this._tooltipContents;r.style.left=r.style.right=r.style.width=r.style.height=o.style.width=o.style.height="auto";var s=n.contents;if(s instanceof Array&&(s=this._getAnnotationContents(s)),"string"==typeof s)o.innerHTML=s;else if(this._isNode(s))o.appendChild(s);else{if(!(s instanceof i.ProjectionTextModel))return;var a=this._view,l=a.getOptions();l.wrapMode=!1,l.parent=o;var d="tooltipTheme",c=l.themeClass;c?(c=c.replace(d,""),c&&(c=" "+c),c=d+c):c=d,l.themeClass=c;var h=this._contentsView=new t.TextView(l),u={onLineStyle:function(e){a.onLineStyle(e)}};h.addEventListener("LineStyle",u.onLineStyle),h.setModel(s);var p=h.computeSize();o.style.width=p.width+"px",o.style.height=p.height+"px",h.resize()}var f=r.ownerDocument.documentElement;if("right"===n.anchor){var g=f.clientWidth-n.x;r.style.right=g+"px",r.style.maxWidth=f.clientWidth-g-10+"px"}else{var m=parseInt(this._getNodeStyle(r,"padding-left","0"),10);m+=parseInt(this._getNodeStyle(r,"border-left-width","0"),10),m=n.x-m,r.style.left=m+"px",r.style.maxWidth=f.clientWidth-m-10+"px"}var v=parseInt(this._getNodeStyle(r,"padding-top","0"),10);if(v+=parseInt(this._getNodeStyle(r,"border-top-width","0"),10),v=n.y-v,r.style.top=v+"px",r.style.maxHeight=f.clientHeight-v-10+"px",r.style.opacity="1",r.style.visibility="visible",e){var y=this,_=this._getWindow();y._hideTimeout=_.setTimeout(function(){y._hideTimeout=null;var e=parseFloat(y._getNodeStyle(r,"opacity","1"));y._fadeTimeout=_.setInterval(function(){return"visible"===r.style.visibility&&e>0?(e-=.1,void(r.style.opacity=e)):void y._hide()},y._fadeDelay/10)},y._autoHideDelay)}}}},_getAnnotationContents:function(t){function n(e,t){var n=g.getLineStart(g.getLineAtOffset(e)),i=g.getLineEnd(g.getLineAtOffset(t),!0);return g.getText(n,i)}function s(e){var t=e.title,i=o.createElement(u,"div");if(i.className="tooltipRow",e.html&&(i.innerHTML=e.html,i.lastChild&&r.addEventListener(i.lastChild,"click",function(){var t=e.start,n=e.end;f.getBaseModel&&(t=f.mapOffset(t,!0),n=f.mapOffset(n,!0)),p.setSelection(t,n,1/3,function(){h._hide()})},!1),i.appendChild(u.createTextNode(" "))),t||(t=n(e.start,e.end)),"function"==typeof t&&(t=e.title()),"string"==typeof t){var s=o.createElement(u,"span");s.appendChild(u.createTextNode(t)),t=s}return i.appendChild(t),i}for(var a,l=[],d=0;d<t.length;d++)a=t[d],""===a.title||a.groupAnnotation||l.push(a);if(t=l,0===t.length)return null;var c,h=this,u=this._tooltipDiv.ownerDocument,p=this._view,f=p.getModel(),g=f.getBaseModel?f.getBaseModel():f;if(1===t.length){if(a=t[0],void 0!==a.title){if(c=s(a),c.firstChild){var m=c.firstChild.className;m&&(m+=" "),m+="single",c.firstChild.className=m}return c}var v=new i.ProjectionTextModel(g),y=g.getLineStart(g.getLineAtOffset(a.start)),_=g.getCharCount();return a.end!==_&&v.addProjection({start:a.end,end:_}),y>0&&v.addProjection({start:0,end:y}),v}var C=o.createElement(u,"div"),w=o.createElement(u,"em");w.appendChild(u.createTextNode(e.multipleAnnotations)),C.appendChild(w);for(var b=0;b<t.length;b++)a=t[b],c=s(a),c&&C.appendChild(c);return C},_getNodeStyle:function(e,t,n){var i;if(e&&(i=e.style[t],!i))if(e.currentStyle){for(var r=0,o=t;-1!==(r=o.indexOf("-",r));)o=o.substring(0,r)+o.substring(r+1,r+2).toUpperCase()+o.substring(r+2);i=e.currentStyle[o]}else{var s=e.ownerDocument.defaultView.getComputedStyle(e,null);i=s?s.getPropertyValue(t):null}return i||n},_isNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName}},{Tooltip:s}}),define("orion/editor/editor",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/tooltip","orion/editor/annotations","orion/objects","orion/util"],function(e,t,n,i,r,o){function s(e){e=e||{},this._domNode=e.domNode,this._model=e.model,this._undoStack=e.undoStack,this._statusReporter=e.statusReporter,this._title=null;var t=this;this._listener={onChanged:function(e){t.onChanged(e)}},this._model&&this._model.addEventListener("Changed",this._listener.onChanged),this.checkDirty()}function a(e){e=e||{},s.call(this,e),this._textViewFactory=e.textViewFactory,this._undoStackFactory=e.undoStackFactory,this._textDNDFactory=e.textDNDFactory,this._annotationFactory=e.annotationFactory,this._foldingRulerFactory=e.foldingRulerFactory,this._lineNumberRulerFactory=e.lineNumberRulerFactory,this._contentAssistFactory=e.contentAssistFactory,this._keyBindingFactory=e.keyBindingFactory,this._annotationStyler=null,this._annotationModel=null,this._annotationRuler=null,this._lineNumberRuler=null,this._overviewRuler=null,this._foldingRuler=null,this._contentAssist=null}var l=i.AnnotationType,d="orion.annotation.highlightError";return s.prototype={destroy:function(){this.uninstall(),this._statusReporter=this._domNode=null,this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(e,t){return this.getModel().getText(e,t)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean(),this.setDirty(!1)},onDirtyChanged:function(e){return this.dispatchEvent(e)},onInputChanged:function(e){return this.dispatchEvent(e)},onChanged:function(){this.checkDirty()},reportStatus:function(e,t,n){this._statusReporter&&this._statusReporter(e,t,n)},resize:function(){},setDirty:function(e){this._dirty!==e&&(this._dirty=e,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(e){this._model&&this._model.setText(e)},setInput:function(e,t,n,i){this._title=e,i||(t?this.reportStatus(t,"error"):null!==n&&void 0!==n&&"string"==typeof n&&this._setModelText(n),this._undoStack&&this._undoStack.reset()),this.checkDirty(),this.onInputChanged({type:"InputChanged",title:e,message:t,contents:n,contentsSaved:i})},setText:function(e,t,n){this.getModel().setText(e,t,n)},uninstall:function(){this.installed=!1}},t.EventTarget.addMixin(s.prototype),a.prototype=new s,r.mixin(a.prototype,{destroy:function(){s.prototype.destroy.call(this),this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getModel:function(){if(!this._textView)return null;var e=this._textView.getModel();return e.getBaseModel&&(e=e.getBaseModel()),e},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(e,t){if((this._annotationRulerVisible!==e||t)&&(this._annotationRulerVisible=e,this._annotationRuler)){var n=this._textView;e?n.addRuler(this._annotationRuler,0):n.removeRuler(this._annotationRuler)}},setFoldingRulerVisible:function(e,t){if((this._foldingRulerVisible!==e||t)&&(this._foldingRulerVisible=e,this._foldingRuler)){var n=this._textView;n.getModel().getBaseModel&&(e?n.addRuler(this._foldingRuler):n.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(e,t){if((this._lineNumberRulerVisible!==e||t)&&(this._lineNumberRulerVisible=e,this._lineNumberRuler)){var n=this._textView;e?n.addRuler(this._lineNumberRuler,this._annotationRulerVisible?1:0):n.removeRuler(this._lineNumberRuler)}},setOverviewRulerVisible:function(e,t){if((this._overviewRulerVisible!==e||t)&&(this._overviewRulerVisible=e,this._overviewRuler)){var n=this._textView;e?n.addRuler(this._overviewRuler):n.removeRuler(this._overviewRuler)}},mapOffset:function(e,t){var n=this._textView,i=n.getModel();return i.getBaseModel&&(e=i.mapOffset(e,t)),e},getLineAtOffset:function(e){return this.getModel().getLineAtOffset(this.mapOffset(e))},getLineStart:function(e){return this.getModel().getLineStart(e)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var e=this._textView,t=e.getSelection(),n=e.getModel();return n.getBaseModel&&(t.start=n.mapOffset(t.start),t.end=n.mapOffset(t.end)),t},_expandOffset:function(e){var t=this._textView.getModel(),n=this._annotationModel;if(n&&t.getBaseModel)for(var i=n.getAnnotations(e,e+1);i.hasNext();){var r=i.next();r.type===l.ANNOTATION_FOLDING&&r.expand&&r.expand()}},setCaretOffset:function(e,t,n){var i=this._textView,r=i.getModel();r.getBaseModel&&(this._expandOffset(e),e=r.mapOffset(e,!0)),i.setCaretOffset(e,t,n)},setText:function(e,t,n){var i=this._textView,r=i.getModel();r.getBaseModel&&(void 0!==t&&(this._expandOffset(t),t=r.mapOffset(t,!0)),void 0!==n&&(this._expandOffset(n),n=r.mapOffset(n,!0))),i.setText(e,t,n)},setSelection:function(e,t,n,i){var r=this._textView,o=r.getModel();o.getBaseModel&&(this._expandOffset(e),this._expandOffset(t),e=o.mapOffset(e,!0),t=o.mapOffset(t,!0)),r.setSelection(e,t,n,i)},moveSelection:function(e,t,n,i){t=t||e;var r=this._textView;this.setSelection(e,t,1/3,function(){(void 0===i||i)&&r.focus(),n&&n()})},_getTooltipInfo:function(e,t){var n=this._textView,i=this.getAnnotationModel();if(!i)return null;var r=this._annotationStyler;if(!r)return null;var o=n.getOffsetAtLocation(e,t);if(-1===o)return null;o=this.mapOffset(o);for(var s=r.getAnnotationsByType(i,o,o+1),a=[],l=0;l<s.length;l++)s[l].rangeStyle&&a.push(s[l]);if(0===a.length)return null;var d=n.convert({x:e,y:t},"document","page"),c={contents:a,anchor:"left",x:d.x+10,y:d.y+20};return c},_highlightCurrentLine:function(e,t){var n=this._annotationModel;if(n){var i=this._textView;if(!i.getOptions("singleMode")){var r=i.getModel(),o=t?r.getLineAtOffset(t.start):-1,s=r.getLineAtOffset(e.start),a=e.start===e.end,d=!t||t.start===t.end,c=r.getLineStart(s),h=r.getLineEnd(s);r.getBaseModel&&(c=r.mapOffset(c),h=r.mapOffset(h));var u=this._currentLineAnnotation;if(!(o===s&&d&&a&&u&&u.start===c&&u.end===h)){var p,f=u?[u]:null;if(a){var g=l.ANNOTATION_CURRENT_LINE;u=l.createAnnotation(g,c,h),p=[u]}this._currentLineAnnotation=u,n.replaceAnnotations(f,p)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){if(this._textView=this._textViewFactory(),this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty()),this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack)),this._contentAssistFactory){var e=this._contentAssistFactory.createContentAssistMode(this);this._contentAssist=e.getContentAssist()}var t=this,i=this._textView,r=this;if(this._listener={onModelChanged:function(){r.checkDirty()},onMouseOver:function(e){r._listener.onMouseMove(e)},onMouseMove:function(e){var t=n.Tooltip.getTooltip(i);t&&(r._listener.lastMouseX!==e.event.clientX||r._listener.lastMouseY!==e.event.clientY)&&(r._listener.lastMouseX=e.event.clientX,r._listener.lastMouseY=e.event.clientY,t.setTarget({x:e.x,y:e.y,getTooltipInfo:function(){return r._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(e){var t=n.Tooltip.getTooltip(i);t&&(r._listener.lastMouseX!==e.event.clientX||r._listener.lastMouseY!==e.event.clientY)&&(r._listener.lastMouseX=e.event.clientX,r._listener.lastMouseY=e.event.clientY,t.setTarget(null))},onScroll:function(){var e=n.Tooltip.getTooltip(i);e&&e.setTarget(null,0,0)},onSelection:function(e){r._updateCursorStatus(),r._highlightCurrentLine(e.newValue,e.oldValue)}},i.addEventListener("ModelChanged",this._listener.onModelChanged),i.addEventListener("Selection",this._listener.onSelection),i.addEventListener("MouseOver",this._listener.onMouseOver),i.addEventListener("MouseOut",this._listener.onMouseOut),i.addEventListener("MouseMove",this._listener.onMouseMove),i.addEventListener("Scroll",this._listener.onScroll),this._keyBindingFactory){var o;o="function"==typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(t,this._undoStack,this._contentAssist),o&&(this._textActions=o.textActions,this._linkedMode=o.linkedMode,this._sourceCodeActions=o.sourceCodeActions)}var a=function(e){if(void 0!==e&&-1!==e){for(var n=this.getView(),i=n.getModel(),r=this.getAnnotationModel(),o=t.mapOffset(i.getLineStart(e)),s=t.mapOffset(i.getLineEnd(e)),a=r.getAnnotations(o,s),d=null;a.hasNext();){var c=a.next();if(c.type===l.ANNOTATION_BOOKMARK){d=c;break}}d?r.removeAnnotation(d):(d=l.createAnnotation(l.ANNOTATION_BOOKMARK,o,s),d.title=void 0,r.addAnnotation(d))}};if(this._annotationFactory){var c=i.getModel();if(c.getBaseModel&&(c=c.getBaseModel()),this._annotationModel=this._annotationFactory.createAnnotationModel(c),this._annotationModel){var h=this._annotationStyler=this._annotationFactory.createAnnotationStyler(i,this._annotationModel);h&&(h.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),h.addAnnotationType(l.ANNOTATION_ERROR),h.addAnnotationType(l.ANNOTATION_WARNING),h.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),h.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),h.addAnnotationType(l.ANNOTATION_CURRENT_LINE),h.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),h.addAnnotationType(l.ANNOTATION_SELECTED_LINKED_GROUP),h.addAnnotationType(l.ANNOTATION_CURRENT_LINKED_GROUP),h.addAnnotationType(l.ANNOTATION_LINKED_GROUP),h.addAnnotationType(d))}var u=this._annotationFactory.createAnnotationRulers(this._annotationModel),p=this._annotationRuler=u.annotationRuler;p&&(p.onDblClick=a,p.setMultiAnnotationOverlay({html:"<div class='annotationHTML overlay'></div>"}),p.addAnnotationType(l.ANNOTATION_ERROR),p.addAnnotationType(l.ANNOTATION_WARNING),p.addAnnotationType(l.ANNOTATION_TASK),p.addAnnotationType(l.ANNOTATION_BOOKMARK)),this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0),p=this._overviewRuler=u.overviewRuler,p&&(p.addAnnotationType(l.ANNOTATION_CURRENT_SEARCH),p.addAnnotationType(l.ANNOTATION_MATCHING_SEARCH),p.addAnnotationType(l.ANNOTATION_READ_OCCURRENCE),p.addAnnotationType(l.ANNOTATION_WRITE_OCCURRENCE),p.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),p.addAnnotationType(l.ANNOTATION_ERROR),p.addAnnotationType(l.ANNOTATION_WARNING),p.addAnnotationType(l.ANNOTATION_TASK),p.addAnnotationType(l.ANNOTATION_BOOKMARK),p.addAnnotationType(l.ANNOTATION_MATCHING_BRACKET),p.addAnnotationType(l.ANNOTATION_CURRENT_BRACKET),p.addAnnotationType(l.ANNOTATION_CURRENT_LINE)),this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)
}this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(l.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=a,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0)),this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),this._foldingRuler.addAnnotationType(l.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));var f={type:"TextViewInstalled",textView:i};this.dispatchEvent(f),s.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var e=this._textView;if(e){e.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=this._annotationStyler=this._annotationRuler=this._overviewRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0;var t={type:"TextViewUninstalled",textView:e};this.dispatchEvent(t),s.prototype.uninstall.call(this)}},_updateCursorStatus:function(){for(var t=this.getModel(),n=this.getCaretOffset(),i=t.getLineAtOffset(n),r=t.getLineStart(i),s=n-r,a=this.getKeyModes(),l=0;l<a.length;l++){var d=a[l];if(d.isActive()&&d.isStatusActive&&d.isStatusActive())return}this.reportStatus(o.formatMessage(e.lineColumn,i+1,s+1))},showAnnotations:function(e,t,n,i){var r=this._annotationModel;if(r){for(var o,s=[],a=[],d=r.getTextModel(),c=r.getAnnotations();c.hasNext();)o=c.next(),-1!==t.indexOf(o.type)&&o.creatorID===this&&s.push(o);if(e)for(var h=0;h<e.length;h++)if(o=e[h]){if(n)o=n(o);else{var u,p;if("number"==typeof o.line){var f=o.line-1,g=d.getLineStart(f);u=g+o.start-1,p=g+o.end-1}else u=o.start,p=o.end;var m=i(o);if(!m)continue;o=l.createAnnotation(m,u,p,o.description)}o.creatorID=this,a.push(o)}r.replaceAnnotations(s,a)}},showProblems:function(e){this.showAnnotations(e,[l.ANNOTATION_ERROR,l.ANNOTATION_WARNING,l.ANNOTATION_TASK],null,function(e){switch(e.severity){case"error":return l.ANNOTATION_ERROR;case"warning":return l.ANNOTATION_WARNING;case"task":return l.ANNOTATION_TASK}return null})},showOccurrences:function(e){this.showAnnotations(e,[l.ANNOTATION_READ_OCCURRENCE,l.ANNOTATION_WRITE_OCCURRENCE],null,function(e){return e.readAccess?l.ANNOTATION_READ_OCCURRENCE:l.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(t){var n=this._blameRGB,s=this.getTextView().getOptions("parent").ownerDocument;if(!n){var a=o.createElement(s,"div");a.className="annotation blame",s.body.appendChild(a);var d=s.defaultView||s.parentWindow,c=d.getComputedStyle(a),h=c.getPropertyValue("background-color");a.parentNode.removeChild(a);var u=h.indexOf("("),p=h.indexOf(")");h=h.substring(u+1,p),this._blameRGB=n=h.split(",").slice(0,3)}var f=function(){var e=i.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);return e.style=r.mixin({},e.style),e.style.style=r.mixin({},e.style.style),e.style.style.backgroundColor="",this.groupAnnotation=e,e.blame=this.blame,e.html=this.html,e.creatorID=this.creatorID,e},g=function(){var t=o.createElement(s,"div");t.className="tooltipTitle";var n=this.blame.Message.indexOf("\n");-1===n&&(n=this.blame.Message.length);var i=o.createElement(s,"a");return i.href=this.blame.CommitLink,i.appendChild(s.createTextNode(this.blame.Message.substring(0,n))),t.appendChild(i),t.appendChild(o.createElement(s,"br")),t.appendChild(s.createTextNode(o.formatMessage(e.committerOnTime,this.blame.AuthorName,this.blame.Time))),t},m=this.getModel();this.showAnnotations(t,[l.ANNOTATION_BLAME,l.ANNOTATION_CURRENT_BLAME],function(e){var t=m.getLineStart(e.Start-1),o=m.getLineEnd(e.End-1,!0),s=i.AnnotationType.createAnnotation(l.ANNOTATION_BLAME,t,o,g),a=n.slice(0);return a.push(e.Shade),s.style=r.mixin({},s.style),s.style.style=r.mixin({},s.style.style),s.style.style.backgroundColor="rgba("+a.join()+")",s.groupId=e.Name,s.groupType=l.ANNOTATION_CURRENT_BLAME,s.createGroupAnnotation=f,s.html='<img class="annotationHTML blame" src="'+e.AuthorImage+'"/>',s.blame=e,s})},showSelection:function(e,t,n,i,r){if("number"==typeof e)"number"!=typeof t&&(t=e),this.moveSelection(e,t);else if("number"==typeof n){var o=this.getModel(),s=o.getLineStart(n-1);"number"==typeof i&&(s+=i),"number"!=typeof r&&(r=0),this.moveSelection(s,s+r)}},_setModelText:function(e){this._textView&&(this._textView.setText(e),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(e,t,n,i,r){s.prototype.setInput.call(this,e,t,n,i),!this._textView||i||r||this._textView.focus()},onGotoLine:function(e,t,n,i){if(this._textView){var r=this.getModel();e=Math.max(0,Math.min(e,r.getLineCount()-1));var o=r.getLineStart(e),s=0;if(void 0===n&&(n=0),"string"==typeof t){var a=r.getLine(e).indexOf(t);-1!==a&&(s=a,n=s+t.length)}else{s=t;var l=r.getLineEnd(e)-o;s=Math.min(s,l),n=Math.min(n,l)}this.moveSelection(o+s,o+n,i)}}}),{BaseEditor:s,Editor:a}}),define("orion/markdownView",["marked/marked","orion/editor/editor","orion/objects","orion/webui/littlelib","orion/URITemplate","orion/section","orion/URL-shim"],function(e,t,n,i,r,o){function s(e,t,n,i){return function(r,o){if(-1===o.href.indexOf(":"))try{var s;if("filesystem:"===t.protocol?s={href:"filesystem:"+new URL(o.href,t.pathname).href}:(s=new URL(o.href,t),i&&(s.protocol="",s.host="")),"!"!==r[0][0])o.href=h.expand({resource:s.href});else{if(n.readBlob){var a="_md_img_"+p++;return n.readBlob(s.href).then(function(e){var t=s.href.match(u),n=t?"image/"+t[1]:"image/png",i=URL.createObjectURL(new Blob([e],{type:n}));document.getElementById(a).src=i,URL.revokeObjectURL(i)}),"<img id='"+a+"' src=''>"}o.href=s.href}}catch(l){console.log(l)}return e.call(this,r,o)}}function a(t,n,i){var r=e.InlineLexer.prototype.outputLink,o=new URL(n,window.location.href);e.InlineLexer.prototype.outputLink=s(r,o,i,-1===n.indexOf(":"));var a=e(t,{sanitize:!0});return e.InlineLexer.prototype.outputLink=r,a}function l(e){this.fileClient=e.fileClient,this.progress=e.progress,this.canHide=e.canHide,this._node=null}function d(e){this.id="orion.viewer.markdown",this.fileClient=e.fileClient,this.metadata=e.metadata,f.apply(this,arguments)}function c(e){this._parent=e.parent,this.fileClient=e.fileService,this.metadata=e.metadata,this.serviceRegistry=e.serviceRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.progress=e.progressService,this.model=e.model,this.undoStack=e.undoStack}var h=new r("#{,resource,params*}"),u=/\.([0-9a-z]+)(?:[\?#]|$)/i,p=0;l.prototype={display:function(e,t,n,i){e.classList.add("orionMarkdown"),e.innerHTML=a(t,n,i)},displayContents:function(e,t){var n=t.Location||t;i.empty(e);var r=document.createElement("div");(this.progress?this.progress.progress(this.fileClient.read(n),"Reading file "+(t.Name||n)):this.fileClient.read(n)).then(function(e){this.display.bind(this)(r,e,n,this.fileClient)}.bind(this)),e.appendChild(r)},displayInFrame:function(e,t,n,i,r){var s=new o.Section(e,{id:"markdownSection",title:t.Name||r||"readme",headerClass:n,canHide:this.canHide});if(i){var a=s.getTitleElement();a&&a.classList.add(i)}this.displayContents.call(this,s.getContentElement(),t)}};var f=t.BaseEditor;return d.prototype=Object.create(f.prototype),n.mixin(d.prototype,{createMarked:function(e){return a(e,this.metadata.Location,this.fileClient)},install:function(){var e=this._rootDiv=document.createElement("div");e.style.width="100%",e.style.height="100%";var t=this._contentDiv=document.createElement("div");t.classList.add("orionMarkdown"),e.appendChild(t);var n=i.node(this._domNode);n.appendChild(e),this._contentDiv.innerHTML=this.createMarked(this.getModel().getText()),f.prototype.install.call(this)},setInput:function(e,t,n,i){f.prototype.setInput.call(this,e,t,n,i),t||i||(this._contentDiv.innerHTML=this.createMarked(n))},uninstall:function(){i.empty(this._domNode),f.prototype.uninstall.call(this)}}),c.prototype={create:function(){this.editor=new d({domNode:this._parent,fileClient:this.fileClient,metadata:this.metadata,model:this.model,undoStack:this.undoStack}),this.editor.install()},destroy:function(){this.editor&&this.editor.destroy(),this.editor=null}},{MarkdownEditorView:c,MarkdownView:l}}),define("orion/projects/projectEditor",["orion/URITemplate","orion/webui/littlelib","orion/Deferred","orion/objects","orion/projectCommands","orion/commandRegistry","orion/PageLinks","orion/explorers/explorer","orion/section"],function(e,t,n,i,r,o,s,a,l){function d(e){this.root=e}function c(e,t,n){this._init(e),this.projectEditor=t,this.explorer=n}function h(e){this.root=e}function u(e,t,n){this._init(e),this.projectEditor=t,this.explorer=n}function p(e,t){this.root=e,this.projectClient=t}function f(e,t,n){this._init(e),this.projectEditor=t,this.explorer=n,this.commandService=e.commandRegistry,this.actionScopeId=e.actionScopeId}function g(e,t,n){this.root=e,this.launchConfigurations=t,this.projectClient=n}function m(e,t,n){this._init(e),this.projectEditor=t,this.explorer=n,this.commandService=e.commandRegistry,this.actionScopeId=e.actionScopeId,this.projectClient=e.projectClient}function v(e,t,n,i,r){a.Explorer.apply(this,arguments),this.actionScopeId=r,this.selectionActions="LaunchConfigurationExplorerSelectionActions",this.actionsSections=[this.selectionActions]}function y(e){this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.progress=e.progress,this.preferences=e.preferences,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.commandRegistry=e.commandRegistry,this._node=null,this.dependencyActions="dependencyActions",this.launchConfigurationActions="launchConfigurationsActions",this.createCommands()}var _=new e("./edit.html#{,resource,params*}");return d.prototype=new a.ExplorerModel,d.prototype.constructor=d,d.prototype.getRoot=function(e){return e(this.root)},d.prototype.getChildren=function(e,t){t(e===this.root?[{id:"Name",displayName:"Name",value:e.Name,no:1},{id:"Description",displayName:"Description",value:e.Description,no:2},{id:"Url",displayName:"Site",value:e.Url,href:e.Url,no:3}]:[])},d.prototype.getId=function(e){return"ProjectInfo"+e.id},c.prototype=new a.SelectionRenderer,c.prototype.constructor=c,c.prototype.getCellHeaderElement=function(){},c.prototype.getCellElement=function(e,n){if(0===e){var i=document.createElement("td"),r=document.createElement("span");return r.className="discreetInputLabel",r.appendChild(document.createTextNode(n.displayName)),i.classList.add("discreetInputLabel"),i.appendChild(r),i.width="20%",i}if(1===e){var i;if(n.href){i=document.createElement("td"),i.style.verticalAlign="top";var o=document.createElement("input");o.style.visibility="hidden";var s=document.createElement("div");s.style.marginTop="-15px",s.title="Click to edit",s.className="discreetInput",s.tabIndex=n.no;var a=document.createElement("a");return a.href=n.value||"",a.appendChild(document.createTextNode(n.value||"")),a.tabIndex=n.no+1,s.appendChild(a),s.title="Click to edit",s.onclick=function(){s.style.visibility="hidden",a.style.visibility="hidden",o.style.visibility="",o.focus()}.bind(this.projectEditor),s.onfocus=s.onclick,s.onkeyup=function(e){e.keyCode===t.KEY.ENTER&&s.onclick(e)}.bind(this.projectEditor),a.urlSelector=s,this.projectEditor._renderEditableFields(o,n.id,n.no,a),i.appendChild(o),i.appendChild(s),i}i=document.createElement("td"),i.style.verticalAlign="top";var l=document.createElement("Description"===n.id?"textArea":"input");return this.projectEditor._renderEditableFields(l,n.id,n.no,null),i.appendChild(l),i}},h.prototype=new a.ExplorerModel,h.prototype.constructor=h,h.prototype.getRoot=function(e){return e(this.root)},h.prototype.getChildren=function(e,t){if(e===this.root){for(var n=0;n<e.Children.length;n++)e.Children[n].parent=e;t(e.Children)}else t([])},h.prototype.getId=function(e){return"AdditionalInfo"+a.ExplorerModel.prototype.getId.call(this,{Location:e.parent.Name+e.Name})},u.prototype=new a.SelectionRenderer,u.prototype.constructor=u,u.prototype.getCellHeaderElement=function(e){if(0===e){var t=document.createElement("td");return t.colSpan=2,t.appendChild(document.createTextNode(this.explorer.model.root.Name)),t}},u.prototype.getCellElement=function(t,n){if(0===t){var i=document.createElement("td"),r=document.createElement("span");return r.className="discreetInputLabel",r.appendChild(document.createTextNode(n.Name)),i.classList.add("discreetInputLabel"),i.appendChild(r),i.width="20%",i}if(1===t){var i=document.createElement("td");if(n.Href){var o=document.createElement("a"),a=new e(n.Href);o.href=a.expand({OrionHome:s.getOrionHome()}),o.appendChild(document.createTextNode(n.Value||" ")),i.appendChild(o)}else i.appendChild(document.createTextNode(n.Value||" "));return i}},p.prototype=new a.ExplorerModel,p.prototype.constructor=p,p.prototype.getRoot=function(e){return e(this.root)},p.prototype.getChildren=function(e,t){if(e===this.root){var r=[];n.all((e.Dependencies||[]).map(function(t){var n={Dependency:t,Project:e};return r.push(n),this.projectClient.getDependencyFileMetadata(t,e.WorkspaceLocation).then(function(e){i.mixin(n,e)},function(){n.Directory=n.disconnected=!0})}.bind(this))).then(function(){t(r)}.bind(this))}else t([])},p.prototype.getId=function(e){return a.ExplorerModel.prototype.getId.call(this,e.Dependency)},f.prototype=new a.SelectionRenderer,f.prototype.constructor=f,f.prototype.getCellHeaderElement=function(){},f.prototype.getCellElement=function(e,t,n){if(0===e){var i=document.createElement("td");if(t.Location){i.className="navColumnNoIcon";var r=document.createElement("a");r.href=_.expand({resource:t.Location}),r.appendChild(document.createTextNode(t.Dependency.Name)),i.appendChild(r)}else{var o=t.Dependency.Name;t.disconnected&&(o+=" (disconnected)"),i.appendChild(document.createTextNode(o))}return i}if(1===e){var s=this.getActionsColumn(t,n,null,null,!0);return s.style.textAlign="right",s}},g.prototype=new a.ExplorerModel,g.prototype.constructor=g,g.prototype.getRoot=function(e){return e(this.root)},g.prototype.getChildren=function(e,t){if(e===this.root)if(this.launchConfigurations){for(var n=0;n<this.launchConfigurations.length;n++)this.launchConfigurations[n].project=e;this.root.children=this.launchConfigurations,t(this.launchConfigurations)}else this.projectClient.getProjectLaunchConfigurations(e).then(function(n){for(var i=0;i<n.length;i++)n[i].project=e;e.children=n,t(n)});else t([])},g.prototype.getId=function(e){return"LaunchConfiguration"+a.ExplorerModel.prototype.getId.call(this,{Location:e.Name})},m.prototype=new a.SelectionRenderer,m.prototype.constructor=m,m.prototype.getCellHeaderElement=function(){},m.prototype.getCellElement=function(t,n,r){if(0===t){var o=document.createElement("td");return n.Name&&(o.className="secondaryColumnLeft",o.appendChild(document.createTextNode(n.Name))),o}if(1===t){var o=document.createElement("td");if(n.Url){var a=document.createElement("a");a.target="_new",a.href=n.Url.indexOf("://")<0?"http://"+n.Url:n.Url,a.title=n.Url,a.appendChild(document.createTextNode(n.UrlTitle||n.Params.Name||"View App")),o.appendChild(a)}return o}if(2===t){var o=document.createElement("td");return n.ServiceId&&this.projectClient.getProjectDelpoyService(n.ServiceId,n.Type).then(function(t){if(t)if(t.getLogLocationTemplate)t.getLogLocationTemplate(n).then(function(t){if(t){var r=document.createElement("a");r.target="_new";var a=new e(t),l=i.clone(n.Params);i.mixin(l,{OrionHome:s.getOrionHome()}),r.href=a.expand(l),r.appendChild(document.createTextNode("Logs")),o.appendChild(r)}});else if(t.logLocationTemplate){var r=document.createElement("a");r.target="_new";var a=new e(t.logLocationTemplate),l=i.clone(n.Params);i.mixin(l,{OrionHome:s.getOrionHome()}),r.href=a.expand(l),r.appendChild(document.createTextNode("Logs")),o.appendChild(r)}}),o}if(3===t){var o=document.createElement("td");if(o.classList.add("secondaryColumnRight"),n.status&&n.status.CheckState===!0)delete n.status;else if(n.status){if(n.status.error&&n.status.error.Retry)return n.parametersRequested=n.status.error.Retry.parameters,n.optionalParameters=n.status.error.Retry.optionalParameters,this.getActionsColumn(n,r,null,"secondaryColumnRight",!0);if(n.status.error){var l=document.createElement("span");return l.appendChild(document.createTextNode("Error")),l.title=n.status.error.Message,o.appendChild(l),o}if("STARTED"===n.status.State){var l=document.createElement("span");return l.className="imageSprite core-sprite-applicationrunning",l.title=n.status.Message||"Started",o.appendChild(l),o}if("STOPPED"===n.status.State){var l=document.createElement("span");return l.className="imageSprite core-sprite-applicationstopped",l.title=n.status.Message||"Stopped",o.appendChild(l),o}if("NOT_DEPLOYED"===n.status.State){var l=document.createElement("span");return l.className="imageSprite core-sprite-applicationnotdeployed",l.title=n.status.Message||"Not deployed",o.appendChild(l),o}if("PROGRESS"===n.status.State){var l=document.createElement("span");return l.className="imageSprite core-sprite-progress",l.title="Checking application state",o.appendChild(l),o}var l=document.createElement("span");return l.appendChild(document.createTextNode("State unknown")),l.title=n.status.Message,o.appendChild(l),o}return n.ServiceId&&this.projectClient.getProjectDelpoyService(n.ServiceId,n.Type).then(function(e){e&&e.getState?(n.status={State:"PROGRESS"},o.innerHTML=this.getCellElement(t,n,r).innerHTML,e.getState(n.Params).then(function(e){n.status=e;for(var i=this.getCellElement(t,n,r),s=0;s<o.classList.length;s++)i.classList.toggle(o.classList[s],!0);var a=o.previousSibling;r.replaceChild(i,o);for(var l=this.getCellElement(t-1,n,r),s=0;s<a.classList.length;s++)l.classList.toggle(a.classList[s],!0);r.replaceChild(l,a)}.bind(this),function(e){n.status={error:e};for(var i=this.getCellElement(t,n,r),s=0;s<o.classList.length;s++)i.classList.toggle(o.classList[s],!0);var a=o.previousSibling;r.replaceChild(i,o);for(var l=this.getCellElement(t-1,n,r),s=0;s<a.classList.length;s++)l.classList.toggle(a.classList[s],!0);r.replaceChild(l,a)}.bind(this))):o.appendChild(document.createTextNode("State unknown"))}.bind(this)),o}},v.prototype=Object.create(a.Explorer.prototype),i.mixin(v.prototype,{registerCommands:function(){this.commandService.registerCommandContribution(this.selectionActions,"orion.launchConfiguration.manage",1),this.commandService.registerCommandContribution(this.selectionActions,"orion.launchConfiguration.deploy",2),this.commandService.registerCommandContribution(this.selectionActions,"orion.launchConfiguration.startApp",3),this.commandService.registerCommandContribution(this.selectionActions,"orion.launchConfiguration.stopApp",4)},updateCommands:function(e){this.selectionActionsNode=t.node(this.selectionActions),t.empty(this.selectionActionsNode),this.commandService.renderCommands(this.selectionActions,this.selectionActionsNode,e,this,"tool"),t.$$array(".commandLink",this.selectionActionsNode).forEach(function(e){e.target="_new"})},load:function(e,t,n,i){this.createTree(e,new g(t,n,i),{indent:"8px"}),this.loaded()},constructor:v}),y.prototype={createCommands:function(){this.launchConfigurationDispatcher=r.getLaunchConfigurationDispatcher(),this.dependenciesDisplatcher=r.getDependencyDispatcher();var e=this;this.launchConfigurationListener=function(t){e.launchConfigurationChanged.call(e,t)},this._launchConfigurationEventTypes=["create","delete","changeState"],this._launchConfigurationEventTypes.forEach(function(t){e.launchConfigurationDispatcher.addEventListener(t,e.launchConfigurationListener)}),this.dependneciesListener=function(t){e.dependenciesChanged.call(e,t)},this._dependenciesEventTypes=["create","delete"],this._dependenciesEventTypes.forEach(function(t){e.dependenciesDisplatcher.addEventListener(t,e.dependneciesListener)}),this.commandRegistry.registerCommandContribution(this.dependencyActions,"orion.project.dependency.connect",1),this.commandRegistry.registerCommandContribution(this.dependencyActions,"orion.project.dependency.disconnect",2),this.commandRegistry.registerCommandContribution(this.launchConfigurationActions,"orion.launchConfiguration.checkStatus",1)},changedItem:function(){this.fileClient.read(this.parentFolder.Location,!0).then(function(e){t.empty(this.node),this.displayContents(this.node,e)}.bind(this))},display:function(e,t){function n(e,t){t=t||{},e.forEach(function(e){var n;switch(e){case"projectInfo":n=document.createElement("span"),this.node.appendChild(n),this.renderProjectInfo(n,t[e]);break;case"additionalInfo":n=document.createElement("span"),this.node.appendChild(n),this.renderAdditionalProjectProperties(n);break;case"deployment":n=document.createElement("span"),this.node.appendChild(n),this.renderLaunchConfigurations(n,null,t[e]);break;case"dependencies":n=document.createElement("span"),n.id="projectDependenciesNode",this.node.appendChild(n),this.renderDependencies(n,t[e])}}.bind(this))}this.node=e,this.node.className="orionProject",this.projectData=t;var i=["projectInfo","additionalInfo","deployment","dependencies"];this.preferences.getPreferences("/sectionsOrder").then(function(e){i=e.get("projectView")||i;var t=e.get("projectViewNames")||[];n.apply(this,[i,t])}.bind(this),function(e){n.apply(this,[i,{}]),window.console.error(e)}.bind(this))},displayContents:function(e,t){this.parentFolder=t,this.projectClient.readProject(t).then(function(t){this.display.bind(this)(e,t)}.bind(this))},dependenciesChanged:function(e){var n=t.node("projectDependenciesNode");if(n){if(e.project.ContentLocation===this.projectData.ContentLocation)if("delete"===e.type){if(this.projectData.Dependencies&&e.oldValue)for(var i=0;i<this.projectData.Dependencies.length;i++)this.projectData.Dependencies[i].Location===e.oldValue.Location&&this.projectData.Dependencies.splice(i,1)}else"create"===e.type&&this.projectData.Dependencies&&e.newValue&&this.projectData.Dependencies.push(e.newValue);t.empty(n),this.renderDependencies(n,this.dependenciesSectionName)}},_renderEditableFields:function(e,n,i,r){var o=function(i){var o={};o[n]=i.target.value,this.progress.progress(this.projectClient.changeProjectProperties(this.projectData,o),"Saving project "+this.projectData.Name).then(function(n){n&&(this.projectData=n,e.value=i.target.value,r&&(t.empty(r),r.appendChild(document.createTextNode(i.target.value)||""),r.href=i.target.value,r.style.visibility="",r.urlSelector&&(r.urlSelector.style.visibility=""),e.style.visibility="hidden"))}.bind(this))}.bind(this);e.value=this.projectData[n]||"",e.title="Click to edit",e.className="discreetInput",e.tabIndex=String(i),e.onkeyup=function(i){i.keyCode===t.KEY.ENTER?"TEXTAREA"!==e.tagName.toUpperCase()&&e.blur():i.keyCode===t.KEY.ESCAPE&&(e.value=this.projectData[n]||"",e.blur())}.bind(this),e.onblur=function(e){o(e)}},renderProjectInfo:function(e,t){var n=t||"Project Information",i=new l.Section(e,{id:"projectInfoSection",headerClass:["sectionTreeTableHeader"],title:n,canHide:!0}),r=document.createElement("div");r.id="projectInformationNode";var o=new c({checkbox:!1,treeTableClass:"sectionTreeTable",cachePrefix:"ProjectInfoExplorer"},this),s=new a.Explorer(this.serviceRegistry,null,o,this.commandRegistry);i.embedExplorer(s,r),s.createTree(r,new d(this.projectData),{noSelection:!0})},renderAdditionalProjectProperties:function(e){this.projectClient.getMatchingProjectHandlers(this.parentFolder).then(function(t){for(var n=0;n<t.length;n++){var i=t[n];i&&i.getAdditionalProjectProperties&&this.progress.progress(i.getAdditionalProjectProperties(this.parentFolder,this.projectData),"Getting additional project information").then(function(t){if(t&&t.length&&0!==t.length)for(var n=0;n<t.length;n++){var i=t[n];if(i.Name){var r=new l.Section(e,{id:i.Name+"Section",headerClass:["sectionTreeTableHeader"],title:i.Name,canHide:!0}),o=document.createElement("div"),s=new u({treeTableClass:"sectionTreeTable",checkbox:!1},this),d=new a.Explorer(this.serviceRegistry,null,s,this.commandRegistry);r.embedExplorer(d,o),d.createTree(o,new h(i),{noSelection:!0})}}}.bind(this))}}.bind(this))},renderDependencies:function(e,t){if(this.projectData.Dependencies&&0!==this.projectData.Dependencies.length){this.dependenciesSectionName=t||"Associated Content";var n=new l.Section(e,{id:"projectDependenciesSection",headerClass:["sectionTreeTableHeader"],title:this.dependenciesSectionName,canHide:!0}),i=document.createElement("div");i.id="dependenciesNode";var r=new f({checkbox:!1,treeTableClass:"sectionTreeTable",commandRegistry:this.commandRegistry,actionScopeId:this.dependencyActions},this),o=new a.Explorer(this.serviceRegistry,null,r,this.commandRegistry);o.actionScopeId=this.dependencyActions,n.embedExplorer(o,i),o.createTree(i,new p(this.projectData,this.projectClient),{indent:"8px",noSelection:!0})}},renderLaunchConfigurations:function(e,n,i){if(this.configurationsParent=e,!n)return void this.projectClient.getProjectLaunchConfigurations(this.projectData).then(function(t){this.configurations=t,t&&0!==t.length&&this.renderLaunchConfigurations(e,t,i)}.bind(this));t.empty(this.configurationsParent),this.launchCofunctionSectionsTitle=i||"Deployment Information";var r=new l.Section(e,{id:"projectLaunchConfigurationSection",headerClass:["sectionTreeTableHeader"],title:this.launchCofunctionSectionsTitle,canHide:!0}),o=document.createElement("div");o.id="launchConfigurationsNode";var s=new m({checkbox:!1,treeTableClass:"sectionTreeTable",commandRegistry:this.commandRegistry,actionScopeId:this.launchConfigurationActions,projectClient:this.projectClient},this),a=new v(this.serviceRegistry,null,s,this.commandRegistry,this.launchConfigurationActions);r.embedExplorer(a,o),a.load(o,this.projectData,n,this.projectClient)},launchConfigurationChanged:function(e){if(this.configurations&&("create"===e.type||"changeState"===e.type)&&e.newValue){for(var t=0;t<this.configurations.length;t++){var n=this.configurations[t];if(n.Name===e.newValue.Name&&n.ServiceId===e.newValue.ServiceId)return this.configurations[t]=e.newValue,void this.renderLaunchConfigurations(this.configurationsParent,this.configurations,this.launchCofunctionSectionsTitle)}if("create"===e.type)return this.configurations.push(e.newValue),void this.renderLaunchConfigurations(this.configurationsParent,this.configurations,this.launchCofunctionSectionsTitle)}},destroy:function(){var e=this;this._launchConfigurationEventTypes.forEach(function(t){e.launchConfigurationDispatcher.removeEventListener(t,e.launchConfigurationListener)}),this._dependenciesEventTypes.forEach(function(t){e.dependenciesDisplatcher.removeEventListener(t,e.dependneciesListener)})}},{ProjectEditor:y}}),define("orion/projects/projectExplorer",["i18n!orion/edit/nls/messages","orion/Deferred","orion/URITemplate","orion/webui/littlelib","orion/explorers/explorer","orion/section"],function(e,t,n,i,r,o){function s(e){this._init(e)}function a(e,t,n,i){this.registry=t,this.selection=n,this.commandRegistry=i,this.parentId=e,this.renderer=new s({}),this.renderer.explorer=this,this.myTree=null,this.newActionsScope=d,this.actionsSections=[this.newActionsScope],this._init()}var l=new n("../edit/edit.html#{,resource,params*}"),d="newProjectActions";return s.prototype=new r.SelectionRenderer,s.prototype.getCellHeaderElement=function(){return null},s.prototype.emptyCallback=function(t){var n=document.createElement("tr"),r=document.createElement("td");r.colSpan=this.oneColumn?1:3;var o=document.createElement("div");o.classList.add("noFile"),o.textContent=e.NoProjects;var s=document.createElement("span");s.appendChild(document.createTextNode(e.File)),i.processDOMNodes(o,[s]),r.appendChild(o),n.appendChild(r),t.appendChild(n)},s.prototype.getCellElement=function(e,t){function n(e){return e.Description?e.Description.length>200?e.Description.substring(0,180)+"...":e.Description:" "}var i=document.createElement("td");switch(e){case 0:i.className="navColumnNoIcon";var r=document.createElement("a");return r.appendChild(document.createTextNode(t.Name)),r.href=l.expand({resource:t.ContentLocation}),i.appendChild(r),i;case 1:return i.appendChild(document.createTextNode(n(t))),i;case 2:return t.Url?(r=document.createElement("a"),r.appendChild(document.createTextNode(t.Url)),r.href=t.Url,i.appendChild(r)):i.appendChild(document.createTextNode(" ")),i}return null},a.prototype=Object.create(r.Explorer.prototype),a.prototype._init=function(){var e=new o.Section(i.node(this.parentId),{id:"projectsSection",title:"Projects",canHide:!0}),t=document.createElement("div");t.id="projectsExplorer",e.embedExplorer(this,t)},a.prototype.loadProjects=function(e){this.model=new r.SimpleFlatModel(e,"orion.project.",function(e){return e.ContentLocation?e.ContentLocation.replace(/[\\\/]/g,""):void 0}),this.myTree=this.createTree(this.parent,this.model,{indent:"8px",selectionPolicy:this.renderer.selectionPolicy}),this.updateCommands()},{ProjectExplorer:a,newActionsScope:d}}),define("orion/projects/projectView",["orion/projects/projectExplorer","orion/selection","orion/URITemplate","orion/webui/littlelib","orion/fileCommands"],function(e,t,n,i,r){function o(e){this.progress=e.progress,this.fileClient=e.fileClient,this.serviceRegistry=e.serviceRegistry,this.commandRegistry=e.commandRegistry,this.projectClient=this.serviceRegistry.getService("orion.project.client"),this.modelEventDispatcher=r.getModelEventDispatcher();var t=this;this.modelListener=function(e){t.changedItemEvent.call(t,e)},this._eventTypes=["copy","create","delete","import","move"],this._eventTypes.forEach(function(e){t.modelEventDispatcher.addEventListener(e,t.modelListener)})}var s=new n("#{,resource,params*}");return o.prototype={display:function(n,i){i.classList.add("orionProject"),this.projectExplorer=new e.ProjectExplorer(i,this.serviceRegistry,new t.Selection(this.serviceRegistry),this.commandRegistry),this.changedItem(n)},setCommandsVisible:function(e){this.projectExplorer&&this.projectExplorer.setCommandsVisible.call(this.projectExplorer,e)},changedItemEvent:function(e){e.parent&&this.workspace&&e.parent.Location===this.workspace.Location&&this.projects&&this._handleChangedEvent(e.oldValue,e.newValue)},_handleChangedEvent:function(e,t){var n=this;if(e&&e.ContentLocation&&!e.Children&&!e.ChildrenLocation)return void this.fileClient.loadWorkspace(e.ContentLocation).then(function(e){n._handleChangedEvent(e,t)});if(t&&t.ContentLocation&&!t.Children&&!t.ChildrenLocation)return void this.fileClient.loadWorkspace(t.ContentLocation).then(function(t){n._handleChangedEvent(e,t)});if(t)this.projectClient.readProject(t,this.workspace).then(function(t){if(e){for(var i=0;i<n.projects.length;i++)if(e.Location===n.projects[i].ContentLocation)return void(t?(n.projects[i]=t,n.projectExplorer.loadProjects(n.projects)):(n.projects.splice(i,1),n.projectExplorer.loadProjects(n.projects)))}else t&&(n.projects.push(t),n.projectExplorer.loadProjects(n.projects))});else if(e)for(var i=0;i<n.projects.length;i++)if(e.Location===n.projects[i].ContentLocation)return n.projects.splice(i,1),void n.projectExplorer.loadProjects(n.projects)},changedItem:function(e,t,n){var i=this;return"created"===n&&e.ContentLocation?void(window.location=s.expand({resource:e.ContentLocation})):void(e?i.progress.progress(i.projectClient.readAllProjects(e),"Listing projects").then(function(t){i.workspace=e,i.projects=t,i.projectExplorer.loadProjects(t)}):i.progress.progress(i.fileClient.loadWorkspace(),"Getting workspace information").then(function(t){i.progress.progress(i.projectClient.readAllProjects(e),"Listing projects").then(function(e){i.workspace=t,i.projects=e,i.projectExplorer.loadProjects(e)
})}))},destroy:function(){var e=this;this._eventTypes.forEach(function(t){e.modelEventDispatcher.removeEventListener(t,e.modelListener)})}},{ProjectView:o}}),define("orion/folderView",["i18n!orion/edit/nls/messages","orion/globalCommands","orion/explorers/explorer-table","orion/explorers/navigatorRenderer","orion/selection","orion/fileCommands","orion/markdownView","orion/projects/projectEditor","orion/PageUtil","orion/URITemplate","orion/webui/littlelib","orion/objects","orion/Deferred","orion/projects/projectView","orion/section"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f){function g(){_.apply(this,arguments)}function m(e){e.setFocus=!1,e.cachePrefix=null,e.dragAndDrop=o.uploadFile,e.modelEventDispatcher=o.getModelEventDispatcher(),e.rendererFactory=function(t){return new g({checkbox:!1,treeTableClass:"sectionTreeTable",cachePrefix:"FolderNavigator"},t,e.commandRegistry,e.contentTypeRegistry)},y.apply(this,arguments),this.menuBar=e.menuBar,this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.editorInputManager=e.editorInputManager,this.readonly=e.readonly,this.breadCrumbMaker=e.breadCrumbMaker,this.clickHandler=e.clickHandler,this.treeRoot={},this.parent=c.node(e.parentId)}function v(e){this._parent=e.parent,this._metadata=e.metadata,this.menuBar=e.menuBar,this.fileClient=e.fileService,this.progress=e.progressService,this.serviceRegistry=e.serviceRegistry,this.commandRegistry=e.commandRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.editorInputManager=e.inputManager,this.preferences=e.preferences,this.readonly=void 0===e.readonly?!1:e.readonly,this.showProjectView=void 0===e.showProjectView?!0:e.showProjectView,this.showFolderNav=!0,this.editorView=e.editorView,this._maxEditorHeight=e.maxEditorHeight,this.imageView=e.imageView,this.breadCrumbMaker=e.breadCrumbMaker,this.clickHandler=e.clickHandler,this._init()}var y=n.FileExplorer,_=i.NavigatorRenderer,C=new d("#{,resource,params*}");return g.prototype=Object.create(_.prototype),h.mixin(g.prototype,{showFolderImage:!0,createFolderNode:function(e){var t=i.NavigatorRenderer.prototype.createFolderNode.call(this,e);return this.showFolderLinks&&"A"===t.tagName&&(t.href=C.expand({resource:e.Location})),t.classList.add("folderNavFolder"),t.classList.add("navlink"),t.classList.add("targetSelector"),t.classList.remove("navlinkonpage"),this.explorer.readonly&&this.explorer.clickHandler&&(t.href="javascript:void(0)",t.addEventListener("click",function(){this.explorer.clickHandler(e.Location)}.bind(this),!1)),t},updateFileNode:function(e,t,n){i.NavigatorRenderer.prototype.updateFileNode.call(this,e,t,n),this.explorer.readonly&&"A"===t.tagName&&(this.explorer.clickHandler?(t.href="javascript:void(0)",t.addEventListener("click",function(){this.explorer.clickHandler(e.Location)}.bind(this),!1)):t.href=C.expand({resource:e.Location}))},getCellHeaderElement:function(e){if(this.explorer.breadCrumbMaker)return null;var t;if(0===e){t=document.createElement("th"),t.colSpan=1;var n=this.explorer.treeRoot;return t.appendChild(document.createTextNode(n.Parents?n.Name:this.explorer.fileClient.fileServiceName(n.Location))),t}return null},emptyCallback:function(e){this.explorer.readonly||i.NavigatorRenderer.prototype.emptyCallback.call(this,e)},getExpandImage:function(){return null}}),m.prototype=Object.create(y.prototype),h.mixin(m.prototype,{loadRoot:function(e){e?this.load(e,"Loading "+e.Name).then(this.loaded.bind(this)):this.loadResourceList(l.matchResourceParameters().resource+"?depth=1",!1).then(this.loaded.bind(this))},isCommandsVisible:function(){if(!this.selection)return!1;var e=t.getMainSplitter();return e?e.splitter.isClosed():!this.readonly},scope:function(e){window.location.href=C.expand({resource:e})},scopeUp:function(){var e,t=this.treeRoot,n=t.Parents&&t.Parents[0];e=n?n.ChildrenLocation:this.fileClient.fileServiceRootURL(t.Location),this.scope(e)},scopeDown:function(e){this.scope(e.ChildrenLocation)},registerCommands:function(){return(new u).resolve()},updateCommands:function(){this.menuBar&&(this.menuBar.setActiveExplorer(this),this.menuBar.updateCommands())}}),v.prototype={_init:function(){this.markdownView=new s.MarkdownView({fileClient:this.fileClient,canHide:!this.readonly,progress:this.progress}),this.showProjectView&&(this.projectEditor=new a.ProjectEditor({fileClient:this.fileClient,progress:this.progress,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,preferences:this.preferences}),this.projectView=new p.ProjectView({fileClient:this.fileClient,progress:this.progress,serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry}));var e=t.getMainSplitter();e&&t.getMainSplitter().splitter.addEventListener("toggle",this._splitterToggleListener=function(e){[this.markdownView,this.projectEditor,this.projectView,this.folderNavExplorer].forEach(function(t){t&&t.setCommandsVisible&&t.setCommandsVisible(e.closed)})}.bind(this))},_isCommandsVisible:function(){var e=t.getMainSplitter();return e?e.splitter.isClosed():!this.readonly},displayWorkspaceView:function(){var e=this;if(this._node||(this._node=document.createElement("div")),this._parent.appendChild(this._node),this.showProjectView){var t=document.createElement("div");e._node.appendChild(t),this.projectView.display(this._metadata,t),this.projectView.setCommandsVisible(this._isCommandsVisible())}},displayFolderView:function(e){function t(e,t){e.forEach(function(e){if("project"===e)n&&this.showProjectView&&(a=document.createElement("div"),this.projectEditor.displayContents(a,this._metadata),this._node.appendChild(a));else if("folderNav"===e){if(this.showFolderNav){var r=document.createElement("div");r.id="folderNavNode";var o=t[e]||"Files",s=new f.Section(this._node,{id:"folderNavSection",headerClass:["sectionTreeTableHeader"],title:o,canHide:!this.readonly});if(this.editorView){s.setContent(this.editorView.getParent()),this.editorView.create();var l=this.editorView.editor.getTextView();l.getModel().addEventListener("Changed",this._editorViewModelChangedListener=function(){var e=l.getLineHeight()*l.getModel().getLineCount()+20;this._maxEditorHeight&&this._maxEditorHeight>0&&e>this._maxEditorHeight&&(e=this._maxEditorHeight),this.editorView.getParent().style.height=e+"px"}.bind(this)),this.editor=this.editorView.editor}else this.imageView?s.setContent(this.imageView.image):(this.folderNavExplorer=new m({parentId:r,view:this,readonly:this.readonly,menuBar:this.menuBar,breadCrumbMaker:this.breadCrumbMaker,clickHandler:this.clickHandler,serviceRegistry:this.serviceRegistry,fileClient:this.fileClient,editorInputManager:this.editorInputManager,commandRegistry:this.commandRegistry,contentTypeRegistry:this.contentTypeRegistry}),s.embedExplorer(this.folderNavExplorer),this.folderNavExplorer.setCommandsVisible(this._isCommandsVisible()),this.folderNavExplorer.loadRoot(this._metadata));if(this.breadCrumbMaker){var d=s.getTitleElement();if(d){c.empty(d);var h=document.createElement("div");d.appendChild(h),this.breadCrumbMaker(h,s.getHeaderElement().offsetWidth-24)}}}}else"readme"===e&&i&&(a=document.createElement("div"),this.markdownView.displayInFrame(a,i,["sectionTreeTableHeader"],null,t[e]),this._node.appendChild(a))}.bind(this))}var n,i,r=e.Children;if(r)for(var o=0;o<r.length;o++){var s=r[o];s.Directory||"project.json"!==s.Name||(n=s),!s.Directory&&s.Name&&"readme.md"===s.Name.toLowerCase()&&(i=s)}var a;this._node||(this._node=document.createElement("div")),this._parent.appendChild(this._node);var l=["project","folderNav","readme"],d={};this.editorView?t.apply(this,[l,d]):this.preferences?this.preferences.getPreferences("/sectionsOrder").then(function(e){d=e.get("folderViewNames")||d,l=e.get("folderView")||l,t.apply(this,[l,d])}.bind(this),function(e){t.apply(this,[l,d]),window.console.error(e)}.bind(this)):t.apply(this,[l,d])},create:function(){this._metadata.Projects&&this.displayWorkspaceView(),this.editorView||this.imageView?this.displayFolderView(this._metadata):this._metadata.Children?this.displayFolderView(this._metadata):this._metadata.ChildrenLocation&&this.progress.progress(this.fileClient.fetchChildren(this._metadata.ChildrenLocation),"Fetching children of "+this._metadata.Name).then(function(e){this._metadata.Children=e,this.displayFolderView(this._metadata)}.bind(this))},destroy:function(){this.editorView&&(this.editorView.editor.getTextView().getModel().removeEventListener("Changed",this._editorViewModelChangedListener),this.editorView.destroy(),this.editor=null);var e=t.getMainSplitter();e&&e.splitter.removeEventListener("toggle",this._splitterToggleListener),this.folderNavExplorer&&this.folderNavExplorer.destroy(),this.folderNavExplorer=null,this._node&&this._node.parentNode&&this._node.parentNode.removeChild(this._node),this.projectView&&this.projectView.destroy(),this.projectEditor&&this.projectEditor.destroy(),this._node=null}},{FolderView:v}}),define("orion/editor/find",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/regex","orion/objects","orion/util"],function(e,t,n,i,r,o,s){function a(e){var t=e.getTextView();n.KeyMode.call(this,t),this.editor=e,this._active=!1,this._success=!0,this._ignoreSelection=!1,this._prefix="",t.setAction("incrementalFindCancel",function(){return this.setActive(!1),!0}.bind(this)),t.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));var i=this;this._listener={onVerify:function(e){var t=i.editor,n=t.getModel(),o=t.mapOffset(e.start),s=t.mapOffset(e.end),a=n.getText(o,s),l=i._prefix,d=l.match(new RegExp("^"+r.escape(a),"i"));d&&d.length>0&&(l=i._prefix+=e.text,i._success=!0,i._status(),i.find(i._forward,!0),e.text=null)},onSelection:function(){i._ignoreSelection||i.setActive(!1)}}}function l(e,t,n){if(e){this._editor=e,this._undoStack=t,this._showAll=!0,this._visible=!1,this._caseInsensitive=!0,this._wrap=!0,this._wholeWord=!1,this._incremental=!0,this._regex=!1,this._findAfterReplace=!0,this._hideAfterFind=!1,this._reverse=!1,this._start=void 0,this._end=void 0,this._timer=void 0,this._lastString="";var i=this;this._listeners={onEditorFocus:function(e){i._removeCurrentAnnotation(e)}},this.setOptions(n)}}var d={};return a.prototype=new n.KeyMode,o.mixin(a.prototype,{createKeyBindings:function(){var e=t.KeyBinding,n=[];return n.push({actionID:"incrementalFindBackspace",keyBinding:new e(8)}),n.push({actionID:"incrementalFindCancel",keyBinding:new e(13)}),n.push({actionID:"incrementalFindCancel",keyBinding:new e(27)}),n.push({actionID:"incrementalFindReverse",keyBinding:new e(38)}),n.push({actionID:"incrementalFind",keyBinding:new e(40)}),n.push({actionID:"incrementalFindReverse",keyBinding:new e("k",!0,!0)}),n.push({actionID:"incrementalFind",keyBinding:new e("k",!0)}),n},find:function(e,t){if(this._forward=e,!this.isActive())return this.setActive(!0),!1;var n=this._prefix;if(0===n.length)return!1;var i,r=this.editor,o=r.getModel();i=e?this._success?t?this._start:r.getCaretOffset()+1:0:this._success?t?this._start:r.getCaretOffset():o.getCharCount()-1;var s=r.getModel().find({string:n,start:i,reverse:!e,caseInsensitive:n.toLowerCase()===n}).next();return s?(t||(this._start=i),this._success=!0,this._ignoreSelection=!0,r.moveSelection(e?s.start:s.end,e?s.end:s.start),this._ignoreSelection=!1):this._success=!1,this._status(),!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(e){if(this._active!==e){this._active=e,this._prefix="",this._success=!0;var t=this.editor,n=t.getTextView();this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(n.addEventListener("Verify",this._listener.onVerify),n.addEventListener("Selection",this._listener.onSelection),n.addKeyMode(this)):(n.removeEventListener("Verify",this._listener.onVerify),n.removeEventListener("Selection",this._listener.onSelection),n.removeKeyMode(this)),this._status()}},_backspace:function(){var e=this._prefix;return e=this._prefix=e.substring(0,e.length-1),0===e.length?(this._success=!0,this._ignoreSelection=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(!this.isActive())return void this.editor.reportStatus("");var t;t=this._forward?this._success?e.incrementalFindStr:e.incrementalFindStrNotFound:this._success?e.incrementalFindReverseStr:e.incrementalFindReverseStrNotFound,t=s.formatMessage(t,this._prefix),this.editor.reportStatus(t,this._success?"":"error")}}),d.IncrementalFind=a,l.prototype={find:function(e,t,n){this.setOptions({reverse:!e});var i,r=this.getFindString();t&&(r=t.findString||r,i=t.count);var o=this.getOptions();this.setOptions(t);var s=n?this._startOffset:this.getStartOffset(),a=this._doFind(r,s,i);return a&&(n||(this._startOffset=a.start)),this.setOptions(o),this._hideAfterFind&&this.hide(),a},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var e=this._editor.getSelection(),t=this._editor.getText(e.start,e.end);return this._regex&&(t=r.escape(t)),t||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},hide:function(){this._visible=!1,this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null)),this._removeAllAnnotations();var e=this._editor.getTextView();e&&(e.removeEventListener("Focus",this._listeners.onEditorFocus),e.focus())},_processReplaceString:function(e){var t=e;if(this._regex){t="";for(var n=!1,i=this._editor.getModel().getLineDelimiter(),r=0;r<e.length;r++){var o=e.substring(r,r+1);if(n){switch(o){case"R":t+=i;break;case"r":t+="\r";break;case"n":t+="\n";break;case"t":t+="	";break;case"\\":t+="\\";break;default:t+="\\"+o}n=!1}else"\\"===o?n=!0:t+=o}n&&(t+="\\")}return t},isVisible:function(){return this._visible},replace:function(){var e=this.getFindString();if(e){var t=this._editor,n=this._processReplaceString(this.getReplaceString()),i=t.getSelection(),r=i.start,o=t.getModel().find({string:e,start:r,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next();o&&(this.startUndo(),this._doReplace(o.start,o.end,e,n),this.endUndo())}this._findAfterReplace&&e&&this._doFind(e,this.getStartOffset())},replaceAll:function(){var t=this.getFindString();if(t){this._replacingAll=!0;var n=this._editor,i=n.getTextView();n.reportStatus(e.replacingAll);var r=this._processReplaceString(this.getReplaceString()),o=this;window.setTimeout(function(){for(var a=0,l=0;;){var d=o._doFind(t,a,null,!0);if(!d)break;l++,1===l&&(i.setRedraw(!1),o.startUndo()),o._doReplace(d.start,d.end,t,r),a=o.getStartOffset()}l>0&&(o.endUndo(),i.setRedraw(!0)),a>0?n.reportStatus(s.formatMessage(e.replacedMatches,l)):n.reportStatus(e.nothingReplaced,"error"),o._replacingAll=!1},100)}},setOptions:function(e){if(e){if((e.showAll===!0||e.showAll===!1)&&this._showAll!==e.showAll&&(this._showAll=e.showAll,this.isVisible()))if(this._showAll)this._markAllOccurrences();else{var t=this._editor.getAnnotationModel();t&&t.removeAnnotations(i.AnnotationType.ANNOTATION_MATCHING_SEARCH)}(e.caseInsensitive===!0||e.caseInsensitive===!1)&&(this._caseInsensitive=e.caseInsensitive),(e.wrap===!0||e.wrap===!1)&&(this._wrap=e.wrap),(e.wholeWord===!0||e.wholeWord===!1)&&(this._wholeWord=e.wholeWord),(e.incremental===!0||e.incremental===!1)&&(this._incremental=e.incremental),(e.regex===!0||e.regex===!1)&&(this._regex=e.regex),(e.findAfterReplace===!0||e.findAfterReplace===!1)&&(this._findAfterReplace=e.findAfterReplace),(e.hideAfterFind===!0||e.hideAfterFind===!1)&&(this._hideAfterFind=e.hideAfterFind),(e.reverse===!0||e.reverse===!1)&&(this._reverse=e.reverse),e.hasOwnProperty("findCallback")&&(this._findCallback=e.findCallback),e.hasOwnProperty("start")&&(this._start=e.start),e.hasOwnProperty("end")&&(this._end=e.end)}},show:function(e){this._visible=!0,e&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(e)),this._startOffset=this._editor.getSelection().start,this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var t=this;window.setTimeout(function(){t._incremental&&t.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(e,t,n){return this._editor.getModel().find({string:e,start:t,end:this._end,reverse:this._reverse,wrap:n?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(t,n,r,o){r=r||1;var s=this._editor;if(!t)return this._removeAllAnnotations(),null;this._lastString=t;var a,l;if(this._regex)try{l=this._find(t,n,o)}catch(d){return void s.reportStatus(d.message,"error")}else l=this._find(t,n,o);for(var c=0;r>c&&l.hasNext();c++)a=l.next();if(!this._replacingAll){if(a?this._editor.reportStatus(""):this._editor.reportStatus(e.notFound,"error"),this.isVisible()){var h=i.AnnotationType.ANNOTATION_CURRENT_SEARCH,u=s.getAnnotationModel();if(u&&(u.removeAnnotations(h),a&&u.addAnnotation(i.AnnotationType.createAnnotation(h,a.start,a.end))),this._showAll){this._timer&&window.clearTimeout(this._timer);var p=this;this._timer=window.setTimeout(function(){p._markAllOccurrences(),p._timer=null},500)}}this._findCallback?this._findCallback(a):a&&s.moveSelection(a.start,a.end,null,!1)}return a},_doReplace:function(e,t,n,i){var r=this._editor;this._regex&&(i=r.getText(e,t).replace(new RegExp(n,this._caseInsensitive?"i":""),i)),r.setText(i,e,t),r.setSelection(e,e+i.length,!0)},_markAllOccurrences:function(){var e=this._editor.getAnnotationModel();if(e){for(var t,n=i.AnnotationType.ANNOTATION_MATCHING_SEARCH,r=e.getAnnotations(),o=[];r.hasNext();){var s=r.next();s.type===n&&o.push(s)}if(this.isVisible()){var a=this.getFindString();for(r=this._editor.getModel().find({string:a,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}),t=[];r.hasNext();){var l=r.next();t.push(i.AnnotationType.createAnnotation(n,l.start,l.end))}}e.replaceAnnotations(o,t)}},_removeAllAnnotations:function(){var e=this._editor.getAnnotationModel();e&&(e.removeAnnotations(i.AnnotationType.ANNOTATION_CURRENT_SEARCH),e.removeAnnotations(i.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(){var e=this._editor.getAnnotationModel();e&&e.removeAnnotations(i.AnnotationType.ANNOTATION_CURRENT_SEARCH)}},d.Find=l,d}),define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(e,t,n,i,r){function o(e,n,i){t.Find.call(this,e,n,i)}return o.prototype=new t.Find,n.mixin(o.prototype,{getFindString:function(){var e=this._findInput;return e?e.value:t.Find.prototype.getFindString.call(this)},getReplaceString:function(){var e=this._replaceInput;return e?e.value:t.Find.prototype.getReplaceString(this)},hide:function(){var e=this.isVisible();t.Find.prototype.hide.call(this),e&&(this._rootDiv.className="textViewFind")},show:function(e){t.Find.prototype.show.call(this,e);var n=e.findString,i=e.replaceString,r=this._findInput;if(r||(this._create(),r=this._findInput),n&&(r.value=n),i){var o=this._replaceInput;o.value=i}var s=this;window.setTimeout(function(){s._rootDiv.className="textViewFind show",r.select(),r.focus()},0)},_create:function(){var e=this,t=this._editor.getTextView(),n=t.getOptions("parent"),o=n.ownerDocument,s=r.createElement(o,"div");s.className="textViewFind",i.addEventListener(s,"keydown",function(t){e._handleKeyDown(t)}),this._rootDiv=s,this._createContents(o,s),t._rootDiv.insertBefore(s,t._rootDiv.firstChild)},_createContents:function(t,n){var o=this,s=r.createElement(t,"input");s.className="textViewFindInput",this._findInput=s,s.type="text",s.placeholder=e.findWith,i.addEventListener(s,"input",function(e){return o._handleInput(e)}),n.appendChild(s);var a=r.createElement(t,"span");o._createButton(t,a,e.next,function(){o.find(!0)}),o._createButton(t,a,e.previous,function(){o.find(!1)}),n.appendChild(a);var l=o._editor.getTextView().getOptions("readonly");if(!l){var d=r.createElement(t,"input");d.className="textViewReplaceInput",this._replaceInput=d,d.type="text",d.placeholder=e.replaceWith,n.appendChild(d),a=r.createElement(t,"span"),o._createButton(t,a,e.replace,function(){o.replace()}),o._createButton(t,a,e.replaceAll,function(){o.replaceAll()}),n.appendChild(a)}a=r.createElement(t,"span"),o._createButton(t,a,e.regex,function(e){o._toggle("regex",e.target)},this._regex,e.regexTooltip),o._createButton(t,a,e.caseInsensitive,function(e){o._toggle("caseInsensitive",e.target)},this._caseInsensitive,e.caseInsensitiveTooltip),o._createButton(t,a,e.wholeWord,function(e){o._toggle("wholeWord",e.target)},this._wholeWord,e.wholeWordTooltip),n.appendChild(a);var c=o._createButton(t,n,"",function(){o.hide()});c.className="textViewFindCloseButton",c.title=e.closeTooltip},_createButton:function(e,t,n,r,o,s){var a=e.createElement("button");return this._checked(o,a),s&&(a.title=s),i.addEventListener(a,"click",function(e){r.call(this,e)},!1),n&&a.appendChild(e.createTextNode(n)),t.appendChild(a),a},_toggle:function(e,t){var n={};n[e]=!this["_"+e],this.setOptions(n),this._checked(n[e],t)},_checked:function(e,t){t.className="textViewFindButton",e&&(t.className+=" checked")},_handleInput:function(){return this._incremental&&this.find(!0,null,!0),!0},_handleKeyDown:function(e){var t,n=(r.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;return n&&70===e.keyCode&&(t=!0),((r.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||13===e.keyCode)&&(this.find(13===e.keyCode?this._reverse?e.shiftKey:!e.shiftKey:!e.shiftKey),t=!0),n&&82===e.keyCode&&(this.replace(),t=!0),27===e.keyCode&&(this.hide(),t=!0),t?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):!0}}),{FindUI:o}}),define("orion/editor/actions",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/annotations","orion/editor/tooltip","orion/editor/find","orion/editor/findUI","orion/util"],function(e,t,n,i,r,o,s){function a(e,t,n){this.editor=e,this.undoStack=t,this._incrementalFind=new r.IncrementalFind(e),this._find=n?n:new o.FindUI(e,t),this._lastEditLocation=null,this.init()}function l(e,t,n,i){this.editor=e,this.undoStack=t,this.contentAssist=n,this.linkedMode=i,this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",this.contentAssistProposalApplied.bind(this)),this.init()}var d=n.AnnotationType,c={};return a.prototype={init:function(){var n=this.editor.getTextView();this._lastEditListener={onModelChanged:function(e){this.editor.isDirty()&&(this._lastEditLocation=e.start+e.addedCharCount)}.bind(this)},n.addEventListener("ModelChanged",this._lastEditListener.onModelChanged),n.setAction("undo",function(e){if(this.undoStack){var t=1;for(e&&e.count&&(t=e.count);t>0;)this.undoStack.undo(),--t;return!0}return!1}.bind(this),{name:e.undo}),n.setAction("redo",function(e){if(this.undoStack){var t=1;for(e&&e.count&&(t=e.count);t>0;)this.undoStack.redo(),--t;return!0}return!1}.bind(this),{name:e.redo}),n.setKeyBinding(new t.KeyBinding("f",!0),"find"),n.setAction("find",function(){if(this._find){var e=this.editor.getSelection();return this._find.show({findString:this.editor.getText(e.start,e.end)}),!0}return!1}.bind(this),{name:e.find}),n.setKeyBinding(new t.KeyBinding("k",!0),"findNext"),n.setAction("findNext",function(e){return this._find?(this._find.find(!0,e),!0):!1}.bind(this),{name:e.findNext}),n.setKeyBinding(new t.KeyBinding("k",!0,!0),"findPrevious"),n.setAction("findPrevious",function(e){return this._find?(this._find.find(!1,e),!0):!1}.bind(this),{name:e.findPrevious}),n.setKeyBinding(new t.KeyBinding("j",!0),"incrementalFind"),n.setAction("incrementalFind",function(){return this._incrementalFind&&this._incrementalFind.find(!0),!0}.bind(this),{name:e.incrementalFind}),n.setKeyBinding(new t.KeyBinding("j",!0,!0),"incrementalFindReverse"),n.setAction("incrementalFindReverse",function(){return this._incrementalFind&&this._incrementalFind.find(!1),!0}.bind(this),{name:e.incrementalFindReverse}),n.setAction("tab",function(){return this.indentLines()}.bind(this)),n.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:e.unindentLines}),n.setKeyBinding(new t.KeyBinding(38,!1,!1,!0),"moveLinesUp"),n.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:e.moveLinesUp}),n.setKeyBinding(new t.KeyBinding(40,!1,!1,!0),"moveLinesDown"),n.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:e.moveLinesDown}),n.setKeyBinding(new t.KeyBinding(38,!0,!1,!0),"copyLinesUp"),n.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:e.copyLinesUp}),n.setKeyBinding(new t.KeyBinding(40,!0,!1,!0),"copyLinesDown"),n.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:e.copyLinesDown}),n.setKeyBinding(new t.KeyBinding("d",!0,!1,!1),"deleteLines"),n.setAction("deleteLines",function(e){return this.deleteLines(e)}.bind(this),{name:e.deleteLines}),n.setKeyBinding(new t.KeyBinding("l",!s.isMac,!1,!1,s.isMac),"gotoLine"),n.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:e.gotoLine}),n.setKeyBinding(new t.KeyBinding(190,!0),"nextAnnotation"),n.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:e.nextAnnotation}),n.setKeyBinding(new t.KeyBinding(188,!0),"previousAnnotation"),n.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:e.prevAnnotation}),n.setKeyBinding(new t.KeyBinding("e",!0,!1,!0,!1),"expand"),n.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:e.expand}),n.setKeyBinding(new t.KeyBinding("c",!0,!1,!0,!1),"collapse"),n.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:e.collapse}),n.setKeyBinding(new t.KeyBinding("e",!0,!0,!0,!1),"expandAll"),n.setAction("expandAll",function(){return this.expandAnnotations(!0)}.bind(this),{name:e.expandAll}),n.setKeyBinding(new t.KeyBinding("c",!0,!0,!0,!1),"collapseAll"),n.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:e.collapseAll}),n.setKeyBinding(new t.KeyBinding("q",!s.isMac,!1,!1,s.isMac),"lastEdit"),n.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:e.lastEdit})},copyLinesDown:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start),o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end),s=n.getLineStart(r),a=n.getLineEnd(o,!0),l=n.getLineCount(),d="",c=n.getText(s,a);o===l-1&&(c=(d=n.getLineDelimiter())+c);var h=a;return e.setText(c,h,h),e.setSelection(h+d.length,h+c.length),!0},copyLinesUp:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start),o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end),s=n.getLineStart(r),a=n.getLineEnd(o,!0),l=n.getLineCount(),d="",c=n.getText(s,a);o===l-1&&(c+=d=n.getLineDelimiter());var h=s;return e.setText(c,h,h),e.setSelection(h,h+c.length-d.length),!0},deleteLines:function(e){var t=this.editor,n=t.getTextView();if(n.getOptions("readonly"))return!1;var i=1;e&&e.count&&(i=e.count);var r,o=t.getSelection(),s=t.getModel(),a=s.getLineAtOffset(o.start),l=s.getLineStart(a);r=o.start!==o.end||1===i?s.getLineAtOffset(o.end>o.start?o.end-1:o.end):Math.min(a+i-1,s.getLineCount()-1);var d=s.getLineEnd(r,!0);return t.setText("",l,d),!0},expandAnnotation:function(e){var t=this.editor,i=t.getAnnotationModel();if(!i)return!0;var r=t.getModel(),o=t.getCaretOffset(),s=r.getLineAtOffset(o),a=r.getLineStart(s),l=r.getLineEnd(s,!0);r.getBaseModel&&(a=r.mapOffset(a),l=r.mapOffset(l),r=r.getBaseModel());for(var d,c=i.getAnnotations(a,l);!d&&c.hasNext();){var h=c.next();h.type===n.AnnotationType.ANNOTATION_FOLDING&&(d=h)}return d&&e!==d.expanded&&(e?d.expand():(t.setCaretOffset(d.start),d.collapse())),!0},expandAnnotations:function(e){var t=this.editor,i=t.getTextView(),r=t.getAnnotationModel();if(!r)return!0;var o,s=r.getAnnotations();for(i.setRedraw(!1);s.hasNext();)o=s.next(),o.type===n.AnnotationType.ANNOTATION_FOLDING&&e!==o.expanded&&(e?o.expand():o.collapse());return i.setRedraw(!0),!0},indentLines:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;if(t.getOptions("tabMode")){var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start),o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end);if(r!==o){var s=[];s.push("");for(var a=r;o>=a;a++)s.push(n.getLine(a,!0));var l=n.getLineStart(r),d=n.getLineEnd(o,!0),c=t.getOptions("tabSize","expandTab"),h=c.expandTab?new Array(c.tabSize+1).join(" "):"	";return e.setText(s.join(h),l,d),e.setSelection(l===i.start?i.start:i.start+h.length,i.end+(o-r+1)*h.length),!0}return!1}},gotoLastEdit:function(){return"number"==typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation),!0},gotoLine:function(){var t=this.editor,n=t.getModel(),i=n.getLineAtOffset(t.getCaretOffset());return i=prompt(e.gotoLinePrompty,i+1),i&&(i=parseInt(i,10),t.onGotoLine(i-1,0)),!0},moveLinesDown:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start),o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end),s=n.getLineCount();if(o===s-1)return!0;var a,l=n.getLineStart(r),d=n.getLineEnd(o,!0),c=n.getLineEnd(o+1,!0)-(d-l),h=0;if(o!==s-2)a=n.getText(l,d);else{var u=n.getLineEnd(o);a=n.getText(u,d)+n.getText(l,u),h+=d-u}return this.startUndo(),e.setText("",l,d),e.setText(a,c,c),e.setSelection(c+h,c+h+a.length),this.endUndo(),!0},moveLinesUp:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start);if(0===r)return!0;var o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end),s=n.getLineCount(),a=n.getLineStart(r-1),l=n.getLineStart(r),d=n.getLineEnd(o,!0),c=n.getText(l,d),h=0;if(o===s-1){var u=n.getLineEnd(r-1),p=n.getLineEnd(r-1,!0);c+=n.getText(u,p),l=u,h=p-u}return this.startUndo(),e.setText("",l,d),e.setText(c,a,a),e.setSelection(a,a+c.length-h),this.endUndo(),!0},nextAnnotation:function(e){function t(e){return!!e.lineStyle||e.type===d.ANNOTATION_MATCHING_BRACKET||e.type===d.ANNOTATION_CURRENT_BRACKET||!o.isAnnotationTypeVisible(e.type)}var n=this.editor,r=n.getAnnotationModel();if(!r)return!0;var o=n.getOverviewRuler()||n.getAnnotationStyler();if(!o)return!0;for(var s=n.getModel(),a=n.getCaretOffset(),l=r.getAnnotations(e?a:0,e?s.getCharCount():a),c=null;l.hasNext();){var h=l.next();if(e){if(h.start<=a)continue}else if(h.start>=a)continue;if(!t(h)&&(c=h,e))break}if(c){var u=[c];for(l=r.getAnnotations(c.start,c.start);l.hasNext();)h=l.next(),h===c||t(h)||u.push(h);var p=n.getTextView(),f=s.getLineAtOffset(c.start),g=i.Tooltip.getTooltip(p);if(!g)return n.moveSelection(c.start),!0;n.moveSelection(c.start,c.start,function(){g.setTarget({getTooltipInfo:function(){var e=p.convert({x:p.getLocationAtOffset(c.start).x,y:p.getLocationAtOffset(s.getLineStart(f)).y},"document","page");return{contents:u,x:e.x,y:e.y+Math.floor(1.33*p.getLineHeight(f))}}},0)})}return!0},unindentLines:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;
if(t.getOptions("tabMode")){for(var n=e.getModel(),i=e.getSelection(),r=n.getLineAtOffset(i.start),o=n.getLineAtOffset(i.end>i.start?i.end-1:i.end),s=t.getOptions("tabSize"),a=new Array(s+1).join(" "),l=[],d=0,c=0,h=r;o>=h;h++){var u=n.getLine(h,!0);if(n.getLineStart(h)!==n.getLineEnd(h))if(0===u.indexOf("	"))u=u.substring(1),d++;else{if(0!==u.indexOf(a))return!0;u=u.substring(s),d+=s}h===r&&(c=d),l.push(u)}var p=n.getLineStart(r),f=n.getLineEnd(o,!0),g=n.getLineStart(o);e.setText(l.join(""),p,f);var m=p===i.start?i.start:i.start-c,v=Math.max(m,i.end-d+(i.end===g+1&&i.start!==i.end?1:0));return e.setSelection(m,v),!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}},c.TextActions=a,l.prototype={init:function(){var n=this.editor.getTextView();n.setAction("lineStart",function(){return this.lineStart()}.bind(this)),n.setAction("enter",function(){return this.autoIndent()}.bind(this)),n.setKeyBinding(new t.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces"),n.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:e.trimTrailingWhitespaces}),n.setKeyBinding(new t.KeyBinding(191,!0),"toggleLineComment"),n.setAction("toggleLineComment",function(){return this.toggleLineComment()}.bind(this),{name:e.toggleLineComment}),n.setKeyBinding(new t.KeyBinding(191,!0,!s.isMac,!1,s.isMac),"addBlockComment"),n.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:e.addBlockComment}),n.setKeyBinding(new t.KeyBinding(220,!0,!s.isMac,!1,s.isMac),"removeBlockComment"),n.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:e.removeBlockComment}),n.setKeyBinding(new t.KeyBinding("[",!1,!1,!1,!1,"keypress"),"autoPairSquareBracket"),n.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this)),n.setKeyBinding(new t.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket"),n.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this)),n.setKeyBinding(new t.KeyBinding("<",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket"),n.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("<",">")}.bind(this)),n.setKeyBinding(new t.KeyBinding(">",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket"),n.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket(">")}.bind(this)),n.setKeyBinding(new t.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses"),n.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this)),n.setKeyBinding(new t.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis"),n.setAction("skipClosingParenthesis",function(){return this.skipClosingBracket(")")}.bind(this)),n.setKeyBinding(new t.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces"),n.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this)),n.setKeyBinding(new t.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace"),n.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this)),n.setKeyBinding(new t.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation"),n.setAction("autoPairSingleQuotation",function(){return this.autoPairQuotations("'")}.bind(this)),n.setKeyBinding(new t.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation"),n.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this)),n.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getSelection();if(n.start===n.end){for(var i,r=e.getModel(),o=r.getLineAtOffset(n.start),s=r.getLine(o,!1),a=r.getLineStart(o),l=0,d=n.start-a;d>l&&(32===(i=s.charCodeAt(l))||9===i);)l++;var c,h,u=s.substring(0,l),p=t.getOptions("tabSize","expandTab"),f=p.expandTab?new Array(p.tabSize+1).join(" "):"	",g=r.getLineDelimiter(),m=/^[\s]*\/\*[\*]*[\s]*$/,v=/^[\s]*\*/,y=/\*\/[\s]*$/,_=s.substring(0,d),C=s.substring(d);if(this.smartIndentation&&123===s.charCodeAt(h=_.trimRight().length-1)){var w=d-h-1,b=C.length-C.trimLeft().length;return c=125===s.charCodeAt(d+b)?g+u+f+g+u:g+u+f,e.setText(c,n.start-w,n.end+b),e.setCaretOffset(n.start+g.length+u.length+f.length-w),!0}if(this.autoCompleteComments&&!y.test(_)&&(m.test(_)||v.test(_))){var x,S=m.exec(_);if(S)return c=g+u+" * ",c+=y.test(C)?C.substring(0,C.length-2).trim():C.trim(),r.getLineCount()!==o+1&&v.test(r.getLine(o+1))||(c+=g+u+" */"),e.setText(c,n.start,n.end+C.length),e.setCaretOffset(n.start+g.length+u.length+3),!0;if(S=v.exec(_))for(var L=o-1;L>=0;L--){var E=r.getLine(L,!1);if(m.test(E))return y.test(C)||47===s.charCodeAt(d)?(c=g+u+"*"+C,x=n.start+g.length+u.length+1):(c=g+u+"* "+C,x=n.start+g.length+u.length+2),e.setText(c,n.start,n.end+C.length),e.setCaretOffset(x),!0;if(!v.test(E))return!1}return!1}if(y.test(_)&&32===u.charCodeAt(u.length-1))return c=g+u.substring(0,u.length-1),e.setText(c,n.start,n.end),e.setCaretOffset(n.start+c.length),!0;if(l>0){for(l=d;l<s.length&&(32===(i=s.charCodeAt(l++))||9===i);)n.end++;return e.setText(r.getLineDelimiter()+u,n.start,n.end),!0}}return!1},addBlockComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getModel(),i=e.getSelection(),r="/*",o="*/",s=new RegExp("/\\*|\\*/","g"),a=this._findEnclosingComment(n,i.start,i.end);if(void 0!==a.commentStart&&void 0!==a.commentEnd)return!0;var l=n.getText(i.start,i.end);if(0===l.length)return!0;var d=l.length;l=l.replace(s,"");var c=l.length;return e.setText(r+l+o,i.start,i.end),e.setSelection(i.start+r.length,i.end+r.length+(c-d)),!0},autoPairBrackets:function(e,t){if("["===e&&!this.autoPairSquareBrackets)return!1;if("{"===e&&!this.autoPairBraces)return!1;if("("===e&&!this.autoPairParentheses)return!1;if("<"===e&&!this.autoPairAngleBrackets)return!1;var n=this.editor,i=n.getTextView();if(i.getOptions("readonly"))return!1;var r=n.getSelection(),o=n.getModel(),s=n.getCaretOffset(),a=s===o.getCharCount()?"":o.getText(r.start,r.start+1).trim(),l=new RegExp("^$|[)}\\]>]");if(r.start===r.end&&l.test(a))return n.setText(e+t,r.start,r.start),n.setCaretOffset(r.start+1),!0;if(r.start!==r.end){var d=o.getText(r.start,r.end);return n.setText(e+d+t,r.start,r.end),n.setSelection(r.start+1,r.end+1),!0}return!1},autoPairQuotations:function(e){if(!this.autoPairQuotation)return!1;var t=this.editor,n=t.getTextView();if(n.getOptions("readonly"))return!1;var i=t.getSelection(),r=t.getModel(),o=t.getCaretOffset(),s=0===o?"":r.getText(i.start-1,i.start).trim(),a=o===r.getCharCount()?"":r.getText(i.start,i.start+1).trim(),l=new RegExp("^\"$|^'$"),d=new RegExp("\\w"),c=new RegExp("^$|[)}\\]>]");if(i.start!==i.end){var h=r.getText(i.start,i.end);if(l.test(h))return!1;t.setText(e+h+e,i.start,i.end),t.setSelection(i.start+1,i.end+1)}else if(a===e)t.setCaretOffset(i.start+1);else{if(s===e||l.test(a)||d.test(s)||!c.test(a))return!1;t.setText(e+e,i.start,i.start),t.setCaretOffset(i.start+1)}return!0},contentAssistProposalApplied:function(e){var t=e.data.proposal;if(t.positions&&t.positions.length>0&&this.linkedMode){for(var n=[],i=0;i<t.positions.length;++i)n[i]={positions:[{offset:t.positions[i].offset,length:t.positions[i].length}]};this.linkedMode.enterLinkedMode({groups:n,escapePosition:t.escapePosition})}else if(t.groups&&t.groups.length>0&&this.linkedMode)this.linkedMode.enterLinkedMode({groups:t.groups,escapePosition:t.escapePosition});else if(t.escapePosition){var r=this.editor.getTextView();r.setCaretOffset(t.escapePosition)}return!0},deletePrevious:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n=e.getSelection();if(n.start!==n.end)return!1;var i=e.getModel(),r=e.getCaretOffset(),o=0===r?"":i.getText(n.start-1,n.start),s=r===i.getCharCount()?"":i.getText(n.start,n.start+1);return("("===o&&")"===s||"["===o&&"]"===s||"{"===o&&"}"===s||"<"===o&&">"===s||'"'===o&&'"'===s||"'"===o&&"'"===s)&&e.setText("",n.start,n.start+1),!1},_findEnclosingComment:function(e,t,n){var i,r,o,s,a,l,d,c="/*",h="*/",u=e.getLineAtOffset(t),p=e.getLineAtOffset(n);for(i=u;i>=0&&(r=e.getLine(i),o=i===u?t-e.getLineStart(u):r.length,s=r.lastIndexOf(c,o),a=r.lastIndexOf(h,o),!(a>s));i--)if(-1!==s){l=e.getLineStart(i)+s;break}for(i=p;i<e.getLineCount()&&(r=e.getLine(i),o=i===p?n-e.getLineStart(p):0,s=r.indexOf(c,o),a=r.indexOf(h,o),!(-1!==s&&a>s));i++)if(-1!==a){d=e.getLineStart(i)+a;break}return{commentStart:l,commentEnd:d}},lineStart:function(){var e,t=this.editor,n=t.getModel(),i=t.getCaretOffset(),r=n.getLineAtOffset(i),o=n.getLineStart(r),s=n.getLine(r);for(e=0;e<s.length;e++){var a=s.charCodeAt(e);if(32!==a&&9!==a)break}return e+=o,i!==e?(t.setSelection(e,e),!0):!1},removeBlockComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;var n,i,r,o=e.getModel(),s=e.getSelection(),a="/*",l="*/",d=o.getText(s.start,s.end);for(r=0;r<d.length;r++)if(d.substring(r,r+a.length)===a){n=s.start+r;break}for(;r<d.length;r++)if(d.substring(r,r+l.length)===l){i=s.start+r;break}if(void 0!==n&&void 0!==i)e.setText(o.getText(n+a.length,i),n,i+l.length),e.setSelection(n,i);else{var c=this._findEnclosingComment(o,s.start,s.end);if(void 0===c.commentStart||void 0===c.commentEnd)return!0;var h=o.getText(c.commentStart+a.length,c.commentEnd);e.setText(h,c.commentStart,c.commentEnd+l.length),e.setSelection(s.start-a.length,s.end-l.length)}return!0},toggleLineComment:function(){var e=this.editor,t=e.getTextView();if(t.getOptions("readonly"))return!1;for(var n,i=this.lineComment||"//",r=e.getModel(),o=e.getSelection(),s=r.getLineAtOffset(o.start),a=r.getLineAtOffset(o.end>o.start?o.end-1:o.end),l=!0,d=[],c=s;a>=c;c++){var h=r.getLine(c,!0);if(n=h.indexOf(i),d.push(n),l&&-1!==n){if(0!==n){var u;for(u=0;n>u;u++){var p=h.charCodeAt(u);if(32!==p&&9!==p)break}l=u===n}}else l=!1}var f,g,m,v=i.length,y=r.getLineStart(s);if(t.setRedraw(!1),this.startUndo(),l){for(m=d.length-1;m>=0;m--)n=d[m]+r.getLineStart(s+m),e.setText("",n,n+v);var _=r.getLineStart(a);f=y===o.start?o.start:o.start-v,g=o.end-v*(a-s+1)+(o.end===_+1?v:0)}else{for(m=d.length-1;m>=0;m--)n=r.getLineStart(s+m),e.setText(i,n,n);f=y===o.start?o.start:o.start+v,g=o.end+v*(a-s+1)}return this.endUndo(),t.setRedraw(!0),e.setSelection(f,g),!0},trimTrailingWhitespaces:function(){var e=this.editor,t=e.getModel(),n=e.getSelection();e.getTextView().setRedraw(!1),e.getUndoStack().startCompoundChange();for(var i=/(\s+$)/,r=t.getLineCount(),o=0;r>o;o++){var s=t.getLine(o),a=i.exec(s);if(a){var l=t.getLineStart(o),d=a[0].length,c=l+a.index;t.setText("",c,c+d),n.start>c&&(n.start=Math.max(c,n.start-d)),n.start!==n.end&&n.end>c&&(n.end=Math.max(c,n.end-d))}}e.getUndoStack().endCompoundChange(),e.getTextView().setRedraw(!0),e.setSelection(n.start,n.end,!1)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(e){var t=this.editor,n=t.getTextView();if(n.getOptions("readonly"))return!1;var i=t.getSelection(),r=t.getModel(),o=t.getCaretOffset(),s=o===r.getCharCount()?"":r.getText(i.start,i.start+1);return s===e?(t.setCaretOffset(i.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(e){this.autoPairParentheses=e},setAutoPairBraces:function(e){this.autoPairBraces=e},setAutoPairSquareBrackets:function(e){this.autoPairSquareBrackets=e},setAutoPairAngleBrackets:function(e){this.autoPairAngleBrackets=e},setAutoPairQuotations:function(e){this.autoPairQuotation=e},setAutoCompleteComments:function(e){this.autoCompleteComments=e},setLineComment:function(e){this.lineComment=e},setSmartIndentation:function(e){this.smartIndentation=e}},c.SourceCodeActions=l,String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")}),String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")}),c}),define("orion/editor/rulers",["i18n!orion/editor/nls/messages","orion/editor/annotations","orion/editor/tooltip","orion/util"],function(e,t,n,i){function r(e,t,n,i){this._location=t||"left",this._overview=n||"page",this._rulerStyle=i,this._view=null;var r=this;this._listener={onTextModelChanged:function(e){r._onTextModelChanged(e)},onAnnotationModelChanged:function(e){r._onAnnotationModelChanged(e)}},this.setAnnotationModel(e)}function o(e,t,n,i,o){r.call(this,e,t,"page",n),this._oddStyle=i||{style:{backgroundColor:"white"}},this._evenStyle=o||{style:{backgroundColor:"white"}},this._numOfDigits=0,this._firstLine=1}function s(e,t,n){r.call(this,e,t,"page",n)}function a(e,t,n){r.call(this,e,t,"document",n)}function l(e,t,n){s.call(this,e,t,n)}return r.prototype={getAnnotations:function(e,t){var n=this._annotationModel;if(!n)return[];var i=this._view.getModel(),r=i.getLineStart(e),o=i.getLineEnd(t-1),s=i;i.getBaseModel&&(s=i.getBaseModel(),r=i.mapOffset(r),o=i.mapOffset(o));for(var a=[],l=this.getAnnotationsByType(n,r,o),d=0;d<l.length;d++)for(var c=l[d],h=s.getLineAtOffset(c.start),u=s.getLineAtOffset(Math.max(c.start,c.end-1)),p=h;u>=p;p++){var f=p;if(i!==s){var g=s.getLineStart(p);if(g=i.mapOffset(g,!0),-1===g)continue;f=i.getLineAtOffset(g)}if(f>=e&&t>f){var m=this._mergeAnnotation(a[f],c,p-h,u-h+1);m&&(a[f]=m)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var v in a)a[v]._multiple&&(a[v].html=a[v].html+this._multiAnnotationOverlay.html);return a},getAnnotationModel:function(){return this._annotationModel},getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},getView:function(){return this._view},getWidestAnnotation:function(){return null},setAnnotationModel:function(e){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged),this._annotationModel=e,this._annotationModel&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(e){this._multiAnnotation=e},setMultiAnnotationOverlay:function(e){this._multiAnnotationOverlay=e},setView:function(e){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged),this._view=e,this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)},onClick:function(e){if(void 0!==e){var t=this._view,i=t.getModel(),r=i,o=i.getLineStart(e),s=o,a=o,l=this._annotationModel;if(l){var d=t.getSelection();a=i.getLineEnd(e,!0),o<=d.start&&d.start<a&&(o=d.start),i.getBaseModel&&(o=i.mapOffset(o),a=i.mapOffset(a),r=i.getBaseModel());for(var c,h=l.getAnnotations(o,a),u=null;!c&&h.hasNext();){var p=h.next();this.isAnnotationTypeVisible(p.type)&&(u=p,p.start<=o||(c=p))}u&&void 0!==u.groupId&&(this._currentClickGroup=this._currentClickGroup===u.groupId?null:u.groupId,this._setCurrentGroup(e)),c&&r.getLineAtOffset(c.start)===r.getLineAtOffset(o)?(o=c.start,a=c.end):a=o=s,i.getBaseModel&&(o=i.mapOffset(o,!0),a=i.mapOffset(a,!0))}var f=n.Tooltip.getTooltip(this._view);f&&f.setTarget(null),this._view.setSelection(a,o,1/3,function(){})}},onDblClick:function(){},onMouseMove:function(e,t){var i=n.Tooltip.getTooltip(this._view);if(i&&(!i.isVisible()||this._tooltipLineIndex!==e)){this._tooltipLineIndex=e;var r=this;i.setTarget({y:t.clientY,getTooltipInfo:function(){return r._getTooltipInfo(r._tooltipLineIndex,this.y)}})}},onMouseOver:function(e,t){this.onMouseMove(e,t),this._currentClickGroup||this._setCurrentGroup(e)},onMouseOut:function(){this._currentClickGroup||this._setCurrentGroup(-1);var e=n.Tooltip.getTooltip(this._view);e&&e.setTarget(null)},_getTooltipInfo:function(e,t){if(void 0!==e){var n=this._view,i=n.getModel(),r=this._annotationModel,o=[];if(r){var s=i.getLineStart(e),a=i.getLineEnd(e);i.getBaseModel&&(s=i.mapOffset(s),a=i.mapOffset(a)),o=this.getAnnotationsByType(r,s,a)}var l=this._getTooltipContents(e,o);if(!l)return null;var d={contents:l,anchor:this.getLocation()},c=n.getClientArea();return c.y="document"===this.getOverview()?n.convert({y:t},"view","document").y:n.getLocationAtOffset(i.getLineStart(e)).y,n.convert(c,"document","page"),d.x=c.x,d.y=c.y,"right"===d.anchor&&(d.x+=c.width),d}},_getTooltipContents:function(e,t){return t},_onAnnotationModelChanged:function(e){function t(e){for(var t=0;t<e.length;t++)if(r.isAnnotationTypeVisible(e[t].type)){var o=e[t].start,s=e[t].end;i.getBaseModel&&(o=i.mapOffset(o,!0),s=i.mapOffset(s,!0)),-1!==o&&-1!==s&&n.redrawLines(i.getLineAtOffset(o),i.getLineAtOffset(Math.max(o,s-1))+1,r)}}var n=this._view;if(n){var i=n.getModel(),r=this,o=i.getLineCount();if(e.textModelChangedEvent){var s=e.textModelChangedEvent.start;i.getBaseModel&&(s=i.mapOffset(s,!0));var a=i.getLineAtOffset(s);return void n.redrawLines(a,o,r)}t(e.added),t(e.removed),t(e.changed)}},_mergeAnnotation:function(e,t,n){return e||(e={}),0===n&&(e.html&&t.html?(t.html!==e.html&&!e._multiple&&this._multiAnnotation&&(e.html=this._multiAnnotation.html),e._multiple=!0):e.html=t.html),e.style=this._mergeStyle(e.style,t.style),e},_mergeStyle:function(e,t){if(t){e||(e={}),e.styleClass&&t.styleClass&&e.styleClass!==t.styleClass?e.styleClass+=" "+t.styleClass:e.styleClass=t.styleClass;var n;if(t.style){e.style||(e.style={});for(n in t.style)void 0===e.style[n]&&(e.style[n]=t.style[n])}if(t.attributes){e.attributes||(e.attributes={});for(n in t.attributes)void 0===e.attributes[n]&&(e.attributes[n]=t.attributes[n])}}return e},_setCurrentGroup:function(e){var t,n,i=this._annotationModel,r=null,o=i.getTextModel(),s=this._currentGroupAnnotation;if(-1!==e){var a=o.getLineStart(e),l=o.getLineEnd(e);for(o.getBaseModel&&(a=o.mapOffset(a),l=o.mapOffset(l)),n=i.getAnnotations(a,l);n.hasNext();)if(t=n.next(),this.isAnnotationTypeVisible(t.type)&&t.start<=a&&t.end>=l&&void 0!==t.groupId){r=t;break}if(s&&r&&s.groupId===r.groupId)return}if(this._currentGroupAnnotation=null,s&&i.removeAnnotations(s.groupType),r&&-1!==e){this._currentGroupAnnotation=r,n=i.getAnnotations();for(var d=[];n.hasNext();)t=n.next(),delete t.groupAnnotation,t.groupId===r.groupId&&(t=t.createGroupAnnotation(),d.push(t));i.replaceAnnotations(null,d)}}},t.AnnotationTypeList.addMixin(r.prototype),o.prototype=new r,o.prototype.getAnnotations=function(e,t){for(var n=r.prototype.getAnnotations.call(this,e,t),i=this._view.getModel(),o=e;t>o;o++){var s=1&o?this._oddStyle:this._evenStyle,a=o;if(i.getBaseModel){var l=i.getLineStart(a);a=i.getBaseModel().getLineAtOffset(i.mapOffset(l))}n[o]||(n[o]={}),n[o].html=this._firstLine+a+"",n[o].style||(n[o].style=s)}return n},o.prototype.getWidestAnnotation=function(){var e=this._view.getModel().getLineCount();return this.getAnnotations(e-1,e)[e-1]},o.prototype.setFirstLine=function(e){this._firstLine=void 0!==e?e:1},o.prototype._onTextModelChanged=function(e){var t=e.start,n=this._view.getModel(),i=n.getBaseModel?n.getBaseModel().getLineCount():n.getLineCount(),r=(this._firstLine+i-1+"").length;if(this._numOfDigits!==r){this._numOfDigits=r;var o=n.getLineAtOffset(t);this._view.redrawLines(o,n.getLineCount(),this)}},s.prototype=new r,a.prototype=new r,a.prototype.getRulerStyle=function(){var e={style:{lineHeight:"1px",fontSize:"1px"}};return e=this._mergeStyle(e,this._rulerStyle)},a.prototype._getTooltipContents=function(t,n){if(0===n.length){var o=this._view.getModel(),s=t;if(o.getBaseModel){var a=o.getLineStart(s);s=o.getBaseModel().getLineAtOffset(o.mapOffset(a))}return i.formatMessage(e.line,s+1)}return r.prototype._getTooltipContents.call(this,t,n)},a.prototype._mergeAnnotation=function(e,t,n,i){if(0!==n)return void 0;var r=e;if(!r){var o=3*i;r={html:"&nbsp;",style:{style:{height:o+"px"}}},r.style=this._mergeStyle(r.style,t.overviewStyle)}return r},l.prototype=new s,l.prototype.onClick=function(e){if(void 0!==e){var t=this._annotationModel;if(t){var i=this._view,r=i.getModel(),o=r.getLineStart(e),s=r.getLineEnd(e,!0);r.getBaseModel&&(o=r.mapOffset(o),s=r.mapOffset(s),r=r.getBaseModel());for(var a,l=t.getAnnotations(o,s);!a&&l.hasNext();){var d=l.next();this.isAnnotationTypeVisible(d.type)&&r.getLineAtOffset(d.start)===r.getLineAtOffset(o)&&(a=d)}if(a){var c=n.Tooltip.getTooltip(this._view);c&&c.setTarget(null),a.expanded?a.collapse():a.expand()}}}},l.prototype._getTooltipContents=function(e,t){if(t.length>0){var n=this._view,i=n.getModel(),r=i.getLineStart(e);i.getBaseModel&&(r=i.mapOffset(r),i=i.getBaseModel());for(var o=i.getLineAtOffset(r),a=0;a<t.length;a++){var l=t[a];if(this.isAnnotationTypeVisible(l.type)&&i.getLineAtOffset(l.start)===o){if(t[a].expanded)break;return s.prototype._getTooltipContents.call(this,e,[l])}}}return null},l.prototype._onAnnotationModelChanged=function(e){function t(e){for(i=0;i<e.length;i++)if(o.isAnnotationTypeVisible(e[i].type)){var t=e[i].start;r.getBaseModel&&(t=r.mapOffset(t,!0)),-1!==t&&(l=Math.min(l,r.getLineAtOffset(t)))}}if(e.textModelChangedEvent)return void s.prototype._onAnnotationModelChanged.call(this,e);var n=this._view;if(n){var i,r=n.getModel(),o=this,a=r.getLineCount(),l=a;t(e.added),t(e.removed),t(e.changed);var d=n.getRulers();for(i=0;i<d.length;i++)n.redrawLines(l,a,d[i])}},{Ruler:r,AnnotationRuler:s,LineNumberRuler:o,OverviewRuler:a,FoldingRuler:l}}),define("orion/editor/textDND",["orion/util"],function(e){function t(e,t){this._view=e,this._undoStack=t,this._dragSelection=null,this._dropOffset=-1,this._dropText=null;var n=this;this._listener={onDragStart:function(e){n._onDragStart(e)},onDragEnd:function(e){n._onDragEnd(e)},onDragEnter:function(e){n._onDragEnter(e)},onDragOver:function(e){n._onDragOver(e)},onDrop:function(e){n._onDrop(e)},onDestroy:function(e){n._onDestroy(e)}},e.addEventListener("DragStart",this._listener.onDragStart),e.addEventListener("DragEnd",this._listener.onDragEnd),e.addEventListener("DragEnter",this._listener.onDragEnter),e.addEventListener("DragOver",this._listener.onDragOver),e.addEventListener("Drop",this._listener.onDrop),e.addEventListener("Destroy",this._listener.onDestroy)}return t.prototype={destroy:function(){var e=this._view;e&&(e.removeEventListener("DragStart",this._listener.onDragStart),e.removeEventListener("DragEnd",this._listener.onDragEnd),e.removeEventListener("DragEnter",this._listener.onDragEnter),e.removeEventListener("DragOver",this._listener.onDragOver),e.removeEventListener("Drop",this._listener.onDrop),e.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(){this.destroy()},_onDragStart:function(e){var t=this._view,n=t.getSelection(),i=t.getModel();i.getBaseModel&&(n.start=i.mapOffset(n.start),n.end=i.mapOffset(n.end),i=i.getBaseModel());var r=i.getText(n.start,n.end);r&&(this._dragSelection=n,e.event.dataTransfer.effectAllowed="copyMove",e.event.dataTransfer.setData("Text",r))},_onDragEnd:function(t){if(this._dragSelection){var n=this._view,i=t.event.dataTransfer.dropEffect;e.isFirefox||("none"!==i||this._dropText)&&(i=t.event.dataTransfer.dropEffect=this._dropEffect),this._undoStack&&this._undoStack.startCompoundChange();var r="move"===i;if(r&&n.setText("",this._dragSelection.start,this._dragSelection.end),this._dropText){var o=this._dropText,s=this._dropOffset;r&&(s>=this._dragSelection.end?s-=this._dragSelection.end-this._dragSelection.start:s>=this._dragSelection.start&&(s=this._dragSelection.start)),n.setText(o,s,s),n.setSelection(s,s+o.length),this._dropText=null,this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(e){this._onDragOver(e)},_onDragOver:function(t){var n=t.event.dataTransfer.types,i=!this._view.getOptions("readonly");if(i&&n&&(i=n.contains?n.contains("text/plain")||n.contains("Text"):-1!==n.indexOf("text/plain")||-1!==n.indexOf("Text")),i){if(!e.isFirefox){var r=e.isMac?t.event.altKey:t.event.ctrlKey;this._dropEffect=t.event.dataTransfer.dropEffect=r?"copy":"move"}}else t.event.dataTransfer.dropEffect="none"},_onDrop:function(t){var n=this._view,i=t.event.dataTransfer.getData("Text");if(i){e.isFirefox||(t.event.dataTransfer.dropEffect=this._dropEffect);var r=n.getOffsetAtLocation(t.x,t.y);this._dragSelection?(this._dropOffset=r,this._dropText=i):(n.setText(i,r,r),n.setSelection(r,r+i.length))}}},{TextDND:t}}),define("orion/editor/templates",[],function(){function e(e,t){return t.substring(e.length)}function t(e,t,n,i){this.prefix=e,this.description=t,this.template=n,this.name=i,this._parse()}function n(e,t){this._keywords=e||[],this._templates=[],this.addTemplates(t||[])}var i="${tab}",r="${delimiter}",o="${cursor}";return t.prototype={getProposal:function(e,t,n){var s,a=t-e.length,l={},d=void 0!==n.delimiter?n.delimiter:"\n";n.indentation&&(d+=n.indentation);for(var c=void 0!==n.tab?n.tab:"	",h=0,u=this.variables,p=this.segments,f=[],g=0;g<p.length;g++){var m=p[g],v=u[m];if(void 0!==v)switch(m){case i:m=c;break;case r:m=d;break;case o:m="",s=h;break;default:var y=l[m];y||(y=l[m]={data:v.data,positions:[]}),m=v.substitution,y.data&&y.data.values&&(m=y.data.values[0]),y.positions.push({offset:a+h,length:m.length})}f.push(m),h+=m.length}var _=[];for(var C in l)l.hasOwnProperty(C)&&_.push(l[C]);return f=f.join(""),void 0===s&&(s=f.length),{proposal:f,name:this.name,description:this.description,groups:_,escapePosition:a+s,style:"noemphasis"}},match:function(e){return 0===this.prefix.indexOf(e)},_parse:function(){var e,t=this.template,n=[],o={},s=0;t=t.replace(/\n/g,r),t=t.replace(/\t/g,i),t.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(i,r,a){var l=i.substring(2,i.length-1),d=i,c=l,h=null,u=c.indexOf(":");-1!==u&&(c=c.substring(0,u),d="${"+c+"}",h=JSON.parse(l.substring(u+1).replace("\\}","}").trim()));var p=o[d];return p||(p=o[d]={}),p.substitution=c,h&&(p.data=h),e=t.substring(s,a),e&&n.push(e),n.push(d),s=a+i.length,c}),e=t.substring(s,t.length),e&&n.push(e),this.segments=n,this.variables=o}},n.prototype={addTemplates:function(e){for(var n=this.getTemplates(),i=0;i<e.length;i++)n.push(new t(e[i].prefix,e[i].description,e[i].template,e[i].name))},initialize:function(){},computeProposals:function(e,t,n){var i=this.getPrefix(e,t,n),r=[];return this.isValid(i,e,t,n)&&(r=r.concat(this.getTemplateProposals(i,t,n)),r=r.concat(this.getKeywordProposals(i))),r},getKeywords:function(){return this._keywords},getKeywordProposals:function(t){var n=[],i=this.getKeywords();if(i){for(var r=0;r<i.length;r++)0===i[r].indexOf(t)&&n.push({proposal:e(t,i[r]),description:i[r],style:"noemphasis_keyword"});0<n.length&&n.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return n},getPrefix:function(e,t,n){return n.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(e,t,n){for(var i=[],r=this.getTemplates(),o=0;o<r.length;o++){var s=r[o];if(s.match(e)){var a=s.getProposal(e,t,n);this.removePrefix(e,a),i.push(a)}}return 0<i.length&&(i.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),i.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0})),i},removePrefix:function(t,n){var i=n.overwrite=n.proposal.substring(0,t.length)!==t;i||(n.proposal=e(t,n.proposal))},isValid:function(){return!0}},{Template:t,TemplateContentAssist:n}}),define("orion/editor/linkedMode",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/annotations","orion/editor/templates","orion/objects","orion/util"],function(e,t,n,i,r,o){function s(e,t,i){var r=e.getTextView();n.KeyMode.call(this,r),this.editor=e,this.undoStack=t,this.contentAssist=i,this.linkedModeModel=null,r.setAction("linkedModeEnter",function(){return this.exitLinkedMode(!0),!0}.bind(this)),r.setAction("linkedModeCancel",function(){return this.exitLinkedMode(!1),!0}.bind(this)),r.setAction("linkedModeNextGroup",function(){var e=this.linkedModeModel;return this.selectLinkedGroup((e.selectedGroupIndex+1)%e.groups.length),!0}.bind(this)),r.setAction("linkedModePreviousGroup",function(){var e=this.linkedModeModel;return this.selectLinkedGroup(e.selectedGroupIndex>0?e.selectedGroupIndex-1:e.groups.length-1),!0}.bind(this)),this.linkedModeListener={onActivating:function(){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(e){if(!this.ignoreVerify){for(var t,n,i=this.editor.mapOffset(e.start),r=this.linkedModeModel;r&&(t=this._getPositionChanged(r,i,i+e.removedCharCount),n=t.position,void 0===n||n.model!==r);)this.exitLinkedMode(!1),r=this.linkedModeModel;if(r){for(var o,s,a=0,l=e.addedCharCount-e.removedCharCount,d=t.positions,c=0;c<d.length;++c){s=d[c],o=s.position;var h=o.offset<=i&&i<=o.offset+o.length;h&&!s.ansestor?(o.offset+=a,o.length+=l,a+=l):(o.offset+=a,s.ansestor&&h&&(o.length+=l)),s.escape&&(s.model.escapePosition=o.offset)}this._updateAnnotations(d)}}}.bind(this),onVerify:function(e){if(!this.ignoreVerify){for(var t,n,i=this.editor,r=i.mapOffset(e.start),o=this.editor.mapOffset(e.end),s=this.linkedModeModel;s&&(t=this._getPositionChanged(s,r,o),n=t.position,void 0===n||n.model!==s);)this.exitLinkedMode(!1),s=this.linkedModeModel;if(s){var a=this._compoundChange;a?(a.owner.model!==s||a.owner.group!==n.group)&&(this.endUndo(),this.startUndo()):this.startUndo(),s.selectedGroupIndex=n.group;for(var l,d,c=0,h=e.text.length-(o-r),u=t.positions,p=r-n.position.offset,f=o-n.position.offset,g=0;g<u.length;++g)d=u[g],l=d.position,d.oldOffset=l.offset,d.model===s&&d.group===n.group?(l.offset+=c,l.length+=h,c+=h):(l.offset+=c,d.ansestor&&(l.length+=n.count*h)),d.escape&&(d.model.escapePosition=l.offset);for(this.ignoreVerify=!0,g=u.length-1;g>=0;g--)d=u[g],d.model===s&&d.group===n.group&&i.setText(e.text,d.oldOffset+p,d.oldOffset+f);this.ignoreVerify=!1,e.text=null,this._updateAnnotations(u)}}}.bind(this)}}var a={};return s.prototype=new n.KeyMode,o.mixin(s.prototype,{createKeyBindings:function(){var e=t.KeyBinding,n=[];return n.push({actionID:"linkedModeEnter",keyBinding:new e(13)}),n.push({actionID:"linkedModeCancel",keyBinding:new e(27)}),n.push({actionID:"linkedModeNextGroup",keyBinding:new e(9)}),n.push({actionID:"linkedModePreviousGroup",keyBinding:new e(9,!1,!0)}),n},enterLinkedMode:function(t){if(!this.linkedModeModel){var n=this.editor.getTextView();n.addKeyMode(this),n.addEventListener("Verify",this.linkedModeListener.onVerify),n.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var i=this.contentAssist;i.addEventListener("Activating",this.linkedModeListener.onActivating),this.editor.reportStatus(e.linkedModeEntered,null,!0)}this._sortedPositions=null,this.linkedModeModel&&(t.previousModel=this.linkedModeModel,t.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=t),this.linkedModeModel=t,this.selectLinkedGroup(0)},exitLinkedMode:function(t){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null),this._sortedPositions=null;var n=this.linkedModeModel;if(this.linkedModeModel=n.previousModel,n.parentGroup=n.previousModel=void 0,this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0),!this.linkedModeModel){var i=this.editor,r=i.getTextView();r.removeKeyMode(this),r.removeEventListener("Verify",this.linkedModeListener.onVerify),r.removeEventListener("ModelChanged",this.linkedModeListener.onModelChanged);var o=this.contentAssist;o.removeEventListener("Activating",this.linkedModeListener.onActivating),o.offset=void 0,this.editor.reportStatus(e.linkedModeExited,null,!0),t&&i.setCaretOffset(n.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var e=this,t=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:t,group:t.selectedGroupIndex,end:function(){e._compoundChange=null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()
},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(e){var t=this.linkedModeModel;if(t){t.selectedGroupIndex=e;var n=t.groups[e],i=n.positions[0],o=this.editor;o.setSelection(i.offset,i.offset+i.length);var s=this.contentAssist;if(s)if(s.offset=void 0,n.data&&"link"===n.data.type&&n.data.values){var a=this._groupContentAssistProvider=new r.TemplateContentAssist(n.data.values);a.getPrefix=function(){var e=o.getSelection();if(e.start===e.end){var t=o.getCaretOffset();if(i.offset<=t&&t<=i.offset+i.length)return o.getText(i.offset,t)}return""},s.offset=i.offset,s.deactivate(),s.activate()}else this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,s.deactivate())}this._updateAnnotations()},_getModelPositions:function(e,t,n){for(var i=t.groups,r=0;r<i.length;r++)for(var o=i[r].positions,s=0;s<o.length;s++){var a=o[s];n&&(a={offset:a.offset+n,length:a.length});var l={index:s,group:r,count:o.length,model:t,position:a};e.push(l),t.nextModel&&t.nextModel.parentGroup===r&&(l.ansestor=!0,this._getModelPositions(e,t.nextModel,(n||0)+o[s].offset-o[0].offset))}},_getSortedPositions:function(e){var t=this._sortedPositions;if(!t){for(t=[];e.previousModel;)e=e.previousModel;for(this._getModelPositions(t,e);e;)void 0!==e.escapePosition&&t.push({escape:!0,model:e,position:{offset:e.escapePosition,length:0}}),e=e.nextModel;t.sort(function(e,t){return e.position.offset-t.position.offset}),this._sortedPositions=t}return t},_getPositionChanged:function(e,t,n){for(var i,r=this._getSortedPositions(e),o=r.length-1;o>=0;o--){var s=r[o].position;if(s.offset<=t&&n<=s.offset+s.length){i=r[o];break}}return{position:i,positions:r}},_updateAnnotations:function(e){var t=this.editor.getAnnotationModel();if(t){for(var n,r=[],o=[],s=t.getAnnotations();s.hasNext();)switch(n=s.next(),n.type){case i.AnnotationType.ANNOTATION_LINKED_GROUP:case i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:r.push(n)}var a=this.linkedModeModel;if(a){e=e||this._getSortedPositions(a);for(var l=0;l<e.length;l++){var d=e[l];if(d.model===a){var c=i.AnnotationType.ANNOTATION_LINKED_GROUP;d.group===a.selectedGroupIndex&&(c=0===d.index?i.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:i.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP),d=d.position,n=i.AnnotationType.createAnnotation(c,d.offset,d.offset+d.length,""),o.push(n)}}}t.replaceAnnotations(r,o)}}}),a.LinkedMode=s,a}),define("orion/editor/factories",["orion/editor/actions","orion/editor/undoStack","orion/editor/rulers","orion/editor/annotations","orion/editor/textDND","orion/editor/linkedMode"],function(e,t,n,i,r,o){function s(){}function a(){}function l(){}function d(){}function c(){}function h(){}var u={};return s.prototype={createKeyBindings:function(t,n,i,r){var s=new e.TextActions(t,n,r),a=new o.LinkedMode(t,n,i),l=new e.SourceCodeActions(t,n,i,a);return{textActions:s,linkedMode:a,sourceCodeActions:l}}},u.KeyBindingsFactory=s,a.prototype={createUndoStack:function(e){var n=e.getTextView();return new t.UndoStack(n,200)}},u.UndoFactory=a,l.prototype={createLineNumberRuler:function(e){return new n.LineNumberRuler(e,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}},u.LineNumberRulerFactory=l,d.prototype={createFoldingRuler:function(e){return new n.FoldingRuler(e,"left",{styleClass:"ruler folding"})}},u.FoldingRulerFactory=d,c.prototype={createAnnotationModel:function(e){return new i.AnnotationModel(e)},createAnnotationStyler:function(e,t){return new i.AnnotationStyler(e,t)},createAnnotationRulers:function(e){var t=new n.AnnotationRuler(e,"left",{styleClass:"ruler annotations"}),i=new n.OverviewRuler(e,"right",{styleClass:"ruler overview"});return{annotationRuler:t,overviewRuler:i}}},u.AnnotationFactory=c,h.prototype={createTextDND:function(e,t){return new r.TextDND(e.getTextView(),t)}},u.TextDNDFactory=h,u}),define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(e,t,n,i){return i.mixin({},e,t,n)}),define("orion/editor/contentAssist",["i18n!orion/editor/nls/messages","orion/keyBinding","orion/editor/keyModes","orion/editor/eventTarget","orion/Deferred","orion/objects","orion/editor/util","orion/util","orion/webui/littlelib"],function(e,t,n,i,r,o,s,a,l){function d(n){this.textView=n,this.state=u.INACTIVE,this.clearProviders();var i=this;this._textViewListeners={onModelChanging:function(e){this._latestModelChangingEvent=e,e&&this._updateFilterText(e)}.bind(this),onSelection:function(e){this.isDeactivatingChange(this._latestModelChangingEvent,e)?this.setState(u.INACTIVE):this.isActive()&&(this.state===u.ACTIVE&&this.setState(u.FILTERING),this.filterProposals()),this._latestModelChangingEvent=null}.bind(this),onScroll:function(){this.setState(u.INACTIVE)}.bind(this)},n.setKeyBinding(a.isMac?new t.KeyBinding(" ",!1,!1,!1,!0):new t.KeyBinding(" ",!0),"contentAssist"),n.setKeyBinding(a.isMac?new t.KeyBinding(" ",!1,!1,!0,!0):new t.KeyBinding(" ",!0,!1,!0),"contentAssist"),n.setAction("contentAssist",function(){return n.getOptions("readonly")||i.activate(),!0},{name:e.contentAssist})}function c(e,t){var i=e.textView;n.KeyMode.call(this,i),this.contentAssist=e,this.widget=t,this.proposals=[];var r=this;this.contentAssist.addEventListener("ProposalsComputed",function(e){if(r.proposals=e.data.proposals,0===r.proposals.length)r.selectedIndex=-1,r.cancel();else{for(r.selectedIndex=0;r.proposals[r.selectedIndex]&&r.proposals[r.selectedIndex].unselectable;)r.selectedIndex++;if(r.proposals[r.selectedIndex]){if(r.widget){var t=!0;if(e.autoApply){for(var n=r.selectedIndex+1;r.proposals[n]&&r.proposals[n].unselectable;)n++;r.proposals[n]||(t=!1,r.contentAssist.apply(r.proposals[r.selectedIndex]))}t&&(r.widget.show(),r.widget.selectNode(r.selectedIndex))}}else r.selectedIndex=-1,r.cancel()}}),i.setAction("contentAssistApply",function(){return this.enter()}.bind(this)),i.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this)),i.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this)),i.setAction("contentAssistPreviousProposal",function(){return this.lineUp()}.bind(this)),i.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this)),i.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this)),i.setAction("contentAssistHome",function(){return this.widget&&this.widget.scrollIndex(0,!0),this.lineDown(0)}.bind(this)),i.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this)),i.setAction("contentAssistTab",function(){return this.tab()}.bind(this)),this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function h(e,t){this.contentAssist=e,this.textView=this.contentAssist.getTextView(),this.textViewListenerAdded=!1,this.isShowing=!1;var n=this.textView.getOptions("parent").ownerDocument;if(this.parentNode="string"==typeof t?n.getElementById(t):t,!this.parentNode){this.parentNode=a.createElement(n,"div"),this.parentNode.className="contentassist";var i=n.getElementsByTagName("body")[0];if(!i)throw new Error("parentNode is required");i.appendChild(this.parentNode)}s.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var r=this;this.textViewListener={onMouseDown:function(e){var t=e.event.target||e.event.srcElement;t.parentElement!==r.parentNode&&r.contentAssist.deactivate()}},this.contentAssist.addEventListener("Deactivating",function(){r.hide()}),this.scrollListener=function(){r.isShowing&&r.position()},s.addEventListener(n,"scroll",this.scrollListener)}var u={INACTIVE:1,ACTIVE:2,FILTERING:3},p={selected:"selected",hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};return d.prototype={apply:function(e){if(!e)return!1;var t=this.textView,n=t.getSelection(),i=this._initialCaretOffset,r=i,o=Math.max(n.start,n.end),s=o,a=t.getModel();a.getBaseModel&&(r=a.mapOffset(r),s=a.mapOffset(s),a=a.getBaseModel()),e.overwrite&&(i=this.getPrefixStart(a,r));var l={proposal:e,start:r,end:s};this.setState(u.INACTIVE);var d="string"==typeof e?e:e.proposal;return t.setText(d,i,o),this.dispatchEvent({type:"ProposalApplied",data:l}),!0},activate:function(e,t){this.state===u.INACTIVE&&(this._autoTriggered=t?!0:!1,this.setState(u.ACTIVE,e))},deactivate:function(){this.setState(u.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===u.ACTIVE||this.state===u.FILTERING},isDeactivatingChange:function(e,t){var n=!1,i=t.newValue.start<this._initialCaretOffset;return i||!e?n=!0:e&&(n=e.removedLineCount>0||e.addedLineCount>0),n},setState:function(e,t){var n;e===u.ACTIVE?(n="Activating",this._mode&&this._mode.setActive(!0)):e===u.INACTIVE&&(n="Deactivating",this._mode&&this._mode.setActive(!1)),n&&this.dispatchEvent({type:n,providers:t}),this.state=e,this.onStateChange(e)},setMode:function(e){this._mode=e},onStateChange:function(e){e===u.INACTIVE?(this._removeTextViewListeners(),this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):e===u.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var e=this.textView.getCaretOffset(),t=this.textView.getSelection(),n=Math.min(t.start,t.end);this._initialCaretOffset=Math.min(e,n),this._computedProposals=null,this._computeProposals(this._initialCaretOffset).then(function(e){if(this.isActive()){var t=this._flatten(e);t&&Array.isArray(t)&&0<t.length&&(this._computedProposals=e),this.dispatchEvent({type:"ProposalsComputed",data:{proposals:t},autoApply:!this._autoTriggered}),this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(e,t){for(var n=t;n>0&&/[A-Za-z0-9_]/.test(e.getText(n-1,n));)n--;return n},handleError:function(e){"undefined"!=typeof console&&(console.log("Error retrieving content assist proposals"),console.log(e&&e.stack))},initialize:function(){this._providers.forEach(function(e){var t=e.provider;"function"==typeof t.initialize&&t.initialize()})},_computeProposals:function(e){var t=this._providers,n=this.textView,i=n.getSelection(),s=n.getModel(),a=e;s.getBaseModel&&(a=s.mapOffset(a),i.start=s.mapOffset(i.start),i.end=s.mapOffset(i.end),s=s.getBaseModel());for(var l=s.getLine(s.getLineAtOffset(a)),d=0;d<l.length&&/\s/.test(l.charAt(d));)d++;var c=l.substring(0,d),h=n.getOptions("tabSize","expandTab"),u=h.expandTab?new Array(h.tabSize+1).join(" "):"	",p={line:l,offset:a,prefix:s.getText(this.getPrefixStart(s,a),a),selection:i,delimiter:s.getLineDelimiter(),tab:u,indentation:c},f=this,g=t.map(function(e){var t,n=e.provider;try{var i,l;if(i=n.computeContentAssist){var d=f.editorContextProvider,c=d.getEditorContext();p=o.mixin(p,d.getOptions()),l=i.apply(n,[c,p])}else(i=n.getProposals||n.computeProposals)&&(l=i.apply(n,[s.getText(),a,p]));t=f.progress?f.progress.progress(l,"Generating content assist proposal"):l}catch(h){return(new r).reject(h)}return r.when(t)});return r.all(g,this.handleError)},filterProposals:function(e){if(this._computedProposals&&(this._latestModelChangingEvent||e)){var t=this.textView.getModel();t.getBaseModel&&(t=t.getBaseModel());var n=this.getPrefixStart(t,this._initialCaretOffset),i=this.textView.getText(n,this._initialCaretOffset),r=[];this._computedProposals.forEach(function(e){if(e&&Array.isArray(e)){var t=e.filter(function(e){if(!e)return!1;if(p[e.style]===p.hr||p[e.style]===p.noemphasis_title)return!0;var t="";if(e.overwrite){if(e.name)t=e.name;else{if(!e.proposal)return!1;t=e.proposal}return 0===t.indexOf(i+this._filterText)}if(e.name||e.proposal){var n=!1;return e.name&&(n=0===e.name.indexOf(i+this._filterText)),!n&&e.proposal&&(n=0===e.proposal.indexOf(this._filterText)),n}return"string"==typeof e?0===e.indexOf(this._filterText):!1},this);t.length>0&&r.push(t)}},this);var o=[];r&&(r=this._removeExtraUnselectableElements(r),o=this._flatten(r)),this.dispatchEvent({type:"ProposalsComputed",data:{proposals:o},autoApply:!1})}},_removeExtraUnselectableElements:function(e){var t=e.map(function(e){var t=e.filter(function(t,n){var i=!0;if(p[t.style]===p.hr)0===n||e.length-1===n?i=!1:p.hr===p[e[n-1].style]&&(i=!1);else if(p[t.style]===p.noemphasis_title){var r=e[n+1];r?p[r.style]===p.noemphasis_title&&(i=!1):i=!1}return i});return t});return t},setEditorContextProvider:function(e){this.editorContextProvider=e},_generateProviderId:function(){return this._idcount?this._idcount++:this._idcount=0,"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(e){this._autoTriggerEnabled=e,this._updateAutoTriggerListenerState()},setProviders:function(e){var t=this;this.setProviderInfoArray(e.map(function(e){return e.id?e:{provider:e,id:t._generateProviderId()}}))},setProviderInfoArray:function(e){this.clearProviders(),this._providers=e,this._charTriggersInstalled=e.some(function(e){return e.charTriggers}),this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[],this._charTriggersInstalled=!1,this._updateAutoTriggerListenerState()},setProgress:function(e){this.progress=e},setStyleAccessor:function(e){this._styleAccessor=e},_flatten:function(e){return e.reduce(function(e,t){var n=e,i=null;if(t&&Array.isArray(t)&&(i=t.filter(function(e){return e})),i&&Array.isArray(i)&&i.length>0){var r=i,o=e,s=i[0].style;if(s&&0===p[s].indexOf(p.noemphasis)&&(r=e,o=i),r.length>0){var a=r[r.length-1].style;a&&p.hr!==p[a]&&(r=r.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}))}n=r.concat(o)}return n},[])},_triggerListener:function(){var e=this.textView.getCaretOffset(),t=null,n=[];if(this._charTriggersInstalled){var i=this.textView.getText(e-1,e);this._providers.forEach(function(r){var o=r.charTriggers;if(o&&o.test(i)){var s=!1,a=r.excludedStyles;this._styleAccessor&&a&&(t||(t=this._styleAccessor.getStyles(e-1)),s=t.some(function(e){return a.test(e.style)})),s||n.push(r)}},this),n.length>0&&this.activate(n,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this)),this._triggerListenerInstalled?this._autoTriggerEnabled&&this._charTriggersInstalled||(this.textView.removeEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!1):this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(e){var t=e.removedCharCount;if(t){var n=this._filterText.length-t;this._filterText=this._filterText.substring(0,n)}var i=e.text;i&&(this._filterText=this._filterText.concat(i))}},i.EventTarget.addMixin(d.prototype),c.prototype=new n.KeyMode,o.mixin(c.prototype,{createKeyBindings:function(){var e=t.KeyBinding,n=[];return n.push({actionID:"contentAssistApply",keyBinding:new e(13)}),n.push({actionID:"contentAssistCancel",keyBinding:new e(27)}),n.push({actionID:"contentAssistNextProposal",keyBinding:new e(40)}),n.push({actionID:"contentAssistPreviousProposal",keyBinding:new e(38)}),n.push({actionID:"contentAssistNextPage",keyBinding:new e(34)}),n.push({actionID:"contentAssistPreviousPage",keyBinding:new e(33)}),n.push({actionID:"contentAssistHome",keyBinding:new e(l.KEY.HOME)}),n.push({actionID:"contentAssistEnd",keyBinding:new e(l.KEY.END)}),n.push({actionID:"contentAssistTab",keyBinding:new e(9)}),n},cancel:function(){this.getContentAssist().deactivate()},getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(e){e?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(e,t){return this.selectNew(e,t,!1)},lineDown:function(e,t){return this.selectNew(e,t,!0)},selectNew:function(e,t,n){var i=e;if(n){if(void 0===i&&(i=this.selectedIndex+1),i>=this.proposals.length){if(t)return!0;i=0}}else if(void 0===i&&(i=this.selectedIndex-1),0>i){if(t)return!0;i=this.proposals.length-1}for(var r=i;this.proposals[i]&&this.proposals[i].unselectable;){if(n){if(i++,i>=this.proposals.length){if(t)return!0;i=0}}else if(i--,0>i){if(t)return!0;i=this.proposals.length-1}if(i===r){i=-1;break}}return this.selectedIndex=i,this.widget&&this.widget.selectNode(i),!0},pageUp:function(){if(this.widget){var e=this.widget.getTopIndex();return e===this.selectedIndex&&(this.widget.scrollIndex(e,!1),e=this.widget.getTopIndex()),0===e?this.lineDown(e,!0):this.lineUp(e,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var e=this.widget.getBottomIndex();return e===this.selectedIndex&&(this.widget.scrollIndex(e,!0),e=this.widget.getBottomIndex()),this.lineDown(e,!0)}return this.lineDown()},enter:function(){var e=this.proposals[this.selectedIndex]||null;return this.contentAssist.apply(e)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}}),h.prototype={onClick:function(e){e||(e=window.event),this.contentAssist.apply(this.getProposal(e.target||e.srcElement)),this.textView.focus()},onScroll:function(){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(p.selected)),this.preserveCloneThroughScroll=!1},createDiv:function(e,t,n){var i=t.ownerDocument,r=a.createElement(i,"div");r.id="contentoption"+n,r.setAttribute("role","option"),r.className=p[e.style]?p[e.style]:p.dfault;var o;"hr"===e.style?o=a.createElement(i,"hr"):(o=this._createDisplayNode(r,e,n),r.contentAssistProposalIndex=n),r.appendChild(o),t.appendChild(r)},createAccessible:function(){var e=this._contentAssistMode,t=this;s.addEventListener(this.parentNode,"keydown",function(n){return n||(n=window.event),n.preventDefault&&n.preventDefault(),n.keyCode===l.KEY.ESCAPE?e.cancel():n.keyCode===l.KEY.UP?e.lineUp():n.keyCode===l.KEY.DOWN?e.lineDown():n.keyCode===l.KEY.ENTER?e.enter():n.keyCode===l.KEY.PAGEDOWN?e.pageDown():n.keyCode===l.KEY.PAGEUP?e.pageUp():n.keyCode===l.KEY.HOME?(t.scrollIndex(0,!0),e.lineDown(0)):n.keyCode===l.KEY.END?e.lineUp(e.getProposals().length-1):!1})},_createDisplayNode:function(e,t,n){var i=null,r=null;if("string"==typeof t)r=t;else if(t.description&&"string"==typeof t.description)if(t.name&&"string"==typeof t.name){var o=this._createNameNode(t.name);o.contentAssistProposalIndex=n,i=document.createElement("span"),i.appendChild(o);var s=document.createTextNode(t.description);i.appendChild(s),e.setAttribute("title",t.name+t.description)}else r=t.description;else r=t.proposal;return r&&(i=this._createNameNode(r),e.setAttribute("title",r)),i.contentAssistProposalIndex=n,i},_createNameNode:function(e){var t=document.createElement("span");return t.classList.add("proposal-name"),t.appendChild(document.createTextNode(e)),t},getProposal:function(e){var t=null,n=e.contentAssistProposalIndex;return void 0!==n&&(t=this._contentAssistMode.getProposals()[n]||null),t},getTopIndex:function(){for(var e=this.parentNode.childNodes,t=0;t<e.length;t++){var n=e[t];if(n.offsetTop>=this.parentNode.scrollTop)return t}return 0},getBottomIndex:function(){for(var e=this.parentNode.childNodes,t=0;t<e.length;t++){var n=e[t];if(n.offsetTop+n.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,t-1)}return e.length-1},scrollIndex:function(e,t){this.parentNode.childNodes[e].scrollIntoView(t),this.preserveCloneThroughScroll=!0},selectNode:function(e){var t=null;if(this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(p.selected),this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode()),-1!==e){t=this.parentNode.childNodes[e],t.classList.add(p.selected),this.parentNode.setAttribute("aria-activedescendant",t.id),t.focus(),t.offsetTop<this.parentNode.scrollTop?(t.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):t.offsetTop+t.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(t.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var n=t.firstChild||t,i=l.bounds(n),r=l.bounds(this.parentNode),o=window.getComputedStyle(this.parentNode),s=window.getComputedStyle(t),a=parseInt(o.paddingLeft)+parseInt(o.paddingRight)+parseInt(s.paddingLeft)+parseInt(s.paddingRight);if(i.width>=r.width-a){var d=parseInt(o.top),c=t.cloneNode(!0);c.classList.add("cloneProposal"),c.style.top=d+t.offsetTop-this.parentNode.scrollTop+"px",c.style.left=o.left,c.setAttribute("id",c.id+"_clone");var h=document.documentElement.clientWidth,u=i.left+i.width-parseInt(h);if(u>0){var f=parseInt(o.left)-u;0>f&&(f=0),c.style.left=f+"px"}var g=document.createElement("div");g.id="clone_contentassist",g.classList.add("contentassist"),g.classList.add("cloneWrapper"),g.appendChild(c),g.onclick=this.parentNode.onclick,this.parentNode.parentNode.insertBefore(g,this.parentNode);var m=function(e){if(e.contentAssistProposalIndex=t.contentAssistProposalIndex,e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++)m(e.childNodes[n])};m(g),t.classList.remove(p.selected),this.previousCloneNode=g}}this.previousSelectedNode=t},setContentAssistMode:function(e){this._contentAssistMode=e},show:function(){var e=this._contentAssistMode.getProposals();if(0===e.length)this.hide();else{this.parentNode.innerHTML="";for(var t=0;t<e.length;t++)this.createDiv(e[t],this.parentNode,t);this.position(),this.parentNode.onclick=this.onClick.bind(this),this.isShowing=!0,this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus(),this.parentNode.style.display="none",this.parentNode.onclick=null,this.isShowing=!1,this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1),this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var e,t=this.contentAssist,n=this.textView;if(void 0!==t.offset){e=t.offset;var i=n.getModel();i.getBaseModel&&(e=i.mapOffset(e,!0))}else e=this.textView.getCaretOffset();var r=n.getLocationAtOffset(e);r.y+=n.getLineHeight(),this.textView.convert(r,"document","page"),this.parentNode.style.position="fixed",this.parentNode.style.left=r.x+"px",this.parentNode.style.top=r.y+"px",this.parentNode.style.display="block",this.parentNode.scrollTop=0;var o=this.parentNode.ownerDocument,s=o.documentElement.clientWidth,a=o.documentElement.clientHeight;r.y+this.parentNode.offsetHeight>a&&(this.parentNode.style.top=r.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px"),r.x+this.parentNode.offsetWidth>s&&(this.parentNode.style.left=s-this.parentNode.offsetWidth+"px")},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode),this.previousCloneNode=null}},{ContentAssist:d,ContentAssistMode:c,ContentAssistWidget:h}}),define("orion/editor/emacs",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(e,t,n,i){function r(e){t.KeyMode.call(this,e)}return r.prototype=new t.KeyMode,r.prototype.createKeyBindings=function(){var e=[];e.push({actionID:"emacs-beginning-of-line",keyBinding:this._createStroke("a",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-end-of-line",keyBinding:this._createStroke("e",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-forward-char",keyBinding:this._createStroke("f",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-backward-char",keyBinding:this._createStroke("b",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-forward-word",keyBinding:this._createStroke("f",!1,!1,!0)}),e.push({actionID:"emacs-backward-word",keyBinding:this._createStroke("b",!1,!1,!0)}),e.push({actionID:"emacs-next-line",keyBinding:this._createStroke("n",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-previous-line",keyBinding:this._createStroke("p",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-beginning-of-buffer",keyBinding:this._createStroke(188,!1,!0,!0)}),e.push({actionID:"emacs-end-of-buffer",keyBinding:this._createStroke(190,!1,!0,!0)}),e.push({actionID:"emacs-delete-backward-char",keyBinding:this._createStroke(46,!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-delete-char",keyBinding:this._createStroke("d",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-kill-line",keyBinding:this._createStroke("k",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-kill-word",keyBinding:this._createStroke("d",!1,!1,!0)}),e.push({actionID:"emacs-backward-kill-word",keyBinding:this._createStroke(46,!1,!1,!0)}),e.push({actionID:"undo",keyBinding:this._createSequence([this._createStroke("x",!0),this._createStroke("u")])}),e.push({actionID:"redo",keyBinding:this._createSequence([this._createStroke("x",!0),this._createStroke("r")])}),e.push({actionID:"emacs-scroll-up",keyBinding:this._createStroke("v",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-scroll-down",keyBinding:this._createStroke("v",!1,!1,!0)}),e.push({actionID:"emacs-set-mark-command",keyBinding:this._createStroke(" ",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-reset-mark-command",keyBinding:this._createStroke("g",!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-exchange-point-and-mark",keyBinding:this._createSequence([this._createStroke("x",!i.isMac,!1,!1,i.isMac),this._createStroke("x",!i.isMac,!1,!1,i.isMac)])});for(var t=0;9>=t;t++)e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!1,!1,!0)}),e.push({actionID:"emacs-digit-argument-"+t,keyBinding:this._createStroke(48+t,!i.isMac,!1,!0,i.isMac)});return e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!i.isMac,!1,!1,i.isMac)}),e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!1,!1,!0)}),e.push({actionID:"emacs-negative-argument",keyBinding:this._createStroke(189,!i.isMac,!1,!0,i.isMac)}),e.push({actionID:"emacs-uppercase",keyBinding:this._createStroke("u",!1,!1,!0)}),e.push({actionID:"emacs-lowercase",keyBinding:this._createStroke("l",!1,!1,!0)}),e.push({actionID:"emacs-capitalize",keyBinding:this._createStroke("c",!1,!1,!0)}),e.push({actionID:"contentAssist",keyBinding:this._createStroke(191,!1,!1,!0)}),e.push({actionID:"find",keyBinding:this._createStroke("r",!1,!1,!0)}),e.push({actionID:"incrementalFind",keyBinding:this._createStroke("s",!0)}),e.push({actionID:"incrementalFindReverse",keyBinding:this._createStroke("r",!0)}),e.push({actionID:"save",keyBinding:this._createSequence([this._createStroke("x",!i.isMac,!1,!1,i.isMac),this._createStroke("s",!i.isMac,!1,!1,i.isMac)])}),this._createActions(this.getView()),e},r.prototype._createStroke=function(t,i,r,o,s){var a=new n.KeyStroke(t,i,r,o,s);return a.scopeName=e.emacs,a},r.prototype._createSequence=function(t){var i=new n.KeySequence(t);return i.scopeName=e.emacs,i},r.prototype._getData=function(){var e={count:(this._argument||1)*(this._sign||1)};return this._argument=0,this._sign=1,e},r.prototype._moveCursor=function(e){var t=this._getData();this._marker&&(t.select=!0);var n=this.getView();return n.invokeAction(e,!1,t)},r.prototype._digitArgument=function(e){return this._argument=10*(this._argument||0)+e,!0},r.prototype._negativeArgument=function(){return this._sign=-1*(this._sign||1),!0},r.prototype._createActions=function(t){var n=this;t.setAction("emacs-beginning-of-line",function(){return n._moveCursor("lineStart")},{name:e.lineStart}),t.setAction("emacs-end-of-line",function(){return n._moveCursor("lineEnd")},{name:e.lineEnd}),t.setAction("emacs-forward-char",function(){return n._moveCursor("charNext")},{name:e.charNext}),t.setAction("emacs-backward-char",function(){return n._moveCursor("charPrevious")},{name:e.charPrevious}),t.setAction("emacs-forward-word",function(){return n._moveCursor("wordNext")},{name:e.wordNext}),t.setAction("emacs-backward-word",function(){return n._moveCursor("wordPrevious")},{name:e.wordPrevious}),t.setAction("emacs-next-line",function(){return n._moveCursor("lineDown")},{name:e.lineDown}),t.setAction("emacs-previous-line",function(){return n._moveCursor("lineUp")},{name:e.lineUp}),t.setAction("emacs-beginning-of-buffer",function(){return n._moveCursor("textStart")},{name:e.textStart}),t.setAction("emacs-end-of-buffer",function(){return n._moveCursor("textEnd")},{name:e.textEnd}),t.setAction("emacs-delete-backward-char",function(){return t.invokeAction("deletePrevious")},{name:e.deletePrevious}),t.setAction("emacs-delete-char",function(){return t.invokeAction("deletePrevious")},{name:e.deletePrevious}),t.setAction("emacs-kill-line",function(){return t.invokeAction("deleteLineEnd")},{name:e.deleteLineEnd}),t.setAction("emacs-kill-word",function(){return t.invokeAction("deleteWordNext")},{name:e.deleteWordNext}),t.setAction("emacs-backward-kill-word",function(){return t.invokeAction("deleteWordPrevious")},{name:e.deleteWordPrevious}),t.setAction("emacs-scroll-up",function(){return n._moveCursor("pageDown")},{name:e.pageDown}),t.setAction("emacs-scroll-down",function(){return n._moveCursor("pageUp")},{name:e.pageUp}),t.setAction("emacs-set-mark-command",function(){var e=t.getCaretOffset();return t.setCaretOffset(e),n._marker=e,!0},{name:e.setMarkCommand}),t.setAction("emacs-exchange-point-and-mark",function(){if(void 0!==n._marker){var e=t.getCaretOffset(),i=t.getSelection();if(i.end===e){var r=i.start;i.start=i.end,i.end=r}n._marker=e,t.setSelection(i.start,i.end)}return!0},{name:e.exchangeMarkPoint}),t.setAction("emacs-reset-mark-command",function(){var e=t.getCaretOffset();return t.setCaretOffset(e),n._marker=void 0,!0},{name:e.clearMark}),t.setAction("emacs-digit-argument-0",function(){return n._digitArgument(0)},{name:i.formatMessage(e.digitArgument,"0")}),t.setAction("emacs-digit-argument-1",function(){return n._digitArgument(1)},{name:i.formatMessage(e.digitArgument,"1")}),t.setAction("emacs-digit-argument-2",function(){return n._digitArgument(2)},{name:i.formatMessage(e.digitArgument,"2")}),t.setAction("emacs-digit-argument-3",function(){return n._digitArgument(3)},{name:i.formatMessage(e.digitArgument,"3")}),t.setAction("emacs-digit-argument-4",function(){return n._digitArgument(4)},{name:i.formatMessage(e.digitArgument,"4")}),t.setAction("emacs-digit-argument-5",function(){return n._digitArgument(5)},{name:i.formatMessage(e.digitArgument,"5")}),t.setAction("emacs-digit-argument-6",function(){return n._digitArgument(6)},{name:i.formatMessage(e.digitArgument,"6")}),t.setAction("emacs-digit-argument-7",function(){return n._digitArgument(7)},{name:i.formatMessage(e.digitArgument,"7")}),t.setAction("emacs-digit-argument-8",function(){return n._digitArgument(8)},{name:i.formatMessage(e.digitArgument,"8")}),t.setAction("emacs-digit-argument-9",function(){return n._digitArgument(9)
},{name:i.formatMessage(e.digitArgument,"9")}),t.setAction("emacs-negative-argument",function(){return n._negativeArgument()},{name:e.negativeArgument}),t.setAction("emacs-uppercase",function(){var e=n._getData();return e.unit="word",t.invokeAction("uppercase",!1,e)},{name:e.uppercase}),t.setAction("emacs-lowercase",function(){var e=n._getData();return e.unit="word",t.invokeAction("lowercase",!1,e)},{name:e.lowercase}),t.setAction("emacs-capitalize",function(){var e=n._getData();return e.unit="word",t.invokeAction("capitalize",!1,e)},{name:e.capitalize})},{EmacsMode:r}}),define("orion/editor/vi",["i18n!orion/editor/nls/messages","orion/editor/keyModes","orion/keyBinding","orion/util"],function(e,t,n,i){function r(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function o(t,i,r,o,s,a,l){var d=new n.KeyStroke(t,i,r,o,s,a);return d.scopeName=l||e.vi,d}function s(t,i){var r=new n.KeySequence(t);return r.scopeName=i||e.vi,r}function a(e,n,i){this.key=n,this.msg=i,this.number="",t.KeyMode.call(this,e),e&&this._createActions(e)}function l(e){var n=e.getView();this.viMode=e,t.KeyMode.call(this,n),this._createActions(n)}function d(e,t,n,i){this.viMode=e,this.nextMode=t,a.call(this,e.getView(),n,i)}function c(e){var n=e.getView();t.KeyMode.call(this,n),this.viMode=e,this._createActions(n)}function h(t,n){a.call(this,t,"",e.vimove),this.insertMode=new c(this),this.changeMode=new d(this,this.insertMode,"c",e.vichange),this.deleteMode=new d(this,this,"d",e.videlete),this.yankMode=new d(this,this,"y",e.viyank),this.statusReporter=n}var u,p;return a.prototype=new t.KeyMode,r(a.prototype,{_msg:function(t){return{name:i.formatMessage(e[t],this.msg)}},createKeyBindings:function(){var e=[],t=this.key;t=t?"-"+t+"-":"-";for(var n=0;9>=n;n++)e.push({actionID:"vi"+t+n,keyBinding:o(n+"",!1,!1,!1,!1,"keypress"),predefined:!0});return e.push({actionID:"vi"+t+"Left",keyBinding:o("h",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Left",keyBinding:o("h",!0,!1,!1,!1)}),e.push({actionID:"vi"+t+"Left",keyBinding:o(8)}),e.push({actionID:"vi"+t+"Left",keyBinding:o(37)}),e.push({actionID:"vi"+t+"Down",keyBinding:o("j",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Down",keyBinding:o(40)}),e.push({actionID:"vi"+t+"Up",keyBinding:o("k",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Up",keyBinding:o(38)}),e.push({actionID:"vi"+t+"Right",keyBinding:o("l",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"Right",keyBinding:o(39)}),e.push({actionID:"vi"+t+"Right",keyBinding:o(32)}),e.push({actionID:"vi"+t+"w",keyBinding:o("w",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"b",keyBinding:o("b",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"W",keyBinding:o("W",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"B",keyBinding:o("B",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"e",keyBinding:o("e",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"E",keyBinding:o("E",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"$",keyBinding:o("$",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"^_",keyBinding:o("^",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"^_",keyBinding:o("_",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"+",keyBinding:o("+",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"+",keyBinding:o(13)}),e.push({actionID:"vi"+t+"-",keyBinding:o("-",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"|",keyBinding:o("|",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"H",keyBinding:o("H",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"M",keyBinding:o("M",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"L",keyBinding:o("L",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"/",keyBinding:o("/",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"?",keyBinding:o("?",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"n",keyBinding:o("n",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"N",keyBinding:o("N",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"f",keyBinding:o("f",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"F",keyBinding:o("F",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"t",keyBinding:o("t",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"T",keyBinding:o("T",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+",",keyBinding:o(",",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+";",keyBinding:o(";",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi"+t+"G",keyBinding:o("G",!1,!1,!1,!1,"keypress")}),e},_createActions:function(e){function t(t){for(var n=e.getModel(),i=n.getLine(t),r=0,o=i.charCodeAt(r);32===o||9===o;)r++,o=i.charCodeAt(r);return r}function n(e,t){e&&r.getView().setCaretOffset(e.start),t.editDone&&t.editDone()}var i=this.key;i=i?"-"+i+"-":"-";var r=this;e.setAction("vi"+i+"0",function(){return r._storeNumber(0)}),e.setAction("vi"+i+"1",function(){return r._storeNumber(1)}),e.setAction("vi"+i+"2",function(){return r._storeNumber(2)}),e.setAction("vi"+i+"3",function(){return r._storeNumber(3)}),e.setAction("vi"+i+"4",function(){return r._storeNumber(4)}),e.setAction("vi"+i+"5",function(){return r._storeNumber(5)}),e.setAction("vi"+i+"6",function(){return r._storeNumber(6)}),e.setAction("vi"+i+"7",function(){return r._storeNumber(7)}),e.setAction("vi"+i+"8",function(){return r._storeNumber(8)}),e.setAction("vi"+i+"9",function(){return r._storeNumber(9)}),e.setAction("vi"+i+"Left",function(){return r._invoke("charPrevious",{unit:"character"})},this._msg("viLeft")),e.setAction("vi"+i+"Right",function(){return r._invoke("charNext",{unit:"character"})},this._msg("viRight")),e.setAction("vi"+i+"Up",function(){return r._invoke("lineUp",{editLine:!0})},this._msg("viUp")),e.setAction("vi"+i+"Down",function(){return r._invoke("lineDown",{editLine:!0})},this._msg("viDown")),e.setAction("vi"+i+"w",function(){return r._invoke("wordNext",{unit:"word"})},this._msg("viw")),e.setAction("vi"+i+"b",function(){return r._invoke("wordPrevious",{unit:"word"})},this._msg("vib")),e.setAction("vi"+i+"W",function(){return r._invoke("wordNext",{unit:"wordWS"})},this._msg("viW")),e.setAction("vi"+i+"B",function(){return r._invoke("wordPrevious",{unit:"wordWS"})},this._msg("viB")),e.setAction("vi"+i+"e",function(){return r._invoke("charNext",{unit:"character"}),r._invoke("wordNext",{unit:"wordend"}),r._invoke("charPrevious",{unit:"character"}),!0},this._msg("vie")),e.setAction("vi"+i+"E",function(){return r._invoke("wordNext",{unit:"wordendWS"})},this._msg("viE")),e.setAction("vi"+i+"$",function(){return r._invoke("lineEnd")},this._msg("vi$")),e.setAction("vi"+i+"^_",function(){return r._invoke(function(){var n=e.getModel(),i=e.getCaretOffset(),r=n.getLineAtOffset(i);e.setCaretOffset(n.getLineStart(r)+t(r))})},this._msg("vi^_")),e.setAction("vi"+i+"+",function(){return r._invoke(function(n){var i=e.getModel(),r=e.getCaretOffset(),o=i.getLineCount()-1,s=Math.min(i.getLineAtOffset(r)+n.count,o);e.setCaretOffset(i.getLineStart(s)+t(s))},{editLine:!0})},this._msg("vi+")),e.setAction("vi"+i+"-",function(){return r._invoke(function(n){var i=e.getModel(),r=e.getCaretOffset(),o=Math.max(i.getLineAtOffset(r)-n.count,0);e.setCaretOffset(i.getLineStart(o)+t(o))},{editLine:!0})},this._msg("vi-")),e.setAction("vi"+i+"|",function(){return r._invoke(function(t){var n=e.getModel(),i=e.getCaretOffset(),r=n.getLineAtOffset(i);e.setCaretOffset(Math.min(n.getLineStart(r)+t.count-1,n.getLineEnd(r)))})},this._msg("vi|")),e.setAction("vi"+i+"H",function(){return r._invoke(function(t){var n=e.getModel().getLineStart(e.getTopIndex(!0)+(t.count-1));e.setCaretOffset(n)},{editLine:!0})},this._msg("viH")),e.setAction("vi"+i+"M",function(){return r._invoke(function(){var t=Math.ceil((e.getBottomIndex(!0)-e.getTopIndex(!0))/2)+e.getTopIndex(!0);e.setCaretOffset(e.getModel().getLineStart(t))},{editLine:!0})},this._msg("viM")),e.setAction("vi"+i+"L",function(){return r._invoke(function(t){e.setCaretOffset(e.getModel().getLineStart(e.getBottomIndex(!0)-(t.count-1)))},{editLine:!0})},this._msg("viL")),e.setAction("vi"+i+"/",function(){var e={hideAfterFind:!0,incremental:!1,reverse:!1,findCallback:function(t){r._searchFwd=!0,n(t,e)}};return r._invoke("find",e)},this._msg("vi/")),e.setAction("vi"+i+"?",function(){var e={hideAfterFind:!0,incremental:!1,reverse:!0,findCallback:function(t){r._searchFwd=!1,n(t,e)}};return r._invoke("find",e)},this._msg("vi?")),e.setAction("vi"+i+"n",function(){var t,i=e.getCaretOffset();r._searchFwd?(t="findNext",i++):t="findPrevious";var o={start:i,findCallback:function(e){n(e,o)}};return r._invoke(t,o)},this._msg("vin")),e.setAction("vi"+i+"N",function(){var t,i=e.getCaretOffset();r._searchFwd?t="findPrevious":(t="findNext",i++);var o={start:i,findCallback:function(e){n(e,o)}};return r._invoke(t,o)},this._msg("viN")),e.setAction("vi"+i+"f",function(){var t=e.getModel(),n=e.getCaretOffset();return r._findChar(n,t.getLineEnd(t.getLineAtOffset(n)),!1,0)},this._msg("vif")),e.setAction("vi"+i+"F",function(){var t=e.getModel(),n=e.getCaretOffset();return r._findChar(t.getLineStart(t.getLineAtOffset(n)),n,!0,0)},this._msg("viF")),e.setAction("vi"+i+"t",function(){var t=e.getModel(),n=e.getCaretOffset();return r._findChar(n,t.getLineEnd(t.getLineAtOffset(n)),!1,-1)},this._msg("vit")),e.setAction("vi"+i+"T",function(){var t=e.getModel(),n=e.getCaretOffset();return r._findChar(t.getLineStart(t.getLineAtOffset(n)),n,!0,1)},this._msg("viT")),e.setAction("vi"+i+",",function(){return r._findNextChar(r._charTempOptions.reverse)},this._msg("vi,")),e.setAction("vi"+i+";",function(){return r._findNextChar(!r._charTempOptions.reverse)},this._msg("vi;")),e.setAction("vi"+i+"G",function(){if(""===r.number){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),r.number=t.getLineCount()}return r._invoke(function(t){t=t||{},t.line=t.count,t.editLine=!0,t.callback=function(){t.editDone&&t.editDone()},e.invokeAction("gotoLine",!1,t)})},this._msg("viG"))},_invoke:function(e,t){var n=this.getView();return t=t||{},t.count=this._getCount(),"function"==typeof e?e(t):n.invokeAction(e,!1,t),!0},_getCount:function(){var e=1;return""!==this.number&&(e=this.number>>0),this.number="",e},_findChar:function(e,t,n,i){this._charTempOptions={},this._charTempOptions.start=e,this._charTempOptions.end=t,this._charTempOptions.hideAfterFind=!0,this._charTempOptions.incremental=!1,this._charTempOptions.reverse=n,this._charTempOptions.offset=i;var r=this._charTempOptions,o=this;return this._charTempOptions.findCallback=function(e){e&&o.getView().setCaretOffset(e.start+i),r.editDone&&r.editDone()},this._invoke("find",this._charTempOptions)},_findNextChar:function(e){if(this._charTempOptions){var t=this.getView(),n={};n.hideAfterFind=this._charTempOptions.hideAfterFind,n.incremental=this._charTempOptions.incremental,n.reverse=this._charTempOptions.reverse,n.wrap=!1;var i=n,r=this;n.findCallback=function(e){e&&r.getView().setCaretOffset(e.start+r._charTempOptions.offset),i.editDone&&i.editDone()};var o=t.getModel();return e?(n.start=t.getCaretOffset()+1-this._charTempOptions.offset,n.end=o.getLineEnd(o.getLineAtOffset(n.start)),n.reverse=!1,this._invoke("findNext",n)):(n.start=t.getCaretOffset()-this._charTempOptions.offset,n.end=o.getLineStart(o.getLineAtOffset(n.start)),n.reverse=!0,this._invoke("findPrevious",n))}return!0},_storeNumber:function(e){var t=this;return 0!==e||this.number?(this.number+=e,!0):this._invoke(function(){t.getView().invokeAction("lineStart",!0)})}}),l.prototype=new t.KeyMode,r(l.prototype,{createKeyBindings:function(){var e=[];return e.push({actionID:"vi-:-ESC",keyBinding:o(27),predefined:!0}),e},_createActions:function(e){var t=this;e.setAction("vi-:-ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0})},match:function(e){var n=t.KeyMode.prototype.match.call(this,e);return n||(n=this.getView().getKeyModes()[0].match(e)),n},storeNumber:function(e){this.number=e}}),d.prototype=new a,r(d.prototype,{createKeyBindings:function(){var e=a.prototype.createKeyBindings.call(this);return e.push({actionID:"vi-"+this.key+"ESC",keyBinding:o(27),predefined:!0}),e.push({actionID:"vi-"+this.key+"-"+this.key,keyBinding:o(this.key,!1,!1,!1,!1,"keypress")}),e},_invoke:function(e,t){t=t||{};var n=this.getView(),i=n.getCaretOffset(),r=i,o=n.getModel(),s=this;return t.editDone=function(){var e=n.getCaretOffset();if(r>e){var a=r;r=e,e=a}t.editLine&&(r=o.getLineStart(o.getLineAtOffset(r)),e=o.getLineEnd(o.getLineAtOffset(e),"c"===s.key?!1:!0)),"y"===s.key?(u=n.getText(r,e),p=t.editLine,n.setCaretOffset(i)):n.setText("",r,e),n.removeKeyMode(s),n.addKeyMode(s.nextMode)},a.prototype._invoke.call(this,e,t),t.editDone(),!0},_getCount:function(){var e=1;""!==this.firstNumber&&(e=this.firstNumber>>0);var t=1;return""!==this.number&&(t=this.number>>0),e*=t,this.number=this.firstNumber="",e},_createActions:function(e){a.prototype._createActions.call(this,e);var t=this;e.setAction("vi-"+t.key+"ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0}),e.setAction("vi-"+t.key+"-"+t.key,function(){return t._invoke("lineEnd",{editLine:!0})},this._msg("viycd"))},storeNumber:function(e){this.firstNumber=e},_modeAdded:function(){this.secondNumber=""},_modeRemoved:function(){this.command="",this.firstNumber="",this.number=""}}),c.prototype=new t.KeyMode,r(c.prototype,{createKeyBindings:function(){var e=[];return e.push({actionID:"vi-insert-ESC",keyBinding:o(27),predefined:!0}),e},_createActions:function(e){var t=this;e.setAction("vi-insert-ESC",function(){return e.removeKeyMode(t),e.addKeyMode(t.viMode),!0})},match:function(e){var n=t.KeyMode.prototype.match.call(this,e);return n||(n=this.getView().getKeyModes()[0].match(e)),n},storeNumber:function(){}}),h.prototype=new a,r(h.prototype,{createKeyBindings:function(){var e=a.prototype.createKeyBindings.call(this);return e.push({actionID:"vi-ctrl-f",keyBinding:o("f",!0)}),e.push({actionID:"vi-ctrl-b",keyBinding:o("b",!0)}),e.push({actionID:"vi-ctrl-e",keyBinding:o("e",!0)}),e.push({actionID:"vi-ctrl-y",keyBinding:o("y",!0)}),e.push({actionID:"statusLineMode",keyBinding:o(":",!1,!1,!1,!1,"keypress")}),e.push({actionID:"vi-a",keyBinding:o("a",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-A",keyBinding:o("A",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-i",keyBinding:o("i",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-I",keyBinding:o("I",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-o",keyBinding:o("o",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-O",keyBinding:o("O",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-R",keyBinding:o("R",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-s",keyBinding:o("s",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-S",keyBinding:o("S",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-p",keyBinding:o("p",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-P",keyBinding:o("P",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-u",keyBinding:o("u",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-c",keyBinding:o("c",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-d",keyBinding:o("d",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-y",keyBinding:o("y",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-~",keyBinding:o("~",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-x",keyBinding:o("x",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-X",keyBinding:o("X",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-C",keyBinding:o("C",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-D",keyBinding:o("D",!1,!1,!1,!1,"keypress"),predefined:!0}),e.push({actionID:"vi-*",keyBinding:o("*",!1,!1,!1,!1,"keypress"),predefined:!0}),e},getKeyBindings:function(e){var n=t.KeyMode.prototype.getKeyBindings.call(this,e);n=n||[];var i,r=this.changeMode.getKeyBindings(e);if(!this.changeMode.isActive())for(i=0;i<r.length;i++)r[i]=s([o("c",!1,!1,!1,!1,"keypress"),r[i]]);if(n=n.concat(r),r=this.deleteMode.getKeyBindings(e),!this.deleteMode.isActive())for(i=0;i<r.length;i++)r[i]=s([o("d",!1,!1,!1,!1,"keypress"),r[i]]);if(n=n.concat(r),r=this.yankMode.getKeyBindings(e),!this.yankMode.isActive())for(i=0;i<r.length;i++)r[i]=s([o("y",!1,!1,!1,!1,"keypress"),r[i]]);return n=n.concat(r)},match:function(e){var n=t.KeyMode.prototype.match.call(this,e);return n||"keypress"!==e.type||(n="noop"),n},_createActions:function(t){a.prototype._createActions.call(this,t);var n=this;t.setAction("vi-ctrl-f",function(){return n._invoke("pageDown")},{name:e.pageDown}),t.setAction("vi-ctrl-b",function(){return n._invoke("pageUp")},{name:e.pageUp}),t.setAction("vi-ctrl-e",function(){return n._invoke("scrollLineDown")},{name:e.scrollLineDown}),t.setAction("vi-ctrl-y",function(){return n._invoke("scrollLineUp")},{name:e.scrollLineUp}),t.setAction("vi-a",function(){return n._toInsertMode("charNext")},{name:e.via}),t.setAction("vi-A",function(){return n._toInsertMode("lineEnd")},{name:e.viA}),t.setAction("vi-i",function(){return n._toInsertMode("noop")},{name:e.vii}),t.setAction("vi-I",function(){return n._toInsertMode("lineStart")},{name:e.viI}),t.setAction("vi-O",function(){return n._invoke("lineUp"),n._invoke("lineEnd"),n._toInsertMode("enter"),!0},{name:e.viO}),t.setAction("vi-o",function(){return n._invoke("lineEnd"),n._toInsertMode("enter"),!0},{name:e.vio}),t.setAction("vi-R",function(){return n._toInsertMode("toggleOverwriteMode")},{name:e.viR}),t.setAction("vi-s",function(){return n._toInsertMode("deleteNext",{unit:"char"})},{name:e.vis}),t.setAction("vi-S",function(){return n._toInsertMode("deleteLines",{unit:"line"})},{name:e.viS}),t.setAction("vi-p",function(){return n._invoke(function(){var e=n.getView(),t=e.getSelection();if(t.start===t.end){var i=e.getModel(),r=e.getCaretOffset();p?t.start=t.end=i.getLineEnd(i.getLineAtOffset(r),!0):(t.start++,t.end++)}e.setText(u,t.start,t.end)})},{name:e.vip}),t.setAction("vi-P",function(){return n._invoke(function(){var e=n.getView(),t=e.getSelection();if(t.start===t.end){var i=e.getModel(),r=e.getCaretOffset();p&&(t.start=t.end=i.getLineStart(i.getLineAtOffset(r)))}e.setText(u,t.start,t.end)})},{name:e.viP}),t.setAction("vi-u",function(){return n._invoke("undo")},{name:e.Undo}),t.setAction("vi-c",function(){return t.removeKeyMode(n),t.addKeyMode(n.changeMode),n.changeMode.storeNumber(n.number),n.number="",!0}),t.setAction("vi-d",function(){return t.removeKeyMode(n),t.addKeyMode(n.deleteMode),n.deleteMode.storeNumber(n.number),n.number="",!0}),t.setAction("vi-y",function(){return t.removeKeyMode(n),t.addKeyMode(n.yankMode),n.yankMode.storeNumber(n.number),n.number="",!0}),t.setAction("vi-~",function(){return n._invoke("reversecase")},{name:e.reversecase}),t.setAction("vi-x",function(){return n._invoke("deleteNext")},{name:e.deleteNext}),t.setAction("vi-X",function(){return n._invoke("deletePrevious")},{name:e.deletePrevious}),t.setAction("vi-C",function(){return n._toInsertMode("deleteLineEnd")},{name:e.viC}),t.setAction("vi-D",function(){return n._invoke("deleteLineEnd")},{name:e.deleteLineEnd}),t.setAction("vi-*",function(){var e=n.getView(),t=e.getCaretOffset(),i=e.getNextOffset(t+1,{count:-1,unit:"word"}),r=e.getNextOffset(i,{count:1,unit:"wordend"}),o=e.getText(i,r);n._searchFwd=!0;var s={hideAfterFind:!0,incremental:!1,reverse:!1,findString:o};return n._invoke("find",s)},{name:e.viStar})},_reportStatus:function(e){this.statusReporter&&this.statusReporter(e)},_toInsertMode:function(e,t){t=t||{};var n=1;""!==this.number&&(n=this.number>>0),t.count=n;var i=this.getView();return this.insertMode.storeNumber(this.number),i.invokeAction(e,!1,t),i.removeKeyMode(this),i.addKeyMode(this.insertMode),this.number="",!0},_modeAdded:function(){this.getView().setOptions({blockCursorVisible:!0})},_modeRemoved:function(){var e=this.getView();e.setOptions({blockCursorVisible:!1}),e.removeKeyMode(this.insertMode),e.removeKeyMode(this.changeMode),e.removeKeyMode(this.deleteMode)}}),{VIMode:h}}),define("orion/editorPreferences",[],function(){function e(e,n){if(this._preferences=e,this._callback=n,n)var i=e.listenForChangedSettings(t,function(e){e.key===i&&n()}.bind(this))}var t="/editor/settings",n="editorSettings",i={autoSave:!1,autoSaveVisible:!0,autoSaveLocalVisible:!0,autoSaveTimeout:250,autoSaveTimeoutVisible:!0,themeVisible:!0,themeLocalVisible:!0,fontSizeVisible:!0,fontSizeLocalVisible:!0,autoLoad:!0,autoLoadVisible:!0,saveDiffs:!0,saveDiffsVisible:!0,contentAssistAutoTrigger:!0,contentAssistAutoTriggerVisible:!0,showOccurrences:!1,showOccurrencesVisible:!0,autoPairParentheses:!0,autoPairParenthesesVisible:!0,autoPairBraces:!0,autoPairBracesVisible:!0,autoPairSquareBrackets:!0,autoPairSquareBracketsVisible:!0,autoPairAngleBrackets:!1,autoPairAngleBracketsVisible:!0,autoPairQuotations:!0,autoPairQuotationsVisible:!0,autoCompleteComments:!0,autoCompleteCommentsVisible:!0,smartIndentation:!0,smartIndentationVisible:!0,trimTrailingWhiteSpace:!1,trimTrailingWhiteSpaceVisible:!0,tabSize:4,tabSizeVisible:!0,expandTab:!1,expandTabVisible:!0,scrollAnimation:!0,scrollAnimationVisible:!0,scrollAnimationTimeout:300,scrollAnimationTimeoutVisible:!0,annotationRuler:!0,annotationRulerVisible:!0,lineNumberRuler:!0,lineNumberRulerVisible:!0,foldingRuler:!0,foldingRulerVisible:!0,overviewRuler:!0,overviewRulerVisible:!0,showTabs:!1,showTabsVisible:!0,showSpaces:!1,showSpacesVisible:!0,wordWrap:!1,wordWrapVisible:!0,showMargin:!1,showMarginVisible:!0,marginOffset:80,marginOffsetVisible:!0,keyBindings:"Default",keyBindingsVisible:!0,keyBindingsLocalVisible:!0,splitOrientation:"horizontal",splitOrientationVisible:!0,splitOrientationLocalVisible:!0};return e.prototype={_initialize:function(e){var t=e.get(n)||{};for(var r in i)t.hasOwnProperty(r)||(t[r]=i[r]);return t},getPrefs:function(e){this._preferences.getPreferences(t).then(function(t){var n=this._initialize(t);"string"==typeof n&&(n=JSON.parse(n)),e(n)}.bind(this))},setPrefs:function(e,i){this._preferences.getPreferences(t).then(function(t){t.put(n,e),e=this._initialize(t),i&&i(e),this._callback&&this._callback(e)}.bind(this))}},{EditorPreferences:e}}),define("orion/widgets/themes/editor/ThemeData",["i18n!orion/settings/nls/messages","orion/editor/textTheme","orion/widgets/themes/ThemeVersion"],function(e,t,n){function i(){}function r(){this.styles=[];var e=new i;e.name="Eclipse",e.annotationRuler="white",e.background="white",e.comment="green",e.keyword="#7f0055",e.text="darkSlateGray",e.string="blue",e.overviewRuler="white",e.lineNumberOdd="#444",e.lineNumberEven="#444",e.lineNumber="#444",e.currentLine="#EAF2FE",e.constant="blue",e.tag="darkorange",e.attribute="cadetBlue",e.fontFamily=u,e.fontSize=p,e.rightRuler="#DDDDDD",e.leftRuler="#DDDDDD",this.styles.push(e);var t=new i;t.name="Prospecto",t.annotationRuler="white",t.background="white",t.comment="#3C802C",t.keyword="#CC4C07",t.text="#333",t.string="#446FBD",t.overviewRuler="white",t.lineNumberOdd="#CCCCCC",t.lineNumberEven="#CCCCCC",t.lineNumber="#CCCCCC",t.currentLine="#EAF2FE",t.tag="#CC4C07",t.attribute="cadetBlue",t.fontFamily=u,t.fontSize=p,t.rightRuler="#EEEEEE",t.leftRuler="#EEEEEE",t.constant="darkOrchid",this.styles.push(t);var n=new i;n.name="Blue",n.annotationRuler="lavender",n.background="aliceBlue",n.comment="indigo",n.keyword="cornFlowerBlue",n.text="navy",n.string="cornFlowerBlue",n.overviewRuler="lavender",n.lineNumberOdd="darkSlateGray",n.lineNumberEven="darkSlateGray",n.lineNumber="darkSlateGray",n.currentLine="white",n.tag="cornFlowerBlue",n.attribute="cadetBlue",n.rightRuler="white",n.leftRuler="white",n.fontFamily=u,n.fontSize=p,n.constant="blue",this.styles.push(n);var r=new i;r.name="Ambience",r.annotationRuler="#3D3D3D",r.background="darkgrey",r.comment="mediumslateblue",r.keyword="cornFlowerBlue",r.text="darkseagreen",r.string="lightcoral",r.overviewRuler="white",r.lineNumberOdd="black",r.lineNumberEven="black",r.lineNumber="black",r.currentLine="lightcyan",r.tag="cornFlowerBlue",r.attribute="cadetBlue",r.rightRuler="#baa289",r.leftRuler="#baa289",r.fontFamily=u,r.fontSize=p,r.constant="blue",this.styles.push(r);var o=new i;o.name="Tierra",o.annotationRuler="moccasin",o.background="lemonchiffon",o.comment="darkseagreen",o.keyword="darkred",o.text="#555555",o.string="orangered",o.overviewRuler="moccasin",o.lineNumberOdd="chocolate",o.lineNumberEven="chocolate",o.lineNumber="chocolate",o.currentLine="#baa289",o.tag="darkred",o.attribute="cadetBlue",o.rightRuler="#baa289",o.leftRuler="#baa289",o.fontFamily=u,o.fontSize=p,o.constant="blue",this.styles.push(o);var s=new i;s.name="Nimbus",s.annotationRuler="#232323",s.background="#333333",s.comment="darkseagreen",s.keyword="darkorange",s.text="#DDDDDD",s.string="cornflowerblue",s.overviewRuler="#232323",s.lineNumberOdd="#555555",s.lineNumberEven="#555555",s.lineNumber="#555555",s.currentLine="dimgrey",s.tag="darkorange",s.attribute="cadetBlue",s.rightRuler="#3a3a3a",s.leftRuler="#3a3a3a",s.fontFamily=u,s.fontSize=p,s.constant="#01B199",this.styles.push(s);var a=new i;a.name="Adelante",a.annotationRuler="#E2D2B2",a.background="#F1E7C8",a.comment="#5D774E",a.keyword="#AF473B",a.text="dimgray",a.string="#DE5D3B",a.overviewRuler="#E2D2B2",a.lineNumberOdd="#AF473B",a.lineNumberEven="#AF473B",a.lineNumber="#AF473B",a.currentLine="#9e937b",a.tag="#AF473B",a.attribute="cadetBlue",a.rightRuler="#9e937b",a.leftRuler="#9e937b",a.fontFamily=u,a.fontSize=p,a.constant="blue",this.styles.push(a);var l=new i;l.name="Raspberry Pi",l.annotationRuler="seashell",l.background="seashell",l.comment="#66B32F",l.keyword="#E73E36",l.text="dimgray",l.string="darkorange",l.overviewRuler="seashell",l.lineNumberOdd="#f6b8b6",l.lineNumberEven="#f6b8b6",l.lineNumber="#E73E36",l.currentLine="#F5B1AE",l.tag="#E73E36",l.attribute="cadetBlue",l.rightRuler="#fbdfde",l.leftRuler="#fbdfde",l.fontFamily=u,l.fontSize=p,l.constant="blue",this.styles.push(l)}function o(){return this.styles}function s(){return{storage:"/themes",styleset:"editorstyles",defaultTheme:"Prospecto",selectedKey:"editorSelected",version:n}}function a(){var t={};t.top=10,t.left=10,t.width=400,t.height=350;var n=t.left,i=t.top;t.shapes=[{type:"TEXT",name:e["Line Numbers"],label:"1",x:n+20,y:i+20,fill:"darkSlateGray",family:"lineNumber",font:"9pt sans-serif"},{type:"RECTANGLE",name:e.Background,x:n+46,y:i,width:290,height:t.height,family:"background",fill:"white"},{type:"TEXT",name:e.Strings,label:"'text/javascript'",x:n+134,y:i+20,fill:"darkorange",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"=",x:n+124,y:i+20,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Current Line"],x:n+46,y:i+87,width:290,height:18,family:"currentLine",fill:"#eaf2fd"},{type:"TEXT",name:e["HTML Attribute"],label:"type",x:n+98,y:i+20,fill:"darkGray",family:"attribute",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Overview Ruler"],x:n+336,y:i,width:14,height:t.height,family:"overviewRuler",fill:"white"},{type:"TEXT",name:e.Comments,label:"/* comment */",x:n+75,y:i+40,fill:"darkSeaGreen",family:"comment",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"<script",x:n+55,y:i+20,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:">",x:n+213,y:i+20,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Strings,label:"'Result'",x:n+164,y:i+80,fill:"cornflowerBlue",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"multiply(a,b){",x:n+120,y:i+60,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"function",x:n+75,y:i+60,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"var",x:n+95,y:i+80,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"output = ",x:n+115,y:i+80,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:";",x:n+205,y:i+80,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"var",x:n+95,y:i+100,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"result = a*b;",x:n+115,y:i+100,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Keywords,label:"return",x:n+95,y:i+120,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"output + result;",x:n+135,y:i+120,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"}",x:n+75,y:i+140,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"</script>",x:n+55,y:i+160,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"<style",x:n+55,y:i+200,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Attribute"],label:"type",x:n+95,y:i+200,fill:"darkGray",family:"attribute",font:"9pt sans-serif"},{type:"TEXT",name:e.Foreground,label:"=",x:n+121,y:i+200,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e.Strings,label:"'text/css'",x:n+131,y:i+200,fill:"darkorange",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:">",x:n+180,y:i+200,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:".some-class",x:n+75,y:i+220,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:"{",x:n+145,y:i+220,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Attribute"],label:"color:",x:n+95,y:i+240,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Value"],label:"#123456",x:n+130,y:i+240,fill:"darkSlateGray",family:"string",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Text"],label:";",x:n+180,y:i+240,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["CSS Class Name"],label:"}",x:n+75,y:i+260,fill:"darkSlateGray",family:"text",font:"9pt sans-serif"},{type:"TEXT",name:e["HTML Tag"],label:"</style>",x:n+55,y:i+280,fill:"darkorange",family:"keyword",font:"9pt sans-serif"},{type:"RECTANGLE",name:e["Annotation Ruler"],x:n,y:i,width:46,height:t.height,family:"annotationRuler",fill:"white"}];for(var r=0;16>r;r++)t.shapes.push({type:"TEXT",name:e["Line Numbers"],label:r+1,x:n+20,y:i+20*r+20,fill:"darkSlateGray",family:"lineNumber",font:"9pt sans-serif"});return t}function l(e){try{var t=null;if(window.DOMParser){var n=new DOMParser;t=n.parseFromString(e,"text/xml");var i=t.getElementsByTagName("parsererror");return i&&i.length&&i[0].childNodes.length?null:t}return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}catch(r){}}function d(e){console.log("fontsize: "+e)}function c(e){console.log("import theme"),console.log(e);var t=e.parameters.valueFor("name"),n=this.parseToXML(t),r=new i;r.name=n.getElementsByTagName("colorTheme")[0].attributes[1].value,r.annotationRuler=n.getElementsByTagName("background")[0].attributes[0].value,r.background=n.getElementsByTagName("background")[0].attributes[0].value,r.comment=n.getElementsByTagName("singleLineComment")[0].attributes[0].value,r.keyword=n.getElementsByTagName("keyword")[0].attributes[0].value,r.text=n.getElementsByTagName("foreground")[0].attributes[0].value,r.string=n.getElementsByTagName("string")[0].attributes[0].value,r.overviewRuler=n.getElementsByTagName("background")[0].attributes[0].value,r.lineNumberOdd=n.getElementsByTagName("lineNumber")[0].attributes[0].value,r.lineNumberEven=n.getElementsByTagName("lineNumber")[0].attributes[0].value,r.lineNumber=n.getElementsByTagName("lineNumber")[0].attributes[0].value,r.currentLine=n.getElementsByTagName("selectionBackground")[0].attributes[0].value,e.items.addTheme(r)}function h(e){var n="editorTheme",i=t.TextTheme.getTheme();i.setThemeClass(n,i.buildStyleSheet(n,e))}var u='"Consolas", "Monaco", "Vera Mono", monospace',p="10pt";r.prototype.styles=[],r.prototype.getStyles=o;
var f=!0;return r.prototype.fontSettable=f,r.prototype.getThemeStorageInfo=s,r.prototype.parseToXML=l,r.prototype.selectFontSize=d,r.prototype.importTheme=c,r.prototype.processSettings=h,r.prototype.getViewData=a,{ThemeData:r,getStyles:o}}),define("orion/widgets/input/TextField",["orion/objects","orion/webui/littlelib"],function(e,t){function n(n,i){e.mixin(this,n),this.node=i||document.createElement("div"),this.node.innerHTML=this.templateString,this.textfield=t.$(".setting-control",this.node)}return e.mixin(n.prototype,{templateString:'<input type="text" class="setting-control" name="myname"/>',category:null,item:null,element:null,ui:null,show:function(){this.textfield.addEventListener("change",this.change.bind(this)),this.postCreate()},destroy:function(){this.node&&(t.empty(this.node),this.textfield=this.node=null)},setStorageItem:function(){},width:function(e){this.textfield.style.width=e},getValue:function(){return"integer"===this.inputType?parseInt(this.textfield.value,10):this.textfield.value},setValue:function(e){this.textfield.value=e},getSelection:function(){return this.getValue()},setSelection:function(e){this.setValue(e)},postCreate:function(){this.inputType&&"password"===this.inputType&&(this.textfield.type="password"),this.editmode&&"readonly"===this.editmode&&this.textfield.setAttribute("readonly","true")},change:function(){var e;this.selection&&this.selection.value&&(e=this.selection.value),this.setStorageItem(this.category,this.item,this.element,e,this.ui)}}),n}),define("orion/widgets/input/LabeledTextfield",["orion/objects","orion/webui/littlelib","orion/widgets/input/TextField"],function(e,t,n){function i(){n.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}return e.mixin(i.prototype,n.prototype,{templateString:'<div class="setting-property"><label><span class="setting-label"></span><input class="setting-control" type="text" /></label></div>',destroy:function(){n.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)},postCreate:function(){n.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel+":"}}),i}),define("orion/widgets/input/Checkbox",["orion/objects","orion/webui/littlelib"],function(e,t){function n(n,i){e.mixin(this,n),this.node=i||document.createElement("div"),this.node.innerHTML=this.templateString,this.checkbox=t.$(".setting-control",this.node)}return e.mixin(n.prototype,{templateString:'<label><input class="setting-control settingsCheckbox" type="checkbox"/></label>',show:function(){this.checkbox.addEventListener("change",this.change.bind(this)),this.postCreate()},destroy:function(){this.node&&(t.empty(this.node),this.node=null,this.checkbox=null)},setStorageItem:function(){},isChecked:function(){return this.checkbox.checked},setChecked:function(e){this.checkbox.checked=e},getSelection:function(){return this.isChecked()},setSelection:function(e){this.setChecked(e)},change:function(){var e=this.checkbox.value;this.setStorageItem(e)},postCreate:function(){this.checkbox.style.width="20px",this.editmode&&"readonly"===this.editmode&&this.checkbox.setAttribute("disabled","disabled")}}),n}),define("orion/widgets/input/LabeledCheckbox",["orion/objects","orion/webui/littlelib","orion/widgets/input/Checkbox"],function(e,t,n){function i(){n.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}return e.mixin(i.prototype,n.prototype,{templateString:'<label><span class="setting-label"></span><input class="setting-control settingsCheckbox" type="checkbox"/></label>',postCreate:function(){n.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel+":"},destroy:function(){n.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)}}),i}),define("orion/widgets/input/Select",["orion/objects","orion/webui/littlelib"],function(e,t){function n(n,i){e.mixin(this,n),this.node=i||document.createElement("div"),this.node.innerHTML=this.templateString,this.select=t.$(".setting-control",this.node)}return e.mixin(n.prototype,{templateString:'<select class="setting-control" id="selection"></select>',addOptions:function(e){var t=document.createElement("option");t.value=e.value,t.appendChild(document.createTextNode("string"==typeof e.label?e.label:e.value)),e.selected&&(t.selected="selected"),this.select.appendChild(t)},show:function(){this.postCreate()},postCreate:function(){this.options.forEach(this.addOptions.bind(this)),this.select.addEventListener("change",this.change.bind(this))},destroy:function(){this.node&&(t.empty(this.node),this.node=this.select=null)},setStorageItem:function(){},getSelected:function(){return this.select.value},getSelectedIndex:function(){return this.select.selectedIndex},setSelectedIndex:function(e){this.select.selectedIndex=e},getSelection:function(){return this.getSelected()},setSelection:function(e){for(var t=0;t<this.options.length;t++)if(this.options[t].value===e)return void this.setSelectedIndex(t);this.setSelectedIndex(0)},change:function(){var e=this.select.value;this.category?this.setStorageItem(this.category,this.item,this.element,e,this.ui):this.setStorageItem(e)}}),n}),define("orion/widgets/input/LabeledSelect",["orion/objects","orion/webui/littlelib","orion/widgets/input/Select"],function(e,t,n){function i(){n.apply(this,arguments),this.mylabel=t.$(".setting-label",this.node)}return e.mixin(i.prototype,n.prototype,{templateString:'<div class="setting-property"><label><span class="setting-label"></span><select class="setting-control"></select></label></div>',postCreate:function(){n.prototype.postCreate.call(this),this.mylabel.textContent=this.fieldlabel+":"},destroy:function(){n.prototype.destroy.call(this),this.mylabel&&(this.mylabel=null)}}),i}),define("orion/widgets/settings/Subsection",[],function(){function e(e){var t=e.sectionName;this.parentNode=e.parentNode,this.children=e.children;var n=document.createElement("section");n.classList.add("setting-row"),n.setAttribute("role","region"),n.setAttribute("aria-labelledby","Navigation-header");var i=document.createElement("h3");i.classList.add("setting-header"),i.textContent=t;var r=document.createElement("div");r.classList.add("setting-content"),n.appendChild(i),n.appendChild(r),this.node=n,this.subsectionContent=r}return e.prototype.show=function(){if(this.parentNode&&this.parentNode.appendChild(this.node),this.children){var e=this;this.children.forEach(function(t){e.subsectionContent.appendChild(t.node),t.show()})}},e}),define("orion/widgets/settings/EditorSettings",["i18n!orion/settings/nls/messages","orion/widgets/input/LabeledTextfield","orion/widgets/input/LabeledCheckbox","orion/widgets/input/LabeledSelect","orion/section","orion/widgets/settings/Subsection","orion/commands","orion/objects","orion/webui/littlelib"],function(e,t,n,i,r,o,s,a,l){function d(t,n,i,r,o){if(!r.local){var s=document.createElement("span");s.classList.add(m),s.classList.add(o[n+"LocalVisible"]?v:y),s.title=e.localSettingsTooltip,s.addEventListener("click",function(){s.classList.contains(y)?(s.classList.add(v),s.classList.remove(y)):(s.classList.add(y),s.classList.remove(v))});var a=l.$("label",t.node);a.parentNode.insertBefore(s,a)}return t}function c(e,t,i){return d(new n(t),e,this,t,i)}function h(e,n,i){return n.inputType="integer",d(new t(n),e,this,n,i)}function u(e,t,n){var r=this.values;t.options=[];for(var o=0;o<r.length;o++){var s=r[o],a={value:s.value,label:s.label};s.value===n[e]&&(a.selected=!0),t.options.push(a)}return d(new i(t),e,this,t,n)}function p(t,n){return this.min<=n[t]&&n[t]<=this.max?"":e[t+"Invalid"]}function f(e,t){a.mixin(this,e),this.node=t}var g=[{value:"",label:e.Default},{value:"Emacs",label:"Emacs"},{value:"vi",label:"vi"}],m="setting-local-indicator",v="on",y="off",_={editorSettings:{keys:{keyBindings:{values:g,create:u}},splitEditors:{splitOrientation:{values:[{value:"vertical",label:e.vertical},{value:"horizontal",label:e.horizontal}],create:u}},fileManagement:{autoSave:{create:c},autoSaveTimeout:{min:50,max:1e4,create:h,validate:p},autoLoad:{create:c},saveDiffs:{create:c},trimTrailingWhiteSpace:{create:c}},typing:{autoPairQuotations:{create:c},autoPairParentheses:{create:c},autoPairBraces:{create:c},autoPairSquareBrackets:{create:c},autoPairAngleBrackets:{create:c},autoCompleteComments:{create:c},smartIndentation:{create:c}},tabs:{tabSize:{min:1,max:16,create:h,validate:p},expandTab:{create:c}},whitespaces:{showTabs:{create:c},showSpaces:{create:c}},wrapping:{wordWrap:{create:c},showMargin:{create:c},marginOffset:{min:10,max:200,create:h,validate:p}},smoothScrolling:{scrollAnimation:{create:c},scrollAnimationTimeout:{min:50,max:1e3,create:h,validate:p}},rulers:{annotationRuler:{create:c},lineNumberRuler:{create:c},foldingRuler:{create:c},overviewRuler:{create:c}},languageTools:{showOccurrences:{create:c},contentAssistAutoTrigger:{create:c}}}};return a.mixin(f.prototype,{templateString:'<div class="sections"></div>',commandTemplate:'<div id="commandButtons"><div id="editorCommands" class="layoutRight sectionActions"></div></div>',createElements:function(){if(this.node.innerHTML=this.templateString,this.sections=l.$(".sections",this.node),this.createSections(),this.local)this.sections.classList.add("local");else{var e=document.getElementById("pageActions");e.innerHTML=this.commandTemplate,this.createToolbar()}},createSections:function(){var t,n,s,a,d=this.oldPrefs,c=[],h=this.themePreferences;if(!this.local&&this.editorThemeWidget)this.editorThemeSection=new r.Section(this.sections,{id:"editorThemeSettings",title:e.EditorThemes,canHide:!0,slideout:!0}),this.editorThemeWidget.renderData(this.editorThemeSection.getContentElement(),"INITIALIZE");else{var u=this.oldThemeStyles;if(d.themeVisible&&(!this.local||d.themeLocalVisible)){var p=u.styles;n=[];for(var f=0;f<p.length;f++)s={value:p[f].name,label:p[f].name},p[f].name===u.style.name&&(s.selected=!0),n.push(s);c.push(a=this.themeSelect=new i({fieldlabel:e.Theme,options:n})),a.setStorageItem=function(e){h.setTheme(e)}}if(d.fontSizeVisible&&(!this.local||d.fontSizeLocalVisible)){var g=u.style.fontSize;n=[];for(var C=8;19>C;C++)s={value:C+"pt",label:C+"pt"},s.label===g&&(s.selected=!0),n.push(s);c.push(a=this.sizeSelect=new i({fieldlabel:e["Font Size"],options:n})),a.setStorageItem=function(e){h.setFontSize(e)}}!this.local&&c.length>0&&(t=new o({sectionName:e.Theme,parentNode:this.editorThemeSection.getContentElement(),children:c}),t.show(),c=[])}var w,b;for(var x in _)if(_.hasOwnProperty(x)){if(!this.local){w=new r.Section(this.sections,{id:x,title:e[x],canHide:!0,slideout:!0});var S=document.createElement("div");S.classList.add("setting-info"),S.textContent=e.editorSettingsInfo;var L=document.createElement("span");L.classList.add(m),L.classList.add(v);var E=document.createElement("span");E.classList.add(m),E.classList.add(y);var k=document.createElement("span");k.classList.add("core-sprite-wrench"),k.classList.add("icon-inline"),k.classList.add("imageSprite"),l.processDOMNodes(S,[L,E,k]),w.getContentElement().appendChild(S)}for(var T in _[x])if(_[x].hasOwnProperty(T)){for(var A in _[x][T])if(d[A+"Visible"]&&(!this.local||d[A+"LocalVisible"])){var N=_[x][T][A];n={},n.local=this.local,n.fieldlabel=e[A],c.push(N.widget=N.create(A,n,d))}!this.local&&c.length>0&&(b=new o({sectionName:e[T],parentNode:w.getContentElement(),children:c}),b.show(),c=[])}}this.local&&c.forEach(function(e){this.sections.appendChild(e.node),e.hasOwnProperty("setStorageItem")||(e.setStorageItem=this.update.bind(this)),e.show()}.bind(this))},createToolbar:function(){var t=l.node("editorSettingsToolActionsArea"),n=new s.Command({name:e.Restore,tooltip:e["Restore default Editor Settings"],id:"orion.restoreeditorsettings",callback:function(e){this.restore(e.items)}.bind(this)});this.commandService.addCommand(n),this.commandService.registerCommandContribution("restoreEditorSettingCommand","orion.restoreeditorsettings",2),this.commandService.renderCommands("restoreEditorSettingCommand",t,this,this,"button");var i=new s.Command({name:e.Update,tooltip:e["Update Editor Settings"],id:"orion.updateeditorsettings",callback:function(e){this.update(e.items)}.bind(this)});this.commandService.addCommand(i),this.commandService.registerCommandContribution("editorSettingCommand","orion.updateeditorsettings",1),this.commandService.renderCommands("editorSettingCommand",t,this,this,"button")},valueChanged:function(){var e={};for(var t in this.oldPrefs)this.oldPrefs.hasOwnProperty(t)&&(e[t]=this.oldPrefs[t]);this.getValues(e);for(var n in e)if(e.hasOwnProperty(n)&&e[n]!==this.oldPrefs[n])return e;return void 0},validate:function(e){var t="";return this._forEach(function(n,i){return i.validate&&(t=i.validate(n,e))?!1:!0}),t},_progress:function(e,t){if(this.registry){var n=this.registry.getService("orion.page.message");n.setProgressResult({Message:e,Severity:t})}},update:function(){var t=this.valueChanged();if(t){var n=this.validate(t);if(n)return void this._progress(n,"Error");this.preferences.setPrefs(t,function(){this.setValues(this.oldPrefs=t),this._progress(e["Editor preferences updated"],"Normal")}.bind(this))}else this.setValues(this.oldPrefs);this.editor&&this.editor.focus()},restore:function(){this.preferences.setPrefs({},function(t){this._show(t),this._progress(e["Editor defaults restored"],"Normal")}.bind(this))},show:function(e,t){e&&(this.node=e),this.themePreferences.getTheme(function(e){this.preferences.getPrefs(function(n){this._show(n,e),t&&t()}.bind(this))}.bind(this))},_show:function(e,t){t&&(this.oldThemeStyles=t),this.oldPrefs=e,this.createElements(),this.setValues(e)},_forEach:function(e){for(var t in _)if(_.hasOwnProperty(t))for(var n in _[t])if(_[t].hasOwnProperty(n))for(var i in _[t][n])if(_[t][n].hasOwnProperty(i)){var r=_[t][n][i];if(r.widget&&!e(i,r))return}},getValues:function(e){this._forEach(function(t,n){if(e[t]=n.widget.getSelection(),!this.local){var i=l.$("."+m,n.widget.node);e[t+"LocalVisible"]=i&&i.classList.contains(v)}return!0}.bind(this))},setValues:function(e){this._forEach(function(t,n){if(n.widget.setSelection(e[t]),!this.local){var i=l.$("."+m,n.widget.node);i&&(e[t+"LocalVisible"]?(i.classList.add(v),i.classList.remove(y)):(i.classList.add(y),i.classList.remove(v)))}return!0}.bind(this))},destroy:function(){this.node&&(this.node=null),this.editorThemeWidget&&(this.editorThemeWidget.destroy(),this.editorThemeWidget=null)}}),f}),define("orion/search/nls/root/messages",{"Find:":"Find:","Find With":"Find With","ReplaceWith:":"ReplaceWith:","Replace With":"Replace With","Show all":"Show all","Wrap search":"Wrap search","Incremental search":"Incremental search","Whole Word":"Whole Word","Regular expression":"Regular expression","Find after replace":"Find after replace",Options:"Options","Find next match":"Find next match","Find previous match":"Find previous match",Next:"Next",Previous:"Previous",Replace:"Replace","Replace...":"Replace...","Replace All":"Replace All","Show Replace":"Show Replace","Hide Replace":"Hide Replace","Search ${0}":"Search ${0}","Type a keyword or wild card to search in ":"Type a keyword or wild card to search in ","Search failed.":"Search failed.","No matches found for ${0}":"No matches found for ${0}","Searching...":"Searching...","Resource has been changed by others.":"Resource has been changed by others.","Failed to write file.":"Failed to write file.",Results:"Results","Files ${0} of ${1} matching ${2}":"Files ${0} of ${1} matching ${2}","Replace ${0} with ${1} for files ${2} of ${3}":"Replace ${0} with ${1} for files ${2} of ${3}",Location:"Location","Click to compare":"Click to compare",'Search again in this folder with "${0}"':'Search again in this folder with "${0}"',"Files replaced":"Files replaced",Status:"Status","${0} out of ${1}  matches replaced.":"${0} out of ${1}  matches replaced.","Replace all matches with...":"Replace all matches with...","Apply Changes":"Apply Changes","Replace all selected matches":"Replace all selected matches","Hide Compare":"Hide Compare","Hide compare view of changes":"Hide compare view of changes","Show Compare":"Show Compare","Show compare view of changes":"Show compare view of changes","Show All":"Show All","Show all the results in one page":"Show all the results in one page","< Previous Page":"< Previous Page","Show previous page of search result":"Show previous page of search result","Next Page >":"Next Page >","Show next page of search result":"Show next page of search result","Next result":"Next result","Previous result":"Previous result","Expand all results":"Expand all results","Collapse all results":"Collapse all results","Writing files...":"Writing files...","Preparing preview...":"Preparing preview...","Replaced File (${0})":"Replaced File (${0})","Original File (${0})":"Original File (${0})","Sort by Name":"Sort by Name","Compare changes":"Compare changes","Search Results":"Search Results","Replace All Matches":"Replace All Matches","No matches":"No matches",Rename:"Rename","Save frequently used searches by clicking on the ${0} button above.":"Save frequently used searches by clicking on the ${0} button above.",Search:"Search","All types":"All types","File type":"File type","All ${0} files":"All ${0} files","${0} is already saved":"${0} is already saved","Type a search term":"Type a search term","Type a replace term":"Type a replace term","Case sensitive":"Case sensitive","File name":"File name","Path name":"Path name",Save:"Save","Type filter text":"Type filter text","Scope Search":"Scoped Search","Open in Search page for this directory":"Open the Search page for this folder.","${0}. Try your search again.":"${0}. Try your search again.","Click or use delete key to delete the search term":"Click or use delete key to delete the search term","${0} matches":"${0} matches","Regular expression is off. You can click here or use options to turn it on for replacement - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>.":"Regular expression is off. You can click here or use options to turn it on for replacement - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>.","Regular expression is on. You can click here or use options to turn it off - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>.":"Regular expression is on. You can click here or use options to turn it off - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>.",Scope:"Scope","Show previous search terms":"Show previous search terms","Show previous replace terms":"Show previous replace terms","Show replacement preview":"Show replacement preview","File name patterns (comma-separated)":"File name patterns (comma-separated)","(* = any string, ? = any character)":"(* = any string, ? = any character)","Choose a Folder":"Choose a Folder"}),define("orion/search/nls/messages",["orion/i18n!orion/search/nls/messages","orion/search/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/inputCompletion/inputCompletion",["orion/EventTarget"],function(e){function t(t,n,i){e.attach(this),this._binderFunc=n,this.setInputField(t);var r=i?i.group:null;r||(r=this._inputField&&this._inputField.id?this._inputField.id:"default__input__group"),this._completionIdPrefix=r+"__completion__",this._proposeFromStart=i?i.proposeFromStart:!1,this._extendedProvider=i?i.extendedProvider:null,this._serviceRegistry=i?i.serviceRegistry:null,this._onDelete=i?i.onDelete:null,this._deleteToolTips=i?i.deleteToolTips:"",this._proposalIndex=-1,this._dismissed=!0,this._mouseDown=!1,this._dataList=[],this._initUI(),this._listeners=[];var o=function(e){if(this._binderFunc){var t=this;this._binderFunc(function(t){this._bind(t),e.deleting&&(this._proposeOn(this._inputField.value),this._selectProposal(this._proposalIndex,!0))}.bind(t))}}.bind(this);this.addEventListener("inputDataListChanged",o),this._listeners.push({evtTarget:this,type:"inputDataListChanged",handler:o});var s=function(){this._mouseDown=!0}.bind(this);this._completionUIContainer.addEventListener("mousedown",s),this._listeners.push({evtTarget:this._completionUIContainer,type:"mousedown",handler:s});var a=function(){this._mouseDown=!1}.bind(this);this._completionUIContainer.addEventListener("mouseup",a),this._listeners.push({evtTarget:this._completionUIContainer,type:"mouseup",handler:a})}return t.prototype._removeListeners=function(e){e&&e.forEach(function(e){e.evtTarget.removeEventListener(e.type,e.handler,!1)})},t.prototype.destroy=function(){this._removeListeners(this._inputFieldListeners),this._removeListeners(this.listeners)},t.prototype.hasValueOf=function(e){return this._dataList.some(function(t){return t.value===e})},t.prototype.setInputField=function(e){this._inputField&&this._inputFieldListeners&&this._removeListeners(this._inputFieldListeners),this._inputFieldListeners=[],this._inputField=e,"string"==typeof this._inputField&&(this._inputField=document.getElementById(this._inputField));var t=function(){if(this._mouseDown){var e=this;window.setTimeout(function(){this._inputField.focus()}.bind(e),200)}else document.activeElement!==this._inputField&&this._dismiss()}.bind(this);this._inputField.addEventListener("blur",t),this._inputFieldListeners.push({evtTarget:this._inputField,type:"blur",handler:t});var n=function(e){this.onKeyDown(e)}.bind(this);this._inputField.addEventListener("keydown",n),this._inputFieldListeners.push({evtTarget:this._inputField,type:"keydown",handler:n});var i=function(){this._proposeOn(this._inputField.value)}.bind(this);this._inputField.addEventListener("input",i),this._inputFieldListeners.push({evtTarget:this._inputField,type:"input",handler:i});var r=function(){if(this._dismissed&&this._binderFunc){if(this._dismissing)return void(this._dismissing=!1);if(this._binderFunc){var e=this;this._binderFunc(function(e){this._bind(e),this._inputField.value}.bind(e))}}}.bind(this);this._inputField.addEventListener("focus",r),this._inputFieldListeners.push({evtTarget:this._inputField,type:"focus",handler:r})},t.prototype.onKeyDown=function(e){if(this._dismissed)return!0;var t=e.charCode||e.keyCode;return 13===t?this._proposalList&&this._proposalList.length>0&&this._proposalIndex>=0&&this._proposalIndex<this._proposalList.length?(e.preventDefault(),this._dismiss(this._proposalList[this._proposalIndex].item.value,e.ctrlKey),e.stopPropagation(),!1):!0:(40===t||38===t)&&this._proposalList&&this._proposalList.length>0?(e.preventDefault(),this._walk(40===t),e.stopPropagation(),!1):27===t?(e.preventDefault(),this._dismiss(),!1):46===t&&this._proposalIndex>-1&&this._onDelete?(e.preventDefault(),this._onDelete(this._proposalList[this._proposalIndex].item.value,this),this._resetIndexAfterDeletion(),e.stopPropagation(),!1):!0},t.prototype._resetIndexAfterDeletion=function(){this._proposalList.length<=1?this._proposalIndex=-1:this._proposalIndex===this._proposalList.length-1&&(this._proposalIndex=this._proposalList.length-2)},t.prototype._bind=function(e){this._dataList=e},t.prototype._getUIContainerID=function(){return this._completionIdPrefix+"UIContainer"},t.prototype._getUIProposalListId=function(){return this._completionIdPrefix+"UIProposalList"},t.prototype._initUI=function(){this._completionUIContainer=document.getElementById(this._getUIContainerID()),this._completionUIContainer||(this._completionUIContainer=document.createElement("div"),this._completionUIContainer.id=this._getUIContainerID(),this._completionUIContainer.style.display="none",this._completionUIContainer.className="inputCompletionContainer",this._completionUIContainer.setAttribute("role","list"),this._completionUIContainer.setAttribute("aria-atomic","true"),this._completionUIContainer.setAttribute("aria-live","assertive"),document.body.appendChild(this._completionUIContainer)),this._completionUIContainer.textContent="",this._completionUL=document.getElementById(this._getUIProposalListId()),this._completionUL||(this._completionUL=document.createElement("ul"),this._completionUL.id=this._getUIProposalListId(),this._completionUL.className="inputCompletionUL"),this._completionUL.textContent="",this._completionUIContainer.appendChild(this._completionUL)},t.prototype._createProposalLink=function(e,t,n,i){var r=document.createElement("a");return r.href=require.toUrl(t),r.appendChild(this._createBoldText(e,n,i)),r},t.prototype._createBoldText=function(e,t,n,i){if(0>t)return document.createTextNode(e);var r,o=i?i:document.createElement("span"),s=0;s!==t&&(r=document.createTextNode(e.substring(s,t)),o.appendChild(r));var a=document.createElement("b");return o.appendChild(a),r=document.createTextNode(e.substring(t,t+n)),a.appendChild(r),t+n<e.length&&(r=document.createTextNode(e.substring(t+n)),o.appendChild(r)),o},t.prototype._proposeOnCategory=function(e,t){if(0!==t.length){var n;if(e){n=document.createElement("li"),n.className="inputCompletionLICategory";var i=document.createTextNode(e);n.appendChild(i),this._completionUL.appendChild(n)}t.forEach(function(e){n=document.createElement("li"),n.onmouseover=function(e){this._selectProposal(e.currentTarget)}.bind(this),n.onclick=function(e){this._dismiss(e.currentTarget.completionItem.value)}.bind(this),n.className="inputCompletionLINormal",n.completionItem=e.item;var t;if("string"==typeof e.item.value){var i=document.createElement("table");i.style.width="100%",i.style.tableLayout="fixed",i.style.borderSpacing="0";var r=document.createElement("tr");r.style.width=this._inputField.offsetWidth+"px",i.appendChild(r);var o=document.createElement("td");o.classList.add("inputCompletionLILeftTD");var s=this._createBoldText(e.item.value,e.boldIndex,e.boldLength);if(o.appendChild(s),o.style.overflow="hidden",r.appendChild(o),this._onDelete){t=document.createElement("button"),t.classList.add("inputCompletionDismissButton"),t.classList.add("layoutRight"),t.classList.add("core-sprite-close"),t.classList.add("imageSprite"),t.style.display="none",t.style.margin="0 0 0",t.title=this._deleteToolTips,t.onclick=function(t){t.stopPropagation(),this._onDelete(e.item.value,this),this._resetIndexAfterDeletion()}.bind(this);var a=document.createElement("td");a.classList.add("inputCompletionLIRightTD"),a.appendChild(t),r.appendChild(a)}n.appendChild(i)}else e.item.value.name&&"link"===e.item.value.type&&n.appendChild(this._createProposalLink(e.item.value.name,e.item.value.value,e.boldIndex,e.boldLength));this._completionUL.appendChild(n),this._proposalList.push({item:e.item,domNode:n,deleteBtn:t})}.bind(this))}},t.prototype._domNode2Index=function(e){if(this._proposalList)for(var t=0;t<this._proposalList.length;t++)if(this._proposalList[t].domNode===e)return t;return-1},t.prototype._highlight=function(e,t){var n,i=e,r=!1;isNaN(i)||(r=!0,this._proposalList&&e>=0&&e<this._proposalList.length?(i=this._proposalList[e].domNode,n=this._proposalList[e].deleteBtn):i=null),i&&(i.className=t?"inputCompletionLISelected":"inputCompletionLINormal",n&&(n.style.display=t?"":"none"),t&&r&&(i.offsetTop<this._completionUIContainer.scrollTop?i.scrollIntoView(!0):i.offsetTop+i.offsetHeight>this._completionUIContainer.scrollTop+this._completionUIContainer.clientHeight&&i.scrollIntoView(!1)))},t.prototype._selectProposal=function(e,t){var n=e;isNaN(n)&&(n=this._domNode2Index(e)),(n!==this._proposalIndex||t)&&(this._highlight(this._proposalIndex,!1),this._proposalIndex=n,this._highlight(this._proposalIndex,!0))},t.prototype._dismiss=function(e,t){this._mouseDown||(this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,"string"==typeof e?(this._inputField.value=e,this._dismissing=!0,this._inputField.focus()):e&&e.name&&"link"===e.type&&(t?window.open(e.value):window.location.href=e.value),this._completionUIContainer.style.display="none")},t.prototype._show=function(){if(this._proposalList&&this._proposalList.length>0){for(var e=0,t=0,n=this._inputField;n;)e+=n.offsetLeft,t+=n.offsetTop,n=n.offsetParent;this._completionUIContainer.style.display="block",this._completionUIContainer.style.top=t+this._inputField.offsetHeight+2+"px",this._completionUIContainer.style.left=e+"px",this._completionUIContainer.style.width=this._inputField.offsetWidth+"px",this._mouseDown=!1,this._dismissed=!1}else this._dismissed=!0,this._proposalList=null,this._proposalIndex=-1,this._completionUIContainer.style.display="none"},t.prototype._walk=function(e){var t=this._proposalIndex+(e?1:-1);-1>t?t=this._proposalList.length-1:t>=this._proposalList.length&&(t=-1),this._selectProposal(t)},t.prototype._proposeOnList=function(e,t,n){var i="",r=[],o=t?t.length:0;e.forEach(function(e){if("category"===e.type)this._proposeOnCategory(i,r),i=e.label,r=[];else{var s=!0,a=-1;if(t&&n){var l;"string"==typeof e.value?l=e.value.toLowerCase():e.value.name&&(l=e.value.name.toLowerCase()),a=l.indexOf(t),0>a?s=!1:this._proposeFromStart&&(s=0===a)}s&&r.push({item:e,boldIndex:a,boldLength:o})}}.bind(this)),this._proposeOnCategory(i,r)},t.prototype._proposeOn=function(e){this._completionUL.textContent="";var t=e?e.toLowerCase():null;this._proposalList=[],this._proposeOnList(this._dataList,t,!0),this._extendedProvider&&t?this._extendedProvider(e,function(n){if(n){var i=this;n.forEach(function(n){this._proposeOnList(n.proposals,n.filterForMe?t:e,n.filterForMe)}.bind(i))}this._show()}.bind(this),[]):this._show()},t.prototype.constructor=t,{InputCompletion:t}}),define("orion/searchAndReplace/textSearcher",["i18n!orion/search/nls/messages","orion/editor/find","orion/commands","orion/objects","orion/searchUtils","orion/inputCompletion/inputCompletion","orion/webui/littlelib"],function(e,t,n,i,r,o,s){function a(e,n,i,r,o){t.Find.call(this,e,r,o),this._serviceRegistry=n,this._commandService=i}var l=30;return a.prototype=new t.Find,i.mixin(a.prototype,{getFindString:function(){var e=document.getElementById("localSearchFindWith");return e?e.value:t.Find.prototype.getFindString.call(this)},getReplaceString:function(){var e=document.getElementById("localSearchReplaceWith");return e?e.value:t.Find.prototype.getReplaceString(this)},hide:function(){var e=this.isVisible();t.Find.prototype.hide.call(this),e&&this._commandService.closeParameterCollector()},show:function(e){t.Find.prototype.show.call(this,e);var n=e.findString;this._addRecentfind(n);var i=e.replaceString,r=document.getElementById("localSearchFindWith");if(r||(this._createActionTable(),r=document.getElementById("localSearchFindWith")),n&&(r.value=n),i){var o=document.getElementById("localSearchReplaceWith");o.value=i}window.setTimeout(function(){r.select(),r.focus()},10)},_showReplaceInfo:function(){this._regex?(this._replaceInfo.src="data:image/gif;base64,R0lGODlhBwAIAMQAAMzX6cbT5kh4qFiIuKC40FCIuGSXwmWZw2SaxGacxmadxmWcxbPM4GigyJW92JzC26DI0P///////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABIALAAAAAAHAAgAAAUmoEQUQkFI0PBEz5A2yII0w9AwkUPbRpTsjUNEQUsFIgCXiGSShAAAOw==",this._replaceInfo.title=e["Regular expression is on. You can click here or use options to turn it off - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>."],this._replaceInfo.style.display=""):(this._replaceInfo.src="data:image/gif;base64,R0lGODlhBwAIAEAAACH5BAEAABIALAAAAAAHAAgAhwAAAAAAMwAAZgAAmQAAzAAA/wArAAArMwArZgArmQArzAAr/wBVAABVMwBVZgBVmQBVzABV/wCAAACAMwCAZgCAmQCAzACA/wCqAACqMwCqZgCqmQCqzACq/wDVAADVMwDVZgDVmQDVzADV/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMrADMrMzMrZjMrmTMrzDMr/zNVADNVMzNVZjNVmTNVzDNV/zOAADOAMzOAZjOAmTOAzDOA/zOqADOqMzOqZjOqmTOqzDOq/zPVADPVMzPVZjPVmTPVzDPV/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YrAGYrM2YrZmYrmWYrzGYr/2ZVAGZVM2ZVZmZVmWZVzGZV/2aAAGaAM2aAZmaAmWaAzGaA/2aqAGaqM2aqZmaqmWaqzGaq/2bVAGbVM2bVZmbVmWbVzGbV/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5krAJkrM5krZpkrmZkrzJkr/5lVAJlVM5lVZplVmZlVzJlV/5mAAJmAM5mAZpmAmZmAzJmA/5mqAJmqM5mqZpmqmZmqzJmq/5nVAJnVM5nVZpnVmZnVzJnV/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wrAMwrM8wrZswrmcwrzMwr/8xVAMxVM8xVZsxVmcxVzMxV/8yAAMyAM8yAZsyAmcyAzMyA/8yqAMyqM8yqZsyqmcyqzMyq/8zVAMzVM8zVZszVmczVzMzV/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8rAP8rM/8rZv8rmf8rzP8r//9VAP9VM/9VZv9Vmf9VzP9V//+AAP+AM/+AZv+Amf+AzP+A//+qAP+qM/+qZv+qmf+qzP+q///VAP/VM//VZv/Vmf/VzP/V////AP//M///Zv//mf//zP///wAAAAAAAAAAAAAAAAgsAPcpQzMJjbJ9xNAQQ6hwUqaHDws+3PeQoMN9DiUuzFRQ2ZiDyyYdHFhwYUAAOw==",this._replaceInfo.title=e["Regular expression is off. You can click here or use options to turn it on for replacement - e.g. when the option is on you can replace <td([\\s\\S]*?)</td> with <span$1</span>."],this._replaceInfo.style.display="")
},_createActionTable:function(){var t=this;this._commandService.openParameterCollector("pageNavigationActions",function(i){var r=document.createElement("input");r.type="text",r.name=e["Find:"],r.className="parameterInput",r.id="localSearchFindWith",r.placeholder=e["Find With"],r.oninput=function(e){return t._handleInput(e)},r.onkeydown=function(e){return t._handleKeyDown(e)},i.appendChild(r),t._initCompletion(r),t._createButton(e.Next,i,function(){t._addRecentfind(t.getFindString()),t.find(!0)}),t._createButton(e.Previous,i,function(){t._addRecentfind(t.getFindString()),t.find(!1)});var o=t._editor.getTextView().getOptions("readonly");if(!o){var s=document.createElement("input");s.type="text",s.name=e["ReplaceWith:"],s.className="parameterInput",s.id="localSearchReplaceWith",s.placeholder=e["Replace With"],s.onkeydown=function(e){return t._handleKeyDown(e)},i.appendChild(s),t._replaceInfo=t._createInfoImage(null,i,null),t._showReplaceInfo(),t._createButton(e.Replace,i,function(){t.replace()}),t._createButton(e["Replace All"],i,function(){t.replaceAll()})}var a=document.createElement("div");i.appendChild(a),a.classList.add("findOptionsDiv");var l=n.createDropdownMenu(a,e.Options,null,"dismissButton",null,!0);return l.menuButton.classList.add("parameterInlineButton"),n.createCheckedMenuItem(l.menu,e["Show all"],t._showAll,function(e){var n=e.target.checked;t.setOptions({showAll:n}),l.dropdown.close(!0)}),n.createCheckedMenuItem(l.menu,e["Case sensitive"],!t._caseInsensitive,function(e){t.setOptions({caseInsensitive:!e.target.checked}),l.dropdown.close(!0),t.find(!0)}),n.createCheckedMenuItem(l.menu,e["Wrap search"],t._wrap,function(e){t.setOptions({wrap:e.target.checked}),l.dropdown.close(!0)}),n.createCheckedMenuItem(l.menu,e["Incremental search"],t._incremental,function(e){t.setOptions({incremental:e.target.checked}),l.dropdown.close(!0)}),n.createCheckedMenuItem(l.menu,e["Whole Word"],t._wholeWord,function(e){t.setOptions({wholeWord:e.target.checked}),l.dropdown.close(!0),t.find(!0)}),t._regExBox=n.createCheckedMenuItem(l.menu,e["Regular expression"],t._regex,function(e){t.setOptions({regex:e.target.checked}),l.dropdown.close(!0),t.find(!0),t._showReplaceInfo()}),o||n.createCheckedMenuItem(l.menu,e["Find after replace"],t._findAfterReplace,function(e){t.setOptions({findAfterReplace:e.target.checked}),l.dropdown.close(!0)}),r},function(){t.hide()})},_storeRecentFind:function(e,t,n){this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(i){i.put("recentFind",e),t&&window.setTimeout(function(){t.dispatchEvent({type:"inputDataListChanged",deleting:n})}.bind(this),20)})},_addRecentfind:function(e){"string"==typeof e&&e&&(this._completion&&this._completion.hasValueOf(e)||this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(t){var n,i=t.get("recentFind");if("string"==typeof i&&(i=JSON.parse(i)),i){for(n in i)if(i[n].name===e)return;if(i.length>=l){var r=i.length;i.splice(l-1,r-l+1)}}else i=[];i.splice(0,0,{name:e}),this._storeRecentFind(i,this._completion)}.bind(this)))},_removeRecentSearch:function(e,t){"string"==typeof e&&e&&this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(n){var i,r=n.get("recentFind");if("string"==typeof r&&(r=JSON.parse(r)),r)for(i in r)if(r[i].name===e){r.splice(i,1),this._storeRecentFind(r,t,!0);break}}.bind(this))},_initCompletion:function(t){if(this._completion)this._completion.setInputField(t);else{var n=function(e){this._serviceRegistry.getService("orion.core.preference").getPreferences("/window/favorites").then(function(t){var n=t.get("recentFind");if("string"==typeof n&&(n=JSON.parse(n)),n){var i=[];n.forEach(function(e){i.push({type:"proposal",label:e.name,value:e.name})}),e(i)}})}.bind(this);this._completion=new o.InputCompletion(t,n,{serviceRegistry:this._serviceRegistry,group:"localSearch",onDelete:function(e,t){this._removeRecentSearch(e,t)}.bind(this),deleteToolTips:e["Click or use delete key to delete the search term"]})}},_createButton:function(e,t,n){var i=document.createElement("button");i.addEventListener("click",n.bind(this),!1);var r=this;i.addEventListener("keydown",function(e){e.keyCode===s.KEY.ESCAPE&&r.hide()}),i.appendChild(document.createTextNode(e)),i.className="dismissButton parameterInlineButton",t.appendChild(i)},_createInfoImage:function(e,t){var n=document.createElement("img");return n.classList.add("replaceInfo"),n.addEventListener("click",function(){this._regExBox.checked=!this._regex,this.setOptions({regex:!this._regex}),this.find(!0),this._showReplaceInfo()}.bind(this)),t.appendChild(n),n},_handleInput:function(){return this._incremental&&this.find(!0,null,!0),!0},_handleKeyDown:function(e){var t=(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;return t&&70===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!1):(this.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||13===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,this._addRecentfind(this.getFindString()),this.find(13===e.keyCode?this._reverse?e.shiftKey:!e.shiftKey:!e.shiftKey),!1):t&&82===e.keyCode?(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,this.replace(),!1):27===e.keyCode?(this.hide(),!1):!0}}),{TextSearcher:a}}),define("orion/edit/dispatcher",["orion/edit/dispatcher"],function(){function e(e,t,n){if(this.serviceRegistry=e,this.editor=t,this.inputManager=n,this.contentTypeService=e.getService("orion.core.contentTypeRegistry"),!this.contentTypeService)throw new Error("Missing required service");this.serviceReferences={};var i=this;this.listener={onServiceAdded:function(e){i._onServiceAdded(e.serviceReference)},onServiceRemoved:function(e){i._onServiceRemoved(e.serviceReference)}},this.serviceRegistry.addEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.addEventListener("unregistering",this.listener.onServiceRemoved),this._init()}return e.prototype={_init:function(){var e=this;this.editor.getTextView()?this._wire(this.serviceRegistry):this.editor.addEventListener("TextViewInstalled",function(){e._wire(e.serviceRegistry)})},_wire:function(e){for(var t=e.getServiceReferences("orion.edit.model"),n=0;n<t.length;n++)this._wireServiceReference(t[n])},_wireServiceReference:function(e){var t=e.getProperty("contentType");if(void 0!==typeof t&&null!==t){var n=this;this.contentTypeService.isSomeExtensionOf(this.inputManager.getContentType(),t).then(function(t){t&&n._wireService(e,n.serviceRegistry.getService(e))})}},_wireService:function(e,t){for(var n=Object.keys(t),i=this.editor.getTextView(),r=0;r<n.length;r++){var o=n[r],s=t[o];if("on"===o.substr(0,2)&&"function"==typeof s){var a=o.substr("on".length);this._wireServiceMethod(e,t,s,i,a)}}this._initService(t,i)},_wireServiceMethod:function(e,t,n,i,r){var o=function(e){n(e).then()},s=e.getProperty("service.id");this.serviceReferences[s]=this.serviceReferences[s]||[],this.serviceReferences[s].push([i,r,o]),i.addEventListener(r,o)},_onServiceRemoved:function(e){var t=e.getProperty("service.id"),n=this.serviceReferences[t];if(n){for(var i=0;i<n.length;i++){var r=n[i],o=r[0],s=r[1],a=r[2];o.removeEventListener(s,a)}delete this.serviceReferences[t]}},_onServiceAdded:function(e){-1!==e.getProperty("objectClass").indexOf("orion.edit.model")&&this._wireServiceReference(e)},_initService:function(e,t){var n=e.onModelChanging;if("function"==typeof n){var i=t.getModel(),r=i.getText(),o={type:"Changing",text:r,start:0,removedCharCount:0,addedCharCount:r.length,removedLineCount:0,addedLineCount:i.getLineCount()};n.call(e,o)}}},{Dispatcher:e}}),define("orion/edit/typedefs",["orion/objects","orion/serviceTracker"],function(e,t){function n(e,t){throw new Error(e+" [service id: "+t.getProperty("service.id")+"]")}function i(e){this.props=Object.create(null),this.defs=Object.create(null),this.registration=null;var i=new t(e,"orion.core.typedef"),r=this;i.onServiceAdded=function(e){var t=e.getProperty("id"),i=e.getProperty("defs");t&&i||n("TypeDef registration missing required 'id' or 'defs'",e);var o={};e.getPropertyKeys().forEach(function(t){"defs"!==t&&"service.id"!==t&&"service.names"!==t&&"objectClass"!==t&&(o[t]=e.getProperty(t))}),r.props[t]=o,r.defs[t]=i,r._updateRegistration()},i.removedService=function(e){var t=e.getProperty("id");delete r.props[t],delete r.defs[t],r._updateRegistration()},i.open(),this.registration=e.registerService("orion.edit.context",{getTypeDef:this.getTypeDef.bind(this)},null),this._updateRegistration()}return e.mixin(i.prototype,{_updateRegistration:function(){this.registration&&this.registration.setProperties({typeDefs:this.getAllProperties()})},getTypeDef:function(e){return this.defs[e]||null},getProperties:function(e){return this.props[e]||null},getAllProperties:function(){return this.props}}),i}),define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"keyword.other.documentation.tag"},{match:"\\<\\S*\\>",name:"keyword.other.documentation.markup"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}}),define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["break","case","class","catch","continue","const","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","static","super","switch","this","throw","true","try","typeof","undefined","var","void","while","with","yield"],n=e.grammars;return n.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control.js"}]}),{id:n[n.length-1].id,grammars:n,keywords:t}}),define("orion/editor/stylers/text_x-java-source/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["abstract","boolean","break","byte","case","catch","char","class","continue","default","do","double","else","extends","false","final","finally","float","for","if","implements","import","instanceof","int","interface","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","void","volatile","while"],n=e.grammars;return n.push({id:"orion.java",contentTypes:["text/x-java-source"],patterns:[{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.control.java"}]}),{id:n[n.length-1].id,grammars:n,keywords:t}}),define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(e){var t=["alignment-adjust","alignment-baseline","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","appearance","azimuth","backface-visibility","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-top","border-width","border","bottom","box-align","box-decoration-break","box-direction","box-flex-group","box-flex","box-lines","box-ordinal-group","box-orient","box-pack","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color-profile","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue-after","cue-before","cue","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit-position","fit","flex-align","flex-flow","flex-inline-pack","flex-order","flex-pack","float-offset","float","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","font","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-height","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","line-stacking","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","mark-after","mark-before","mark","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline-color","outline-offset","outline-style","outline-width","outline","overflow-style","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","page-break-after","page-break-before","page-break-inside","page-policy","page","pause-after","pause-before","pause","perspective-origin","perspective","phonemes","pitch-range","pitch","play-during","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest-after","rest-before","rest","richness","right","rotation-point","rotation","ruby-align","ruby-overhang","ruby-position","ruby-span","size","speak-header","speak-numeral","speak-punctuation","speak","speech-rate","stress","string-set","table-layout","target-name","target-new","target-position","target","text-align-last","text-align","text-decoration","text-emphasis","text-height","text-indent","text-justify","text-outline","text-shadow","text-transform","text-wrap","top","transform-origin","transform-style","transform","transition-delay","transition-duration","transition-property","transition-timing-function","transition","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch-range","voice-pitch","voice-rate","voice-stress","voice-volume","volume","white-space-collapse","white-space","widows","width","word-break","word-spacing","word-wrap","z-index"],n=e.grammars;return n.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+t.join("|")+")\\b",name:"keyword.control.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",name:"constant.numeric.hex.css"}}}),{id:n[n.length-1].id,grammars:n,keywords:t}}),define("examples/editor/textStyler",["orion/editor/annotations","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_x-java-source/syntax","orion/editor/stylers/text_css/syntax"],function(e,t,n,i){function r(e,t){this.keywords=e,this.whitespacesVisible=t,this.setText("")}function o(){r.call(this,null,!0)}function s(e){r.call(this,null,e)}function a(){r.call(this,null,!1)}function l(e,t,n){this.commentStart="/*",this.commentEnd="*/";var i=[];switch(t){case"java":i=c;break;case"js":i=d;break;case"css":i=h}this.whitespacesVisible=this.spacesVisible=this.tabsVisible=!1,this.detectHyperlinks=!0,this.highlightCaretLine=!1,this.foldingEnabled=!0,this.detectTasks=!0,this._scanner=new r(i,this.whitespacesVisible),this._firstScanner=new a,this._commentScanner=new s(this.whitespacesVisible),this._whitespaceScanner=new o,"css"===t&&(this._scanner.isCSS=!0,this._firstScanner.isCSS=!0),this.view=e,this.annotationModel=n,this._bracketAnnotations=void 0;var l=this;this._listener={onChanged:function(e){l._onModelChanged(e)},onDestroy:function(e){l._onDestroy(e)},onLineStyle:function(e){l._onLineStyle(e)},onMouseDown:function(e){l._onMouseDown(e)},onSelection:function(e){l._onSelection(e)}};var u=e.getModel();u.getBaseModel&&(u=u.getBaseModel()),u.addEventListener("Changed",this._listener.onChanged),e.addEventListener("MouseDown",this._listener.onMouseDown),e.addEventListener("Selection",this._listener.onSelection),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),this._computeComments(),this._computeFolding(),e.redrawLines()}var d=t.keywords,c=n.keywords,h=i.keywords,u=1,p=2,f=3,g=4,m=5,v=6,y=7,_=8,C=9,w=10,b=11,x=12,S=13,L=14,E="{}()[]<>",k={styleClass:"comment"},T={styleClass:"comment"},A={styleClass:"comment block documentation"},N={styleClass:"keyword other documentation markup"},M={styleClass:"keyword other documentation task"},I={styleClass:"keyword other documentation tag"},D={styleClass:"string"},R={styleClass:"constant numeric"},P={styleClass:"keyword"},O={styleClass:"punctuation separator space",unmergeable:!0},B={styleClass:"punctuation separator tab",unmergeable:!0},F={styleClass:"meta annotation currentLine"};return r.prototype={getOffset:function(){return this.offset},getStartOffset:function(){return this.startOffset},getData:function(){return this.text.substring(this.startOffset,this.offset)},getDataLength:function(){return this.offset-this.startOffset},_default:function(e){switch(e){case 32:case 9:if(this.whitespacesVisible)return 32===e?b:w;do e=this._read();while(32===e||9===e);return this._unread(e),C;case 123:case 125:case 40:case 41:case 91:case 93:case 60:case 62:return e;default:var t=this.isCSS,n=this.offset-1;if(!t&&e>=48&&57>=e){for(var i=!1,r=!1,o=!1,s=e;;)if(e=this._read(),46!==e||i)if(101!==e||r){if(120===e&&48===s&&this.offset-n===2)i=r=o=!0;else if(!(e>=48&&57>=e||o&&(e>=65&&70>=e||e>=97&&102>=e)))break}else i=r=!0,e=this._read(),45!==e&&this._unread(e);else i=!0;return this._unread(e),f}if(e>=97&&122>=e||e>=65&&90>=e||95===e||45===e&&t){do e=this._read();while(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e||45===e&&t);this._unread(e);var a=this.keywords;if(a.length>0)for(var l=this.text.substring(n,this.offset),d=0;d<a.length;d++)if(this.keywords[d]===l)return p}return u}},_read:function(){return this.offset<this.text.length?this.text.charCodeAt(this.offset++):-1},_unread:function(e){-1!==e&&this.offset--},nextToken:function(){for(this.startOffset=this.offset;;){var e,t=this._read();switch(t){case-1:return null;case 47:if(t=this._read(),!this.isCSS&&47===t)for(;;)if(t=this._read(),-1===t||10===t||13===t)return this._unread(t),v;if(42===t){t=this._read();var n=y;for(42===t&&(n=_);;){for(;42===t;)if(t=this._read(),47===t)return n;if(-1===t)return this._unread(t),n;t=this._read()}}return this._unread(t),u;case 39:for(e=g;;)switch(t=this._read()){case 39:return e;case 13:case 10:case-1:return this._unread(t),e;case 92:switch(t=this._read()){case 10:e=m;break;case 13:e=m,t=this._read(),10!==t&&this._unread(t)}}break;case 34:for(e=g;;)switch(t=this._read()){case 34:return e;case 13:case 10:case-1:return this._unread(t),e;case 92:switch(t=this._read()){case 10:e=m;break;case 13:e=m,t=this._read(),10!==t&&this._unread(t)}}break;default:return this._default(t)}}},setText:function(e){this.text=e,this.offset=0,this.startOffset=0}},o.prototype=new r(null),o.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var e=this._read();switch(e){case-1:return null;case 32:return b;case 9:return w;default:do e=this._read();while(32!==e&&9!==e&&-1!==e);return this._unread(e),u}}},s.prototype=new r(null),s.prototype.setType=function(e){this._type=e},s.prototype.nextToken=function(){for(this.startOffset=this.offset;;){var e=this._read();switch(e){case-1:return null;case 32:case 9:if(this.whitespacesVisible)return 32===e?b:w;do e=this._read();while(32===e||9===e);return this._unread(e),C;case 60:if(this._type===_){do e=this._read();while(62!==e&&-1!==e);if(62===e)return x}return u;case 64:if(this._type===_){do e=this._read();while(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e);return this._unread(e),S}return u;case 84:if(79===(e=this._read()))if(68===(e=this._read()))if(79===(e=this._read())){if(e=this._read(),!(e>=97&&122>=e||e>=65&&90>=e||95===e||e>=48&&57>=e))return this._unread(e),L;this._unread(e)}else this._unread(e);else this._unread(e);else this._unread(e);default:do e=this._read();while(32!==e&&9!==e&&-1!==e&&60!==e&&64!==e&&84!==e);return this._unread(e),u}}},a.prototype=new r(null),a.prototype._default=function(e){for(;;)switch(e=this._read()){case 47:case 34:case 39:case-1:return this._unread(e),u}},l.prototype={destroy:function(){var e=this.view;if(e){var t=e.getModel();t.getBaseModel&&(t=t.getBaseModel()),t.removeEventListener("Changed",this._listener.onChanged),e.removeEventListener("MouseDown",this._listener.onMouseDown),e.removeEventListener("Selection",this._listener.onSelection),e.removeEventListener("Destroy",this._listener.onDestroy),e.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null}},setHighlightCaretLine:function(e){this.highlightCaretLine=e},setWhitespacesVisible:function(e,t){this.whitespacesVisible!==e&&(this.whitespacesVisible=e,this._scanner.whitespacesVisible=e,this._commentScanner.whitespacesVisible=e,t&&this.view.redraw())},setTabsVisible:function(e){this.tabsVisible!==e&&(this.tabsVisible=e,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setSpacesVisible:function(e){this.spacesVisible!==e&&(this.spacesVisible=e,this.setWhitespacesVisible(this.tabsVisible||this.spacesVisible,!1),this.view.redraw())},setDetectHyperlinks:function(e){this.detectHyperlinks=e},setFoldingEnabled:function(e){this.foldingEnabled=e},setDetectTasks:function(e){this.detectTasks=e},_binarySearch:function(e,t,n,i,r){var o;for(void 0===i&&(i=-1),void 0===r&&(r=e.length);r-i>1;)if(o=Math.floor((r+i)/2),t<=e[o].start)r=o;else{if(n&&t<e[o].end){r=o;break}i=o}return r},_computeComments:function(){var e=this.view.getModel();e.getBaseModel&&(e=e.getBaseModel()),this.comments=this._findComments(e.getText())},_computeFolding:function(){if(this.foldingEnabled){var t=this.view,n=t.getModel();if(n.getBaseModel){var i=this.annotationModel;if(i){i.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING);for(var r=[],o=n.getBaseModel(),s=this.comments,a=0;a<s.length;a++){var l=s[a],d=this._createFoldingAnnotation(n,o,l.start,l.end);d&&r.push(d)}i.replaceAnnotations(null,r)}}}},_createFoldingAnnotation:function(t,n,i,r){var o=n.getLineAtOffset(i),s=n.getLineAtOffset(r);return o===s?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(i,r,t)},_computeTasks:function(t,n,i){if(this.detectTasks){var r=this.annotationModel;if(r){var o=this.view,s=o.getModel(),a=s;s.getBaseModel&&(a=s.getBaseModel());for(var l=r.getAnnotations(n,i),d=[],c=e.AnnotationType.ANNOTATION_TASK;l.hasNext();){var h=l.next();h.type===c&&d.push(h)}var u=[],p=this._commentScanner;p.setText(a.getText(n,i));for(var f;f=p.nextToken();){var g=p.getStartOffset()+n;if(f===L){var m=a.getLineEnd(a.getLineAtOffset(g));t!==v&&(m=Math.min(m,i-this.commentEnd.length)),u.push(e.AnnotationType.createAnnotation(c,g,m,a.getText(g,m)))}}r.replaceAnnotations(d,u)}}},_getLineStyle:function(e){if(this.highlightCaretLine){var t=this.view,n=t.getModel(),i=t.getSelection();if(i.start===i.end&&n.getLineAtOffset(i.start)===e)return F}return null},_getStyles:function(e,t,n){e.getBaseModel&&(n=e.mapOffset(n));for(var i=n+t.length,r=[],o=n,s=this.comments,a=this._binarySearch(s,n,!0),l=a;l<s.length&&!(s[l].start>=i);l++){var d=s[l].start,c=s[l].end;d>o&&this._parse(t.substring(o-n,d-n),o,r);var h,u=s[l].type;switch(u){case _:h=A;break;case y:h=T;break;case m:h=D}var p=Math.max(o,d),f=Math.min(i,c);u!==_&&u!==y||!this.whitespacesVisible&&!this.detectHyperlinks?u===m&&this.whitespacesVisible?this._parseString(t.substring(p-n,f-n),p,r,D):r.push({start:p,end:f,style:h}):this._parseComment(t.substring(p-n,f-n),p,r,h,u),o=c}if(i>o&&this._parse(t.substring(o-n,i-n),o,r),e.getBaseModel)for(var g=0;g<r.length;g++){var v=r[g].end-r[g].start;r[g].start=e.mapOffset(r[g].start,!0),r[g].end=r[g].start+v}return r},_parse:function(e,t,n){var i=this._scanner;i.setText(e);for(var r;r=i.nextToken();){var o=i.getStartOffset()+t,s=null;switch(r){case p:s=P;break;case f:s=R;break;case m:case g:if(this.whitespacesVisible){this._parseString(i.getData(),o,n,D);continue}s=D;break;case _:this._parseComment(i.getData(),o,n,A,r);continue;case v:this._parseComment(i.getData(),o,n,k,r);continue;case y:this._parseComment(i.getData(),o,n,T,r);continue;case w:this.whitespacesVisible&&this.tabsVisible&&(s=B);break;case b:this.whitespacesVisible&&this.spacesVisible&&(s=O)}n.push({start:o,end:i.getOffset()+t,style:s})}},_parseComment:function(e,t,n,i,r){var o=this._commentScanner;o.setText(e),o.setType(r);for(var s;s=o.nextToken();){var a=o.getStartOffset()+t,l=i;switch(s){case w:this.whitespacesVisible&&this.tabsVisible&&(l=B);break;case b:this.whitespacesVisible&&this.spacesVisible&&(l=O);break;case x:l=N;break;case S:l=I;break;case L:l=M;break;default:this.detectHyperlinks&&(l=this._detectHyperlinks(o.getData(),a,n,l))}l&&n.push({start:a,end:o.getOffset()+t,style:l})}},_parseString:function(e,t,n,i){var r=this._whitespaceScanner;r.setText(e);for(var o;o=r.nextToken();){var s=r.getStartOffset()+t,a=i;switch(o){case w:this.whitespacesVisible&&this.tabsVisible&&(a=B);break;case b:this.whitespacesVisible&&this.spacesVisible&&(a=O)}a&&n.push({start:s,end:r.getOffset()+t,style:a})}},_detectHyperlinks:function(e,t,n,i){var r,o,s=null;if((r=e.indexOf("://"))>0){s=e;for(var a=r;a>0;){var l=s.charCodeAt(a-1);if(!(l>=97&&122>=l||l>=65&&90>=l||45===l||l>=48&&57>=l))break;a--}if(a>0){var d="\"\"''(){}[]<>";if(r=d.indexOf(s.substring(a-1,a)),-1!==r&&0===(1&r)&&-1!==(r=s.lastIndexOf(d.substring(r+1,r+2)))){var c=r;return o=this._clone(i),o.tagName="a",o.attributes={href:s.substring(a,c)},n.push({start:t,end:t+a,style:i}),n.push({start:t+a,end:t+c,style:o}),n.push({start:t+c,end:t+e.length,style:i}),null}}}else 0===e.toLowerCase().indexOf("bug#")&&(s="https://bugs.eclipse.org/bugs/show_bug.cgi?id="+parseInt(e.substring(4),10));return s?(o=this._clone(i),o.tagName="a",o.attributes={href:s},o):i},_clone:function(e){if(!e)return e;var t={};for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t[n]=i}return t},_findComments:function(e,t){t=t||0;var n,i=this._firstScanner;i.setText(e);for(var r=[];n=i.nextToken();)(n===y||n===_||n===m)&&r.push({start:i.getStartOffset()+t,end:i.getOffset()+t,type:n}),(n===v||n===y||n===_)&&this._computeTasks(n,i.getStartOffset()+t,i.getOffset()+t);return r},_findMatchingBracket:function(e,t){var n=E,i=e.getText(t,t+1),r=n.indexOf(i,0);if(-1===r)return-1;var o;o=1&r?n.substring(r-1,r):n.substring(r+1,r+2);var s=e.getLineAtOffset(t),a=e.getLine(s),l=e.getLineStart(s),d=e.getLineEnd(s);n=this._findBrackets(i,o,a,l,l,d);for(var c=0;c<n.length;c++){var h=n[c]>=0?1:-1;if(n[c]*h-1===t){var u=1;if(1&r){for(c--;c>=0;c--)if(h=n[c]>=0?1:-1,u+=h,0===u)return n[c]*h-1;for(s-=1;s>=0;){a=e.getLine(s),l=e.getLineStart(s),d=e.getLineEnd(s),n=this._findBrackets(i,o,a,l,l,d);for(var p=n.length-1;p>=0;p--)if(h=n[p]>=0?1:-1,u+=h,0===u)return n[p]*h-1;s--}}else{for(c++;c<n.length;c++)if(h=n[c]>=0?1:-1,u+=h,0===u)return n[c]*h-1;s+=1;for(var f=e.getLineCount();f>s;){a=e.getLine(s),l=e.getLineStart(s),d=e.getLineEnd(s),n=this._findBrackets(i,o,a,l,l,d);for(var g=0;g<n.length;g++)if(h=n[g]>=0?1:-1,u+=h,0===u)return n[g]*h-1;s++}}break}}return-1},_findBrackets:function(e,t,n,i,r,o){for(var s,a=[],l=e.charCodeAt(0),d=t.charCodeAt(0),c=r,h=this._scanner,u=this.comments,p=this._binarySearch(u,r,!0),f=p;f<u.length&&!(u[f].start>=o);f++){var g=u[f].start,m=u[f].end;if(g>c)for(h.setText(n.substring(c-r,g-r));s=h.nextToken();)s===l?a.push(h.getStartOffset()+c-r+i+1):s===d&&a.push(-(h.getStartOffset()+c-r+i+1));
c=m}if(o>c)for(h.setText(n.substring(c-r,o-r));s=h.nextToken();)s===l?a.push(h.getStartOffset()+c-r+i+1):s===d&&a.push(-(h.getStartOffset()+c-r+i+1));return a},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){e.textView===this.view&&(e.style=this._getLineStyle(e.lineIndex)),e.ranges=this._getStyles(e.textView.getModel(),e.lineText,e.lineStart)},_onSelection:function(t){var n,i=t.oldValue,r=t.newValue,o=this.view,s=o.getModel();if(this.highlightCaretLine){var a=s.getLineAtOffset(i.start);n=s.getLineAtOffset(r.start);var l=r.start===r.end,d=i.start===i.end;a===n&&d&&l||(d&&o.redrawLines(a,a+1),a===n&&d||!l||o.redrawLines(n,n+1))}if(this.annotationModel){var c,h,u=this._bracketAnnotations;if(r.start===r.end&&(h=o.getCaretOffset())>0){var p=h-1;s.getBaseModel&&(p=s.mapOffset(p),s=s.getBaseModel());var f=this._findMatchingBracket(s,p);-1!==f&&(c=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,f,f+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,p,p+1)])}this._bracketAnnotations=c,this.annotationModel.replaceAnnotations(u,c)}},_onMouseDown:function(e){if(2===e.clickCount){var t=this.view,n=t.getModel(),i=t.getOffsetAtLocation(e.x,e.y);if(i>0){var r=i-1,o=n;n.getBaseModel&&(r=n.mapOffset(r),o=n.getBaseModel());var s=this._findMatchingBracket(o,r);if(-1!==s){e.preventDefault();var a=s;n.getBaseModel&&(a=n.mapOffset(a,!0)),i>a&&(i--,a++),t.setSelection(a,i)}}}},_onModelChanged:function(t){var n,i=t.start,r=t.removedCharCount,o=t.addedCharCount,s=o-r,a=this.view,l=a.getModel(),d=l.getBaseModel?l.getBaseModel():l,c=i+r,h=d.getCharCount(),u=this.comments.length,p=d.getLineStart(d.getLineAtOffset(i)),f=this._binarySearch(this.comments,p,!0),g=this._binarySearch(this.comments,c,!1,f-1,u);u>f&&this.comments[f].start<=p&&p<this.comments[f].end?(n=this.comments[f].start,n>i&&(n+=s)):n=f===u&&u>0&&h-s===this.comments[u-1].end?this.comments[u-1].start:p;var m;u>g?(m=this.comments[g].end,m>i&&(m+=s),g+=1):(g=u,m=h);var v,y,_=d.getText(n,m),C=this._findComments(_,n);for(y=f;y<this.comments.length;y++)v=this.comments[y],v.start>i&&(v.start+=s),v.start>i&&(v.end+=s);var w=g-f!==C.length;if(!w)for(y=0;y<C.length;y++){v=this.comments[f+y];var b=C[y];if(v.start!==b.start||v.end!==b.end||v.type!==b.type){w=!0;break}}var x=[f,g-f].concat(C);if(Array.prototype.splice.apply(this.comments,x),w){var S=n,L=m;l!==d&&(S=l.mapOffset(S,!0),L=l.mapOffset(L,!0)),a.redrawRange(S,L)}if(this.foldingEnabled&&d!==l&&this.annotationModel){for(var E,k=this.annotationModel,T=k.getAnnotations(n,m),A=[],N=[];T.hasNext();)if(E=T.next(),E.type===e.AnnotationType.ANNOTATION_FOLDING){for(N.push(E),y=0;y<C.length&&(E.start!==C[y].start||E.end!==C[y].end);y++);if(y===C.length)A.push(E),E.expand();else{var M=E.start,I=E.end;if(M>i&&(M-=s),I>i&&(I-=s),i>=M&&I>i&&c>=M&&I>c){var D=d.getLineAtOffset(E.start),R=d.getLineAtOffset(E.end);D!==R?E.expanded||E.expand():k.removeAnnotation(E)}}}var P=[];for(y=0;y<C.length;y++){v=C[y];for(var O=0;O<N.length&&(N[O].start!==v.start||N[O].end!==v.end);O++);O===N.length&&(E=this._createFoldingAnnotation(l,d,v.start,v.end),E&&P.push(E))}k.replaceAnnotations(A,P)}}},{TextStyler:l}}),define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget"],function(e,t){function n(e,t){this._patternManager=new i(e,t)}function i(e,t){this._unnamedCounter=0,this._patterns=[],this._rootId=t,e.forEach(function(e){this._addRepositoryPatterns(e.repository||{},e.id),this._addPatterns(e.patterns||[],e.id)}.bind(this))}function r(e,t,n,i,r,o,s){this.start=e.start,this.end=e.end,this.contentStart=e.contentStart,this.contentEnd=e.contentEnd,this.name=t,this.typeId=n,this.styler=i,this.parent=o,s&&s(this),this._subBlocks=i.computeBlocks(r,r.getText(this.start,this.end),this,this.start,null,null,null)}function o(e){this._styler=e}function s(t,n,i){this._whitespacesVisible=this._spacesVisible=this._tabsVisible=!1,this._highlightCaretLine=!1,this._foldingEnabled=!0,this._detectTasks=!0,this._view=t,this._annotationModel=n,this._stylerAdapter=i,this._stylerAdapter.setStyler(this),this._accessor=new o(this),this._bracketAnnotations;var r=this;this._listener={onChanged:function(e){r._onModelChanged(e)},onDestroy:function(e){r._onDestroy(e)},onLineStyle:function(e){r._onLineStyle(e)},onMouseDown:function(e){r._onMouseDown(e)},onSelection:function(e){r._onSelection(e)}};var s=t.getModel();s.getBaseModel&&(s=s.getBaseModel()),s.addEventListener("Changed",this._listener.onChanged),t.addEventListener("MouseDown",this._listener.onMouseDown),t.addEventListener("Selection",this._listener.onSelection),t.addEventListener("Destroy",this._listener.onDestroy),t.addEventListener("LineStyle",this._listener.onLineStyle);var a=s.getCharCount(),l={start:0,contentStart:0,end:a,contentEnd:a};if(this._rootBlock=this._stylerAdapter.createBlock(l,this,s,null),n){var d=[];n.removeAnnotations(e.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),t.getModel(),d),this._detectTasks&&(n.removeAnnotations(e.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,s,d)),n.replaceAnnotations([],d)}t.redrawLines()}var a=function(e,t,n,i,r){var o;for(void 0===i&&(i=-1),void 0===r&&(r=e.length);r-i>1;)if(o=Math.floor((r+i)/2),t<=e[o].start)r=o;else{if(n&&t<e[o].end){r=o;break}i=o}return r},l=function(e,t){return new n(e,t)};return n.prototype={blockSpansBeyondEnd:function(e){return e.pattern.regexEnd===this._eolRegex},computeBlocks:function(e,t,n,i,r,o,s){if(!t)return[];var a=[],l=[];if(r=r||0,o=o||1/0,s=s||1/0,n.blockPatterns.forEach(function(e){var n=this._findMatch(e.regexBegin||e.regex,t,r);n&&l.push({result:n,pattern:e})}.bind(this)),!l.length)return a;l.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.pattern.index<t.pattern.pattern.index?-1:1});for(var d=0;l.length>0;){var c=l[0];if(l.splice(0,1),o<c.result.index)break;if(c.result.index<d)this._updateMatch(c,t,l,d,o);else{var h=i+c.result.index,u=c.result.index,p=null,f=c.pattern.regexEnd;if(f){u+=c.result[0].length;var g=c.pattern,m=this._substituteCaptureValues(f,c.result);m!==f&&(g={pattern:g.pattern,regexBegin:g.regexBegin,regexEnd:m},f=m);for(var v=u;!p;){var y=this._findMatch(f,t,v);y||(this._eolRegex.lastIndex=0,y=this._eolRegex.exec(t),g={pattern:g.pattern,regexBegin:g.regexBegin,regexEnd:this._eolRegex});var _=this.createBlock({start:h,end:i+y.index+y[0].length,contentStart:i+u,contentEnd:i+y.index},n.styler,e,n,g),C=_.getBlocks();(!C.length||C[C.length-1].end<=y.index+i)&&(p=_),v=y.index+y[0].length}}else p=this.createBlock({start:h,end:h+c.result[0].length,contentStart:h,contentEnd:h+c.result[0].length},n.styler,e,n,c.pattern);if(a.push(p),a.length===s||o<=p.end)break;d=p.end-i,this._updateMatch(c,t,l,d,o)}}return a},computeStyle:function(e,t,n){if(!e.pattern)return null;var i={start:e.start,end:e.end,style:e.pattern.pattern.name};if(e.contentStart<=n&&n<e.contentEnd)return e.pattern.pattern.contentName?{start:e.contentStart,end:e.contentEnd,style:e.pattern.pattern.contentName}:i;var r,o,s,l;if(n<e.contentStart){if(o=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures,!o)return i;r=e.pattern.regexBegin,s=t.getText(e.start,e.contentStart),l=e.start}else{if(o=e.pattern.pattern.endCaptures||e.pattern.pattern.captures,!o)return i;r=e.pattern.regexEnd,s=t.getText(e.contentEnd,e.end),l=e.contentEnd}r.lastIndex=0;var d=r.exec(s);if(d){var c=[];this._getCaptureStyles(d,o,l,c);var h=c[a(c,n,!0)];if(h&&h.start<=n&&n<h.end)return h}return i},createBlock:function(e,t,n,i,o){return new r(e,o?o.pattern.name:null,o?o.pattern.id:null,t,n,i,function(e){e.pattern=o,e.linePatterns=[],e.blockPatterns=[],e.enclosurePatterns={},this._initPatterns(this._patternManager,e)}.bind(this))},getBlockContentStyleName:function(e){return e.pattern.pattern.contentName||e.pattern.pattern.name},getBlockEndStyle:function(e,t,n,i){var r;if(e.pattern.regexEnd&&(r=this._findMatch(e.pattern.regexEnd,t,0))){var o=e.pattern.pattern.endCaptures||e.pattern.pattern.captures;o?this._getCaptureStyles(r,o,n-r[0].length,i):e.pattern.pattern.name&&i.push({start:n-r[0].length,end:n,style:e.pattern.pattern.name})}return r?r[0]:null},getBlockStartStyle:function(e,t,n,i){var r;if(e.pattern.regexBegin&&(r=this._findMatch(e.pattern.regexBegin,t,0))){var o=e.pattern.pattern.beginCaptures||e.pattern.pattern.captures;o?this._getCaptureStyles(r,o,n,i):i.push({start:n,end:n+r[0].length,style:e.pattern.pattern.name})}return r?r[0]:null},getBracketMatch:function(e,t){for(var n,i=Object.keys(e.enclosurePatterns),r=0;r<i.length;r++){var o=e.enclosurePatterns[i[r]],s=this._findMatch(o.regex,t,0);if(s&&0===s.index){n=o;break}}if(!n)return null;var a,l=!1;-1!==n.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(l=!0,a=n.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):a=n.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);var d=e.enclosurePatterns[a];return d?{beginName:n.pattern.name,endName:a,atStart:l}:null},parse:function(e,t,n,i,r){if(e){var o=n.linePatterns;if(o){var s=[];o.forEach(function(t){var n=t.regex||t.regexBegin;n.oldLastIndex=n.lastIndex;var i=this._findMatch(n,e,0);i&&s.push({result:i,pattern:t})}.bind(this)),s.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.pattern.index<t.pattern.pattern.index?-1:1});for(var a=0;s.length>0;){var l=s[0];if(s.splice(0,1),l.result.index<a)this._updateMatch(l,e,s,a);else{var d,c,h=l.result.index,u=[];if(l.pattern.regex){c=l.result,d=h+c[0].length;var p={start:t+h,end:t+d,style:l.pattern.pattern.name};if(!r){l.pattern.pattern.captures&&this._getCaptureStyles(c,l.pattern.pattern.captures,t+h,u),u.sort(function(e,t){return e.start<t.start?-1:e.start>t.start?1:0});for(var f=0;f<u.length-1;f++)if(u[f+1].start<u[f].end){var g={start:u[f+1].end,end:u[f].end,style:u[f].style};u[f].end=u[f+1].start,u.splice(f+2,0,g)}}this._mergeStyles(p,u,i)}else{var m=l.pattern.regexEnd;m=this._substituteCaptureValues(m,l.result),c=this._findMatch(m,e,l.result.index+l.result[0].length),c||(this._eolRegex.lastIndex=0,c=this._eolRegex.exec(e)),d=c.index+c[0].length,i.push({start:t+h,end:t+d,style:l.pattern.pattern.name})}a=c.index+c[0].length,this._updateMatch(l,e,s,a)}}o.forEach(function(e){var t=e.regex||e.regexBegin;t.lastIndex=t.oldLastIndex})}}},setStyler:function(){},verifyBlock:function(e,t,n,i){var r=null,o=[],s=n.parent;if(s.blockPatterns.forEach(function(e){var n=this._findMatch(e.regexBegin||e.regex,t,0);n&&o.push({result:n,pattern:e})}.bind(this)),o.sort(function(e,t){return!e.result.index&&t.result.index?-1:e.result.index&&!t.result.index?1:e.result.index||t.result.index?0:e.pattern.pattern.index<t.pattern.pattern.index?-1:1}),o.length&&0===o[0].result.index&&o[0].pattern.pattern.id===n.pattern.pattern.id){var a=o[0],l=a.pattern.regexEnd;if(l){l=this._substituteCaptureValues(l,a.result);for(var d=a.result[0].length,c=this._findMatch(l,t,d);null===r&&c&&n.start+c.index!==n.contentEnd+i;){var h=this.computeBlocks(e,t,n,n.start,d,c.index+1,null);!h.length||h[h.length-1].end<=n.start+c.index?r=!1:h.length?(d=h[h.length-1].end-n.start,c=this._findMatch(l,t,d)):c=null}c||(this._eolRegex.lastIndex=0,c=this._eolRegex.exec(t),r=n.start+c.index===n.end+i)}else r=n.start+a.result[0].length===n.end+i}else r=!1;return null!==r?r:!0},_findMatch:function(e,t,n,i){var r=n,o=e.lastIndex;this._linebreakRegex.lastIndex=n;var s,a,l=this._linebreakRegex.exec(t);if(e.lastIndex=0,l){for(var d=l.index;0<=--d;){var c=t.charAt(d);if(c===this._NEWLINE||c===this._CR)break}s=t.substring(d+1,l.index+l[1].length),e.lastIndex=a=l.index-d-1}for(;l&&l.index<t.length;){var h;if(i){var u=e.lastIndex;e.test(s)&&(e.lastIndex=u,h=e.exec(s))}else h=e.exec(s);if(h)return h.index+=r,h.index-=a,e.lastIndex=o,h;a=0,r+=l[0].length,l=this._linebreakRegex.exec(t),l&&(s=l[1],e.lastIndex=0)}return e.lastIndex=o,null},_getCaptureStyles:function(e,t,n,i){if(t[0])return void i.push({start:n,end:n+e[0].length,style:t[0].name});for(var r=0,o=1;o<e.length;o++)if(e[o]){var s=t[o];if(s){var a=n+r;i.push({start:a,end:a+e[o].length,style:s.name})}r+=e[o].length}},_initPatterns:function(e,t){if(t.pattern&&t.pattern.pattern.linePatterns)return t.linePatterns=t.pattern.pattern.linePatterns,t.blockPatterns=t.pattern.pattern.blockPatterns,void(t.enclosurePatterns=t.pattern.pattern.enclosurePatterns);var n=e.getPatterns(t.pattern?t.pattern.pattern:null),i=function(e){var t="string"==typeof e?e:e.match,n=this._ignoreCaseRegex.exec(t),i=this._FLAGS;return n&&(t=t.substring(n[0].length),i+="i"),new RegExp(t,i)}.bind(this),r=-1,o=0;n.forEach(function(e){var n;!e.match||e.begin||e.end?!e.match&&e.begin&&e.end&&(r=o,n={regexBegin:i(e.begin),regexEnd:i(e.end),pattern:e},t.linePatterns.push(n)):(n={regex:i(e.match),pattern:e},t.linePatterns.push(n),!e.name||0!==e.name.indexOf("punctuation.section")||-1===e.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)&&-1===e.name.indexOf(this._PUNCTUATION_SECTION_END)||(t.enclosurePatterns[e.name]=n)),o++}.bind(this)),t.blockPatterns=t.linePatterns.slice(0,r+1),t.pattern&&(t.pattern.pattern.enclosurePatterns=t.enclosurePatterns,t.pattern.pattern.linePatterns=t.linePatterns,t.pattern.pattern.blockPatterns=t.blockPatterns)},_mergeStyles:function(e,t,n){var i=e.start;t.forEach(function(t){i<=t.start&&n.push({start:i,end:t.start,style:e.style}),n.push(t),i=t.end}),i<e.end&&n.push({start:i,end:e.end,style:e.style})},_substituteCaptureValues:function(e,t){var n=e.toString();if(this._captureReferenceRegex.lastIndex=0,!this._captureReferenceRegex.test(n))return e;this._captureReferenceRegex.lastIndex=0;for(var i=this._captureReferenceRegex.exec(n);i;)n=n.replace(i[0],t[i[1]]||""),this._captureReferenceRegex.lastIndex=0,i=this._captureReferenceRegex.exec(n);return new RegExp(n.substring(1,n.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(e,t,n,i,r){var o=e.pattern.regex?e.pattern.regex:e.pattern.regexBegin;r=r||1/0;var s=this._findMatch(o,t,i,!0);if(s&&s.index<r){e.result=s;for(var a=0;a<n.length;a++)if(s.index<n[a].result.index||s.index===n[a].result.index&&e.pattern.pattern.index<n[a].pattern.pattern.index)return void n.splice(a,0,e);n.push(e)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"},i.prototype={getPatterns:function(e){var t;e?(t="string"==typeof e?e:e.qualifiedId,t+="#"):t=this._rootId+"#"+this._NO_ID;var n=[0],i={},r=new RegExp("^"+t+"[^#]+$");this._patterns.forEach(function(e){r.test(e.qualifiedId)&&(e.include?this._processInclude(e,n,i):(e.index=n[0]++,i[e.id]=e))}.bind(this));var o=[],s=Object.keys(i);return s.forEach(function(e){o.push(i[e])}),o},_addPattern:function(e,t,n){e.parentId=n,e.id=t,e.qualifiedId=e.parentId+"#"+e.id,this._patterns.push(e),e.patterns&&!e.include&&this._addPatterns(e.patterns,e.qualifiedId)},_addPatterns:function(e,t){e.forEach(function(e){this._addPattern(e,this._NO_ID+this._unnamedCounter++,t)}.bind(this))},_addRepositoryPatterns:function(e,t){var n=Object.keys(e);n.forEach(function(n){this._addPattern(e[n],n,t)}.bind(this))},_processInclude:function(e,t,n){var i,r=e.include.indexOf("#");i=new RegExp(0===r?"^"+e.qualifiedId.substring(0,e.qualifiedId.indexOf("#"))+e.include+"$":-1===r?"^"+e.include+"#"+this._NO_ID+"[^#]+$":"^"+e.include+"$"),this._patterns.forEach(function(e){i.test(e.qualifiedId)&&(e.include?this._processInclude(e,t,n):n[e.id]||(e.index=t[0]++,n[e.id]=e))}.bind(this))},_NO_ID:"NoID"},r.prototype={adjustBounds:function(e,t){e<this.start&&(this.start+=t),e<this.contentStart&&(this.contentStart+=t),e<=this.end&&(this.end+=t),e<=this.contentEnd&&(this.contentEnd+=t),this._subBlocks.forEach(function(n){e<=n.end&&n.adjustBounds(e,t)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(e){return a(this.getBlocks(),e,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}},o.prototype={getStyles:function(e){return this._styler.getStyles(e)}},s.prototype={computeBlocks:function(e,t,n,i,r,o,s){return this._stylerAdapter.computeBlocks(e,t,n,i,r,o,s)},destroy:function(){if(this._view){var e=this._view.getModel();e.getBaseModel&&(e=e.getBaseModel()),e.removeEventListener("Changed",this._listener.onChanged),this._view.removeEventListener("MouseDown",this._listener.onMouseDown),this._view.removeEventListener("Selection",this._listener.onSelection),this._view.removeEventListener("Destroy",this._listener.onDestroy),this._view.removeEventListener("LineStyle",this._listener.onLineStyle),this._view=null}},getBlockAtIndex:function(e){return this._findBlock(this._rootBlock,e)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(e){var t=[],n=this._view.getModel();n.getBaseModel&&(n=n.getBaseModel());var i=this._findBlock(this._rootBlock,e),r=n.getLineAtOffset(e),o=n.getLine(r),s=[];this._stylerAdapter.parse(o,n.getLineStart(r),i,s);var l=s[a(s,e,!0)];for(l&&l.start<=e&&e<l.end&&t.push(l);i;)l=this._stylerAdapter.computeStyle(i,n,e),l&&t.splice(0,0,l),i=i.parent;return t},setDetectHyperlinks:function(){},setDetectTasks:function(e){this._detectTasks=e},setFoldingEnabled:function(e){this._foldingEnabled=e},setHighlightCaretLine:function(e){this._highlightCaretLine=e},setSpacesVisible:function(e){this._spacesVisible!==e&&(this._spacesVisible=e,this.setWhitespacesVisible(this._tabsVisible||this._spacesVisible,!1),this._view.redraw())},setTabsVisible:function(e){this._tabsVisible!==e&&(this._tabsVisible=e,this.setWhitespacesVisible(this._tabsVisible||this._spacesVisible,!1),this._view.redraw())},setWhitespacesVisible:function(e,t){this._whitespacesVisible!==e&&(this._whitespacesVisible=e,t&&this._view.redraw())},_computeFolding:function(e,t,n){if(t.getBaseModel){var i=t.getBaseModel();e.forEach(function(e){var r=this._createFoldingAnnotation(t,i,e.start,e.end);r&&n.push(r),this._computeFolding(e.getBlocks(),t,n)}.bind(this))}},_computeTasks:function(t,n,i,r,o){if(r=r||t.start,o=o||t.end,t.start<=o&&r<=t.end){if(!this._annotationModel)return;var s=e.AnnotationType.ANNOTATION_TASK;if(t.name&&0===t.name.indexOf("comment")){var a=[];this._stylerAdapter.parse(n.getText(t.contentStart,t.end),t.contentStart,t,a,!0);for(var l=0;l<a.length;l++)"meta.annotation.task.todo"===a[l].style&&r<=a[l].start&&a[l].end<=o&&i.push(e.AnnotationType.createAnnotation(s,a[l].start,a[l].end,n.getText(a[l].start,a[l].end)))}t.getBlocks().forEach(function(e){this._computeTasks(e,n,i,r,o)}.bind(this))}},_createFoldingAnnotation:function(t,n,i,r){var o=n.getLineAtOffset(i),s=n.getLineAtOffset(r);return o===s?null:o+1===s&&n.getLineStart(s)===n.getLineEnd(s)?null:new(e.AnnotationType.getType(e.AnnotationType.ANNOTATION_FOLDING))(i,r,t)},_findBlock:function(e,t){var n=e.getBlocks();if(!n.length)return e;var i=a(n,t,!0);return i<n.length&&n[i].start<=t&&t<n[i].end?this._findBlock(n[i],t):e},_findBrackets:function(e,t,n,i,r){for(var o=[],s=[],l=i,d=t.getBlocks(),c=a(d,i,!0),h=c;h<d.length&&!(d[h].start>=r);h++){var u=d[h].start,p=d[h].end;u>l&&(this._stylerAdapter.parse(n.substring(l-i,u-i),l,t,s),s.forEach(function(t){0===t.style.indexOf(e.beginName)?o.push(t.start+1):0===t.style.indexOf(e.endName)&&o.push(-(t.start+1))}),s=[]),l=p}return r>l&&(this._stylerAdapter.parse(n.substring(l-i,r-i),l,t,s),s.forEach(function(t){t.style&&(0===t.style.indexOf(e.beginName)?o.push(t.start+1):0===t.style.indexOf(e.endName)&&o.push(-(t.start+1)))})),o},_findMatchingBracket:function(e,t,n){var i=e.getLineAtOffset(n),r=e.getLineEnd(i),o=e.getText(n,r),s=this._stylerAdapter.getBracketMatch(t,o);if(!s)return-1;for(var a=e.getLine(i),l=e.getLineStart(i),d=this._findBrackets(s,t,a,l,r),c=0;c<d.length;c++){var h=d[c]>=0?1:-1;if(d[c]*h-1===n){var u=1;if(s.atStart){for(c++;c<d.length;c++)if(h=d[c]>=0?1:-1,u+=h,0===u)return d[c]*h-1;i+=1;for(var p=e.getLineCount();p>i;){a=e.getLine(i),l=e.getLineStart(i),r=e.getLineEnd(i),d=this._findBrackets(s,t,a,l,r);for(var f=0;f<d.length;f++)if(h=d[f]>=0?1:-1,u+=h,0===u)return d[f]*h-1;i++}}else{for(c--;c>=0;c--)if(h=d[c]>=0?1:-1,u+=h,0===u)return d[c]*h-1;for(i-=1;i>=0;){a=e.getLine(i),l=e.getLineStart(i),r=e.getLineEnd(i),d=this._findBrackets(s,t,a,l,r);for(var g=d.length-1;g>=0;g--)if(h=d[g]>=0?1:-1,u+=h,0===u)return d[g]*h-1;i--}}break}}return-1},_getLineStyle:function(e){if(this._highlightCaretLine){var t=this._view.getModel(),n=this._view.getSelection();if(n.start===n.end&&t.getLineAtOffset(n.start)===e)return this._caretLineStyle}return null},_getStyles:function(e,t,n,i){t.getBaseModel&&(i=t.mapOffset(i));for(var r=i+n.length,o=[],s=i,l=e.getBlocks(),d=a(l,i,!0),c=d;c<l.length&&!(l[c].start>=r);c++){var h=l[c].start,u=l[c].end;h>s&&this._stylerAdapter.parse(n.substring(s-i,h-i),s,e,o);var p=Math.max(s,h);if(p===h){var f=this._stylerAdapter.getBlockStartStyle(l[c],n.substring(p-i),p,o);f&&(p+=f.length)}var g=Math.min(r,u),m=[];if(g===u){var v=n.substring(g-s-(l[c].end-l[c].contentEnd)),y=this._stylerAdapter.getBlockEndStyle(l[c],v,g,m);y&&(g-=y.length)}var _=this._getStyles(l[c],t,n.substring(p-i,g-i),p),C=this._stylerAdapter.getBlockContentStyleName(l[c]);if(C){var w=p;_.forEach(function(e){e.start-w&&o.push({start:w,end:e.start,style:C}),e.mergeable&&(e.style+=","+C),o.push(e),w=e.end}),g-w&&o.push({start:w,end:g,style:C})}else o=o.concat(_);o=o.concat(m),s=u}if(r>s&&this._stylerAdapter.parse(n.substring(s-i,r-i),s,e,o),t.getBaseModel)for(var b=0;b<o.length;b++){var x=o[b].end-o[b].start;o[b].start=t.mapOffset(o[b].start,!0),o[b].end=o[b].start+x}return o},_isRenderingWhitespace:function(){return this._whitespacesVisible&&(this._tabsVisible||this._spacesVisible)},_onDestroy:function(){this.destroy()},_onLineStyle:function(e){e.textView===this._view&&(e.style=this._getLineStyle(e.lineIndex)),e.ranges=this._getStyles(this._rootBlock,e.textView.getModel(),e.lineText,e.lineStart),e.ranges.forEach(function(e){e.style&&(e.style={styleClass:e.style.replace(/\./g," ")})}),this._isRenderingWhitespace()&&(this._spacesVisible&&this._spliceStyles(this._spacePattern,e.ranges,e.lineText,e.lineStart),this._tabsVisible&&this._spliceStyles(this._tabPattern,e.ranges,e.lineText,e.lineStart))},_onModelChanged:function(t){for(var n,i,r,o,s,l,d,c=t.start,h=t.removedCharCount,u=t.addedCharCount,p=u-h,f=this._view.getModel(),g=f.getBaseModel?f.getBaseModel():f,m=c+h,v=g.getCharCount(),y=g.getLineStart(g.getLineAtOffset(c)),_=this._findBlock(this._rootBlock,c);;)if(r=_.parent,n||!r||(s=g.getText(_.start,Math.min(v,_.end+p+1)),this._stylerAdapter.verifyBlock(g,s,_,p))){i=_.getBlocks();var C=i.length,w=a(i,y,!0),b=a(i,m,!1,w-1,C);if(n=!1,w&&i.length&&i[w-1].end===c){s=g.getText(i[w-1].start,Math.min(v,c+1));var x=this.computeBlocks(g,s,_,i[w-1].start,null,null,null);x.length&&x[0].end!==i[w-1].end&&(w--,n=!0)}C>w&&i[w].start<=y&&(y<i[w].end||n)?(d=i[w].start,d>c&&(d+=p)):w===C&&C>0&&_.end-p===i[C-1].end?(d=i[--w].start,d>c&&(d+=p)):d=Math.max(y,_.contentStart),l=C>b?i[b].end:_.contentEnd,l>=c&&(l+=p),l=Math.min(l,v-1),s=g.getText(d,l+1);var S=this.computeBlocks(g,s,_,d,null,null,null);if(C>b){if(S.length&&S[S.length-1].end===l&&S[S.length-1].typeId===i[b].typeId)break;if(S.length&&this._stylerAdapter.blockSpansBeyondEnd(S[S.length-1])){b++;for(var L=S[S.length-1].getBlocks(),E=(L.length?L[L.length-1]:S[S.length-1]).typeId;C>b;){if(i[b].typeId===E){var k=i[b].end+p;k=Math.min(k,v-1),s=g.getText(d,k+1);var T=this.computeBlocks(g,s,_,d,null,null,null);if(T.length&&T[T.length-1].end===k){l=k,S=T;break}}b++}if(C>b)break}}else if(!S.length||S[S.length-1].end<=_.contentEnd+p)break;if(!r){l=v,b=C,s=g.getText(d,l),S=this.computeBlocks(g,s,_,d,null,null,null);break}_=r,o=!0}else _=r;this._rootBlock.adjustBounds(c,p),b=Math.min(b+1,C);var A;if(o||(o=b-w!==S.length),!o)for(var N=0;N<S.length;N++){A=i[w+N];var M=S[N];if(A.start!==M.start||A.end!==M.end||A.typeId!==M.typeId){o=!0;break}}this.dispatchEvent(i.length||S.length?{type:"BlocksChanged",old:i.slice(w,b),"new":S}:{type:"BlocksChanged",old:[_],"new":[_]});var I=[w,b-w].concat(S);if(Array.prototype.splice.apply(i,I),o){var D=d,R=l;f!==g&&(D=f.mapOffset(D,!0),R=f.mapOffset(R,!0)),this._view.redrawRange(D,R)}if(this._annotationModel){for(var P=[],O=[],B=[],F=this._annotationModel.getAnnotations(d,l),V=this._foldingEnabled&&g!==f,j=_.parent||_;F.hasNext();){var U=F.next();if(V&&U.type===e.AnnotationType.ANNOTATION_FOLDING)if(B.push(U),A=this._findBlock(j,U.start),A&&U.start===A.start&&U.end===A.end){var H=U.start,W=U.end;if(H>c&&(H-=p),W>c&&(W-=p),c>=H&&W>c&&m>=H&&W>m){var $=g.getLineAtOffset(U.start),K=g.getLineAtOffset(U.end);$!==K?U.expanded||U.expand():P.push(U)}}else P.push(U),U.expand();else U.type===e.AnnotationType.ANNOTATION_TASK&&_.start<=U.start&&U.end<=_.end&&P.push(U)}V&&j.getBlocks().forEach(function(e){this._updateFolding(e,g,f,B,O,d,l)}.bind(this)),this._detectTasks&&this._computeTasks(_,g,O,d,l),this._annotationModel.replaceAnnotations(P,O)}},_onMouseDown:function(e){if(2===e.clickCount){var t=this._view.getModel(),n=this._view.getOffsetAtLocation(e.x,e.y);if(n>0){var i=n-1,r=t;t.getBaseModel&&(i=t.mapOffset(i),r=t.getBaseModel());var o=this._findBlock(this._rootBlock,i),s=this._findMatchingBracket(r,o,i);if(-1!==s){e.preventDefault();var a=s;t.getBaseModel&&(a=t.mapOffset(a,!0)),n>a&&(n--,a++),this._view.setSelection(a,n)}}}},_onSelection:function(t){var n,i=t.oldValue,r=t.newValue,o=this._view.getModel();if(this._highlightCaretLine){var s=o.getLineAtOffset(i.start);n=o.getLineAtOffset(r.start);var a=r.start===r.end,l=i.start===i.end;s===n&&l&&a||(l&&this._view.redrawLines(s,s+1),s===n&&l||!a||this._view.redrawLines(n,n+1))}if(this._annotationModel){var d,c,h=this._bracketAnnotations;if(r.start===r.end&&(c=this._view.getCaretOffset())>0){var u=c-1;o.getBaseModel&&(u=o.mapOffset(u),o=o.getBaseModel());var p=this._findBlock(this._rootBlock,u),f=this._findMatchingBracket(o,p,u);-1!==f&&(d=[e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_MATCHING_BRACKET,f,f+1),e.AnnotationType.createAnnotation(e.AnnotationType.ANNOTATION_CURRENT_BRACKET,u,u+1)])}this._bracketAnnotations=d,this._annotationModel.replaceAnnotations(h,d)}},_spliceStyles:function(e,t,n,i){var r=e.regex;r.lastIndex=0;for(var o=0,s=r.exec(n);s;){for(var a=i+s.index;o<t.length&&!(a<t[o].end);)o++;var l={start:a,end:a+1,style:e.style};if(o<t.length&&t[o].start<=a){var d={start:a+1,end:t[o].end,style:t[o].style};t[o].end=a,t.splice(o+1,0,d),t.splice(o+1,0,l),o+=2}else t.splice(o,0,l),o++;s=r.exec(n)}},_updateFolding:function(e,t,n,i,r,o,s){if(o=o||e.start,s=s||e.end,!e.doNotFold&&e.start<=s&&o<=e.end){var l=a(i,e.start,!0);if(!(l<i.length&&i[l].start===e.start&&i[l].end===e.end)){var d=this._createFoldingAnnotation(n,t,e.start,e.end);d&&r.push(d)}e.getBlocks().forEach(function(e){this._updateFolding(e,t,n,i,r,o,s)}.bind(this))}},_caretLineStyle:{styleClass:"meta annotation currentLine"},_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}},t.EventTarget.addMixin(s.prototype),{TextStyler:s,Block:r,createPatternBasedAdapter:l}}),define("orion/editor/textMateStyler",["orion/regex"],function(e){function t(e){var n;if(e instanceof Array){n=new Array(e.length);for(var i=0;i<e.length;i++)n[i]=t(e[i])}else{n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=e[r];n[r]="object"==typeof o&&null!==o?t(o):o}}return n}function n(e,n,i){this.initialize(e),this.grammar=t(n),this.externalGrammars=i?t(i):[],this._styles={},this._tree=null,this._allGrammars={},this.preprocess(this.grammar)}var i={unsupported:[{regex:/\(\?[ims\-]:/,func:function(){return"option on/off for subexp"}},{regex:/\(\?<([=!])/,func:function(e){return"="===e[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(){return"atomic group"}}],toRegExp:function(e){function t(e,t){throw new Error('Unsupported regex feature "'+e+'": "'+t[0]+'" at index: '+t.index+" in "+t.input)}function n(e){for(var t="",n=!1,i=e.length,r=0;i>r;){var o=e.charAt(r);if(n||"#"!==o)if(!n&&/\s/.test(o))for(;i>r&&/\s/.test(o);)o=e.charAt(++r);else"\\"===o?(t+=o,/\s/.test(e.charAt(r+1))||(t+=e.charAt(r+1),r+=1),r+=1):"["===o?(n=!0,t+=o,r+=1):"]"===o?(n=!1,t+=o,r+=1):(t+=o,r+=1);else for(;i>r&&"\r"!==o&&"\n"!==o;)o=e.charAt(++r)}return t}var r,o="";for(e=i.processGlobalFlag("x",e,function(e){return n(e)}),e=i.processGlobalFlag("i",e,function(e){return o+="i",e}),r=0;r<this.unsupported.length;r++){var s;(s=this.unsupported[r].regex.exec(e))&&t(this.unsupported[r].func(s),s)}return new RegExp(e,o)},processGlobalFlag:function(e,t,n){function i(e,t){for(var n=0,i=e.length,r=-1,o=t;i>o&&-1===r;o++)switch(e.charAt(o)){case"\\":o++;break;case"(":n++;break;case")":n--,0===n&&(r=o)}return r}var r="(?"+e+")",o="(?"+e+":";if(t.substring(0,r.length)===r)return n(t.substring(r.length));if(t.substring(0,o.length)===o){var s=i(t,0);if(s<t.length-1)throw new Error("Only a "+o+") group that encloses the entire regex is supported in: "+t);return n(t.substring(o.length,s))}return t},hasBackReference:function(e){return/\\\d+/.test(e.source)},getSubstitutedRegex:function(t,n,i){i="undefined"==typeof i?!0:!1;for(var r=t.source.split(/(\\\d+)/g),o=[],s=0;s<r.length;s++){var a=r[s],l=/\\(\d+)/.exec(a);if(l){var d=n[l[1]]||"";o.push(i?e.escape(d):d)}else o.push(a)}return new RegExp(o.join(""))},groupify:function(e,t){for(var n=1,i=2,r=3,o=4,s=e.source,a=s.length,l=[],d=0,c=[],h=1,u=1,p=[],f={},g={},m=0;a>m;m++){var v=l[l.length-1],y=s.charAt(m);switch(y){case"(":v===o&&(l.pop(),p.push(")"),c[c.length-1].end=m);var _=a>m+2?s.charAt(m+1)+""+s.charAt(m+2):null;if("?:"===_||"?="===_||"?!"===_){var C;"?:"===_?C=n:(C=r,d++),l.push(C),c.push({start:m,end:-1,type:C}),p.push(y),p.push(_),m+=_.length}else l.push(i),c.push({start:m,end:-1,type:i,oldNum:h,num:u}),p.push(y),0===d&&(g[u]=null),f[h]=u,h++,u++;break;case")":var w=l.pop();w===r&&d--,c[c.length-1].end=m,p.push(y);break;case"*":case"+":case"?":case"}":var b=y,x=s.charAt(m-1),S=m-1;if("}"===y){for(var L=m-1;"{"!==s.charAt(L)&&L>=0;L--);x=s.charAt(L-1),S=L-1,b=s.substring(L,m+1)}var E=c[c.length-1];if(")"===x&&(E.type===i||E.type===o)){p.splice(E.start,0,"("),p.push(b),p.push(")");for(var k={start:E.start,end:p.length-1,type:o,num:E.num},T=0;T<c.length;T++)w=c[T],(w.type===i||w.type===o)&&w.start>=E.start&&w.end<=S&&(w.start+=1,w.end+=1,w.num=w.num+1,w.type===i&&(f[w.oldNum]=w.num));c.push(k),u++;break}default:if("|"!==y&&v!==i&&v!==o&&0===d&&(l.push(o),c.push({start:m,end:-1,type:o,num:u}),p.push("("),g[u]=null,u++),p.push(y),"\\"===y){var A=s.charAt(m+1);p.push(A),m+=1}}}for(;l.length;)l.pop(),p.push(")");var N=new RegExp(p.join("")),M={};t=t||f;for(var I in t)t.hasOwnProperty(I)&&(M[I]="\\"+t[I]);return N=this.getSubstitutedRegex(N,M,!1),[N,f,g]},complexCaptures:function(e){if(!e)return!1;for(var t in e)if(e.hasOwnProperty(t)&&"0"!==t)return!0;return!1}};return n.prototype={initialize:function(e){this.textView=e,this.textView.stylerOptions=this;var t=this;this._listener={onModelChanged:function(e){t.onModelChanged(e)},onDestroy:function(e){t.onDestroy(e)},onLineStyle:function(e){t.onLineStyle(e)},onStorage:function(e){t.onStorage(e)}},e.addEventListener("ModelChanged",this._listener.onModelChanged),e.addEventListener("Destroy",this._listener.onDestroy),e.addEventListener("LineStyle",this._listener.onLineStyle),e.redrawLines()},onDestroy:function(){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null),this.grammar=null,this._styles=null,this._tree=null,this._listener=null},preprocess:function(e){for(var t=[e];0!==t.length;){var n=t.pop();
if((!n._resolvedRule||!n._typedRule)&&(n._resolvedRule=this._resolve(n),n._typedRule=this._createTypedRule(n),this.addStyles(n.name),this.addStyles(n.contentName),this.addStylesForCaptures(n.captures),this.addStylesForCaptures(n.beginCaptures),this.addStylesForCaptures(n.endCaptures),n._resolvedRule!==n&&t.push(n._resolvedRule),n.patterns))for(var i=0;i<n.patterns.length;i++)t.push(n.patterns[i])}},addStyles:function(e){if(e&&!this._styles[e]){this._styles[e]=[];for(var t=e.split("."),n=0;n<t.length;n++)this._styles[e].push(t.slice(0,n+1).join("-"))}},addStylesForCaptures:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t].name;this.addStyles(n)}},ContainerRule:function(){function e(e){this.rule=e,this.subrules=e.patterns}return e.prototype.valueOf=function(){return"aa"},e}(),BeginEndRule:function(){function e(e){this.rule=e,this.beginRegex=i.toRegExp(e.begin),this.endRegex=i.toRegExp(e.end),this.subrules=e.patterns||[],this.endRegexHasBackRef=i.hasBackReference(this.endRegex);var t=i.complexCaptures(e.captures),n=i.complexCaptures(e.beginCaptures)||i.complexCaptures(e.endCaptures);if(this.isComplex=t||n,this.isComplex){var r=i.groupify(this.beginRegex);this.beginRegex=r[0],this.beginOld2New=r[1],this.beginConsuming=r[2];var o=i.groupify(this.endRegex,this.beginOld2New);this.endRegex=o[0],this.endOld2New=o[1],this.endConsuming=o[2]}}return e.prototype.valueOf=function(){return this.beginRegex},e}(),MatchRule:function(){function e(e){if(this.rule=e,this.matchRegex=i.toRegExp(e.match),this.isComplex=i.complexCaptures(e.captures),this.isComplex){var t=i.groupify(this.matchRegex);this.matchRegex=t[0],this.matchOld2New=t[1],this.matchConsuming=t[2]}}return e.prototype.valueOf=function(){return this.matchRegex},e}(),_createTypedRule:function(e){return e.match?new this.MatchRule(e):e.begin?new this.BeginEndRule(e):new this.ContainerRule(e)},_resolve:function(e){var t=e;if(e.include){if(e.begin||e.end||e.match)throw new Error('Unexpected regex pattern in "include" rule '+e.include);var n=e.include;if("#"===n.charAt(0)){if(t=this.grammar.repository&&this.grammar.repository[n.substring(1)],!t)throw new Error("Couldn't find included rule "+n+" in grammar repository")}else if("$self"===n)t=this.grammar;else{if("$base"===n)throw new Error('Include "$base" is not supported');if(t=this._allGrammars[n],!t)for(var i=0;i<this.externalGrammars.length;i++){var r=this.externalGrammars[i];if(r.scopeName===n){this.preprocess(r),this._allGrammars[n]=r,t=r;break}}}}return t},ContainerNode:function(){function e(e,t){this.parent=e,this.rule=t,this.children=[],this.start=null,this.end=null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.valueOf=function(){var e=this.rule;return"ContainerNode { "+(e.include||"")+" "+(e.name||"")+(e.comment||"")+"}"},e}(),BeginEndNode:function(){function e(e,t,n){this.parent=e,this.rule=t,this.children=[],this.setStart(n),this.end=null,this.endMatch=null,this.endRegexSubstituted=t.endRegexHasBackRef?i.getSubstitutedRegex(t.endRegex,n):null}return e.prototype.addChild=function(e){this.children.push(e)},e.prototype.getIndexInParent=function(){return this.parent?this.parent.children.indexOf(this):-1},e.prototype.setStart=function(e){this.start=e.index,this.beginMatch=e},e.prototype.setEnd=function(e){if(e&&"object"==typeof e){var t=e;this.endMatch=t,this.end=t.index+t[0].length}else{var n=e;this.endMatch=null,this.end=n}},e.prototype.shiftStart=function(e){this.start+=e,this.beginMatch.index+=e},e.prototype.shiftEnd=function(e){this.end+=e,this.endMatch&&(this.endMatch.index+=e)},e.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range="+this.start+".."+this.end+"}"},e}(),push:function(e,t){if(t)for(var n=t.length;n>0;)e.push(t[--n])},exec:function(e,t,n){var i=e.exec(t);return i&&(i.index+=n),e.lastIndex=0,i},afterMatch:function(e){return e.index+e[0].length},getEndMatch:function(e,t,n){if(e instanceof this.BeginEndNode){var i=e.rule,r=e.endRegexSubstituted||i.endRegex;return r?this.exec(r,t,n):null}return null},initialParse:function(){var e=(this.textView.getModel().getCharCount(),new this.ContainerNode(null,this.grammar._typedRule));this._tree=e,this.parse(this._tree,!1,0)},onModelChanged:function(e){var t=e.addedCharCount,n=(e.addedLineCount,e.removedCharCount),i=(e.removedLineCount,e.start);if(this._tree){var r=this.textView.getModel(),o=r.getCharCount(),s=r.getLineEnd(r.getLineAtOffset(i)-1),a=this.getFirstDamaged(s,s);s=-1===s?0:s;var l;l=a?this.parse(a,!0,s,i,t,n):o,this.textView.redrawRange(s,l)}else this.initialParse()},getFirstDamaged:function(e,t){if(0>e)return this._tree;for(var n=[this._tree],i=null;n.length;){var r=n.pop();if(!r.parent||this.isDamaged(r,e,t)){r instanceof this.BeginEndNode&&(i=r);for(var o=0;o<r.children.length;o++)n.push(r.children[o])}}return i||this._tree},isDamaged:function(e,t,n){return e.start<=n&&e.end>t},parse:function(e,t,n,i,r,o){var s=this.textView.getModel(),a=s.getLineStart(s.getLineCount()-1),l=s.getCharCount(),d=this.getInitialExpected(e,n),c=-1;if(t){e.repaired=!0,e.endNeedsUpdate=!0;var h=e.children[e.children.length-1],u=r-o,p=h?s.getLineEnd(s.getLineAtOffset(h.end+u)):-1,f=s.getLineEnd(s.getLineAtOffset(i+o));c=Math.max(p,f)}c=-1===c?l:c;for(var g=d,m=e,v=!1,y=n,_=-1;m&&(!t||c>y);){var C=this.getNextMatch(s,m,y);C||(y=y>=a?l:s.getLineStart(s.getLineAtOffset(y)+1));var w=C&&C.match,b=C&&C.rule,x=C&&C.isSub,S=C&&C.isEnd;if(x){if(y=this.afterMatch(w),b instanceof this.BeginEndRule)if(v=!0,t&&b===g.rule&&m===g.parent){var L=g;L.setStart(w),L.repaired=!0,L.endNeedsUpdate=!0,m=L,g=this.getNextExpected(g,"begin")}else{t&&(this.prune(m,g),t=!1);var E=new this.BeginEndNode(m,b,w);m.addChild(E),m=E}}else(S||y===l)&&(m instanceof this.BeginEndNode&&(w?(v=!0,_=Math.max(_,m.end),m.setEnd(w),y=this.afterMatch(w),t&&m===g&&m.parent===g.parent?(m.repaired=!0,delete m.endNeedsUpdate,g=this.getNextExpected(g,"end")):t&&(this.prune(m,g),t=!1)):(m.setEnd(l),delete m.endNeedsUpdate)),m=m.parent);t&&y>=c&&!v&&(this.prune(e,d),t=!1)}return this.removeUnrepairedChildren(e,t,n),this.cleanup(t,e,n,c,l,r,o),t?Math.max(_,y):y},removeUnrepairedChildren:function(e,t,n){if(t){for(var i=e.children,r=-1,o=0;o<i.length;o++){var s=i[o];if(!s.repaired&&this.isDamaged(s,n,Number.MAX_VALUE)){r=o;break}}-1!==r&&(e.children.length=r)}},cleanup:function(e,t,n,i,r,o,s){var a,l,d;if(e){var c=o-s,h=this.getIntersecting(i-c+1,r);for(d=this.getIntersecting(n,i),a=0;a<h.length;a++)l=h[a],!l.repaired&&l instanceof this.BeginEndNode&&(l.shiftEnd(c),l.shiftStart(c));for(a=0;a<d.length;a++)l=d[a],l.repaired&&l.endNeedsUpdate&&l.shiftEnd(c),delete l.endNeedsUpdate,delete l.repaired}else for(d=this.getIntersecting(n,i),a=0;a<d.length;a++)delete d[a].repaired},getNextMatch:function(e,t,n,i){var r=e.getLineAtOffset(n),o=e.getLineEnd(r),s=e.getText(n,o),a=[],l=[],d=[],c=[];for(this.push(a,t.rule.subrules);a.length;){var h=a.length?a.pop():null,u=h&&h._resolvedRule._typedRule;if(u instanceof this.ContainerRule&&-1===l.indexOf(u))l.push(u),this.push(a,u.subrules);else if(!u||!i||u.matchRegex){var p=u&&this.exec(u.matchRegex||u.beginRegex,s,n);p&&(d.push(p),c.push(u))}}for(var f=Number.MAX_VALUE,g=-1,m=0;m<d.length;m++){var v=d[m];v.index<f&&(f=v.index,g=m)}if(!i){var y=t,_=this.getEndMatch(t,s,n);if(_){var C=y.rule.applyEndPatternLast,w=-1===g||_.index<f||!C&&_.index===f;if(w)return{isEnd:!0,rule:y.rule,match:_}}}return-1===g?null:{isSub:!0,rule:c[g],match:d[g]}},getInitialExpected:function(e,t){var n,i;if(e===this._tree){for(n=0;n<e.children.length;n++)if(i=e.children[n],i.start>=t)return i}else if(e instanceof this.BeginEndNode&&e.endMatch){var r=e.endMatch.index;for(n=0;n<e.children.length&&(i=e.children[n],!(i.start>=t));n++);if(i&&i.start<r)return i}return e},getNextExpected:function(e,t){var n=e;if("begin"===t){var i=n.children[0];return i?i:n}if("end"===t){var r=n.parent;if(r){var o=r.children[r.children.indexOf(n)+1];return o?o:r}}return null},prune:function(e,t){var n=t.parent===e;n?e.children.length=t.getIndexInParent():e instanceof this.BeginEndNode&&(e.endMatch=null,e.end=null),e.parent&&(e.parent.children.length=e.getIndexInParent()+1)},onLineStyle:function(e){function t(e,t){return e.start-t.start}this._tree||this.initialParse();var n=e.lineStart,i=this.textView.getModel(),r=i.getLineEnd(e.lineIndex),o=i.getLineEnd(i.getLineAtOffset(n)-1),s=this.getFirstDamaged(o,o),a=this.getLineScope(i,s,n,r);e.ranges=this.toStyleRanges(a),e.ranges.sort(t)},getLineScope:function(e,t,n,i){for(var r=n,o=this.getInitialExpected(t,n),s=[],a=[];t&&i>r;){var l=this.getNextMatch(e,t,r);if(!l)break;var d=l&&l.match,c=l&&l.rule,h=l&&l.isSub,u=l&&l.isEnd;d.index!==r&&a.push({start:r,end:d.index,node:t}),h?(r=this.afterMatch(d),c instanceof this.BeginEndRule?(this.addBeginScope(s,d,c),t=o,o=this.getNextExpected(o,"begin")):this.addMatchScope(s,d,c)):u&&(r=this.afterMatch(d),this.addEndScope(s,d,c),o=this.getNextExpected(o,"end"),t=t.parent)}i>r&&a.push({start:r,end:i,node:t});var p=this.getInheritedLineScope(a,n,i);return s.concat(p)},getInheritedLineScope:function(e){for(var t=[],n=0;n<e.length;n++)for(var i=e[n],r=i.node;r;){var o=r.rule.rule,s=o.name,a=o.contentName,l=a||s;if(l){this.addScopeRange(t,i.start,i.end,l);break}r=r.parent}return t},addBeginScope:function(e,t,n){var i=n.rule;this.addCapturesScope(e,t,i.beginCaptures||i.captures,n.isComplex,n.beginOld2New,n.beginConsuming)},addEndScope:function(e,t,n){var i=n.rule;this.addCapturesScope(e,t,i.endCaptures||i.captures,n.isComplex,n.endOld2New,n.endConsuming)},addMatchScope:function(e,t,n){var i=n.rule,r=i.name,o=i.captures;o?this.addCapturesScope(e,t,o,n.isComplex,n.matchOld2New,n.matchConsuming):this.addScope(e,t,r)},addScope:function(e,t,n){n&&e.push({start:t.index,end:this.afterMatch(t),scope:n})},addScopeRange:function(e,t,n,i){i&&e.push({start:t,end:n,scope:i})},addCapturesScope:function(e,t,n,i,r,o){if(n)if(i){for(var s={1:0},a=0,l=1;void 0!==t[l];l++)void 0!==o[l]&&(a+=t[l].length),void 0!==t[l+1]&&(s[l+1]=a);for(var d=t.index,c=1;n[c];c++){var h=n[c].name,u=r[c],p=d+s[u];if("undefined"!=typeof t[u]){var f=p+t[u].length;this.addScopeRange(e,p,f,h)}}}else this.addScope(e,t,n[0]&&n[0].name)},getIntersecting:function(e,t){for(var n=[],i=this._tree?[this._tree]:[];i.length;){var r=i.pop(),o=!1;if(r instanceof this.ContainerNode?o=!0:this.isDamaged(r,e,t)&&(o=!0,n.push(r)),o)for(var s=r.children.length,a=0;s>a;a++)i.push(r.children[a])}return n.reverse()},toStyleRanges:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=this._styles[i.scope];if(!r)throw new Error("styles not found for "+i.scope);var o=r.join(" ");t.push({start:i.start,end:i.end,style:{styleClass:o}})}return t}},{RegexUtil:i,TextMateStyler:n}}),define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(e,t){function n(e){return-1!==e.getProperty("objectClass").indexOf(r)&&"highlighter"===e.getProperty("type")}function i(e,t,n){this.initialize(e,t,n),this.lineStyles=[]}var r="orion.edit.highlighter",o="orion.annotation.highlightError",s=r+" service must be an event emitter";return t.AnnotationType.registerType(o,{title:e.syntaxError,html:"<div class='annotationHTML error'></div>",rangeStyle:{styleClass:"annotationRange error"}}),i.prototype={initialize:function(e,t,i){this.textView=e,this.serviceRegistry=t,this.annotationModel=i,this.services=[];var o=this;this.listener={onModelChanging:function(e){o.onModelChanging(e)},onModelChanged:function(e){o.onModelChanged(e)},onDestroy:function(e){o.onDestroy(e)},onLineStyle:function(e){o.onLineStyle(e)},onStyleReady:function(e){o.onStyleReady(e)},onServiceAdded:function(e){o.onServiceAdded(e.serviceReference,o.serviceRegistry.getService(e.serviceReference))},onServiceRemoved:function(e){o.onServiceRemoved(e.serviceReference,o.serviceRegistry.getService(e.serviceReference))}},e.addEventListener("ModelChanging",this.listener.onModelChanging),e.addEventListener("ModelChanged",this.listener.onModelChanged),e.addEventListener("Destroy",this.listener.onDestroy),e.addEventListener("LineStyle",this.listener.onLineStyle),t.addEventListener("registered",this.listener.onServiceAdded),t.addEventListener("unregistering",this.listener.onServiceRemoved);for(var s=t.getServiceReferences(r),a=0;a<s.length;a++){var l=s[a];n(l)&&this.addServiceListener(t.getService(l))}},onDestroy:function(){this.destroy()},destroy:function(){if(this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null),this.services){for(var e=0;e<this.services.length;e++)this.removeServiceListener(this.services[e]);this.services=null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null),this.listener=null,this.lineStyles=null},onModelChanging:function(e){this.startLine=this.textView.getModel().getLineAtOffset(e.start)},onModelChanged:function(e){var t=this.startLine;(e.addedLineCount||e.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[t,e.removedLineCount].concat(this._getEmptyStyle(e.addedLineCount)))},onStyleReady:function(e){var n=e.lineStyles||e.style,i=Number.MAX_VALUE,r=-1,s=this.textView.getModel();for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(this.lineStyles[a]=n[a],i=Math.min(i,a),r=Math.max(r,a));i=Math.max(i,0),r=Math.min(r,s.getLineCount());var l=this.annotationModel;if(l){for(var d=l.getAnnotations(s.getLineStart(i),s.getLineEnd(r)),c=[];d.hasNext();){var h=d.next();h.type===o&&c.push(h)}for(var u=[],p=i;r>=p;p++){a=p;var f=this.lineStyles[a],g=f&&f.errors,m=s.getLineStart(a);if(g)for(var v=0;v<g.length;v++){var y=g[v];u.push(t.AnnotationType.createAnnotation(o,y.start+m,y.end+m))}}l.replaceAnnotations(c,u)}this.textView.redrawLines(i,r+1)},onLineStyle:function(e){function t(e,t){for(var n=e.length,i=[],r=0;n>r;r++){var o=e[r];i.push({start:o.start+t,end:o.end+t,style:o.style})}return i}var n=this.lineStyles[e.lineIndex];n&&(n.ranges?e.ranges=t(n.ranges,e.lineStart):n.style&&(e.style=n.style))},_getEmptyStyle:function(e){for(var t=[],n=0;e>n;n++)t.push(null);return t},setContentType:function(e){if(this.contentType=e,this.services)for(var t=0;t<this.services.length;t++){var n=this.services[t];if(n.setContentType){var i=this.serviceRegistry.getService("orion.page.progress");i?i.progress(n.setContentType(this.contentType),this.contentType.id):n.setContentType(this.contentType)}}},onServiceAdded:function(e,t){n(e)&&this.addServiceListener(t)},onServiceRemoved:function(e,t){-1!==this.services.indexOf(t)&&this.removeServiceListener(t)},addServiceListener:function(e){if("function"==typeof e.addEventListener){if(e.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(e),e.setContentType&&this.contentType){var t=this.serviceRegistry.getService("orion.page.progress");t?t.progress(e.setContentType(this.contentType),this.contentType.id):e.setContentType(this.contentType)}}else"undefined"!=typeof console&&console.log(new Error(s))},removeServiceListener:function(e){if("function"==typeof e.removeEventListener){e.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady);var t=this.services.indexOf(e);-1!==t&&this.services.splice(t,1)}else"undefined"!=typeof console&&console.log(new Error(s))}},i}),define("orion/highlight",["examples/editor/textStyler","orion/editor/textStyler","orion/editor/textMateStyler","orion/editor/AsyncStyler","orion/Deferred"],function(e,t,n,i,r){function o(o,s,l,d,c,h,u){function p(e,t){var n=e.getProperty("contentType")||e.getProperty("contentTypes"),i=e.getProperty("fileTypes");if(n)return r.when(s.isSomeExtensionOf(l,n)).then(function(t){return t?e:null});if(t&&i&&-1!==i.indexOf(t)){var o=new r;return o.resolve(e),o}return null}function f(e){return u||"highlighter"!==e.getProperty("type")}function g(t){var n=null;switch(t&&t.id){case"application/javascript":case"application/json":n=new e.TextStyler(d,"js",c);break;case"text/x-java-source":n=new e.TextStyler(d,"java",c);break;case"text/css":n=new e.TextStyler(d,"css",c)}return n}if(!a){var m=g(l);if(m){var v=new r;return v.resolve(m),v}}a&&!this.orionGrammars&&(this.orionGrammars={});for(var y=h&&h.split(".").pop().toLowerCase(),_=o.getServiceReferences("orion.edit.highlighter"),C=[],w=[],b=0;b<_.length;b++){var x=_[b],S=x.getProperty("type");if("grammar"===S||!a&&"undefined"==typeof S)C.push(x.getProperty("grammar"));else if("highlighter"!==S){var L=x.getProperty("id");L&&!this.orionGrammars[L]&&(this.orionGrammars[L]={id:L,contentTypes:x.getProperty("contentTypes"),patterns:x.getProperty("patterns"),repository:x.getProperty("repository")})}var E=p(x,y);E&&w.push(E)}return r.all(w,function(e){return{_error:e}}).then(function(e){for(var r,s=e.length-1;s>=0;s--){var h=e[s];if(h&&!h._error&&f(h)){r=h;break}}var u;if(r){var p=r.getProperty("type");if("highlighter"===p)u=new i(d,o,c),u.setContentType(l);else if("grammar"===p||!a&&"undefined"==typeof p){var g=r.getProperty("grammar");u=new n.TextMateStyler(d,g,C)}else if(a){var m=[];for(var v in this.orionGrammars)m.push(this.orionGrammars[v]);var y=new t.createPatternBasedAdapter(m,r.getProperty("id"));u=new t.TextStyler(d,c,y)}}return u})}function s(e,t){this.serviceRegistry=e,this.contentTypeService=t,this.styler=null}var a=1;return s.prototype={setup:function(e,t,n,i,r){r="undefined"==typeof r?!0:r,this.styler&&(this.styler.destroy&&this.styler.destroy(),this.styler=null);var s=this;return o(this.serviceRegistry,this.contentTypeService?this.contentTypeService:this.serviceRegistry.getService("orion.core.contentTypeRegistry"),e,t,n,i,r).then(function(e){return s.styler=e,e})},getStyler:function(){return this.styler}},{createStyler:o,SyntaxHighlighter:s}}),define("orion/markOccurrences",["orion/edit/editorContext","orion/Deferred"],function(e,t){function n(e,t,n){this.registry=e,this.inputManager=t,this.editor=n}return n.prototype={setOccurrencesVisible:function(e){this.occurrencesVisible!==e&&(this.occurrencesVisible=e,e||this.editor.showOccurrences([]))},findOccurrences:function(){function n(e,n,i){function r(e,t,n){var i=t.getProperty("contentType");return o.isSomeExtensionOf(n,i).then(function(e){return e?t:null})}for(var o=e.getService("orion.core.contentTypeRegistry"),s=e.getServiceReferences("orion.edit.occurrences"),a=[],l=0;l<s.length;l++){var d=s[l],c=d.getProperty("pattern");if(d.getProperty("contentType"))a.push(r(e,d,n));else if(c&&new RegExp(c).test(i)){var h=new t;h.resolve(d),a.push(h)}}return t.all(a,function(e){return{_error:e}}).then(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i&&!i._error&&t.push(i)}return t})}var i,r=this,o=r.registry.getService("orion.edit.occurrences"),s=function(){i&&window.clearTimeout(i),r.occurrencesVisible&&(i=window.setTimeout(function(){i=null;var t=r.editor,n={selection:t.getSelection(),contentType:r.inputManager.getContentType().id};o.computeOccurrences(e.getEditorContext(r.registry),n).then(function(e){r.editor.showOccurrences(e)})},500))};r.inputManager.addEventListener("InputChanged",function(e){var t=r.editor.getTextView();t&&(t.removeEventListener("Selection",s),n(r.registry,e.contentType,e.title).then(function(e){e&&0!==e.length?t.addEventListener("Selection",s):i&&window.clearTimeout(i)}))})}},{MarkOccurrences:n}}),define("orion/syntaxchecker",["orion/Deferred","orion/edit/editorContext"],function(e,t){var n=function(){function n(e,t){this.registry=e,this.editor=t}function i(e,t,n){return e=Math.max(e,t),e=Math.min(e,n)}return n.prototype={checkSyntax:function(n,i,r,o){function s(t,n){function r(e,t,n){var i=t.getProperty("contentType");return o.isSomeExtensionOf(n,i).then(function(e){return e?t:null})}for(var o=t.getService("orion.core.contentTypeRegistry"),s=t.getServiceReferences("orion.edit.validator"),a=[],l=0;l<s.length;l++){var d=s[l],c=d.getProperty("pattern");if(d.getProperty("contentType"))a.push(r(t,d,n));else if(c&&new RegExp(c).test(i)){var h=new e;h.resolve(d),a.push(h)}}return e.all(a,function(e){return{_error:e}}).then(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i&&!i._error&&t.push(i)}return t})}if(n&&!r){var a=this,l=this.registry;s(l,n).then(function(r){var s=function(e){e=e||{};var t=e.problems||e.errors||e;return Array.isArray(t)?t:[]},d=l.getService("orion.page.progress"),c=r.map(function(e){var r,a=l.getService(e);if(a.computeProblems){var c={contentType:n.id,title:i};r=a.computeProblems(t.getEditorContext(l),c)}else a.checkSyntax&&(r=a.checkSyntax(i,o));return d.progress(r,"Validating "+i).then(s)});e.all(c,function(e){return{_error:e}}).then(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i._error||(a._fixup(i),t=t.concat(i))}l.getService("orion.core.marker")._setProblems(t)})})}},_fixup:function(e){for(var t=this.editor.getModel(),n=0;n<e.length;n++){var r=e[n];if(r.description=r.description||r.reason,r.severity=r.severity||"error",r.start="number"==typeof r.start?r.start:r.character,"number"==typeof r.line){var o=t.getLine(r.line-1,!1).length;r.start=i(r.start,1,o-1),r.end="number"==typeof r.end?r.end:-1,r.end=i(r.end,r.start+1,o)}else{var s=t.getCharCount();if(r.start=i(r.start,0,s),r.end="number"==typeof r.end?r.end:-1,r.end=i(r.end,r.start,s),r.end===s&&t.getLineCount()>1&&s===t.getLineStart(t.getLineCount()-1)){var a=t.getLineCount()-2,l=t.getLineStart(a),d=t.getLineEnd(a);l===d?r.start=r.end=d:(r.start=d-1,r.end=d)}}}}},n}();return{SyntaxChecker:n}}),define("orion/editorView",["i18n!orion/edit/nls/messages","orion/editor/editor","orion/editor/eventTarget","orion/editor/textView","orion/editor/textModel","orion/editor/projectionTextModel","orion/editor/editorFeatures","orion/editor/contentAssist","orion/editor/emacs","orion/editor/vi","orion/editorPreferences","orion/widgets/themes/ThemePreferences","orion/widgets/themes/editor/ThemeData","orion/widgets/settings/EditorSettings","orion/searchAndReplace/textSearcher","orion/editorCommands","orion/globalCommands","orion/edit/dispatcher","orion/edit/editorContext","orion/edit/typedefs","orion/highlight","orion/markOccurrences","orion/syntaxchecker","orion/keyBinding","orion/uiUtils","orion/util","orion/objects"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m,v,y,_,C,w,b,x,S,L,E){function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];e[i]&&(e[i]=parseInt(e[i],10))}}function T(e){this._parent=e.parent,this.renderToolbars=e.renderToolbars,this.serviceRegistry=e.serviceRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.progress=e.progress,this.statusService=e.statusService,this.fileClient=e.fileService,this.inputManager=e.inputManager,this.preferences=e.preferences,this.readonly=e.readonly,this.searcher=e.searcher,this.statusReporter=e.statusReporter,this.model=e.model,this.undoStack=e.undoStack,this.syntaxHighlighter=new C.SyntaxHighlighter(this.serviceRegistry),this.typeDefRegistry=new _(this.serviceRegistry);var t=m.getKeyAssist();t&&t.addProvider(this);var n=m.getMainSplitter();n&&n.splitter.addEventListener("resize",function(e){this.editor&&e.node===n.main&&this.editor.resize()}.bind(this)),m.getGlobalEventTarget().addEventListener("toggleTrim",function(){this.editor&&this.editor.resize()}.bind(this)),this.settings={},this._init()}return T.prototype={updateKeyMode:function(e,t){this.emacs&&t.removeKeyMode(this.emacs),this.vi&&t.removeKeyMode(this.vi),"Emacs"===e.keyBindings?(this.emacs||(this.emacs=new l.EmacsMode(t)),t.addKeyMode(this.emacs)):"vi"===e.keyBindings&&(this.vi||(this.vi=new d.VIMode(t,this.statusReporter)),t.addKeyMode(this.vi))},getParent:function(){return this._parent},getSettings:function(){return this.settings},setParent:function(e){this._parent=e},updateSourceCodeActions:function(e,t){t&&(t.setAutoPairParentheses(e.autoPairParentheses),t.setAutoPairBraces(e.autoPairBraces),t.setAutoPairSquareBrackets(e.autoPairSquareBrackets),t.setAutoPairAngleBrackets(e.autoPairAngleBrackets),t.setAutoPairQuotations(e.autoPairQuotations),t.setAutoCompleteComments(e.autoCompleteComments),t.setSmartIndentation(e.smartIndentation))},updateViewOptions:function(e){var t=0;e.showMargin&&(t=e.marginOffset,"number"!=typeof t&&(t=e.marginOffset=parseInt(t,10)));var n=0;return e.wordWrap&&(n=t),{readonly:this.readonly||this.inputManager.getReadOnly(),tabSize:e.tabSize||4,expandTab:e.expandTab,wrapMode:e.wordWrap,wrapOffset:n,marginOffset:t,scrollAnimation:e.scrollAnimation?e.scrollAnimationTimeout:0}},updateSettings:function(e){this.settings=e;var t=this.editor,n=this.inputManager;n.setAutoLoadEnabled(e.autoLoad),n.setAutoSaveTimeout(e.autoSave?e.autoSaveTimeout:-1),n.setSaveDiffsEnabled(e.saveDiffs),this.updateStyler(e);var i=t.getTextView();i&&(this.updateKeyMode(e,i),i.setOptions(this.updateViewOptions(e))),this.updateSourceCodeActions(e,t.getSourceCodeActions()),t.setAnnotationRulerVisible(e.annotationRuler),t.setLineNumberRulerVisible(e.lineNumberRuler),t.setFoldingRulerVisible(e.foldingRuler),t.setOverviewRulerVisible(e.overviewRuler),this.renderToolbars&&this.renderToolbars(n.getFileMetadata()),this.markOccurrences.setOccurrencesVisible(e.showOccurrences),t.getContentAssist()&&t.getContentAssist().setAutoTriggerEnabled(e.contentAssistAutoTrigger),this.dispatchEvent({type:"Settings",newSettings:this.settings})},updateStyler:function(e){var t=this.syntaxHighlighter.getStyler();t&&(t.setTabsVisible&&t.setTabsVisible(e.showTabs),t.setSpacesVisible&&t.setSpacesVisible(e.showSpaces))},showKeyBindings:function(t){var n=this.editor;if(n&&n.getTextView&&n.getTextView()){var i=n.getTextView(),r=i.getActions(!0).filter(function(e){var t=i.getActionDescription(e);return t&&t.name});r.sort(function(e,t){return i.getActionDescription(e).name.localeCompare(i.getActionDescription(t).name)}),t.createHeader(e.Editor);for(var o,s=function(e){return function(){return i.focus(),i.invokeAction(e)}},a={},l=0;l<r.length;l++)for(var d=r[l],c=i.getActionDescription(d),h=i.getKeyBindings(d),u=0;u<h.length;u++){o=h[u];var p=S.getUserKeyString(o);o.scopeName?(a[o.scopeName]||(a[o.scopeName]=[]),a[o.scopeName].push({bindingString:p,name:c.name,execute:s(d)})):t.createItem(p,c.name,s(d))}for(var f in a)if(a[f].length){t.createHeader(f);for(var g=0;g<a[f].length;g++)o=a[f][g],t.createItem(o.bindingString,o.name,o.execute)}}},_init:function(){var n=null;this.preferences&&(n=this.editorPreferences=new c.EditorPreferences(this.preferences,function(e){e?this.updateSettings(e):n.getPrefs(this.updateSettings.bind(this))}.bind(this)));var l=null;this.preferences&&(l=new h.ThemePreferences(this.preferences,new u.ThemeData),l.apply());var d,m=this,_=this.readonly,C=this.commandRegistry,S=this.serviceRegistry,T=this.fileClient,A=this.inputManager,N=this.searcher,M=this.progress,I=this.contentTypeRegistry,D=function(){var e=m.updateViewOptions(m.settings);E.mixin(e,{parent:m._parent,model:new o.ProjectionTextModel(m.model||new r.TextModel),wrappable:!0});var t=new i.TextView(e);return t},R=function(e,t,i,r){var o=new f.TextSearcher(e,S,C,i),a=(new s.KeyBindingsFactory).createKeyBindings(e,i,r,o);m.updateSourceCodeActions(m.settings,a.sourceCodeActions);var l=new g.EditorCommandFactory({serviceRegistry:S,commandRegistry:C,fileClient:T,inputManager:A,toolbarId:"toolsActions",saveToolbarId:"fileActions",editToolbarId:"editActions",readonly:_,navToolbarId:"pageNavigationActions",textSearcher:o,searcher:N,editorSettings:function(){return m.settings},localSettings:d});l.generateEditorCommands(e);var c=e.getTextView(),h=C.findCommand("orion.keyAssist");return h&&(c.setKeyBinding(new x.KeyStroke(191,!1,!0,!L.isMac,L.isMac),h.id),c.setAction(h.id,h.callback,h)),c.setAction("toggleWrapMode",function(){c.invokeAction("toggleWrapMode",!0);var e=c.getOptions("wrapMode");return m.settings.wordWrap=e,n&&n.setPrefs(m.settings),!0}),m.vi=m.emacs=null,m.updateKeyMode(m.settings,c),a},P=function(e,t,n){var i=A.getContentType(),r=e.getTitle(),o=S.getServiceReferences("orion.edit.contentAssist").concat(S.getServiceReferences("orion.edit.contentassist")),s=n&&n.providers;s||(s=o.map(function(e){var t=e.getProperty("contentType"),n=e.getProperty("pattern");if(t&&I.isSomeExtensionOf(i,t)||n&&new RegExp(n).test(r)){var o=S.getService(e),s=e.getProperty("service.id").toString(),a=e.getProperty("charTriggers"),l=e.getProperty("excludedStyles");return a&&(a=new RegExp(a)),l&&(l=new RegExp(l)),{provider:o,id:s,charTriggers:a,excludedStyles:l}}return null}).filter(function(e){return!!e}));var a={};Object.keys(y).forEach(function(e){"function"==typeof y[e]&&(a[e]=y[e].bind(null,S))}),t.setEditorContextProvider(a),t.setProviders(s),t.setAutoTriggerEnabled(m.settings.contentAssistAutoTrigger),t.setProgress(M),t.setStyleAccessor(m.getStyleAccessor())},O=_?null:{createContentAssistMode:function(e){var t=new a.ContentAssist(e.getTextView());t.addEventListener("Activating",P.bind(null,e,t));var n=new a.ContentAssistWidget(t,"contentassist"),i=new a.ContentAssistMode(t,n);return t.setMode(i),P(e,t),t.initialize(),i}},B=this.editor=new t.Editor({textViewFactory:D,undoStackFactory:m.undoStack?{createUndoStack:function(e){return m.undoStack.setView(e.getTextView()),m.undoStack}}:new s.UndoFactory,textDNDFactory:new s.TextDNDFactory,annotationFactory:new s.AnnotationFactory,foldingRulerFactory:new s.FoldingRulerFactory,lineNumberRulerFactory:new s.LineNumberRulerFactory,contentAssistFactory:O,keyBindingFactory:R,statusReporter:this.statusReporter,domNode:this._parent});B.id="orion.editor",B.processParameters=function(e){k(e,["start","end","line","offset","length"]),this.showSelection(e.start,e.end,e.line,e.offset,e.length)},this.dispatcher=new v.Dispatcher(this.serviceRegistry,B,A),l&&n&&(d=new p({local:!0,editor:B,themePreferences:l,preferences:n})),A.addEventListener("InputChanged",function(e){var t=B.getTextView();t&&(t.setOptions(this.updateViewOptions(this.settings)),this.syntaxHighlighter.setup(e.contentType,B.getTextView(),B.getAnnotationModel(),e.title,!0).then(function(){this.updateStyler(this.settings),B.getContentAssist()&&P(B,B.getContentAssist())}.bind(this)))}.bind(this)),A.addEventListener("Saving",function(){m.settings.trimTrailingWhiteSpace&&B.getTextView().invokeAction("trimTrailingWhitespaces")});var F=S.getService("orion.core.marker");F&&F.addEventListener("problemsChanged",function(e){B.showProblems(e.problems)});var V=S.getService("orion.core.blame");V&&V.addEventListener("blameChanged",function(e){B.showBlame(e.blameInfo)});var j=this.markOccurrences=new w.MarkOccurrences(S,A,B);j.setOccurrencesVisible(this.settings.occurrencesVisible),j.findOccurrences();var U=new b.SyntaxChecker(S,B);B.addEventListener("InputChanged",function(t){U.checkSyntax(A.getContentType(),t.title,t.message,t.contents),A.getReadOnly()&&B.reportStatus(e.readonly,"error")});var H={};["getCaretOffset","setCaretOffset","getSelection","setSelection","getText","setText","getLineAtOffset","getLineStart"].forEach(function(e){H[e]=B[e].bind(B)}),S.registerService("orion.edit.context",H,null),this.editorPreferences&&this.editorPreferences.getPrefs(this.updateSettings.bind(this))},create:function(){this.editor.install()},destroy:function(){this.editor.uninstall()},getStyleAccessor:function(){var e=null,t=this.syntaxHighlighter.getStyler();return t&&t.getStyleAccessor&&(e=t.getStyleAccessor()),e}},n.EventTarget.addMixin(T.prototype),{EditorView:T}}),define("orion/editorPluginView",["orion/editor/editor","orion/commands","orion/editorCommands","orion/objects","orion/webui/littlelib","orion/PageLinks","orion/URITemplate"],function(e,t,n,i,r){function o(e,t){if(!e)return void window.console.log(t);var n=t.responseText;if(n)try{t=JSON.parse(n)}catch(i){t={Severity:"Error",Message:n}}e.setProgressResult(t)}function s(e){l.apply(this,arguments),this.editorService=e.editorService,this.id=this.editorService.getProperty("id"),this.metadata=e.metadata,this.serviceRegistry=e.serviceRegistry,this.pluginRegistry=e.pluginRegistry,this.statusService=e.statusService,this.inputManager=e.inputManager
}function a(e){this._parent=e.parent,this.serviceRegistry=e.serviceRegistry,this.pluginRegistry=e.pluginRegistry,this.contentTypeRegistry=e.contentTypeRegistry,this.commandRegistry=e.commandRegistry,this.statusService=e.statusService,this.progressService=e.progressService,this.editorService=e.editorService,this.metadata=e.metadata,this.inputManager=e.inputManager,this.readonly=e.readonly,this.model=e.model,this.undoStack=e.undoStack}var l=e.BaseEditor;return s.prototype=Object.create(l.prototype),i.mixin(s.prototype,{_getPlugin:function(){return this.pluginRegistry.getPlugin(this.editorService._properties.__plugin__)},_load:function(){for(var e=this.serviceRegistry,n=e.getServiceReferences("orion.edit.editor"),i=0;i<n.length;i++)n[i].getProperty("id")===this.id&&(this.editorService=n[i]);var r=e.getService(this.editorService);if(r.setBlob&&r.setBlob(new Blob([this._contents],{type:this.inputManager.getContentType().id})),r.setTextModel){var o=e.getService(e.getServiceReferences("orion.edit.model.context")[0]);o.processKey=function(e){t.processKey(e)},r.setTextModel(o)}if(r.registerKeys){var s=t.getKeyBindings(),a=[];Object.keys(s).forEach(function(e){var t=s[e].keyBinding;a.push({keyCode:t.keyCode,mod1:t.mod1,mod2:t.mod2,mod3:t.mod3,mod4:t.mod4})}),r.registerKeys(a)}},install:function(){var e=r.node(this._domNode),t=this._rootDiv=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.overflow="hidden";var n=this,i=this._getPlugin();i.setParent(t).then(function(){n._load()},function(e){o(n.statusService,e)}),e.appendChild(t),l.prototype.install.call(this)},onChanged:function(e){l.prototype.onChanged.call(this,e);var t=this.serviceRegistry.getService(this.editorService);t&&t.onChanged&&t.onChanged(e)},setInput:function(e,t,n,i){"string"!=typeof n&&(this._contents=n),l.prototype.setInput.call(this,e,t,n,i)},uninstall:function(){var e=this._getPlugin();e.setParent(null),r.empty(this._domNode),l.prototype.uninstall.call(this)}}),a.prototype={create:function(){this.editor=new s({domNode:this._parent,model:this.model,undoStack:this.undoStack,serviceRegistry:this.serviceRegistry,pluginRegistry:this.pluginRegistry,editorService:this.editorService,statusService:this.statusService,inputManager:this.inputManager,metadata:this.metadata}),this.editor.install();var e=new n.EditorCommandFactory({serviceRegistry:this.serviceRegistry,commandRegistry:this.commandRegistry,inputManager:this.inputManager,readonly:this.readonly,toolbarId:"toolsActions",saveToolbarId:"fileActions",editToolbarId:"editActions",navToolbarId:"pageNavigationActions"});e.generateBaseEditorCommands(this.editor)},destroy:function(){this.editor&&this.editor.destroy(),this.editor=null}},{PluginEditorView:a,PluginEditor:s}}),define("orion/markdownEditor",["marked/marked","orion/editor/editor","orion/editor/textStyler","orion/editor/util","orion/objects","orion/webui/littlelib","orion/URITemplate","orion/webui/splitter","orion/URL-shim"],function(e,t,n,i,r,o,s,a){function l(e,t,n,i){return function(r,o){if(-1===o.href.indexOf(":"))try{var s;if("filesystem:"===t.protocol?s={href:"filesystem:"+new URL(o.href,t.pathname).href}:(s=new URL(o.href,t),i&&(s.protocol="",s.host="")),"!"!==r[0][0])s.hash="",o.href=h.expand({resource:s.href,params:"editor=orion.editor.markdown"});else{var a=v[s.href];if(a)return"<img id='"+a.id+"' src='"+(a.src?a.src:"")+"'>";if(n.readBlob){var l="_md_img_"+p++;return n.readBlob(s.href).then(function(e){var t=s.href.match(u),n=t?"image/"+t[1]:"image/png",i=URL.createObjectURL(new Blob([e],{type:n}));document.getElementById(l).src=i,v[s.href].src=i}.bind(this)),v[s.href]={id:l},"<img id='"+l+"' src=''>"}o.href=s.href}}catch(d){console.log(d)}return e.call(this,r,o)}}function d(e){this.id="orion.editor.markdown",this._fileService=e.fileService,this._metadata=e.metadata,this._parent=e.parent,this._model=e.model,this._editorView=e.editorView,this._previewClickListener=function(e){var t=this._findNearestBlockElement(e.target);if(t){for(var n=t.getBoundingClientRect(),i=(e.clientY-n.top)/(n.bottom-n.top),r=this._editorView.editor.getTextView(),o=this._stylerAdapter.getBlockWithId(t.id),s=r.getModel(),l=s.mapOffset(o.start,!0);-1===l;)o=o.parent,l=s.mapOffset(o.start,!0);var d=r.getLocationAtOffset(l),c=s.mapOffset(o.end,!0);if(-1===c)for(var h=this._styler.getBlockAtIndex(o.end-1);-1===c;)h=h.parent,c=s.mapOffset(h.start,!0);var u=r.getLocationAtOffset(c),p=r.getLineAtOffset(c);u.y+=r.getLineHeight(p);var f=d.y+(u.y-d.y)*i,g=this._editorDiv.getBoundingClientRect();if(this._splitter.getOrientation()===a.ORIENTATION_VERTICAL)var m=g.height/2;else m=e.clientY-g.top;this._scrollSourceEditor(f-m)}}.bind(this),this._settingsListener=function(e){this._splitter.setOrientation(e.newSettings.splitOrientation),this._rootDiv.style.visibility="visible",this._splitterDiv.style.visibility="visible",this._styler.setTabsVisible(e.newSettings.showTabs),this._styler.setSpacesVisible(e.newSettings.showSpaces)}.bind(this),this._sourceScrollListener=function(e){if(this._ignoreEditorScrollsCounter)return void this._ignoreEditorScrollsCounter--;if(!e.newValue.y)return void this._scrollPreviewDiv(0);var t=this._editorView.editor.getTextView(),n=t.getBottomIndex();if(n===t.getModel().getLineCount()-1)return void this._scrollPreviewDiv(this._previewWrapperDiv.scrollHeight);var i=t.getTopIndex(),r=t.getCaretOffset(),o=t.getLineAtOffset(r);if(o>=i&&n>=o)var s=r;else s=t.getOffsetAtLocation(0,Math.floor(e.newValue.y+this._previewWrapperDiv.clientHeight/2));s=t.getModel().mapOffset(s);for(var a=this._styler.getBlockAtIndex(s),l=document.getElementById(a.elementId);!l&&a.parent;)a=a.parent,l=document.getElementById(a.elementId);this._alignPreviewOnSourceBlock(a,s)}.bind(this),this._sourceSelectionListener=function(e){for(var t=this._editorView.editor.getTextView().getModel(),n=t.mapOffset(e.newValue.start),i=this._styler.getBlockAtIndex(n),r=document.getElementById(i.elementId);!r&&i.parent;)i=i.parent,r=document.getElementById(i.elementId);this._selectedElement&&this._selectedElement!==r&&this._selectedElement.classList.remove(this._markdownSelected),this._selectedElement=r,this._selectedBlock=i,this._selectedElement&&this._selectedElement.classList.add(this._markdownSelected);var o=this._editorView.editor.getTextView(),s=o.getLineAtOffset(e.newValue.start),a=o.getTopIndex(!0),l=o.getBottomIndex(!0);s>=a&&l>=s&&this._alignPreviewOnSourceBlock(i,n)}.bind(this),this._splitterResizeListener=function(){this._editorView.editor.resize()}.bind(this),y.apply(this,arguments)}function c(e){this._options=e}var h=new s("#{,resource,params*}"),u=/\.([0-9a-z]+)(?:[\?#]|$)/i,p=0,f="_orionMDBlock",g="_previewDiv",m=function(t,n,i){this.model=t;var r=e.InlineLexer.prototype.outputLink,o=new URL(n,window.location.href);e.InlineLexer.prototype.outputLink=l(r,o,i,-1===n.indexOf(":")),this._markedOptions=e.parse.defaults,this._markedOptions.sanitize=!0,this._markedOptions.tables=!0,this._inlinePatterns=[];var s=0,a=Object.keys(e.InlineLexer.rules.gfm);a.forEach(function(t){if(0!==t.indexOf("_")){var n=e.InlineLexer.rules.gfm[t];if(n.source){var i=n.source.substring(1).replace(/\|\^/g,"|");i=i.replace(/[ ]\{2,\}/g,"(\\t| {2,})"),this._inlinePatterns.push({regex:new RegExp(i,"g"),name:t,index:s++})}}}.bind(this))};m.prototype={blockSpansBeyondEnd:function(){return!1},computeBlocks:function(t,n,i,r){var o,s=[];if(i.typeId){if("markup.quote.markdown"!==i.typeId&&"markup.list.markdown"!==i.typeId&&"markup.list.item.markdown"!==i.typeId)return s;o=i.seedTokens,i.seedTokens=null}var a=0;o=o||e.lexer(n,this._markedOptions);for(var l=0;l<o.length;l++){var d=null,c=null,h=null,u=null,p=null,f=null,g=null,m=null,v=null;c=null,this._whitespaceRegex.lastIndex=a;var y=this._whitespaceRegex.exec(n);if(y&&y.index===a&&(a+=y[0].length),"heading"===o[l].type){var _="setext"===o[l].style,C=this._getLineEnd(n,a,t);if(h=_?this._getLineEnd(n,a,t,1):C,_){var w=n.substring(C,h);this._setextUnderlineRegex.lastIndex=0;var b=this._setextUnderlineRegex.exec(w);b[0].length<w.length&&(h-=w.length-b[0].length)}d={start:a,contentStart:a+(_?0:o[l].depth+1),contentEnd:C,end:h},c="markup.heading.markdown",f=o[l],a=h}else if("paragraph"===o[l].type||"text"===o[l].type){var x=0;if(void 0!==o[l].pre)for(var S=0;;){if(this._htmlNewlineRegex.lastIndex=S,b=this._htmlNewlineRegex.exec(o[l].text),!b)break;x++,S=b.index+1}else b=o[l].text.match(this._newlineRegex),b&&(x=b.length);h=this._getLineEnd(n,a,t,x),this._isTop(i)?f=o[l]:(o[l].type="text",g=[o[l]]),d={start:a,contentStart:a,contentEnd:h,end:h},c="markup.other.paragraph.markdown",a=h}else if("blockquote_start"===o[l].type||"list_start"===o[l].type){if("blockquote_start"===o[l].type){m="blockquote_end";var L=this._blockquoteStartRegex;c="markup.quote.markdown"}else m="list_end",L=null,c="markup.list.markdown";for(var E=a,k=l,T=0;;){if(o[k].type===o[l].type)T++;else if(o[k].type===m){if(!--T)break}else a=this._advanceIndex(n,o[k],a);k++}if(this._newlineRegex.lastIndex=a,b=this._newlineRegex.exec(n),b&&(a=b.index+b[0].length),L){L.lastIndex=E,b=L.exec(n);var A=E+b[0].length}else A=E;a=Math.max(a,A),d={start:E,contentStart:A,contentEnd:a,end:a},p=o[l],m=o[k],v=o.slice(l+1,k),l=k}else if(-1!==o[l].type.indexOf("_item_start")){for(E=a,k=l,T=0;;){if("list_item_start"===o[k].type||"loose_item_start"===o[k].type)T++;else if("list_item_end"===o[k].type){if(!--T)break}else a=this._advanceIndex(n,o[k],a);k++}this._newlineRegex.lastIndex=a,b=this._newlineRegex.exec(n),b&&(a=b.index+b[0].length),e.Lexer.rules.normal.bullet.lastIndex=E,b=e.Lexer.rules.normal.bullet.exec(n),A=b.index+b[0].length,a=Math.max(a,A),d={start:E,contentStart:A,contentEnd:a,end:a},c="markup.list.item.markdown",p=o[l],m=o[k],v=o.slice(l+1,k),l=k}else"code"===o[l].type?(o[l].hasOwnProperty("lang")?(E=a,u=o[l].text.match(this._newlineRegex),h=this._getLineEnd(n,a,t,2+(u?u.length:0)),c="markup.raw.code.fenced.gfm"):(E=this._getLineStart(n,a),u=o[l].text.match(this._newlineRegex),h=this._getLineEnd(n,a,t,u?u.length:0),c="markup.raw.code.markdown"),d={start:E,contentStart:a,contentEnd:h,end:h},f=o[l],a=h):"hr"===o[l].type?(h=this._getLineEnd(n,a,t),d={start:a,contentStart:a,contentEnd:h,end:h},c="markup.other.separator.markdown",f=o[l],a=h):"table"===o[l].type?(h=this._getLineEnd(n,a,t,o[l].cells.length+1),d={start:a,contentStart:a,contentEnd:h,end:h},this._isTop(i)?(c="markup.other.table.gfm",f=o[l]):(c="markup.other.paragraph.markdown",g=[{type:"text",text:n.substring(a,h)}]),a=h):"space"===o[l].type&&(d={start:a,contentStart:a,contentEnd:a,end:a},c="markup.other.paragraph.markdown",g=[o[l]]);if(c){d.start=d.start+r,d.contentStart=d.contentStart+r,d.contentEnd=d.contentEnd+r,d.end=d.end+r;var N=this.createBlock(d,this._styler,t,i,c,function(e){i.name&&(e.name=i.name),e.startToken=p,f&&(e.tokens=[f]),e.endToken=m,e.seedTokens=v,g&&(e.parentTokens=g,e.doNotFold=!0)});s.push(N)}}return o.links&&Object.keys(o.links).length&&(i.links=o.links),s},computeStyle:function(){return null},createBlock:function(e,t,i,r,o,s){var a=new n.Block(e,o,o,t,i,r,s);return a.elementId=f+this._elementCounter++,this._blocksCache[a.elementId]=a,a},getBlockContentStyleName:function(e){return e.name},getBlockEndStyle:function(){return null},getBlockStartStyle:function(){return null},getBlockWithId:function(e){return this._blocksCache[e]},getBracketMatch:function(){return null},initialPopulatePreview:function(){var e=this._styler.getRootBlock();this._onBlocksChanged({old:[],"new":e.getBlocks()})},parse:function(e,t,n,i){if(n.typeId){var r=[];this._inlinePatterns.forEach(function(t){t.regex.lastIndex=0;var n=t.regex.exec(e);n&&r.push({result:n,pattern:t})}.bind(this)),r.sort(function(e,t){return e.result.index<t.result.index?-1:e.result.index>t.result.index?1:e.pattern.index<t.pattern.index?-1:1});for(var o=0;r.length>0;){var s=r[0];if(r.splice(0,1),s.result.index<o)this._updateMatch(s,e,r,o);else{var a=s.result.index;o=a+s.result[0].length;var l=null;-1!==s.pattern.name.indexOf("link")?l="markup.underline.link.markdown":"strong"===s.pattern.name?l="markup.bold.markdown":"em"===s.pattern.name?l="markup.italic.markdown":"code"===s.pattern.name?l="markup.raw.code.markdown":"br"===s.pattern.name?l="markup.other.br.markdown":"del"===s.pattern.name&&(l="markup.other.strikethrough.gfm"),l&&i.push({start:t+a,end:t+o,style:l,mergeable:!0}),this._updateMatch(s,e,r,o)}}}},setStyler:function(e){this._styler&&this._styler.removeEventListener("BlocksChanged",this._onBlocksChanged),this._styler=e,e.addEventListener("BlocksChanged",this._onBlocksChanged.bind(this))},setView:function(e){this._view=e},verifyBlock:function(e,t,n,i){for(var r=n.parent;r;){if("markup.list.markdown"===r.typeId||"markup.quote.markdown"===r.typeId)return!1;r=r.parent}var o=this.computeBlocks(e,t,n.parent,n.start);return o.length&&o[0].start===n.start&&o[0].end===n.end+i&&o[0].typeId===n.typeId&&o[0].getBlocks().length===n.getBlocks().length},_adoptTokens:function(e,t){e.tokens=t.tokens;for(var n=e.getBlocks(),i=t.getBlocks(),r=0;r<Math.min(n.length,i.length);r++)this._adoptTokens(n[r],i[r])},_advanceIndex:function(e,t,n){if(t.text){this._whitespaceRegex.lastIndex=0;var i=t.text.split(this._whitespaceRegex);i.forEach(function(t){t.length&&(n=e.indexOf(t,n)+t.length)})}else if("blockquote_start"===t.type){this._blockquoteStartRegex.lastIndex=n;var r=this._blockquoteStartRegex.exec(e);n=r.index+r[0].length}else"hr"===t.type?(this._hrRegex.lastIndex=n,r=this._hrRegex.exec(e),n=r.index+r[0].length):"space"===t.type||"table"===t.type&&(i=t.header.slice(),t.cells.forEach(function(e){i=i.concat(e)}),i.forEach(function(t){t.length&&(n=e.indexOf(t,n)+t.length)}));return n},_generateHTML:function(t,n){if(n.startToken||n.tokens){for(var i={},r=n;r;){if(r.links){i=r.links;break}r=r.parent}if(n.tokens){var o=n.tokens.slice();return o.links=i,void(t.innerHTML=e.Parser.parse(o,this._markedOptions))}if(n.startToken){o=[n.startToken,n.endToken],o.links=i,t.innerHTML=e.Parser.parse(o,this._markedOptions);var s=function(r){o=[n.startToken].concat(r).concat(n.endToken),o.links=i;var s=document.createElement("div");s.innerHTML=e.Parser.parse(o,this._markedOptions);for(var a=s.children[0].childNodes;a.length;)t.children[0].appendChild(a[0])}.bind(this),a=[];n.getBlocks().forEach(function(e){if(e.parentTokens)a=a.concat(e.parentTokens);else{a.length&&(s(a),a=[]);var n=document.createElement("div");this._generateHTML(n,e),n.id=e.elementId,t.children[0].appendChild(n)}}.bind(this)),a.length&&s(a)}}},_getLineStart:function(e,t){for(;0<=--t;){var n=e.charAt(t);if(n===this._NEWLINE||n===this._CR)return t+1}return 0},_getLineEnd:function(e,t,n,i){for(i=i||0;;){this._newlineRegex.lastIndex=t;var r=this._newlineRegex.exec(e);if(!r)return e.length;if(t=r.index+r[0].length,!i--)return t}},_isTop:function(e){return e.typeId?"markup.quote.markdown"===e.typeId?this._isTop(e.parent):!1:!0},_onBlocksChanged:function(e){if(1===e.old.length&&1===e.new.length&&e.old[0].elementId===e.new[0].elementId){if(!e.new[0].parent)return;var t=this.computeBlocks(this.model,this.model.getText(e.old[0].start,e.old[0].end),e.old[0].parent,e.old[0].start);this._adoptTokens(e.new[0],t[0])}var n,i,r,o=0,s=[];if(e.old.length){var a=document.getElementById(e.old[0].elementId);n=a.parentElement}else e.new.length&&(n=document.getElementById(e.new[0].parent.elementId)),n||(n=document.getElementById(g));for(i=0;i<n.children.length;i++)if(!a||n.children[i].id===a.id){for(r=i;r<i+e.old.length;r++)s.push(n.children[r]);break}for(e.new.forEach(function(t){var a=null;for(i=o;i<e.old.length;i++)if(e.old[i].elementId===t.elementId){for(a=s[i],r=i-1;r>=o;r--)n.removeChild(s[r]);o=i+1;break}a||(a=document.createElement("div"),a.id=t.elementId,s.length?n.insertBefore(a,s[o]):n.appendChild(a));var l=document.createElement("div");this._generateHTML(l,t),this._updateNode(a,l)}.bind(this)),i=e.old.length-1;i>=o;i--)n.removeChild(s[i])},_updateMatch:function(e,t,n,i){e.pattern.regex.lastIndex=i;var r=e.pattern.regex.exec(t);if(r){e.result=r;for(var o=0;o<n.length;o++)if(r.index<n[o].result.index||r.index===n[o].result.index&&e.pattern.index<n[o].pattern.index)return void n.splice(o,0,e);n.push(e)}},_updateNode:function(e,t){if("#text"===t.nodeName)return void(e.textContent=t.textContent);if("IMG"===t.nodeName&&e.src!==t.src)return void e.parentElement.replaceChild(t,e);for(var n=0,i=[],r=[],o=e.childNodes,s=0;s<o.length;s++)i.push(o[s]);for(o=t.childNodes,s=0;s<o.length;s++)r.push(o[s]);for(r.forEach(function(t){var r=null;for(s=n;s<i.length;s++)if(i[s].nodeName===t.nodeName){r=i[s];for(var o=s-1;o>=n;o--)e.removeChild(i[o]);n=s+1;break}r?this._updateNode(r,t):i.length?e.insertBefore(t,i[n]):e.appendChild(t)}.bind(this)),s=i.length-1;s>=n;s--)e.removeChild(i[s])},_CR:"\r",_NEWLINE:"\n",_blockquoteRemoveMarkersRegex:/^[ \t]*>[ \t]?/gm,_blockquoteStartRegex:/[ \t]*>[ \t]?/g,_blocksCache:{},_elementCounter:0,_hrRegex:/([ \t]*[-*_]){3,}/g,_htmlNewlineRegex:/\n\s*\S[\s\S]*$/g,_newlineRegex:/\n/g,_orderedListRegex:/\d+\.[ \t]/g,_setextUnderlineRegex:/^[ \t]*[-=]+[ \t]*\r?\n?/g,_whitespaceRegex:/\s+/g};var v={},y=t.BaseEditor;return d.prototype=Object.create(y.prototype),r.mixin(d.prototype,{initSourceEditor:function(){var e=this._editorView.editor,t=e.getTextView(),i=e.getAnnotationModel();this._stylerAdapter=new m(this._model,this._metadata.Location,this._fileService),this._styler=new n.TextStyler(t,i,this._stylerAdapter),this._editorView.editor.getTextView().addEventListener("Scroll",this._sourceScrollListener),this._editorView.editor.getTextView().addEventListener("Selection",this._sourceSelectionListener),this._splitter.addEventListener("resize",this._splitterResizeListener),this._previewDiv.addEventListener("click",this._previewClickListener),this._model.getCharCount()&&this._stylerAdapter.initialPopulatePreview();var r=this._editorView.getSettings();this._styler.setTabsVisible(r.showTabs),this._styler.setSpacesVisible(r.showSpaces)},install:function(){this._rootDiv=document.createElement("div"),this._rootDiv.style.position="absolute",this._rootDiv.style.width="100%",this._rootDiv.style.height="100%",this._parent.appendChild(this._rootDiv),this._editorDiv=document.createElement("div"),this._rootDiv.appendChild(this._editorDiv),this._editorView.setParent(this._editorDiv),this._splitterDiv=document.createElement("div"),this._splitterDiv.id="orion.markdown.editor.splitter",this._rootDiv.appendChild(this._splitterDiv),this._previewWrapperDiv=document.createElement("div"),this._previewWrapperDiv.style.overflowX="hidden",this._previewWrapperDiv.style.overflowY="auto",this._rootDiv.appendChild(this._previewWrapperDiv),this._previewDiv=document.createElement("div"),this._previewDiv.id=g,this._previewDiv.classList.add("orionMarkdown"),this._previewWrapperDiv.appendChild(this._previewDiv),this._editorView.addEventListener("Settings",this._settingsListener);var e=this._editorView.getSettings();this._splitter=new a.Splitter({node:this._splitterDiv,sidePanel:this._editorDiv,mainPanel:this._previewWrapperDiv,vertical:e&&e.splitOrientation===a.ORIENTATION_VERTICAL}),e||(this._rootDiv.style.visibility="hidden",this._splitterDiv.style.visibility="hidden"),y.prototype.install.call(this)},uninstall:function(){this._styler.destroy(),this._editorView.removeEventListener("Settings",this._settingsListener);var e=this._editorView.editor.getTextView();e.removeEventListener("Scroll",this._sourceScrollListener),e.removeEventListener("Selection",this._sourceSelectionListener),this._splitter.removeEventListener("resize",this._splitterResizeListener),this._previewDiv.removeEventListener("click",this._previewClickListener),o.empty(this._parent),y.prototype.uninstall.call(this)},_alignPreviewOnSourceBlock:function(e,t){var n=this._editorView.editor.getTextView(),i=n.getModel(),r=document.getElementById(e.elementId);if(r){var o=i.mapOffset(e.start,!0),s=i.mapOffset(e.end,!0);if(-1===s)for(var l=this._styler.getBlockAtIndex(e.end-1);-1===s;)l=l.parent,s=i.mapOffset(l.start,!0);var d=n.getLocationAtOffset(o),c=n.getLocationAtOffset(s),h=n.getLineAtOffset(s),u=n.getLineHeight(h);c.y+=u}else{var p=e.getBlockAtIndex(t),f=e.getBlocks(),g=p?f[p-1].end:0;if(p<f.length)var m=f[p].start;else m=this._model.getCharCount();d=n.getLocationAtOffset(i.mapOffset(g,!0));var v=i.mapOffset(m,!0);c=n.getLocationAtOffset(v),h=n.getLineAtOffset(v),u=n.getLineHeight(h),c.y+=u}var y=c.y-d.y,_=n.getLocationAtOffset(i.mapOffset(t,!0));_.y+=c.y-d.y===u?n.getLineHeight()/2:n.getLineHeight();var C=(_.y-d.y)/y,w=this._previewWrapperDiv.getBoundingClientRect();if(this._splitter.getOrientation()===a.ORIENTATION_VERTICAL)var b=(w.bottom-w.top)/2;else b=_.y-n.getTopPixel();if(r)var x=r.getBoundingClientRect(),S=x.top-w.top+this._previewWrapperDiv.scrollTop,L=S+r.offsetHeight*C;else{if(p<f.length)var E=document.getElementById(f[p].elementId),k=E.getBoundingClientRect().top;else k=w.bottom;if(p)var T=document.getElementById(f[p-1].elementId),A=T.getBoundingClientRect().bottom;else A=0;var N=A-w.top+this._previewWrapperDiv.scrollTop;L=N+(k-A)*C}this._scrollPreviewDiv(L-b)},_findNearestBlockElement:function(e){if(e.id===g)return null;for(var t=e,n=e,i=!0;i;){if(i=!1,t){if(!t.id.indexOf(f))return t;t=t.nextElementSibling,i=!0}if(n){if(!n.id.indexOf(f))return n;n=n.previousElementSibling,i=!0}}return this._findNearestBlockElement(e.parentElement)},_scrollPreviewDiv:function(e){this._scrollPreviewAnimation&&(this._scrollPreviewAnimation.stop(),this._scrollPreviewAnimation=null);var t=e-this._previewWrapperDiv.scrollTop;if(t){var n=this._editorView.getSettings();this._scrollPreviewAnimation=new i.Animation({window:window,curve:[t,0],duration:n.scrollAnimation?n.scrollAnimationTimeout:0,onAnimate:function(e){var n=t-Math.floor(e);this._previewWrapperDiv.scrollTop+=n,t-=n}.bind(this),onEnd:function(){this._scrollPreviewAnimation=null,this._previewWrapperDiv.scrollTop+=t}.bind(this)}),this._scrollPreviewAnimation.play()}},_scrollSourceEditor:function(e){this._scrollSourceAnimation&&(this._scrollSourceAnimation.stop(),this._scrollSourceAnimation=null);var t=this._editorView.editor.getTextView(),n=e-t.getTopPixel();if(n){var r=this._editorView.getSettings();this._scrollSourceAnimation=new i.Animation({window:window,curve:[n,0],duration:r.scrollAnimation?r.scrollAnimationTimeout:0,onAnimate:function(e){var i=n-Math.floor(e);t.setTopPixel(t.getTopPixel()+i),n-=i}.bind(this),onEnd:function(){this._scrollSourceAnimation=null;var e=Math.floor(t.getTopPixel()+n);this._ignoreEditorScrollsCounter=1,t.setTopPixel(e)}.bind(this)}),this._ignoreEditorScrollsCounter=1/0,this._scrollSourceAnimation.play()}},_markdownSelected:"markdownSelected",_selectedBlock:null}),c.prototype={create:function(){this.editor=new d(this._options),this.editor.install(),this._options.editorView.create(),this.editor.initSourceEditor()},destroy:function(){this.editor.destroy(),this.editor=null,this._options.editorView.destroy(),this._options.editorView=null}},{MarkdownEditorView:c}}),define("orion/urlUtils",["orion/PageUtil","orion/URL-shim"],function(e){function t(t){for(var n=/\[([^\]]*)\]\(([^\)]+)\)/g,i=n.exec(t),r=[],o=0;i;){if(3===i.length&&i[2].length>0){var s=new URL(i[2]);":"!==s.protocol&&e.validateURLScheme(s.href)&&(i.index>o&&r.push({segmentStr:t.substring(o,i.index)}),r.push({segmentStr:i[1].length>0?i[1]:i[2],urlStr:i[2]}),o=i.index+i[0].length)}i=n.exec(t)}return 0===o?null:(o<t.length&&r.push({segmentStr:t.substring(o)}),r)}function n(e,t){t.forEach(function(t){if(t.urlStr){var n=document.createElement("a");n.href=t.urlStr,n.appendChild(document.createTextNode(t.segmentStr)),e.appendChild(n)}else{var i=document.createElement("span");i.textContent=t.segmentStr,e.appendChild(i)}})}return{detectValidURL:t,processURLSegments:n}}),define("orion/status",["i18n!orion/nls/messages","orion/webui/littlelib","orion/globalCommands","orion/urlUtils"],function(e,t,n,i){function r(e,t,n,i,r){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.message",this),this._operationsClient=t,this.notificationContainerDomId=r,this.domId=n,this.progressDomId=i||n,this._hookedClose=!1,this._timer=null,this._clickToDisMiss=!0,this._cancelMsg=null}var o;return r.prototype={_init:function(){var e=t.node("closeNotifications");if(e&&!this._hookedClose){e.style.cursor="pointer",this._hookedClose=!0;var n=t.node(this.notificationContainerDomId);t.addAutoDismiss([n],function(){this._clickToDisMiss&&this.close()}.bind(this)),e.addEventListener("click",function(){this.close()}.bind(this)),n.addEventListener("click",function(e){if(e&&e.target&&"a"===e.target.nodeName.toLowerCase()){var i=t.$$("a",n);i&&i.length&&1===i.length&&this.close()}}.bind(this))}},close:function(){window.clearTimeout(this._timer);var e=t.node("closeNotifications");this._cancelMsg&&this._cancelFunc&&e?(e.innerHTML="",e.classList.remove("cancelButton"),e.classList.add("dismissButton"),e.classList.add("core-sprite-close"),e.classList.add("imageSprite"),this._cancelFunc(),this._cancelMsg=null):this.setProgressMessage("")},_getNotifierElements:function(){return this._notifierElements||(this._notifierElements=n.getToolbarElements(this.notificationContainerDomId)),this._notifierElements},setMessage:function(e,n,i){this._init(),this.currentMessage=e;var r=t.node(this.domId);if("boolean"==typeof i){var o=r.getAttribute("aria-live");r.setAttribute("aria-live",i?"polite":"off"),window.setTimeout(function(){e===this.currentMessage&&(t.empty(r),r.appendChild(document.createTextNode(e)),window.setTimeout(function(){r.setAttribute("aria-live",o)},100))}.bind(this),100)}else t.empty(r),r.appendChild(document.createTextNode(e));"number"==typeof n&&window.setTimeout(function(){e===this.currentMessage&&(t.empty(r),r.appendChild(document.createTextNode("")))}.bind(this),n)},setErrorMessage:function(e){this._clickToDisMiss=!0,this.currentMessage=e,this._init();var n=e.responseText||e.message||e;if("string"==typeof n)try{n=JSON.parse(n)}catch(i){}var r=n.Message||n,o="red";if(n.Severity)switch(n.Severity){case"Warning":o="#FFCC00";break;case"Error":o="red";break;case"Info":case"Ok":o="green"}var s=document.createElement("span");s.style.color=o,s.appendChild(document.createTextNode(r));var a=t.node(this.domId);t.empty(a),a.appendChild(s)},setProgressMessage:function(e){this._clickToDisMiss=!1,this._init(),this.currentMessage=e;var n=document.createElement("span");n.classList.add("progressIcon");var i=t.node(this.progressDomId);t.empty(i),i.appendChild(n),i.appendChild(document.createTextNode(e));var r=t.node(this.notificationContainerDomId);if(r.classList.remove("notificationHide"),e&&e.length>0)r.classList.add("progressNormal"),r.classList.add("notificationShow");else{if(this._progressMonitors&&this._progressMonitors.length>0)return this._renderOngoingMonitors();r.classList.remove("notificationShow"),r.classList.add("notificationHide")}},setCancelFunction:function(e){this._cancelFunc=e},setProgressResult:function(n,r){this._clickToDisMiss=!1,this._cancelMsg=r,this.currentMessage=n;var o=n.responseText||n;if("string"==typeof o)try{o=JSON.parse(o)}catch(s){}this._init();var a=o.Message||o.toString(),l=e.UnknownError,d="core-sprite-information",c="progressNormal",h=document.createElement("span");h.classList.add("imageSprite"),h.classList.add("progressIcon");var u=[];if(o.Severity)switch(o.Severity){case"Warning":l=e.UnknownWarning,d="core-sprite-warning",c="progressWarning",u.push("progressInfo"),u.push("progressError"),u.push("progressNormal"),this._clickToDisMiss=!0;break;case"Error":d="core-sprite-error",c="progressError",u.push("progressWarning"),u.push("progressInfo"),u.push("progressNormal"),this._clickToDisMiss=!0;break;default:c="progressNormal",u.push("progressWarning"),u.push("progressError"),u.push("progressNormal")}u.push("notificationHide"),h.classList.add(d);var p=t.node(this.progressDomId),f=t.node(this.notificationContainerDomId);if(t.empty(p),p.appendChild(h),a===Object.prototype.toString()&&(a=l),o.HTML){var g=document.createElement("span");g.innerHTML=a,p.appendChild(g)}else{var m,v=i.detectValidURL(a);v?(m=document.createDocumentFragment(),i.processURLSegments(m,v),Array.prototype.forEach.call(t.$$("a",m),function(e){e.target="_blank"})):("Warning"===o.Severity||"Error"===o.Severity||r||(this._timer&&window.clearTimeout(this._timer),this._timer=window.setTimeout(function(){this.setProgressMessage(""),this._timer=null}.bind(this),5e3)),m=document.createTextNode(a)),p.appendChild(m)}if(c&&this.progressDomId!==this.domId){f.classList.add(c);for(var y=0;y<u.length;y++)f.classList.remove(u[y])}f.classList.add("notificationShow");var _=t.node("closeNotifications");_&&(this._cancelMsg?(_.classList.add("cancelButton"),_.classList.remove("dismissButton"),_.classList.remove("core-sprite-close"),_.classList.remove("imageSprite"),_.innerHTML=this._cancelMsg):(_.innerHTML="",_.classList.remove("cancelButton"),_.classList.add("dismissButton"),_.classList.add("core-sprite-close"),_.classList.add("imageSprite")))},showWhile:function(e,t){var n=this;if(t){n.setProgressMessage(t);var i=function(){t===n.currentMessage&&n.setProgressMessage("")};e.then(i,i)}return e},_lastProgressId:0,_progressMonitors:{length:0},createProgressMonitor:function(e,t){return new o(this,++this._lastProgressId,e,t)},_renderOngoingMonitors:function(){if(this._progressMonitors.length>0){var e="",t=!0;for(var n in this._progressMonitors)this._progressMonitors[n].status&&(t||(e+=", "),e+=this._progressMonitors[n].status,t=!1);this.setProgressMessage(e)}else this.setProgressMessage("")},_beginProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._progressMonitors.length++,this._renderOngoingMonitors()},_workedProgressMonitor:function(e){this._progressMonitors[e.progressId]=e,this._renderOngoingMonitors()},_doneProgressMonitor:function(e){delete this._progressMonitors[e.progressId],this._progressMonitors.length--,e.status?this.setProgressResult(e.status):this._renderOngoingMonitors()}},r.prototype.constructor=r,o=function(e,t,n,i){if(this.statusService=e,this.progressId=t,n){this.deferred=n,this.begin(i);var r=this;n.then(function(){r.done.bind(r)()},function(){r.done.bind(r)()})}},o.prototype.begin=function(e){this.status=e,this.statusService._beginProgressMonitor(this)},o.prototype.done=function(e){this.status=e,this.statusService._doneProgressMonitor(this)},o.prototype.worked=function(e){this.status=e,this.statusService._workedProgressMonitor(this)},o.prototype.constructor=o,{StatusReportingService:r,ProgressMonitor:o}}),define("orion/operations/nls/root/messages",{More:"More","No Matching OperationService for location:":"No Matching OperationService for location:","No operations services registered.":"No operations services registered.","could not find toolbar ":"could not find toolbar ","Remove Completed":"Remove Completed","Remove all completed operations":"Remove all completed operations",Remove:"Remove","Remove operations from the operations list.":"Remove operations from the operations list.",Cancel:"Cancel","Cancel operations from the operations list.":"Cancel operations from the operations list.","Operation resulted in a warning.":"Operation resulted in a warning.","Operation resulted in an error.":"Operation resulted in an error.","Operation is running.":"Operation is running.","Operation is canceled.":"Operation is canceled.","Operation failed.":"Operation failed.",Name:"Name",Actions:"Actions",Status:"Status",Scheduled:"Scheduled"}),define("orion/operations/nls/messages",["orion/i18n!orion/operations/nls/messages","orion/operations/nls/root/messages"],function(e,t){var n={root:t};return Object.keys(e).forEach(function(t){"undefined"==typeof n[t]&&(n[t]=e[t])}),n}),define("orion/operationsCommands",["i18n!orion/operations/nls/messages","require","orion/webui/littlelib","orion/commands"],function(e,t,n,i){var r={};return function(){var t=!1;r.updateNavTools=function(i,r,o,s,a,l){var d=r,c=n.node(s);if(!c)throw e["could not find toolbar "]+s;if(d.destroy(c),d.renderCommands(s,c,l,o,"button"),a){var h=n.node(a);
h&&(d.destroy(h),d.renderCommands(a,h,null,o,"button"))}t||(t=!0,i.getService("orion.page.selection").addEventListener("selectionChanged",function(e){var t=n.node(a);t&&(d.destroy(t),d.renderCommands(a,t,e.selections,o,"button"))}))},r.createOperationsCommands=function(t,n,r){function o(e){return e.operation&&e.operation.type?"loadstart"===e.operation.type||"progress"===e.operation.type:!1}function s(e){return e.operation&&e.operation.cancelable?!0:!1}var a=new i.Command({name:e["Remove Completed"],tooltip:e["Remove all completed operations"],id:"eclipse.removeCompletedOperations",callback:function(){r.removeCompletedOperations().then(function(){n.loadOperations.bind(n)()})},visibleWhen:function(){return!0}});t.addCommand(a);var l=new i.Command({name:e.Remove,tooltip:e["Remove operations from the operations list."],imageClass:"core-sprite-delete",id:"eclipse.removeOperation",callback:function(e){for(var t=Array.isArray(e.items)?e.items:[e.items],i=0;i<t.length;i++){var o=t[i];r.removeOperation.bind(r)(o.Location).then(function(){n.loadOperations.bind(n)()},function(){n.loadOperations.bind(n)()})}},visibleWhen:function(e){if(!Array.isArray(e)||0===e.length)return!o(e);for(var t in e)if(o(e[t]))return!1;return!0}});t.addCommand(l);var d=new i.Command({name:e.Cancel,tooltip:e["Cancel operations from the operations list."],imageClass:"core-sprite-stop",id:"eclipse.cancelOperation",callback:function(e){for(var t=Array.isArray(e.items)?e.items:[e.items],n=0;n<t.length;n++){var i=t[n];i.deferred&&i.deferred.cancel()}},visibleWhen:function(e){if(!Array.isArray(e)||0===e.length)return o(e)&&s(e);for(var t in e)if(!o(e[t])||!s(e[t]))return!1;return!0}});t.addCommand(d)}}(),r}),define("orion/webui/dialogs/OperationsDialog",["i18n!orion/operations/nls/messages","require","orion/webui/littlelib","orion/webui/popupdialog","orion/operationsCommands"],function(e,t,n,i,r){function o(e){this._options=e}return o.prototype=new i.PopupDialog,o.prototype.TEMPLATE='<table style="width: 360px;"><tr><td><h2>Recent operations</h2></td><td style="text-align: right;"><a id="allOperationsLink" class="navlinkonpage">All Operations</a></td></tr></table><div id="operationsExist"><div style="padding-left: 7px" id="myOperationsListEmpty">No operations running on this page.</div><table id="myOperationsList" style="display: none;"></table></div><div style="padding-left: 7px" id="operationsDontExist">No operations running.</div>',o.prototype._init=function(e){this._myOperations=[],this._operationsDeferreds=[],this._commandService=e.commandRegistry,r.createOperationsCommands(this._commandService),this._commandService.registerCommandContribution("operationsDialogItems","eclipse.cancelOperation",1),this._initialize(e.triggerNode)},o.prototype._bindToDom=function(){this.$allOperationsLink.href=t.toUrl("operations/list.html"),this._setOperationsVisibility()},o.prototype.setOperations=function(e,t){if(this._myOperations||this._init(this._options),this._myOperations=[],this._operationsDeferreds=[],e)for(var n in e)this._myOperations.push(e[n]),this._operationsDeferreds.push(t[n]);this._renderOperations()},o.prototype.parseProgressResult=function(e){if(!e)return{};var t=e.responseText||e;try{t=JSON.parse(t)}catch(n){}var i={Message:t.Message||t,Severity:t.Severity};return t.DetailedMessage&&t.DetailedMessage!==i.Message&&(i.DetailedMessage=t.DetailedMessage),i},o.prototype._renderOperations=function(){this._renderOperationsTable(this.$myOperationsList,this._myOperations,this._operationsDeferreds)},o.prototype._renderOperationsTable=function(t,i,r){n.empty(t);for(var o=0;o<i.length;o++){var s=i[o],a=document.createElement("tr"),l=document.createElement("td");l.style.paddingLeft="5px",l.style.paddingRight="5px",l.textContent=s.Name,a.appendChild(l);var d=document.createElement("div");l.appendChild(d);var c=document.createElement("span");switch(c.style.paddingRight="5px",c.classList.add("imageSprite"),s.type){case"Warning":c.classList.add("core-sprite-warning"),c.setAttribute("aria-label",e["Operation resulted in a warning."]);break;case"error":c.classList.add("core-sprite-error"),c.setAttribute("aria-label",e["Operation resulted in an error."]);break;case"loadstart":case"progress":c.classList.add("core-sprite-start"),c.setAttribute("aria-label",e["Operation is running."]);break;case"abort":c.classList.add("core-sprite-stop"),c.setAttribute("aria-label",e["Operation is canceled."]);break;case"load":case"loadend":c.classList.add("core-sprite-ok"),c.setAttribute("aria-label","Operation ok.")}d.appendChild(c);var h=document.createElement("span");if(h.classList.add("operationStatus"),h.textContent=s.Name,d.appendChild(h),s.error){var u=s.error.Message||s.error;s.error.DetailedMessage&&""!==s.error.DetailedMessage&&(u+=": "+s.error.DetailedMessage),h.textContent=u,h.classList.remove("operationStatus"),h.classList.add("operationError")}this._commandService.renderCommands("operationsDialogItems",d,{operation:s,deferred:r[o]},this,"tool"),t.appendChild(a)}this._setOperationsVisibility()},o.prototype._setOperationsVisibility=function(){this.$myOperationsList.style.display=this._myOperations.length>0?"":"none",this.$myOperationsListEmpty.style.display=this._myOperations.length>0?"none":"",this.$operationsDontExist.style.display=this._myOperations.length>0?"none":"",this.$operationsExist.style.display=this._myOperations.length>0?"":"none"},o.prototype.constructor=o,{OperationsDialog:o}}),define("orion/progress",["i18n!orion/nls/messages","require","orion/Deferred","orion/webui/littlelib","orion/webui/dialogs/OperationsDialog"],function(e,t,n,i,r){function o(e,t){if(!this._progressPane){this._progressPane=i.node(e),this._operationsDialog=new r.OperationsDialog({triggerNode:this._progressPane,commandRegistry:t});var n=this;this._progressPane.addEventListener("keydown",function(e){(" "===e.charOrCode||e.keyCode===i.KEY.ENTER)&&n._operationsDialog.show()}),this._progressPane.addEventListener("click",function(){n._operationsDialog.show()}),this._operationsDialog.setOperations(null,null)}}function s(e,t,n,i){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.progress",this),this._commandRegistry=n,this._operationsClient=t,this._operations={},this._operationDeferrds={},this._operationsIndex=0,this._lastOperation=null,this._lastIconClass=null,this._progressMonitorClass=i}return o.prototype={_switchIconTo:function(e){this._lastIconClass&&this._progressPane.classList.remove(this._lastIconClass),this._lastIconClass=e,this._progressPane.classList.add(this._lastIconClass)},generateOperationsInfo:function(t,n){var i={};for(var r in t)t[r].progressMonitor||(i[r]=t[r]);if(this._isEmpty(i))return this._switchIconTo("progressPane_empty"),this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),void this._operationsDialog.setOperations(i,n);var o="";for(var r in i){var s=i[r];if(s.type&&("loadstart"===s.type||"progress"===s.type)){o="running";break}}switch(""===o&&null!=this._lastOperation&&this._lastOperation.type&&"error"===this._lastOperation.type,o){case"running":this._progressPane.title=e["Operations running"],this._progressPane.alt=e["Operations running"],this._progressPane.setAttribute("aria-valuetext",e["Operations running"]),this._switchIconTo("running");break;case"warning":this._progressPane.title=e["Some operations finished with warning"],this._progressPane.alt=e["Some operations finished with warning"],this._progressPane.setAttribute("aria-valuetext",e["Some operations finished with warning"]),this._switchIconTo("warning");break;case"error":this._progressPane.title=e["Some operations finished with error"],this._progressPane.alt=e["Some operations finished with error"],this._progressPane.setAttribute("aria-valuetext",e["Some operations finished with error"]),this._switchIconTo("error");break;default:this._progressPane.title=e.Operations,this._progressPane.alt=e.Operations,this._progressPane.hasAttribute("aria-valuetext")&&this._progressPane.removeAttribute("aria-valuetext"),this._switchIconTo("progressPane_empty")}this._operationsDialog.setOperations(i,n)},_isEmpty:function(e){for(var t in e)return!1;return!0}},o.prototype.constructor=o,s.prototype={init:function(e){this._progressMonitorClass||(this._progressMonitorTool=new o(e,this._commandRegistry))},progress:function(e,t,n){var i=this,r=this._operationsIndex++;return!n&&this._progressMonitorClass&&(n=new this._progressMonitorClass,n.begin(t)),e.then(function(){if(i._operations[r]){var o=i._operations[r];t&&(o.Name=t),i._lastOperation=o,o.type="loadend",n&&(o.progressMonitor=n),i.writeOperation.bind(i)(r,o,e),o.Location||i._removeOperationFromTheList.bind(i)(r)}},function(o){if(i._operations[r]){var s=i._operations[r];t&&(s.Name=t),n&&(s.progressMonitor=n),i._lastOperation=s,s.type=o.canceled?"abort":"error",s.error=o,i.writeOperation.bind(i)(r,s,e),s.Location||i._removeOperationFromTheList.bind(i)(r)}},function(o){t&&(o.Name=t),n&&(o.progressMonitor=n),i.writeOperation.bind(i)(r,o,e)}),e},removeOperation:function(e){var t=this;for(var n in this._operations)if(this._operations[n].Location&&this._operations[n].Location===e){this._removeOperationFromTheList(n);break}t._operationsClient.removeOperation.bind(t._operationsClient)(e)},_removeOperationFromTheList:function(e){var t=this._operations[e].progressMonitor;delete this._operations[e],delete this._operationDeferrds[e],t?t.done():this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)},removeCompletedOperations:function(){for(var e in this._operations){var t=this._operations[e];if(t.type&&"loadstart"!==t.type&&"progress"!==t.type){var n=this._operations[e].progressMonitor;n&&n.done(),delete this._operations[e],delete this._operationDeferrds[e]}}this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)},setProgressResult:function(e){this._serviceRegistry.getService("orion.page.message").setProgressResult(e)},showWhile:function(e,t,n){t&&this._serviceRegistry.getService("orion.page.message").setProgressMessage(t);var i=this;return e.then(function(){i._serviceRegistry.getService("orion.page.message").setProgressMessage("")},function(e){return n?i._serviceRegistry.getService("orion.page.message").setProgressMessage(""):i.setProgressResult.bind(i)(e),e}),this.progress(e,t)},writeOperation:function(e,t,n){this._operations[e]=t,this._operationDeferrds[e]=n,t.Location&&this._serviceRegistry.getService("orion.core.preference").getPreferences("/operations").then(function(e){e.put(t.Location,{Name:t.Name,expires:t.expires})}),t.progressMonitor?t.progressMonitor.progress(t.Name):this._progressMonitorTool.generateOperationsInfo(this._operations,this._operationDeferrds)}},s.prototype.constructor=s,{ProgressService:s}}),define("orion/operationsClient",["i18n!orion/operations/nls/messages","orion/Deferred"],function(e,t){function n(e,t,n){return e[t].apply(e,n)}function i(e){this._location=e}function r(){var n=new t;return n.reject(e["No Matching OperationService for location:"]+this._location),n}function o(e){this._services=[],this._patterns=[],this._operationListeners=[],this._currentLongpollingIds=[],this._preferenceService=e.getService("orion.core.preference");for(var t=e.getServiceReferences("orion.core.operation"),n=0;n<t.length;n++){var r=t[n],o=e.getService(r);this._services[n]=o;var s=t[n].getProperty("pattern")||".*";"^"!==s[0]&&(s="^"+s),this._patterns[n]=new RegExp(s)}this._getService=function(e){if(!e)return this._services[0];for(var t=0;t<this._patterns.length;++t)if(this._patterns[t].test(e))return this._services[t];return this._operations.remove(e),new i(e)}}return i.prototype={getOperation:r,getOperations:r,removeCompletedOperations:r,removeOperation:r,cancelOperation:r},i.prototype.constructor=i,o.prototype={getOperations:function(){var e=new t;if(this._operations)return e.resolve(this._operations),e;var n=this;return this._preferenceService.getPreferences("/operations").then(function(t){n._operations=t,e.resolve(n._operations)}),e},getOperation:function(e){return n(this._getService(e),"getOperation",arguments)},removeCompletedOperations:function(){for(var e=[],i=this,r=0;r<this._services.length;r++){var o=this._patterns[r],s=new t;e[r]=s.promise,n(this._services[r],"removeCompletedOperations").then(function(e){return function(t){Array.isArray(t)&&i.getOperations.bind(i)().then(function(n){for(var i=n.keys(),r=0;r<i.length;r++){var s=i[r];o.test(s)&&t.indexOf(s)<0&&n.remove(s)}e.resolve()})}}(s),function(e){return function(t){e.reject(t)}}(s))}return t.all(e)},removeOperation:function(e){var t=this;return n(this._getService(e),"removeOperation",arguments).then(function(){t.getOperations.bind(t)().then(function(t){t.remove(e)})},function(e){return e},function(e){return e})}},o.prototype.constructor=o,{OperationsClient:o}}),define("orion/dialogs",[],function(){function e(e){this._serviceRegistry=e,this._serviceRegistration=e.registerService("orion.page.dialog",this)}return e.prototype={confirm:function(e,t){t(window.confirm(e))},openFiles:function(){}},e.prototype.constructor=e,{DialogService:e}}),define("orion/searchClient",["i18n!orion/search/nls/messages","require","orion/webui/littlelib","orion/i18nUtil","orion/searchUtils","orion/crawler/searchCrawler","orion/explorers/navigatorRenderer","orion/extensionCommands","orion/Deferred"],function(e,t,n,i,r,o,s,a,l){function d(e,t){this.serviceRegistry=e,this.commandRegistry=t,this.openWithCommands=null}function c(e){this.registry=e.serviceRegistry,this._commandService=e.commandService,this._fileService=e.fileService,this.defaultRenderer=new d(this.registry,this._commandService),this._fileService||console.error("No file service on search client")}return d.prototype.makeRenderFunction=function(o,d,c,h,u){function p(a,p,f,v){l.when(m.openWithCommands,function(l){if(f){n.empty(d);var m=document.createElement("div");return m.appendChild(document.createTextNode(e["Search failed."])),d.appendChild(m),void("function"==typeof h&&h(d))}var y=function(){function e(e,t){var n=t.folderName?t.folderName:t.path,i=document.createElement("span");i.id=n.replace(/[^a-zA-Z0-9_\.:\-]/g,""),i.appendChild(document.createTextNode(" - "+n+" ")),e.appendChild(i)}function t(t,i){var r=i.name;if(n.hasOwnProperty(r)){e(t,i);var o=n[r];"function"==typeof o&&(n[r]=null,o())}else n[r]=function(){e(t,i)}}var n={};return t}(),_=!1;if(n.empty(d),a&&a.length>0){var C=document.createElement("table");C.setAttribute("role","presentation");for(var w=0;w<a.length;w++){var b,x=a[w];if(!_&&(_=!0,c)){var S=C.insertRow(0);b=S.insertCell(0),b.textContent=c}var L=C.insertRow(-1);b=L.insertCell(0),b.colspan=2,u&&u(b);var E={Name:x.name,Directory:x.directory,Location:x.path||x.location},k=null;if("number"==typeof x.LineNumber&&(k={},k.line=x.LineNumber),v&&v.keyword&&!v.nameSearch){var T=r.generateSearchHelper(v);k=k||{},k.find=T.inFileQuery.searchStr,k.regEx=T.inFileQuery.wildCard?!0:void 0}var A=s.createLink(t.toUrl("edit/edit.html"),E,g,o,l,{"aria-describedby":(x.folderName?x.folderName:x.path).replace(/[^a-zA-Z0-9_\.:\-]/g,""),style:{verticalAlign:"middle"}},k);x.LineNumber&&A.appendChild(document.createTextNode(" (Line "+x.LineNumber+")")),b.appendChild(A),y(b,x)}d.appendChild(C),"function"==typeof h&&h(d)}if(!_&&p){var N=i.formatMessage(e["No matches found for ${0}"],p);n.empty(d),d.appendChild(document.createTextNode(N)),"function"==typeof h&&h(d)}})}var f=this.serviceRegistry,g=this.commandRegistry;this.openWithCommands=this.openWithCommands||a.createOpenWithCommands(f,o,g);var m=this;return p},c.prototype={search:function(e,t,n){var i=function(e){for(var n=[],i=0;i<e.response.docs.length;i++){var o=e.response.docs[i],s=o.Location,a=r.path2FolderName(o.Path?o.Path:o.Location,o.Name),l=a?a:s,d=t?l.indexOf(t)>=0:!0;d&&n.push({name:o.Name,path:s,folderName:a,directory:o.Directory,lineNumber:o.LineNumber})}return n};if(this._crawler&&e.nameSearch)this._crawler.searchName(e,function(t){n(i(t),e.keyword,null,e)});else try{this.registry.getService("orion.page.progress").progress(this._fileService.search(e),"Searching "+e.keyword).then(function(t){var r=e.keyword;r=r.substring(r.indexOf("}")+1),r=r.substring(r.indexOf(":")+1),n(i(t),r,null,e)},function(e){n(null,null,e,null)})}catch(s){if("string"==typeof s&&s.indexOf("search")>-1&&this._crawler)this._crawler.searchName(e,function(t){n(i(t),null,null,e)});else if("string"==typeof s&&s.indexOf("search")>-1&&!e.nameSearch){var a=new o.SearchCrawler(this.registry,this._fileService,e,{childrenLocation:this.getChildrenLocation()});a.search(function(t){n(i(t),null,null,e)})}else this.registry.getService("orion.page.message").setErrorMessage(s)}},getFileService:function(){return this._fileService},setCrawler:function(e){this._crawler=e},handleError:function(e,t){return console.error(e),n.empty(t),t.appendChild(document.createTextNode(e)),e},setLocationByMetaData:function(t,r){var o="",s=null;this._searchRootLocation=this._fileService.fileServiceRootURL(t.Location),r&&t&&t.Parents&&t.Parents.length>0?s="last"===r.index?t.Parents[t.Parents.length-1]:t.Parents[0]:t&&t.Directory&&t.Location&&t.Parents&&(s=t),s?(this.setLocationbyURL(s.Location),o=s.Name,this._childrenLocation=s.ChildrenLocation):t&&(this.setLocationbyURL(this._searchRootLocation),o=this._fileService.fileServiceName(t.Location),this._childrenLocation=t.ChildrenLocation);var a=n.node("search");if(o||(o=""),a&&a.placeholder){a.value="";var l=i.formatMessage(e["Search ${0}"],o);a.placeholder=l.length>30?l.substring(0,27)+"...":i.formatMessage(e["Search ${0}"],o)}a&&a.title&&(a.title=e["Type a keyword or wild card to search in "]+o)},setLocationbyURL:function(e){this._searchLocation=e},setRootLocationbyURL:function(e){this._searchRootLocation=e},setChildrenLocationbyURL:function(e){this._childrenLocation=e},getSearchLocation:function(){return this._searchLocation?this._searchLocation:this._fileService.fileServiceRootURL()},getSearchRootLocation:function(){return this._searchRootLocation?this._searchRootLocation:this._fileService.fileServiceRootURL()},getChildrenLocation:function(){return this._childrenLocation?this._childrenLocation:this._fileService.fileServiceRootURL()},createSearchParams:function(e,t,n,i){var r=n?this.getSearchRootLocation():this.getSearchLocation();return t?{resource:r,sort:"NameLower asc",rows:100,start:0,nameSearch:!0,keyword:e}:{resource:r,sort:i&&i.sort?i.sort:"Path asc",rows:i&&i.rows?i.rows:40,start:0,caseSensitive:i?i.caseSensitive:void 0,regEx:i?i.regEx:void 0,fileType:i?i.fileType:void 0,fileNamePatterns:i&&i.fileNamePatterns?i.fileNamePatterns:void 0,keyword:e,replace:i?i.replace:void 0}}},c.prototype.constructor=c,{Searcher:c}}),define("orion/problems",["orion/EventTarget"],function(e){function t(t){this._serviceRegistry=t,e.attach(this),this._serviceRegistration=t.registerService("orion.core.marker",this)}return t.prototype={_setProblems:function(e){this.problems=e,this.dispatchEvent({type:"problemsChanged",problems:e})}},t.prototype.constructor=t,{ProblemService:t}}),define("orion/blameAnnotations",["orion/EventTarget"],function(e){function t(t){this._serviceRegistry=t,e.attach(this),this._serviceRegistration=t.registerService("orion.core.blame",this)}return t.prototype={_setAnnotations:function(e){this.blameInfo=e,this.dispatchEvent({type:"blameChanged",blameInfo:e})}},t.prototype.constructor=t,{BlameService:t}}),define("edit/setup",["i18n!orion/edit/nls/messages","orion/sidebar","orion/inputManager","orion/globalCommands","orion/editor/textModel","orion/editor/undoStack","orion/folderView","orion/editorView","orion/editorPluginView","orion/markdownView","orion/markdownEditor","orion/commandRegistry","orion/contentTypes","orion/fileClient","orion/fileCommands","orion/selection","orion/status","orion/progress","orion/operationsClient","orion/outliner","orion/dialogs","orion/extensionCommands","orion/projectCommands","orion/searchClient","orion/problems","orion/blameAnnotations","orion/Deferred","orion/EventTarget","orion/URITemplate","orion/i18nUtil","orion/PageUtil","orion/objects","orion/webui/littlelib","orion/projectClient"],function(e,t,n,i,r,o,s,a,l,d,c,h,u,p,f,g,m,v,y,_,C,w,b,x,S,L,E,k,T,A,N,M,I,D){function R(e){this.parentNode=e.parentNode,this.commandRegistry=e.commandRegistry,this.serviceRegistry=e.serviceRegistry,this.fileClient=e.fileClient,this.inputManager=e.inputManager,this.parentNode=e.parentNode,this.fileActionsScope="fileActions",this.editActionsScope="editActions",this.viewActionsScope="viewActions",this.toolsActionsScope="toolsActions",this.additionalActionsScope="extraActions",this.createActionSections()}var P={};return R.prototype={},M.mixin(R.prototype,{createActionSections:function(){var t=this;[this.fileActionsScope,this.editActionsScope,this.viewActionsScope,this.toolsActionsScope,this.additionalActionsScope].reverse().forEach(function(e){if(!t[e]){var n=document.createElement("ul");n.id=e,n.classList.add("commandList"),n.classList.add("layoutLeft"),n.classList.add("pageActions"),e===t.additionalActionsScope&&n.classList.add("extraActions"),t.parentNode.insertBefore(n,t.parentNode.firstChild),t[e]=n}});var n=this.commandRegistry,i=this.fileActionsScope,r=this.editActionsScope,o=this.viewActionsScope,s=this.toolsActionsScope;n.addCommandGroup(i,"orion.menuBarFileGroup",1e3,e.File,null,e.noActions,null,null,"dropdownSelection"),n.addCommandGroup(r,"orion.menuBarEditGroup",100,e.Edit,null,e.noActions,null,null,"dropdownSelection"),n.addCommandGroup(o,"orion.menuBarViewGroup",100,e.View,null,e.noActions,null,null,"dropdownSelection"),n.addCommandGroup(s,"orion.menuBarToolsGroup",100,e.Tools,null,null,null,null,"dropdownSelection"),n.addCommandGroup(i,"orion.newContentGroup",0,e.New,"orion.menuBarFileGroup",null,null,null,"dropdownSelection"),n.addCommandGroup(i,"orion.importGroup",100,e.Import,"orion.menuBarFileGroup",null,null,null,"dropdownSelection"),n.addCommandGroup(i,"orion.exportGroup",1001,e.Export,"orion.menuBarFileGroup",null,null,null,"dropdownSelection")},createCommands:function(){var e=this.serviceRegistry,t=this.commandRegistry,n=this.fileClient;return f.createFileCommands(e,t,n).then(function(){return w.createFileCommands(e,null,"all",!0,t).then(function(){var i=e.getService("orion.project.client");return i.getProjectHandlerTypes().then(function(r){return i.getProjectDeployTypes().then(function(o){return b.createProjectCommands(e,t,n,i,r,o)},function(){return b.createProjectCommands(e,t,n,i,r)})})})})},setActiveExplorer:function(e){this.explorer=e},updateCommands:function(){var e,t,n,i=this.explorer;i&&(e=i.isCommandsVisible(),t=i.selection,n=i.treeRoot);var r=this.inputManager.getFileMetadata(),o=this.commandRegistry,s=this.serviceRegistry;o.registerSelectionService(this.fileActionsScope,e?t:null),o.registerSelectionService(this.editActionsScope,e?t:null),o.registerSelectionService(this.viewActionsScope,e?t:null),f.setExplorer(i),b.setExplorer(i),f.updateNavTools(s,o,i,null,[this.fileActionsScope,this.editActionsScope,this.viewActionsScope],n,!0),o.destroy(this.toolsActionsScope),o.renderCommands(this.toolsActionsScope,this.toolsActionsScope,r,i,"tool"),o.destroy(this.additionalActionsScope),o.renderCommands(this.additionalActionsScope,this.additionalActionsScope,n,i,"button")}}),P.setUpEditor=function(f,w,b,E){function P(e){nt!==e&&(nt&&nt.removeEventListener("DirtyChanged",it),nt=e,nt&&nt.addEventListener("DirtyChanged",it=function(){i.setDirtyIndicator(nt.isDirty())}))}function O(e){lt.updateCommands();var t=I.node("pageActions");t&&(j.destroy(t),e&&j.renderCommands(t.id,t,e,nt,"button"));var n=I.node("pageNavigationActions");n&&(j.destroy(n),e&&j.renderCommands(n.id,n,e,nt,"button"));var i=I.node("settingsActions");i&&(j.destroy(i),e&&j.renderCommands(i.id,i,e,nt,"button"))}function B(e,t,n){"progress"===t?U.setProgressMessage(e):"error"===t?U.setErrorMessage(e):U.setMessage(e,null,n)}function F(e,t){var n=null;if(t&&e){var i=M.mixin({input:e,metadata:t},ct);if(t.Directory)n=new s.FolderView(i);else{var r=e.editor;if(st.setParent(et),r&&"orion.editor"!==r){if("orion.viewer.markdown"===r)n=new d.MarkdownEditorView(i);else if("orion.editor.markdown"===r)i.editorView=st,n=new c.MarkdownEditorView(i);else for(var o=f.getServiceReferences("orion.edit.editor"),a=0;a<o.length;a++)if(o[a].getProperty("id")===r){i.editorService=o[a],n=new l.PluginEditorView(i);break}}else n=st}}return dt!==n&&(j.closeParameterCollector(),dt&&dt.destroy(),ht&&ht.Location!==t.Location&&ft.setText(""),dt=n,dt&&dt.create()),ht=t,dt}var V,j,U,H,W,$,K,G,z,q,Y,X;!function(){V=new g.Selection(f);var e=new y.OperationsClient(f);U=new m.StatusReportingService(f,e,"statusPane","notifications","notificationArea"),z=new C.DialogService(f),j=new h.CommandRegistry({selection:V}),G=new v.ProgressService(f,e,j),H=new S.ProblemService(f),$=new _.OutlineService({serviceRegistry:f,preferences:b}),K=new u.ContentTypeRegistry(f),q=new p.FileClient(f),Y=new D.ProjectClient(f,q),X=new x.Searcher({serviceRegistry:f,commandService:j,fileService:q}),W=new L.BlameService(f)}();var J=I.node("sidebar"),Z=I.node("sidebarToolbar"),Q=I.node("pageToolbar"),et=I.node("editor"),tt=!1;i.generateBanner("orion-editor",f,j,b,X,null,null,tt);var nt,it,rt,ot,st,at,lt,dt,ct,ht,ut=new T("#{,resource,params*}"),pt=function(e,t,n){var i=n?n.Location:q.fileServiceRootURL(t);if(e.href=ut.expand({resource:i}),n){var r=rt.getFileMetadata();r&&r.Location===n.Location&&e.addEventListener("click",function(){ot.reveal(n)})}},ft=new r.TextModel,gt=new o.UndoStack(ft,500),mt={};["getText","setText"].forEach(function(e){mt[e]=ft[e].bind(ft)}),f.registerService("orion.edit.model.context",mt,null),rt=new n.InputManager({serviceRegistry:f,fileClient:q,progressService:G,statusReporter:B,selection:V,contentTypeRegistry:K}),rt.addEventListener("InputChanged",function(t){var n=t.metadata,r=F(t.input,n);P(r?r.editor:null),t.editor=nt,O(n);var o=t.name,s=n;(null===t.input||void 0===t.input)&&(o=at?at.Name:"",s=at),i.setPageCommandExclusions(["orion.editFromMetadata"]),i.setPageTarget({task:"Editor",name:o,target:s,makeAlternate:function(){return n&&n.parent?n.parent:n&&n.Parents&&n.Parents.length>0?G.progress(q.read(n.Parents[0].Location,!0),A.formatMessage(e.ReadingMetadata,n.Parents[0].Location)):void 0},makeBreadcrumbLink:pt,makeBreadcrumFinalLink:!0,serviceRegistry:f,commandService:j,searchService:X,fileService:q}),nt&&i.setDirtyIndicator(nt.isDirty()),j.processURL(window.location.href)}),lt=new R({parentNode:Q,fileClient:q,inputManager:rt,commandRegistry:j,serviceRegistry:f}),lt.createCommands().then(function(){function e(){k.attach(this)}ct={parent:et,model:ft,menuBar:lt,undoStack:gt,serviceRegistry:f,pluginRegistry:w,commandRegistry:j,contentTypeRegistry:K,renderToolbars:O,inputManager:rt,readonly:E,preferences:b,searcher:X,selection:V,fileService:q,statusReporter:B,statusService:U,progressService:G},st=new a.EditorView(ct),ot=new e;var n=new t({commandRegistry:j,contentTypeRegistry:K,editorInputManager:rt,preferences:b,fileClient:q,outlineService:$,parent:J,progressService:G,selection:V,serviceRegistry:f,sidebarNavInputManager:ot,switcherScope:"viewActions",menuBar:lt,toolbar:Z});e.prototype.processHash=function(){var e=N.matchResourceParameters().navigate;"string"==typeof e&&this.setInput&&"nav"===n.getActiveViewModeId()&&this.setInput(e)},n.show(),ot.addEventListener("rootChanged",function(e){at=e.root});var i=function(e){var t=e.newInput||e.parent||"";window.location=ut.expand({resource:t})};ot.addEventListener("filesystemChanged",i),ot.addEventListener("editorInputMoved",i),ot.addEventListener("create",function(e){e.newValue&&(window.location=ut.expand({resource:e.newValue.Location}))}),V.addEventListener("selectionChanged",function(e){rt.setInput(e.selection)}),window.addEventListener("hashchange",function(){rt.setInput(N.hash()),ot.processHash(N.hash())}),rt.setInput(N.hash()),ot.processHash(N.hash())}),window.onbeforeunload=function(){return nt&&nt.isDirty()?rt.getAutoSaveEnabled()?(rt.save(),e.unsavedAutoSaveChanges):e.unsavedChanges:void 0}},P}),define("edit/edit",["orion/browserCompatibility","orion/bootstrap","edit/setup"],function(e,t,n){t.startup().then(function(e){var t=e.serviceRegistry,i=e.pluginRegistry,r=e.preferences;n.setUpEditor(t,i,r,!1)})});