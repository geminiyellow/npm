!function(){function e(){for(var e=navigator.userAgent,t={browser:!1,version:!1},r=1,n=[{name:"Chrome/Chromium",regExp:/(?:chrome|crios|chromium)\/(\d+)/i,minVersion:24},{name:"Firefox",regExp:/firefox\/(\d+)/i,minVersion:17},{name:"Microsoft Internet Explorer",regExp:/msie\s(\d+)/i,minVersion:10},{name:"Microsoft Internet Explorer",regExp:/Trident\/(\d+)/i,minVersion:6},{name:"Safari",regExp:/version\/(\d+).*?safari/i,minVersion:6}],i=0;i<n.length;i++){var o=n[i],s=e.match(o.regExp);if(s){t.browser=!0,t.version=s[r]>=o.minVersion,t.name=o.name;break}}return t}function t(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function r(e){throw alert(e),new Error("unsupported browser")}var n=e();if(n.browser)n.version||r("Sorry, your browser version is not supported.\n\nTo use Orion, please upgrade to the latest version of "+n.name+".\n");else if(t()&&!localStorage.skipBrowserCheck){if(!confirm("Sorry, your browser is not supported. The latest version of Chrome, Firefox or Safari web browser is recommended.\nContinue anyway?"))throw"unsupported browser";localStorage.skipBrowserCheck=1}else t()||r("Sorry, your browser is not supported.\n\nTo use Orion, the latest version of the Chrome, Firefox, or Safari web browser is recommended.\n");return{isSupportedBrowser:e,supportsLocalStorage:t,throwBrowserAlert:r}}(),define("orion/browserCompatibility",function(){}),function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=o.shift();)e();s=!1}function t(e){o.push(e),s||(s=!0,u())}function r(e){return function(t){e(t)}}function n(e,t,n){try{var i=e(t),o=i&&("object"==typeof i||"function"==typeof i)&&i.then;if("function"==typeof o)if(i===n.promise)n.reject(new TypeError);else{var s=i.cancel;"function"==typeof s?n._parentCancel=s.bind(i):delete n._parentCancel,o.call(i,r(n.resolve),r(n.reject),r(n.progress))}else n.resolve(i)}catch(u){n.reject(u)}}function i(){function e(){for(var e;e=a.shift();){var t=e.deferred,r="fulfilled"===c?"resolve":"reject",i=e[r];"function"==typeof i?n(i,u,t):t[r](u)}}function r(r){delete f._parentCancel,c="rejected",u=r,a.length&&t(e)}function o(n){function s(e){return function(t){c&&"assumed"!==c||e(t)}}delete f._parentCancel;try{var l=n&&("object"==typeof n||"function"==typeof n)&&n.then;if("function"==typeof l)if(n===f)r(new TypeError);else{c="assumed";var h=n&&n.cancel;if("function"!=typeof h){var d=new i;n=d.promise;try{l(d.resolve,d.reject,d.progress)}catch(p){d.reject(p)}h=n.cancel,l=n.then}u=n,l.call(n,s(o),s(r)),f._parentCancel=h.bind(n)}else c="fulfilled",u=n,a.length&&t(e)}catch(v){s(r)(v)}}function s(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!c){var t=new Error("Cancel");t.name="Cancel",r(t)}}var u,c,a=[],f=this;this.resolve=function(e){return c||o(e),f},this.reject=function(e){return c||r(e),f},this.progress=function(e){return c||a.forEach(function(t){if(t.progress)try{t.progress(e)}catch(r){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(s,0):s(),f},this.then=function(r,n,o){var s=new i;return s._parentCancel=f.promise.cancel,a.push({resolve:r,reject:n,progress:o,deferred:s}),("fulfilled"===c||"rejected"===c)&&t(e),s.promise},this.promise={then:f.then,cancel:f.cancel}}var o=[],s=!1,u=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var r=document.createElement("div"),n=new MutationObserver(e);return n.observe(r,{attributes:!0}),function(){r.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return i.all=function(e,t){function r(e,t){u||(s[e]=t,0===--o&&c.resolve(s))}function n(e,n){if(!u){if(t)try{return void r(e,t(n))}catch(i){n=i}c.reject(n)}}var o=e.length,s=[],u=!1,c=new i;return c.then(void 0,function(){u=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===o?c.resolve(s):e.forEach(function(e,t){e.then(r.bind(void 0,t),n.bind(void 0,t))}),c.promise},i.when=function(e,t,r,n){var o,s;return e&&"function"==typeof e.then?o=e:(s=new i,s.resolve(e),o=s.promise),o.then(t,r,n)},i}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var t=this._namedListeners[e.type];return t&&t.forEach(function(t){try{"function"==typeof t?t(e):t.handleEvent(e)}catch(r){"undefined"!=typeof console&&console.log(r)}}),!e.defaultPrevented},addEventListener:function(e,t){("function"==typeof t||t.handleEvent)&&(this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(t))},removeEventListener:function(e,t){var r=this._namedListeners[e];if(r)for(var n=0;n<r.length;n++)if(r[n]===t){1===r.length?delete this._namedListeners[e]:r.splice(n,1);break}}},e.prototype.constructor=e,e.attach=function(t){var r=new e;t.dispatchEvent=r.dispatchEvent.bind(r),t.addEventListener=r.addEventListener.bind(r),t.removeEventListener=r.removeEventListener.bind(r)},e}),define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function r(e,t,r){this._properties=r||{},this._properties["service.id"]=e,this._properties.objectClass=t,this._properties["service.names"]=t}function n(e,t,r){this._serviceId=e,this._serviceReference=t,this._internalRegistry=r}function i(t,r){function n(n){return function(){var i;try{if(!r())throw new Error("Service was unregistered");var o=t[n].apply(t,Array.prototype.slice.call(arguments));if(o&&"function"==typeof o.then)return o;i=new e,i.resolve(o)}catch(s){i=new e,i.reject(s)}return i.promise}}var i;for(i in t)"function"==typeof t[i]&&(this[i]=n(i))}function o(e,t){this.type=e,this.serviceReference=t}function s(){this._entries=[],this._namedReferences={},this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?!0:!1},unregisterService:function(t){var r=e._entries[t];if(!r)throw new Error("Service has already been unregistered: "+t);var n=r.reference;e._serviceEventTarget.dispatchEvent(new o("unregistering",n)),e._entries[t]=null;var i=n.getProperty("objectClass");i.forEach(function(t){for(var r=e._namedReferences[t],i=0;i<r.length;i++)if(r[i]===n){1===r.length?delete e._namedReferences[t]:r.splice(i,1);break}})},modifyService:function(t){var r=e._entries[t];if(!r)throw new Error("Service not found while trying to send modified event: "+t);var n=r.reference;e._serviceEventTarget.dispatchEvent(new o("modified",n))}}}return r.prototype={getPropertyKeys:function(){var e,t=[];for(e in this._properties)this._properties.hasOwnProperty(e)&&t.push(e);return t},getProperty:function(e){return this._properties[e]}},r.prototype.constructor=r,n.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw new Error("Service has already been unregistered: "+this._serviceId);return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{},e["service.id"]=this._serviceId,e.objectClass=t.objectClass,e["service.names"]=t["service.names"],this._internalRegistry.modifyService(this._serviceId)}},n.prototype.constructor=n,s.prototype={getService:function(e){var t;if("string"==typeof e){var r=this._namedReferences[e];r&&r.some(function(e){return t=this._entries[e.getProperty("service.id")].service,!!t},this)}else{var n=this._entries[e.getProperty("service.id")];n&&(t=n.service)}return t||null},getServiceReferences:function(e){if(e)return this._namedReferences[e]?this._namedReferences[e]:[];var t=[];return this._entries.forEach(function(e){e&&t.push(e.reference)}),t},registerService:function(e,t,s){if("undefined"==typeof t||null===t)throw new Error("invalid service");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var u=this._entries.length,c=new r(u,e,s),a=this._namedReferences;e.forEach(function(e){a[e]=a[e]||[],a[e].push(c)});var f=new i(t,this._internalRegistry.isRegistered.bind(null,u));this._entries.push({reference:c,service:f});var l=this._internalRegistry;return this._serviceEventTarget.dispatchEvent(new o("registered",c)),new n(u,c,l)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}},s.prototype.constructor=s,{ServiceRegistry:s}}),define("orion/xhr",["orion/Deferred"],function(e){function t(e,t,r,n){var i,o="undefined"!=typeof r.response?r.response:r.responseText,s="string"==typeof o?o:null;try{i=r.status}catch(u){i=0}var c={args:t,response:o,responseText:s,status:i,url:e,xhr:r};return"undefined"!=typeof n&&(c.error=n),c}function r(r,n,i){i=i||{};var o,s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,u=new e,c=i.headers||{},a=i.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof i.data||"POST"!==r&&"PUT"!==r||(o=i.data);var f=!1,l=!1;u.promise.then(void 0,function(e){f=!0,!l&&e instanceof Error&&"Cancel"===e.name&&s.abort()}),s.onabort=function(){if(l=!0,!f){var e=new Error("Cancel");e.name="Cancel",u.reject(e)}},s.onload=function(){var e=t(n,i,s);200<=s.status&&s.status<400?u.resolve(e):(u.reject(e),a&&"undefined"!=typeof console&&console.log(new Error(s.statusText)))},s.onerror=function(){var e=t(n,i,s);u.reject(e),a&&"undefined"!=typeof console&&console.log(new Error(s.statusText))},s.onprogress=function(e){e.xhr=s,u.progress(e)};try{if(s.open(r,n,!0),"string"==typeof i.responseType&&(s.responseType=i.responseType),"number"==typeof i.timeout)if("number"==typeof s.timeout)s.timeout=i.timeout,s.addEventListener("timeout",function(){u.reject(t(n,i,s,"Timeout exceeded"))});else{var h=setTimeout(function(){u.reject(t(n,i,s,"Timeout exceeded"))},i.timeout);u.promise.then(clearTimeout.bind(null,h),clearTimeout.bind(null,h))}Object.keys(c).forEach(function(e){s.setRequestHeader(e,c[e])}),s.send(o||null)}catch(d){u.reject(t(n,i,s,d))}return u.promise}return r}),define("orion/preferences",["require","orion/Deferred","orion/xhr"],function(e,t,r){function n(e,t){this._name=e,this._providers=t,this._flushPending=!1,this._cached=null,this._stores=[],this._pendingDeletes=[],this._dirty=[]}function i(e,t){return{get:function(r,n){if(0===t)return null;var i=localStorage.getItem(e+r);if(null===i)return null;var o=JSON.parse(i);return n||-1===t||o._expires&&o._expires>(new Date).getTime()?(delete o._expires,o):null},set:function(r,n){if(0!==t)if(-1!==t&&(n._expires=(new Date).getTime()+1e3*t),0===Object.keys(n).length)localStorage.removeItem(e+r);else{var i=JSON.stringify(n);localStorage.setItem(e+r,i),delete n._expires}},remove:function(t){localStorage.removeItem(e+t)}}}function o(e){this._currentPromises={},this._cache=new i("/orion/preferences/user",3600),this._service=null,this.available=function(){if(!this._service){var t=e.getServiceReferences("orion.core.preference.provider");t.length>0&&(this._service=e.getService(t[0]))}return!!this._service}}function s(e){this._location=e,this._currentPromise=null,this._cache=new i("/orion/preferences/default",3600)}function u(){this._cache=new i("/orion/preferences/local",-1)}function c(t,r){this._userProvider=new o(t),this._localProvider=new u,r=r||"defaults.pref",-1===r.indexOf("://")&&(r=e.toUrl(r)),this._defaultsProvider=new s(r),this._serviceRegistration=t.registerService("orion.core.preference",this)}return n.prototype={_flush:function(){for(var e=[],r=0;r<this._stores.length;++r){var n=this._stores[r];if(-1!==this._dirty.indexOf(n)&&e.push(this._providers[r].put(this._name,n)),this._pendingDeletes[r]&&this._pendingDeletes[r].length>0){for(var i=0;i<this._pendingDeletes[r].length;i++)e.push(this._providers[r].remove(this._name,this._pendingDeletes[r][i]));delete this._pendingDeletes[r]}}return this._dirty=[],t.all(e)},_scheduleFlush:function(e){e&&-1===this._dirty.indexOf(e)&&this._dirty.push(e),this._flushPending||(this._flushPending=!0,window.setTimeout(function(){this._flushPending&&(this._flushPending=!1,this._flush())}.bind(this),0))},_getCached:function(){if(!this._cached){this._cached={};for(var e=0;e<this._stores.length;++e){var t=this._stores[e];for(var r in t)t.hasOwnProperty(r)&&"undefined"==typeof this._cached[r]&&(this._cached[r]=t[r])}}return this._cached},keys:function(){return Object.keys(this._getCached())},get:function(e){var t=this._getCached();return t[e]},put:function(e,t){if(0!==this._stores.length){var r=this._stores[0];r[e]!==t&&(r[e]=t,this._cached=null,this._scheduleFlush(r))}},remove:function(e){for(var t=0;t<this._stores.length;++t){var r=this._stores[t];if(r.hasOwnProperty(e))return delete r[e],this._pendingDeletes[t]||(this._pendingDeletes[t]=[]),this._pendingDeletes[t].push(e),this._cached=null,this._scheduleFlush(),!0}return!1},clear:function(){for(var e=0;e<this._stores.length;++e)this._stores[e]={},this._scheduleFlush(this._stores[e]);this._cached=null},sync:function(e){if(this._flushPending)return this._flushPending=!1,this._flush();for(var r=this,n=[],i=0;i<this._providers.length;++i)n.push(this._providers[i].get(this._name,e).then(function(e){return function(t){r._stores[e]=t}}(i)));return t.all(n).then(function(){r._cached=null,r._getCached()})},flush:function(){this._flush()}},o.prototype={get:function(e,r){if(this._currentPromises[e])return this._currentPromises[e];var n=new t,i=null;if(r?this._cache.remove(e):i=this._cache.get(e),null!==i)n.resolve(i);else{this._currentPromises[e]=n;var o=this;this._service.get(e).then(function(t){o._cache.set(e,t),delete o._currentPromises[e],n.resolve(t)},function(t){if(404===t.status){var r={};o._cache.set(e,r),delete o._currentPromises[e],n.resolve(r)}else delete o._currentPromises[e],n.resolve(o._cache.get(e,!0)||{})})}return n},put:function(e,t){return this._cache.set(e,t),this._service.put(e,t)},remove:function(e,t){var r=this._cache.get(e);return delete r[t],this._cache.set(e,r),this._service.remove(e,t)}},s.prototype={get:function(e,n){if(this._currentPromise)return this._currentPromise;var i=new t,o=null;if(n?this._cache.remove(e):o=this._cache.get(e),null!==o)i.resolve(o);else{this._currentPromise=i;var s=this;r("GET",this._location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(t){var r=JSON.parse(t.response);s._cache.set(e,r[e]||{}),s._currentPromise=null,i.resolve(r[e]||{})},function(t){if(401===t.xhr.status||404===t.xhr.status)s._cache.set(e,{}),s._currentPromise=null,i.resolve({});else{s._currentPromise=null;var r=s._cache.get(e,!0);i.resolve(null!==r?r[e]||{}:{})}})}return i},put:function(){var e=new t;return e.resolve(),e},remove:function(e,t){var r=this._cache.get(e);delete r[t],this.put(e,r)}},u.prototype={get:function(e){var r=new t,n=this._cache.get(e);return r.resolve(null!==n?n:{}),r},put:function(e,r){var n=new t;return this._cache.set(e,r),n.resolve(),n},remove:function(e,t){var r=this._cache.get(e);delete r[t],this.put(e,r)}},c.DEFAULT_SCOPE=1,c.LOCAL_SCOPE=2,c.USER_SCOPE=4,c.prototype={listenForChangedSettings:function(e,t,r){return(!t||"number"!=typeof t||t>7||1>t)&&(r=t,t=c.DEFAULT_SCOPE|c.LOCAL_SCOPE|c.USER_SCOPE),window.addEventListener("storage",r,!1),0!==(c.USER_SCOPE&t)?"/orion/preferences/user"+e:0!==(c.LOCAL_SCOPE&t)?"/orion/preferences/local"+e:"/orion/preferences/default"+e},getPreferences:function(e,t){(!t||"number"!=typeof t||t>7||1>t)&&(t=c.DEFAULT_SCOPE|c.LOCAL_SCOPE|c.USER_SCOPE);var r=[];c.USER_SCOPE&t&&this._userProvider.available()&&r.push(this._userProvider),c.LOCAL_SCOPE&t&&r.push(this._localProvider),c.DEFAULT_SCOPE&t&&r.push(this._defaultsProvider);var i=new n(e,r),o=i.sync().then(function(){return i});return o},getSetting:function(e,t,r){for(var n,i=0;i<e.length;i++)if(e[i].label===t)for(var o=0;o<e[i].data.length;o++)if(e[i].data[o].label===r){n=e[i].data[o].value;break}return n}},{PreferencesService:c}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function r(e){return 0===e.length?"":e.join("&")}function n(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),r=t[1]?decodeURIComponent(t[1]):"",n=t[2]?decodeURIComponent(t[2]):"";return[r,n]}function i(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function o(e,r){var i="",o=[],s=0;return{next:function(){if(i!==e.query&&(i=e.query,o=t(i)),s<o.length){var u=n(o[s++]);switch(r){case"keys":return u[0];case"values":return u[1];case"keys+values":return[u[0],u[1]];default:throw new TypeError}}throw L}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function u(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var r=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=r+e.path}}else e.path=t.path}function c(e){return e.toLowerCase()}function a(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function f(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/")}function l(e){e.scheme&&(e.scheme=c(e.scheme)),e.port&&(e.port=a(e.port)),e.host&&e.path&&(e.path=f(e.path))}function h(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function d(e,t){if("string"!=typeof e)throw new TypeError;e=h(e);var r=_.exec(e);if(!r)return null;var n={};if(n.scheme=r[1]||"",n.scheme&&!E.test(n.scheme))return null;var i=r[2];if(i){var o=y.exec(i);if(n.userinfo=o[1],n.host=o[2],n.port=o[3],n.port&&!b.test(n.port))return null}return n.path=r[3],n.query=r[4],n.fragment=r[5],u(n,t),l(n),n}function p(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function v(e,t){var r;if(t){if(t=t.href||t,r=d(t),!r||!r.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:r})}var n=d(e,r);if(!n)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:n,writable:!0});var i=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?i:null},enumerable:!0})}try{var g;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(g=new window.URL("http://www.w3.org?q")).protocol&&g.query)return}catch(m){}var _=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,y=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,w=/^\S*$/,E=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,b=/^\d*$/,S=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,P=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,O=/^([^?#\s]*)$/,C=/^([^\s]*)$/,R=w,j=/([^:]*):?(.*)/,L="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),x={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(r){e(r);var i,o=t(this._url.query);return o.some(function(e){var t=n(e);return t[0]===r?(i=t[1],!0):void 0}),i},enumerable:!0},set:{value:function(o,s){e(o),e(s);var u=t(this._url.query),c=u.some(function(e,t){var r=n(e);return r[0]===o?(r[1]=s,u[t]=i(r),!0):void 0});c||u.push(i([o,s])),this._url.query=r(u)},enumerable:!0},has:{value:function(r){e(r);var i=t(this._url.query);return i.some(function(e){var t=n(e);return t[0]===r?!0:void 0})},enumerable:!0},"delete":{value:function(i){e(i);var o=t(this._url.query),s=o.filter(function(e){var t=n(e);return t[0]!==i});return s.length!==o.length?(this._url.query=r(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var r=o(this._url,"keys+values");try{for(;;){var n=r.next();e.call(t,n[1],n[0],this)}}catch(i){if(i!==L)throw i}},enumerable:!0},keys:{value:function(){return o(this._url,"keys")},enumerable:!0},values:{value:function(){return o(this._url,"values")},enumerable:!0},items:{value:function(){return o(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(r){e(r);var i=[],o=t(this._url.query);return o.forEach(function(e){var t=n(e);t[0]===r&&i.push(t[1])}),i},enumerable:!0},append:{value:function(n,o){e(n),e(o);var s=t(this._url.query);s.push(i([n,o])),this._url.query=r(s)},enumerable:!0}}),Object.defineProperties(v.prototype,{href:{get:function(){return this._url?p(this._url):this._input},set:function(t){e(t),this._input=t,this._url=d(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var r=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===r||E.test(r))&&(this._url.scheme=c(r))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=j.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var r=j.exec(this._userinfo),n=[encodeURIComponent(t||"")];r[2]&&n.push(r[2]),this._userinfo=n.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=j.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var r=j.exec(this._userinfo),n=[r[1]||""];t&&n.push(encodeURIComponent(t)),this._userinfo=n.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var r=P.exec(t);r&&(this._url.host=r[1],this._url.port=a(r[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var r=S.exec(t);r&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===x[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var r=b.exec(t);r&&(this._url.port=a(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var r=O.exec(t);r&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?f(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var r=C.exec(t);r&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var r=R.exec(t);r&&(this._url.fragment=t)}},enumerable:!0}});var T=window.URL||window.webkitURL;T&&T.createObjectURL&&(Object.defineProperty(v,"createObjectURL",{value:T.createObjectURL.bind(T),enumerable:!1}),Object.defineProperty(v,"revokeObjectURL",{value:T.revokeObjectURL.bind(T),enumerable:!1})),window.URL=v}(),define("orion/URL-shim",function(){}),define("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/URL-shim"],function(e,t){function r(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;r.sort(),n.sort();for(var i=0,o=r.length;o>i;i++){var s=r[i];if(s!==n[i])return!1;var u=e[s],c=t[s];if(u!==c&&JSON.stringify(u)!==JSON.stringify(c))return!1}return!0}function n(e){if(-1===e.indexOf("://"))try{return new URL(e,location.href).href}catch(t){}return e}function i(e){function t(){return r=r||Object.keys(e)}var r=null,n={key:function(e){return t()[e]},getItem:function(t){return e[t]},setItem:function(t,n){e[t]=n,r=null},removeItem:function(t){delete e[t],r=null},clear:function(){t().forEach(function(t){delete e[t]}.bind(this)),r=null}};return Object.defineProperty(n,"length",{get:function(){return t().length}}),n}function o(e,t){if(t&&t instanceof XMLHttpRequest){var r,n;try{r=t.status,n=t.statusText}catch(i){r=0,n=""}return{status:r||0,statusText:n}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,o)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function u(e,t){this.type=e,this.plugin=t}function c(e,t){this.__objectId=e,this.__methods=t}function a(n,i,o){function a(e){E&&o.postMessage(e,E)}function f(t){if(!E)return(new e).reject(new Error("plugin not connected"));t.id=String(T++);var r=new e;A[t.id]=r,r.then(null,function(e){"active"===L&&e instanceof Error&&"Cancel"===e.name&&a({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var n=Object.prototype.toString;return t.params.forEach(function(e,i){if("[object Object]"===n.call(e)&&!(e instanceof c)){var o,s;for(o in e)"[object Function]"===n.call(e[o])&&(s=s||[],s.push(o));if(s){var u=k++;U[u]=e;var a=function(){delete U[u]};r.then(a,a),t.params[i]=new c(u,s)}}}),o.postMessage(t,E),r.promise}function l(e,t){e||0===e?a({id:e,result:null,error:t}):console.log(t)}function h(e,t,r,n){n.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var r={};e.__methods.forEach(function(t){r[t]=function(){return f({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),n[t]=r}});var i=void 0===typeof e?null:{id:e,result:null,error:null};try{var o=r.apply(t,n);if(!i)return;o&&"function"==typeof o.then?(I[e]=o,o.then(function(t){delete I[e],i.result=t,a(i)},function(t){I[e]&&(delete I[e],i.error=s(t),a(i))},function(){a({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(i.result=o,a(i))}catch(u){i&&(i.error=s(u),a(i))}}function d(e){try{if(e.method){var t=e.method,r=e.params||[];if("serviceId"in e){var n=D[e.serviceId];n||l(e.id,"service not found"),t in n?h(e.id,n,n[t],r):l(e.id,"method not found")}else if("objectId"in e){var i=U[e.objectId];i||l(e.id,"object not found"),t in i?h(e.id,i,i[t],r):l(e.id,"method not found")}else if("requestId"in e){var s=I[e.requestId];s&&"cancel"===t&&s.cancel&&s.cancel.apply(s,r)}else if("responseId"in e){var u=A[e.responseId];u&&"progress"===t&&u.progress&&u.progress.apply(u,r)}else if("plugin"===e.method){var c=e.params[0];S({headers:c.headers,services:c.services}).then(function(){w&&w.resolve(_)})}else{if("timeout"!==e.method)throw new Error("Bad method: "+e.method);w&&w.reject(e.error)}}else{var a=A[String(e.id)];if(delete A[String(e.id)],e.error){var f=o.handleServiceError(_,e.error);a.reject(f)}else a.resolve(e.result)}}catch(d){console.log("Plugin._messageHandler "+d)}}function p(e){var r={};if(e.methods&&(e.methods.forEach(function(t){r[t]=function(){var r={serviceId:e.serviceId,method:t,params:Array.prototype.slice.call(arguments)};return"active"===L?f(r):_.start({"transient":!0}).then(function(){return f(r)})}}),r.addEventListener&&r.removeEventListener)){var n=new t,i=k++;U[i]={handleEvent:n.dispatchEvent.bind(n)};var o=new c(i,["handleEvent"]),s=r.addEventListener;r.addEventListener=function(e,t){n._namedListeners[e]||s(e,o),n.addEventListener(e,t)};var u=r.removeEventListener;r.removeEventListener=function(e,t){n.removeEventListener(e,t),n._namedListeners[e]||u(e,o)}}return r}function v(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=n;var r=e.names||e.type||[];return Array.isArray(r)||(r=[r]),t.objectClass=r,t}function g(e){var t=p(e),r=v(e),n=o.registerService(e.names||e.type,t,r);x[e.serviceId]={registration:n,proxy:t}}function m(){o.persist(n,{created:P,headers:O,services:C,autostart:R,lastModified:j})}var _=this;i=i||{};var y,w,E,b,S,P=i.created||(new Date).getTime(),O=i.headers||{},C=i.services||[],R=i.autostart,j=i.lastModified||0,L="installed",x={},T=0,k=0,I={},A={},U={},D={};this._persist=m,this._resolve=function(){L="resolved",o.dispatchEvent(new u("resolved",_))},this._getAutostart=function(){return R},this._getCreated=function(){return P},this.getLocation=function(){return n},this.getHeaders=function(){return JSON.parse(JSON.stringify(O))},this.getName=function(){var e=this.getHeaders();return e?e.name||"":null},this.getVersion=function(){var e=this.getHeaders();return e?e.version||"0.0.0":null},this.getLastModified=function(){return j},this.getServiceReferences=function(){var e=[];return Object.keys(x).forEach(function(t){e.push(x[t].registration.getReference())}),e},this.setParent=function(t){return b!==t?(b=t,_.stop({"transient":!0}).then(function(){return"started"===R?_.start({"transient":!0}):"lazy"===R?_.start({lazy:!0,"transient":!0}):void 0})):(new e).resolve()},this.getState=function(){return L},this.start=function(t){if("uninstalled"===L)return(new e).reject(new Error("Plugin is uninstalled"));if(y)return y.promise.then(this.start.bind(this,t));if("active"===L)return(new e).resolve();if(!t||!t.transient){var r=t&&t.lazy?"lazy":"started";r!==R&&(R=r,m())}var i=o.getState();if("starting"!==i&&"active"!==i)return t.transient?(new e).reject(new Error("start transient error")):(new e).resolve();if("installed"===L)try{this._resolve()}catch(s){return(new e).reject(s)}if("resolved"===L&&C.forEach(function(e){g(e)}),t&&t.lazy)return"starting"!==L&&(L="starting",o.dispatchEvent(new u("lazy activation",_))),(new e).resolve();var c=new e;return y=c,L="starting",o.dispatchEvent(new u("starting",_)),w=new e,E=o.connect(n,d,b),w.then(function(){w=null,L="active",o.dispatchEvent(new u("started",_)),y=null,c.resolve()},function(){w=null,L="stopping",o.dispatchEvent(new u("stopping",_)),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),o.disconnect(E),E=null,L="resolved",y=null,o.dispatchEvent(new u("stopped",_)),c.reject(new Error("plugin activation error"))}),c.promise},this.stop=function(t){if("uninstalled"===L)return(new e).reject(new Error("Plugin is uninstalled"));if(y)return y.promise.then(this.stop.bind(this,t));if(t&&t.transient||"stopped"!==R&&(R="stopped",m()),"active"!==L&&"starting"!==L)return(new e).resolve();var r=new e;return y=r,L="stopping",o.dispatchEvent(new u("stopping",_)),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),E&&(o.disconnect(E),E=null),L="resolved",y=null,o.dispatchEvent(new u("stopped",_)),r.resolve(),r.promise},S=function(t){if("uninstalled"===L)return(new e).reject(new Error("Plugin is uninstalled"));if(!t)return 0===j&&(j=(new Date).getTime(),m()),o.loadManifest(n).then(S);var i=O,s=C,c=R;if(O=t.headers||{},C=t.services||{},R=t.autostart||R,t.lastModified?j=t.lastModified:(j=(new Date).getTime(),m()),r(O,i)&&r(C,s)&&R===c)return(new e).resolve();if("active"===L||"starting"===L){var a=[];Object.keys(C).forEach(function(e){var t=C[e];a.push(e);var n=x[e];if(n){if(r(t.methods,Object.keys(n.proxy))){var i=v(t),o=n.registration.getReference(),s={};return o.getPropertyKeys().forEach(function(e){s[e]=o.getProperty(e)}),void(r(i,s)||n.registration.setProperties(i))}n.registration.unregister(),delete x[e]}g(t)}),Object.keys(x).forEach(function(e){-1===a.indexOf(e)&&(x[e].registration.unregister(),delete x[e])})}return"active"===L&&(o.disconnect(E),w=new e,E=o.connect(n,d,b),w.then(function(){w=null},function(){w=null,L="stopping",o.dispatchEvent(new u("stopping"),_),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),o.disconnect(E),E=null,L="resolved",o.dispatchEvent(new u("stopped",_))})),(new e).resolve()},this.update=function(e){return S(e).then(function(){o.dispatchEvent(new u("updated",_))})},this.uninstall=function(){return"uninstalled"===L?(new e).reject(new Error("Plugin is uninstalled")):"active"===L||"starting"===L||"stopping"===L?this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this)):(o.removePlugin(this),L="uninstalled",o.dispatchEvent(new u("uninstalled",_)),(new e).resolve())}}function f(r,o){function s(e){var t=e.source;p.some(function(r){if(t===r.target){try{var n;if("undefined"==typeof r.useStructuredClone){var i="string"!=typeof e.data;n=i?e.data:JSON.parse(e.data),r.useStructuredClone=i
}else n=r.useStructuredClone?e.data:JSON.parse(e.data);r.handler(n)}catch(o){}return!0}})}o=o||{};var c=o.storage||localStorage;c.getItem||(c=i(c));var f,h="installed",d=[],p=[],v=new t,g={},m={registerService:r.registerService.bind(r),connect:function(e,t,r,n){function i(e){var r=new Error(e);r.name="timeout",t({method:"timeout",error:r})}var o={handler:t,url:e},s=setTimeout(i.bind(null,"Load timeout for: "+e),n||15e3),u=document.createElement("iframe");return u.name=e+"_"+(new Date).getTime(),u.src=e,u.onload=function(){clearTimeout(s),s=setTimeout(i.bind(null,"Plugin handshake timeout for: "+e),5e3)},u.sandbox="allow-scripts allow-same-origin",u.style.width=u.style.height="100%",u.frameBorder=0,(r||f).appendChild(u),o.target=u.contentWindow,o.close=function(){if(clearTimeout(s),u){var e=u.parentNode;e&&e.removeChild(u),u=null}},p.push(o),o},disconnect:function(e){for(var t=0;t<p.length;t++)if(e===p[t]){p.splice(t,1);try{e.close()}catch(r){}break}},removePlugin:function(e){for(var t=0;t<d.length;t++)if(e===d[t]){d.splice(t,1);break}c.removeItem("plugin."+e.getLocation())},persist:function(e,t){c.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.target.postMessage(t.useStructuredClone?e:JSON.stringify(e),t.url)},dispatchEvent:function(e){try{v.dispatchEvent(e)}catch(t){console&&console.log("PluginRegistry.dispatchEvent "+t)}},loadManifest:function(t){var r=new e,n=m.connect(t,function(e){if(n&&e.method)if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];m.disconnect(n),n=null,r.resolve(t)}else"timeout"===e.method&&(m.disconnect(n),n=null,r.reject(e.error))});return r.promise},getState:function(){return h},handleServiceError:function(e,t){if(t&&401===t.status){var r=e.getHeaders(),n=e.getName()||e.getLocation(),i=document.createElement("span");if(i.appendChild(document.createTextNode("Authentication required for: "+n+".")),r.login){i.appendChild(document.createTextNode(" "));var o=document.createElement("a");o.target="_blank",o.textContent="Login",o.href=r.login,l.test(o.href)?(i.appendChild(o),i.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+r.login)}var s=new XMLSerializer;return{Severity:"Error",HTML:!0,Message:s.serializeToString(i)}}if(t.__isError){var u=t;t=new Error(u.message),Object.keys(u).forEach(function(e){t[e]=u[e]}),delete t.__isError}return t}};this.getLocation=function(){return"System"},this.getHeaders=function(){return{}},this.getName=function(){return"System"},this.getVersion=function(){return"0.0.0"},this.getLastModified=function(){return 0},this.getState=m.getState,this.init=function(){if("starting"!==h&&"active"!==h&&"stopping"!==h){addEventListener("message",s,!1);for(var e=[],t=0,r=c.length;r>t;t++)e.push(c.key(t));e.forEach(function(e){if(0===e.indexOf("plugin.")){var t=e.substring("plugin.".length),r=JSON.parse(c.getItem(e));r.created&&d.push(new a(t,r,m))}}),d.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1}),o.parent?f=o.parent:(f=document.createElement("div"),o.visible||(f.style.display="none",f.style.visibility="hidden"),document.body.appendChild(f)),o.plugins&&Object.keys(o.plugins).forEach(function(e){e=n(e);var t=this.getPlugin(e);if(!t){var r=o.plugins[e];"object"!=typeof r&&(r={}),r.autostart=r.autostart||o.defaultAutostart||"lazy",d.push(new a(e,r,m))}}.bind(this)),h="starting"}},this.start=function(){if("starting"!==h&&this.init(),"starting"!==h)return(new e).reject("Cannot start framework. Framework is already "+h+".");var t=[],r=(new Date).getTime();return d.forEach(function(e){var n=e._getAutostart();return 0===e.getLastModified()?void t.push(e.update().then(function(){return"started"===n?e.start({"transient":!0}):"lazy"===n?e.start({lazy:!0,"transient":!0}):void e._resolve()})):void("started"===n?t.push(e.start({"transient":!0})):"lazy"===n?(t.push(e.start({lazy:!0,"transient":!0})),r>e.getLastModified()+864e5&&e.update()):e._resolve())}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){h="active"})},this.stop=function(){if("starting"!==h&&"active"!==h)return(new e).reject("Cannot stop registry. Registry is already "+h+".");h="stopping";var t=[];return d.forEach(function(e){t.push(e.stop({"transient":!0}))}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){if(!o.parent){var e=f.parentNode;e&&e.removeChild(f)}f=null,removeEventListener("message",s),h="resolved"})},this.update=function(){this.stop().then(this.start.bind(this))},this.uninstall=function(){return(new e).reject("Cannot uninstall registry")},this.installPlugin=function(t,r){t=n(t);var i=this.getPlugin(t);if(i)return(new e).resolve(i);if(g[t])return g[t];if(r)return i=new a(t,r,m),d.push(i),i._persist(),m.dispatchEvent(new u("installed",i)),(new e).resolve(i);var o=m.loadManifest(t).then(function(e){return i=new a(t,e,m),d.push(i),i._persist(),delete g[t],m.dispatchEvent(new u("installed",i)),i},function(e){throw delete g[t],e});return g[t]=o,o},this.getPlugins=function(){return d.slice()},this.getPlugin=function(e){var t=null;return e=n(e),d.some(function(r){return e===r.getLocation()?(t=r,!0):void 0}),t},this.addEventListener=v.addEventListener.bind(v),this.removeEventListener=v.removeEventListener.bind(v),this.resolvePlugins=function(){var e=!0;return d.forEach(function(t){e=e&&t._resolve()}),e}}var l=new RegExp("^http[s]?","i");return{Plugin:a,PluginRegistry:f}}),define("orion/objects",[],function(){function e(e){for(var t=Object.prototype.hasOwnProperty,r=1,n=arguments.length;n>r;r++){var i=arguments[r];for(var o in i)t.call(i,o)&&(e[o]=i[o])}return e}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var r=Object.create(Object.getPrototypeOf(t));return e(r,t),r},mixin:e,toArray:function(e){return Array.isArray(e)?e:[e]}}}),define("orion/serviceTracker",[],function(){function e(e,n){function i(e){var t=e.getProperty("service.id"),r=this.addingService(e);r&&(a[t]=e,f[t]=r)}function o(e){var t=e.getProperty("service.id"),r=f[t];delete a[t],delete f[t],this.removedService(e,r)}function s(e){return-1!==e.getProperty("objectClass").indexOf(n)}this.serviceRegistry=e;var u,c,a={},f={},l=t;this.close=function(){if(l!==r)throw"Already closed";l=t,e.removeEventListener("registered",u),e.removeEventListener("unregistering",c),u=null,c=null;var n=this;this.getServiceReferences().forEach(function(e){o.call(n,e)}),"function"==typeof this.onClose&&this.onClose()},this.getServiceReferences=function(){var e=Object.keys(a);return e.length?e.map(function(e){return a[e]}):null},this.open=function(){if(l!==t)throw"Already open";l=r;var a=this;u=function(e){return s(e.serviceReference)&&(i.call(a,e.serviceReference),"function"==typeof a.onServiceAdded)?a.onServiceAdded(e.serviceReference,a.serviceRegistry.getService(e.serviceReference)):void 0},c=function(e){s(e.serviceReference)&&o.call(a,e.serviceReference)},e.addEventListener("registered",u),e.addEventListener("unregistering",c),e.getServiceReferences(n).forEach(function(t){return i.call(a,t),"function"==typeof a.onServiceAdded?a.onServiceAdded(t,e.getService(t)):void 0}),"function"==typeof this.onOpen&&this.onOpen()}}var t=0,r=1;return e.prototype={addingService:function(e){return this.serviceRegistry.getService(e)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(){}},e}),define("orion/config",["orion/Deferred","orion/objects","orion/preferences","orion/serviceTracker"],function(e,t,r,n){var i,o,s,u,c,a=r.PreferencesService,f=a.DEFAULT_SCOPE,l="pid",h="orion.cm.managedservice",d="/cm/configurations";return i=function(t,r,i){function o(e,t,r){f[e]||(f[e]=[]),d[e]||(d[e]=[]),f[e].push(t),d[e].push(r)}function s(e,t,r){var n=f[e],i=d[e];n.length>1?n.splice(n.indexOf(t),1):delete f[e],i.length>1?i.splice(i.indexOf(r),1):delete d[e]}function u(e){return f[e]||[]}function c(e){return d[e]||[]}function a(e,t,n){t.forEach(function(i,o){try{var s=e[o].getProperty("__plugin__"),u=s&&r.getPlugin(s);(!s||u&&"active"===u.getState())&&t[o].updated(n)}catch(c){"undefined"!=typeof console&&console.log(c)}})}n.call(this,t,h);var f={},d={},p=function(r){var n=[];return r.plugin.getServiceReferences().forEach(function(e){if(-1!==e.getProperty("objectClass").indexOf(h)){var r=e.getProperty(l),o=t.getService(e);if(r&&o){var s=i._find(r),u=s&&s.getProperties();n.push(o.updated(u))}}}),e.all(n)};this.addingService=function(e){var r=e.getProperty(l),n=t.getService(e);return r&&n?(o(r,e,n),n):null},this.onServiceAdded=function(e,t){var r=e.getProperty(l),n=i._find(r);a([e],[t],n&&n.getProperties())},this.onOpen=function(){r.addEventListener("started",p)},this.onClose=function(){r.removeEventListener("started",p)},this.notifyUpdated=function(e){var t=e.getPid();a(u(t),c(t),e.getProperties())},this.notifyDeleted=function(e){var t=e.getPid();a(u(t),c(t),null)},this.removedService=function(e,t){var r=e.getProperty(l);s(r,e,t)}},o=function(){function e(e,t,r){this.store=new s(this,r),this.configAdmin=new u(this,this.store),this.tracker=new i(e,t,this.store)}return e.prototype={getConfigurationAdmin:function(){var e=this;return this.configAdmin._init().then(function(t){return e.tracker.open(),t})},notifyDeleted:function(e){this.tracker.notifyDeleted(e)},notifyUpdated:function(e){this.tracker.notifyUpdated(e)}},e}(),u=function(){function e(e,t){this.factory=e,this.store=t}return e.prototype={_prefName:d,_init:function(){var e=this;return this.store._init().then(function(){return e})},getConfiguration:function(e){return this.store.get(e)},getDefaultConfiguration:function(e){return this.store._find(e,f)},listConfigurations:function(){return this.store.list()}},e}(),s=function(){function t(t,r){this.factory=t,this.prefsService=r,this.configs=this.defaultConfigs=null,this.pref=null;var n=this;this.initPromise=e.all([this.prefsService.getPreferences(d,f),this.prefsService.getPreferences(d)]).then(function(e){var t=e[0];n.pref=e[1],n.defaultConfigs=n._toConfigs(t,!0),n.configs=n._toConfigs(n.pref,!1,t)})}return t.prototype={_toConfigs:function(e,t,r){var n=Object.create(null),i=this;return e.keys().forEach(function(o){if(!n[o]){var s=e.get(o),u=r&&r.get(o);"object"==typeof s&&null!==s&&Object.keys(s).length>0&&(s[l]=o,n[o]=new c(i.factory,i,s,t,u))}}),n},_init:function(){return this.initPromise},_find:function(e,t){return t===a.DEFAULT_SCOPE?this.defaultConfigs[e]||null:this.configs[e]||null},get:function(e){var t=this._find(e),r=this._find(e,f);if(!t){var n=r&&r.getProperties(!0);t=new c(this.factory,this,e,!1,n),this.configs[e]=t}return t},list:function(){var e=this,t=[];return this.pref.keys().forEach(function(r){var n=e._find(r);n&&null!==n.getProperties()&&t.push(n)}),t},remove:function(e){this.pref.remove(e),delete this.configs[e]},save:function(e,t){var r=t.getProperties(!0)||{},n=this._find(e,f);if(n){var i=n.getProperties(!0);Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(r,e)&&r[e]===i[e]&&delete r[e]})}this.pref.put(e,r)}},t}(),c=function(){function e(e,r){r=t.clone(r),delete r[l],e.properties=r}function r(t,r,n,i,o){if(this.factory=t,this.store=r,this.readOnly=i,null!==n&&"object"==typeof n)this.pid=n[l],e(this,n);else{if("string"!=typeof n)throw new Error("Invalid pid/properties "+n);this.pid=n,this.properties=null}if(o){var s=this;Object.keys(o).forEach(function(e){e===l||Object.prototype.hasOwnProperty.call(s.properties,e)||(s.properties[e]=o[e])})}}return r.prototype={_checkReadOnly:function(){if(this.readOnly)throw new Error("Configuration is read only")},_checkRemoved:function(){if(this.removed)throw new Error("Configuration was removed")},getPid:function(){return this._checkRemoved(),this.pid},getProperties:function(e){this._checkRemoved();var r=null;return this.properties&&(r=t.clone(this.properties),e||(r[l]=this.pid)),r},remove:function(){this._checkReadOnly(),this._checkRemoved(),this.factory.notifyDeleted(this),this.store.remove(this.pid),this.removed=!0},update:function(t){this._checkReadOnly(),this._checkRemoved(),e(this,t),this.store.save(this.pid,this),this.factory.notifyUpdated(this)},toString:function(){return"[ConfigImpl pid: "+this.pid+", properties: "+JSON.stringify(this.properties)+"]"}},r}(),{ConfigurationAdminFactory:o}}),define("orion/bootstrap",["require","orion/Deferred","orion/serviceregistry","orion/preferences","orion/pluginregistry","orion/config"],function(e,t,r,n,i,o){function s(){if(u)return u;u=new t;var s=new r.ServiceRegistry,c=new n.PreferencesService(s);return c.getPreferences("/plugins").then(function(r){var n={plugins:{}};r.keys().forEach(function(t){var i=e.toUrl(t);n.plugins[i]=r[t]});var a=new i.PluginRegistry(s,n);return a.start().then(function(){return s.getServiceReferences("orion.core.preference.provider").length>0?c.getPreferences("/plugins",c.USER_SCOPE).then(function(r){var n=[];return r.keys().forEach(function(t){var r=e.toUrl(t);a.getPlugin(r)||n.push(a.installPlugin(r,{autostart:"lazy"}).then(function(e){return e.update().then(function(){return e.start({lazy:!0})})}))}),t.all(n,function(e){console.log(e)})}):void 0}).then(function(){return new o.ConfigurationAdminFactory(s,a,c).getConfigurationAdmin().then(s.registerService.bind(s,"orion.cm.configadmin"))}).then(function(){var e=s.getService("orion.core.auth");if(e){var t=e.getUser().then(function(t){return t?void localStorage.setItem("lastLogin",(new Date).getTime()):e.getAuthForm(window.location.href).then(function(e){setTimeout(function(){window.location=e},0)})}),r=localStorage.getItem("lastLogin");if(!r||r<(new Date).getTime()-9e5)return t}}).then(function(){var e={serviceRegistry:s,preferences:c,pluginRegistry:a};return u.resolve(e),e})})}var u;return{startup:s}}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](a)}function t(){var t=f;c&&t.length&&(f=[],e(t))}function r(){c||(c=!0,s&&clearInterval(s),t())}function n(e){return c?e(a):f.push(e),n}var i,o,s,u="undefined"!=typeof window&&window.document,c=!u,a=u?document:null,f=[];if(u){if(document.addEventListener)document.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",r,!1);else if(window.attachEvent){window.attachEvent("onload",r),o=document.createElement("div");try{i=null===window.frameElement}catch(l){}o.doScroll&&i&&window.external&&(s=setInterval(function(){try{o.doScroll(),r()}catch(e){}},30))}"complete"===document.readyState&&r()}return n.version="2.0.1",n.load=function(e,t,r,i){i.isBuild?r(null):n(r)},n}),define("index",["orion/browserCompatibility","orion/bootstrap","domReady!"],function(e,t){t.startup().then(function(){window.location="edit/edit.html"})});