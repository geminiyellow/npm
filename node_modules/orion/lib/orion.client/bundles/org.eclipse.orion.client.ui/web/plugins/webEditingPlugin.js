!function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=o.shift();)e();s=!1}function t(e){o.push(e),s||(s=!0,a())}function n(e){return function(t){e(t)}}function r(e,t,r){try{var i=e(t),o=i&&("object"==typeof i||"function"==typeof i)&&i.then;if("function"==typeof o)if(i===r.promise)r.reject(new TypeError);else{var s=i.cancel;"function"==typeof s?r._parentCancel=s.bind(i):delete r._parentCancel,o.call(i,n(r.resolve),n(r.reject),n(r.progress))}else r.resolve(i)}catch(a){r.reject(a)}}function i(){function e(){for(var e;e=l.shift();){var t=e.deferred,n="fulfilled"===c?"resolve":"reject",i=e[n];"function"==typeof i?r(i,a,t):t[n](a)}}function n(n){delete d._parentCancel,c="rejected",a=n,l.length&&t(e)}function o(r){function s(e){return function(t){c&&"assumed"!==c||e(t)}}delete d._parentCancel;try{var p=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof p)if(r===d)n(new TypeError);else{c="assumed";var f=r&&r.cancel;if("function"!=typeof f){var u=new i;r=u.promise;try{p(u.resolve,u.reject,u.progress)}catch(m){u.reject(m)}f=r.cancel,p=r.then}a=r,p.call(r,s(o),s(n)),d._parentCancel=f.bind(r)}else c="fulfilled",a=r,l.length&&t(e)}catch(h){s(n)(h)}}function s(){var e=d._parentCancel;if(e)delete d._parentCancel,e();else if(!c){var t=new Error("Cancel");t.name="Cancel",n(t)}}var a,c,l=[],d=this;this.resolve=function(e){return c||o(e),d},this.reject=function(e){return c||n(e),d},this.progress=function(e){return c||l.forEach(function(t){if(t.progress)try{t.progress(e)}catch(n){}}),d.promise},this.cancel=function(){return d._parentCancel?setTimeout(s,0):s(),d},this.then=function(n,r,o){var s=new i;return s._parentCancel=d.promise.cancel,l.push({resolve:n,reject:r,progress:o,deferred:s}),("fulfilled"===c||"rejected"===c)&&t(e),s.promise},this.promise={then:d.then,cancel:d.cancel}}var o=[],s=!1,a=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var n=document.createElement("div"),r=new MutationObserver(e);return r.observe(n,{attributes:!0}),function(){n.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return i.all=function(e,t){function n(e,t){a||(s[e]=t,0===--o&&c.resolve(s))}function r(e,r){if(!a){if(t)try{return void n(e,t(r))}catch(i){r=i}c.reject(r)}}var o=e.length,s=[],a=!1,c=new i;return c.then(void 0,function(){a=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===o?c.resolve(s):e.forEach(function(e,t){e.then(n.bind(void 0,t),r.bind(void 0,t))}),c.promise},i.when=function(e,t,n,r){var o,s;return e&&"function"==typeof e.then?o=e:(s=new i,s.resolve(e),o=s.promise),o.then(t,n,r)},i}),function(e,t){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],t):"object"==typeof exports?module.exports=t(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=t(e.orion.Deferred))}(this,function(e){function t(e,t){this.__objectId=e,this.__methods=t}function n(n){function r(e){u&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),u===self?u.postMessage(e):u.postMessage(e,"*"))}function i(){var e=[];return Object.keys(x).forEach(function(t){var n=x[t];e.push({serviceId:t,names:n.names,methods:n.methods,properties:n.properties})}),{headers:p||{},services:e}}function o(e,t){if(t&&t instanceof XMLHttpRequest){var n,r;try{n=t.status,r=t.statusText}catch(i){n=0,r=""}return{status:n||0,statusText:r}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,o)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function a(n){if(!u)return(new e).reject(new Error("plugin not connected"));n.id=String(m++);var r=new e;y[n.id]=r,r.then(null,function(e){f&&e instanceof Error&&"Cancel"===e.name&&b({requestId:n.id,method:"cancel",params:e.message?[e.message]:[]})});var i=Object.prototype.toString;return n.params.forEach(function(e,o){if("[object Object]"===i.call(e)&&!(e instanceof t)){var s,a;for(s in e)"[object Function]"===i.call(e[s])&&(a=a||[],a.push(s));if(a){var c=h++;w[c]=e;var l=function(){delete w[c]};r.then(l,l),n.params[o]=new t(c,a)}}}),b(n),r.promise}function c(e,t){e||0===e?b({id:e,result:null,error:t}):console.log(t)}function l(e,t,n,r){r.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var n={};e.__methods.forEach(function(t){n[t]=function(){return a({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),r[t]=n}});var i=void 0===typeof e?null:{id:e,result:null,error:null};try{var o=n.apply(t,r);if(!i)return;o&&"function"==typeof o.then?(v[e]=o,o.then(function(t){delete v[e],i.result=t,b(i)},function(t){v[e]&&(delete v[e],i.error=s(t),b(i))},function(){b({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(i.result=o,b(i))}catch(c){i&&(i.error=s(c),b(i))}}function d(e){if(e.source===u||"undefined"==typeof window){var t="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(t.method){var n=t.method,r=t.params||[];if("serviceId"in t){var i=x[t.serviceId];i||c(t.id,"service not found"),i=i.implementation,n in i?l(t.id,i,i[n],r):c(t.id,"method not found")}else if("objectId"in t){var o=w[t.objectId];o||c(t.id,"object not found"),!n in o?l(t.id,o,o[n],r):c(t.id,"method not found")}else if("requestId"in t){var s=v[t.requestId];s&&"cancel"===n&&s.cancel&&s.cancel.apply(s,r)}else{if(!("responseId"in t))throw new Error("Bad method: "+t.method);var a=y[t.responseId];a&&"progress"===n&&a.progress&&a.progress.apply(a,r)}}else{var d=y[String(t.id)];delete y[String(t.id)],t.error?d.reject(t.error):d.resolve(t.result)}}catch(p){console.log("Plugin._messageHandler "+p)}}}var p=n,f=!1,u=null,m=0,h=0,g=0,v={},y={},w={},x={},b=r;this.updateHeaders=function(e){if(f)throw new Error("Cannot update headers. Plugin Provider is connected");p=e},this.registerService=function(e,t,n){if(f)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var r=null,i=[];for(r in t)"function"==typeof t[r]&&i.push(r);x[g++]={names:e,methods:i,implementation:t,properties:n||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,t){if(f)return void(e&&e());if("undefined"==typeof window)u=self;else if(window!==window.parent)u=window.parent;else{if(null===window.opener)return void(t&&t("No valid plugin target"));u=window.opener}addEventListener("message",d,!1);var n={method:"plugin",params:[i()]};r(n),f=!0,e&&e()},this.disconnect=function(){f&&(removeEventListener("message",d),u=null,f=!1)}}return n}),define("orion/editor/templates",[],function(){function e(e,t){return t.substring(e.length)}function t(e,t,n,r){this.prefix=e,this.description=t,this.template=n,this.name=r,this._parse()}function n(e,t){this._keywords=e||[],this._templates=[],this.addTemplates(t||[])}var r="${tab}",i="${delimiter}",o="${cursor}";return t.prototype={getProposal:function(e,t,n){var s,a=t-e.length,c={},l=void 0!==n.delimiter?n.delimiter:"\n";n.indentation&&(l+=n.indentation);for(var d=void 0!==n.tab?n.tab:"	",p=0,f=this.variables,u=this.segments,m=[],h=0;h<u.length;h++){var g=u[h],v=f[g];if(void 0!==v)switch(g){case r:g=d;break;case i:g=l;break;case o:g="",s=p;break;default:var y=c[g];y||(y=c[g]={data:v.data,positions:[]}),g=v.substitution,y.data&&y.data.values&&(g=y.data.values[0]),y.positions.push({offset:a+p,length:g.length})}m.push(g),p+=g.length}var w=[];for(var x in c)c.hasOwnProperty(x)&&w.push(c[x]);return m=m.join(""),void 0===s&&(s=m.length),{proposal:m,name:this.name,description:this.description,groups:w,escapePosition:a+s,style:"noemphasis"}},match:function(e){return 0===this.prefix.indexOf(e)},_parse:function(){var e,t=this.template,n=[],o={},s=0;t=t.replace(/\n/g,i),t=t.replace(/\t/g,r),t.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(r,i,a){var c=r.substring(2,r.length-1),l=r,d=c,p=null,f=d.indexOf(":");-1!==f&&(d=d.substring(0,f),l="${"+d+"}",p=JSON.parse(c.substring(f+1).replace("\\}","}").trim()));var u=o[l];return u||(u=o[l]={}),u.substitution=d,p&&(u.data=p),e=t.substring(s,a),e&&n.push(e),n.push(l),s=a+r.length,d}),e=t.substring(s,t.length),e&&n.push(e),this.segments=n,this.variables=o}},n.prototype={addTemplates:function(e){for(var n=this.getTemplates(),r=0;r<e.length;r++)n.push(new t(e[r].prefix,e[r].description,e[r].template,e[r].name))},initialize:function(){},computeProposals:function(e,t,n){var r=this.getPrefix(e,t,n),i=[];return this.isValid(r,e,t,n)&&(i=i.concat(this.getTemplateProposals(r,t,n)),i=i.concat(this.getKeywordProposals(r))),i},getKeywords:function(){return this._keywords},getKeywordProposals:function(t){var n=[],r=this.getKeywords();if(r){for(var i=0;i<r.length;i++)0===r[i].indexOf(t)&&n.push({proposal:e(t,r[i]),description:r[i],style:"noemphasis_keyword"});0<n.length&&n.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return n},getPrefix:function(e,t,n){return n.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(e,t,n){for(var r=[],i=this.getTemplates(),o=0;o<i.length;o++){var s=i[o];if(s.match(e)){var a=s.getProposal(e,t,n);this.removePrefix(e,a),r.push(a)}}return 0<r.length&&(r.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),r.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0})),r},removePrefix:function(t,n){var r=n.overwrite=n.proposal.substring(0,t.length)!==t;r||(n.proposal=e(t,n.proposal))},isValid:function(){return!0}},{Template:t,TemplateContentAssist:n}}),define("plugins/webEditingPlugin",["orion/plugin","orion/editor/templates"],function(e){var t={name:"Orion Web Editing Plugin",version:"1.0",description:"This plugin provides editor link support for the navigator."},n=new e(t);n.registerService("orion.core.contenttype",{},{contentTypes:[{id:"text/plain",name:"Text",extension:["txt"],imageClass:"file-sprite-text modelDecorationSprite"},{id:"application/xml","extends":"text/plain",name:"XML",extension:["xml"],imageClass:"file-sprite-xml"},{id:"text/x-markdown","extends":"text/plain",name:"Markdown",extension:["md"]},{id:"text/conf","extends":"text/plain",name:"Conf",extension:["conf"]},{id:"text/sh","extends":"text/plain",name:"sh",extension:["sh"]},{id:"image/gif",name:"GIF",extension:["gif"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/jpeg",name:"JPG",extension:["jpg","jpeg","jpe"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/ico",name:"ICO",extension:["ico"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/png",name:"PNG",extension:["png"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/tiff",name:"TIFF",extension:["tif","tiff"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/svg",name:"SVG",extension:["svg"],imageClass:"file-sprite-image modelDecorationSprite"}]}),n.registerService("orion.edit.editor",{},{id:"orion.editor","default":!0,nameKey:"Orion Editor",nls:"orion/nls/messages",uriTemplate:"../edit/edit.html#{,Location,params*}",orionTemplate:"../edit/edit.html#{,Location,params*}",validationProperties:[{source:"!Projects"}]}),n.registerService("orion.navigate.openWith",{},{editor:"orion.editor",excludedContentTypes:["image/*"]});var r="orion.viewer.markdown";n.registerService("orion.edit.editor",{},{id:r,nameKey:"Orion Markdown Viewer",nls:"orion/nls/messages",uriTemplate:"../edit/edit.html#{,Location,params*},editor="+r}),n.registerService("orion.navigate.openWith",{},{editor:r,contentType:["text/x-markdown"]});var i="orion.editor.markdown";n.registerService("orion.edit.editor",{},{id:i,nameKey:"Orion Markdown Editor",nls:"orion/nls/messages","default":!0,uriTemplate:"../edit/edit.html#{,Location,params*},editor="+i}),n.registerService("orion.navigate.openWith",{},{editor:i,contentType:["text/x-markdown"]}),n.registerService("orion.edit.editor",{},{id:"orion.viewer.raw",nameKey:"Browser",nls:"orion/nls/messages",uriTemplate:"{+Location}",validationProperties:[{source:"!Projects"}]}),n.connect()});