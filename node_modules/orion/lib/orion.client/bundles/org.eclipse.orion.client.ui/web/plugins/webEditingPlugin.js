!function(e,n){"function"==typeof define&&define.amd?define("orion/Deferred",n):"object"==typeof exports?module.exports=n():(e.orion=e.orion||{},e.orion.Deferred=n())}(this,function(){function e(){for(var e;e=o.shift();)e();a=!1}function n(e){o.push(e),a||(a=!0,s())}function t(e){return function(n){e(n)}}function r(e,n,r){try{var i=e(n),o=i&&("object"==typeof i||"function"==typeof i)&&i.then;if("function"==typeof o)if(i===r.promise)r.reject(new TypeError);else{var a=i.cancel;"function"==typeof a?r._parentCancel=a.bind(i):delete r._parentCancel,o.call(i,t(r.resolve),t(r.reject),t(r.progress))}else r.resolve(i)}catch(s){r.reject(s)}}function i(){function e(){for(var e;e=d.shift();){var n=e.deferred,t="fulfilled"===c?"resolve":"reject",i=e[t];"function"==typeof i?r(i,s,n):n[t](s)}}function t(t){delete f._parentCancel,c="rejected",s=t,d.length&&n(e)}function o(r){function a(e){return function(n){c&&"assumed"!==c||e(n)}}delete f._parentCancel;try{var l=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof l)if(r===f)t(new TypeError);else{c="assumed";var p=r&&r.cancel;if("function"!=typeof p){var u=new i;r=u.promise;try{l(u.resolve,u.reject,u.progress)}catch(m){u.reject(m)}p=r.cancel,l=r.then}s=r,l.call(r,a(o),a(t)),f._parentCancel=p.bind(r)}else c="fulfilled",s=r,d.length&&n(e)}catch(g){a(t)(g)}}function a(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!c){var n=new Error("Cancel");n.name="Cancel",t(n)}}var s,c,d=[],f=this;this.resolve=function(e){return c||o(e),f},this.reject=function(e){return c||t(e),f},this.progress=function(e){return c||d.forEach(function(n){if(n.progress)try{n.progress(e)}catch(t){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(a,0):a(),f},this.then=function(t,r,o){var a=new i;return a._parentCancel=f.promise.cancel,d.push({resolve:t,reject:r,progress:o,deferred:a}),("fulfilled"===c||"rejected"===c)&&n(e),a.promise},this.promise={then:f.then,cancel:f.cancel}}var o=[],a=!1,s=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var n=process.nextTick;return function(){n(e)}}if("function"==typeof MutationObserver){var t=document.createElement("div"),r=new MutationObserver(e);return r.observe(t,{attributes:!0}),function(){t.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return i.all=function(e,n){function t(e,n){s||(a[e]=n,0===--o&&c.resolve(a))}function r(e,r){if(!s){if(n)try{return void t(e,n(r))}catch(i){r=i}c.reject(r)}}var o=e.length,a=[],s=!1,c=new i;return c.then(void 0,function(){s=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===o?c.resolve(a):e.forEach(function(e,n){e.then(t.bind(void 0,n),r.bind(void 0,n))}),c.promise},i.when=function(e,n,t,r){var o,a;return e&&"function"==typeof e.then?o=e:(a=new i,a.resolve(e),o=a.promise),o.then(n,t,r)},i}),function(e,n){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],n):"object"==typeof exports?module.exports=n(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=n(e.orion.Deferred))}(this,function(e){function n(e,n){this.__objectId=e,this.__methods=n}function t(t){function r(e){u&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),u===self?u.postMessage(e):u.postMessage(e,"*"))}function i(){var e=[];return Object.keys(x).forEach(function(n){var t=x[n];e.push({serviceId:n,names:t.names,methods:t.methods,properties:t.properties})}),{headers:l||{},services:e}}function o(e,n){if(n&&n instanceof XMLHttpRequest){var t,r;try{t=n.status,r=n.statusText}catch(i){t=0,r=""}return{status:t||0,statusText:r}}return n}function a(e){var n=e?JSON.parse(JSON.stringify(e,o)):e;return e instanceof Error&&(n.__isError=!0,n.message=n.message||e.message,n.name=n.name||e.name),n}function s(t){if(!u)return(new e).reject(new Error("plugin not connected"));t.id=String(m++);var r=new e;y[t.id]=r,r.then(null,function(e){p&&e instanceof Error&&"Cancel"===e.name&&j({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var i=Object.prototype.toString;return t.params.forEach(function(e,o){if("[object Object]"===i.call(e)&&!(e instanceof n)){var a,s;for(a in e)"[object Function]"===i.call(e[a])&&(s=s||[],s.push(a));if(s){var c=g++;w[c]=e;var d=function(){delete w[c]};r.then(d,d),t.params[o]=new n(c,s)}}}),j(t),r.promise}function c(e,n){e||0===e?j({id:e,result:null,error:n}):console.log(n)}function d(e,n,t,r){r.forEach(function(e,n){if(e&&"undefined"!=typeof e.__objectId){var t={};e.__methods.forEach(function(n){t[n]=function(){return s({objectId:e.__objectId,method:n,params:Array.prototype.slice.call(arguments)})}}),r[n]=t}});var i=void 0===typeof e?null:{id:e,result:null,error:null};try{var o=t.apply(n,r);if(!i)return;o&&"function"==typeof o.then?(h[e]=o,o.then(function(n){delete h[e],i.result=n,j(i)},function(n){h[e]&&(delete h[e],i.error=a(n),j(i))},function(){j({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(i.result=o,j(i))}catch(c){i&&(i.error=a(c),j(i))}}function f(e){if(e.source===u||"undefined"==typeof window){var n="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(n.method){var t=n.method,r=n.params||[];if("serviceId"in n){var i=x[n.serviceId];i||c(n.id,"service not found"),i=i.implementation,t in i?d(n.id,i,i[t],r):c(n.id,"method not found")}else if("objectId"in n){var o=w[n.objectId];o||c(n.id,"object not found"),!t in o?d(n.id,o,o[t],r):c(n.id,"method not found")}else if("requestId"in n){var a=h[n.requestId];a&&"cancel"===t&&a.cancel&&a.cancel.apply(a,r)}else{if(!("responseId"in n))throw new Error("Bad method: "+n.method);var s=y[n.responseId];s&&"progress"===t&&s.progress&&s.progress.apply(s,r)}}else{var f=y[String(n.id)];delete y[String(n.id)],n.error?f.reject(n.error):f.resolve(n.result)}}catch(l){console.log("Plugin._messageHandler "+l)}}}var l=t,p=!1,u=null,m=0,g=0,v=0,h={},y={},w={},x={},j=r;this.updateHeaders=function(e){if(p)throw new Error("Cannot update headers. Plugin Provider is connected");l=e},this.registerService=function(e,n,t){if(p)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var r=null,i=[];for(r in n)"function"==typeof n[r]&&i.push(r);x[v++]={names:e,methods:i,implementation:n,properties:t||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,n){if(p)return void(e&&e());if("undefined"==typeof window)u=self;else if(window!==window.parent)u=window.parent;else{if(null===window.opener)return void(n&&n("No valid plugin target"));u=window.opener}addEventListener("message",f,!1);var t={method:"plugin",params:[i()]};r(t),p=!0,e&&e()},this.disconnect=function(){p&&(removeEventListener("message",f),u=null,p=!1)}}return t}),define("plugins/webEditingPlugin",["orion/plugin"],function(e){var n={name:"Orion Web Editing Plugin",version:"1.0",description:"This plugin provides editor link support for the navigator."},t=new e(n);t.registerService("orion.core.contenttype",{},{contentTypes:[{id:"text/plain",name:"Text",extension:["txt"],imageClass:"file-sprite-text modelDecorationSprite"},{id:"application/xml","extends":"text/plain",name:"XML",extension:["xml"],imageClass:"file-sprite-xml modelDecorationSprite"},{id:"text/x-markdown","extends":"text/plain",name:"Markdown",extension:["md"]},{id:"text/conf","extends":"text/plain",name:"Conf",extension:["conf"]},{id:"text/sh","extends":"text/plain",name:"sh",extension:["sh"]},{id:"application/pdf","extends":"application/browser-renderable",name:"PDF",extension:["pdf"]},{id:"application/octet-stream",name:"octet-stream",extension:["exe","bin","doc","ppt"]},{id:"application/zip","extends":"application/octet-stream",name:"ZIP",extension:["war","jar","zip","rar"]},{id:"image/gif",name:"GIF",extension:["gif"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/jpeg",name:"JPG",extension:["jpg","jpeg","jpe"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/ico",name:"ICO",extension:["ico"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/png",name:"PNG",extension:["png"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/tiff",name:"TIFF",extension:["tif","tiff"],imageClass:"file-sprite-image modelDecorationSprite"},{id:"image/svg",name:"SVG",extension:["svg"],imageClass:"file-sprite-image modelDecorationSprite"}]}),t.registerService("orion.edit.editor",{},{id:"orion.editor","default":!0,nameKey:"Orion Editor",nls:"orion/nls/messages",uriTemplate:"../edit/edit.html#{,Location,params*}",orionTemplate:"../edit/edit.html#{,Location,params*}",validationProperties:[{source:"!Projects"}]}),t.registerService("orion.navigate.openWith",{},{editor:"orion.editor",excludedContentTypes:["image/*"]});var r="orion.viewer.markdown";t.registerService("orion.edit.editor",{},{id:r,nameKey:"Orion Markdown Viewer",nls:"orion/nls/messages",uriTemplate:"../edit/edit.html#{,Location,params*},editor="+r}),t.registerService("orion.navigate.openWith",{},{editor:r,contentType:["text/x-markdown"]});var i="orion.editor.markdown";t.registerService("orion.edit.editor",{},{id:i,nameKey:"Orion Markdown Editor",nls:"orion/nls/messages","default":!0,uriTemplate:"../edit/edit.html#{,Location,params*},editor="+i}),t.registerService("orion.navigate.openWith",{},{editor:i,contentType:["text/x-markdown"]}),t.registerService("orion.edit.editor",{},{id:"orion.viewer.raw",nameKey:"Browser",nls:"orion/nls/messages",uriTemplate:"{+Location}",validationProperties:[{source:"!Projects"}]}),t.connect()});