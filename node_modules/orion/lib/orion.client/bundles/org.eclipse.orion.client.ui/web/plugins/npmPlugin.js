!function(e,n){"function"==typeof define&&define.amd?define("orion/Deferred",n):"object"==typeof exports?module.exports=n():(e.orion=e.orion||{},e.orion.Deferred=n())}(this,function(){function e(){for(var e;e=i.shift();)e();s=!1}function n(e){i.push(e),s||(s=!0,c())}function r(e){return function(n){e(n)}}function t(e,n,t){try{var o=e(n),i=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof i)if(o===t.promise)t.reject(new TypeError);else{var s=o.cancel;"function"==typeof s?t._parentCancel=s.bind(o):delete t._parentCancel,i.call(o,r(t.resolve),r(t.reject),r(t.progress))}else t.resolve(o)}catch(c){t.reject(c)}}function o(){function e(){for(var e;e=u.shift();){var n=e.deferred,r="fulfilled"===a?"resolve":"reject",o=e[r];"function"==typeof o?t(o,c,n):n[r](c)}}function r(r){delete f._parentCancel,a="rejected",c=r,u.length&&n(e)}function i(t){function s(e){return function(n){a&&"assumed"!==a||e(n)}}delete f._parentCancel;try{var d=t&&("object"==typeof t||"function"==typeof t)&&t.then;if("function"==typeof d)if(t===f)r(new TypeError);else{a="assumed";var l=t&&t.cancel;if("function"!=typeof l){var p=new o;t=p.promise;try{d(p.resolve,p.reject,p.progress)}catch(m){p.reject(m)}l=t.cancel,d=t.then}c=t,d.call(t,s(i),s(r)),f._parentCancel=l.bind(t)}else a="fulfilled",c=t,u.length&&n(e)}catch(v){s(r)(v)}}function s(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!a){var n=new Error("Cancel");n.name="Cancel",r(n)}}var c,a,u=[],f=this;this.resolve=function(e){return a||i(e),f},this.reject=function(e){return a||r(e),f},this.progress=function(e){return a||u.forEach(function(n){if(n.progress)try{n.progress(e)}catch(r){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(s,0):s(),f},this.then=function(r,t,i){var s=new o;return s._parentCancel=f.promise.cancel,u.push({resolve:r,reject:t,progress:i,deferred:s}),("fulfilled"===a||"rejected"===a)&&n(e),s.promise},this.promise={then:f.then,cancel:f.cancel}}var i=[],s=!1,c=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var n=process.nextTick;return function(){n(e)}}if("function"==typeof MutationObserver){var r=document.createElement("div"),t=new MutationObserver(e);return t.observe(r,{attributes:!0}),function(){r.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,n){function r(e,n){c||(s[e]=n,0===--i&&a.resolve(s))}function t(e,t){if(!c){if(n)try{return void r(e,n(t))}catch(o){t=o}a.reject(t)}}var i=e.length,s=[],c=!1,a=new o;return a.then(void 0,function(){c=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?a.resolve(s):e.forEach(function(e,n){e.then(r.bind(void 0,n),t.bind(void 0,n))}),a.promise},o.when=function(e,n,r,t){var i,s;return e&&"function"==typeof e.then?i=e:(s=new o,s.resolve(e),i=s.promise),i.then(n,r,t)},o}),define("orion/xhr",["orion/Deferred"],function(e){function n(e,n,r,t){var o,i="undefined"!=typeof r.response?r.response:r.responseText,s="string"==typeof i?i:null;try{o=r.status}catch(c){o=0}var a={args:n,response:i,responseText:s,status:o,url:e,xhr:r};return"undefined"!=typeof t&&(a.error=t),a}function r(r,t,o){o=o||{};var i,s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,c=new e,a=o.headers||{},u=o.log||!1;"undefined"==typeof a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof o.data||"POST"!==r&&"PUT"!==r||(i=o.data);var f=!1,d=!1;c.promise.then(void 0,function(e){f=!0,!d&&e instanceof Error&&"Cancel"===e.name&&s.abort()}),s.onabort=function(){if(d=!0,!f){var e=new Error("Cancel");e.name="Cancel",c.reject(e)}},s.onload=function(){var e=n(t,o,s);200<=s.status&&s.status<400?c.resolve(e):(c.reject(e),u&&"undefined"!=typeof console&&console.log(new Error(s.statusText)))},s.onerror=function(){var e=n(t,o,s);c.reject(e),u&&"undefined"!=typeof console&&console.log(new Error(s.statusText))},s.onprogress=function(e){e.xhr=s,c.progress(e)};try{if(s.open(r,t,!0),"string"==typeof o.responseType&&(s.responseType=o.responseType),"number"==typeof o.timeout)if("number"==typeof s.timeout)s.timeout=o.timeout,s.addEventListener("timeout",function(){c.reject(n(t,o,s,"Timeout exceeded"))});else{var l=setTimeout(function(){c.reject(n(t,o,s,"Timeout exceeded"))},o.timeout);c.promise.then(clearTimeout.bind(null,l),clearTimeout.bind(null,l))}Object.keys(a).forEach(function(e){s.setRequestHeader(e,a[e])}),s.send(i||null)}catch(p){c.reject(n(t,o,s,p))}return c.promise}return r}),function(e,n){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],n):"object"==typeof exports?module.exports=n(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=n(e.orion.Deferred))}(this,function(e){function n(e,n){this.__objectId=e,this.__methods=n}function r(r){function t(e){p&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),p===self?p.postMessage(e):p.postMessage(e,"*"))}function o(){var e=[];return Object.keys(j).forEach(function(n){var r=j[n];e.push({serviceId:n,names:r.names,methods:r.methods,properties:r.properties})}),{headers:d||{},services:e}}function i(e,n){if(n&&n instanceof XMLHttpRequest){var r,t;try{r=n.status,t=n.statusText}catch(o){r=0,t=""}return{status:r||0,statusText:t}}return n}function s(e){var n=e?JSON.parse(JSON.stringify(e,i)):e;return e instanceof Error&&(n.__isError=!0,n.message=n.message||e.message,n.name=n.name||e.name),n}function c(r){if(!p)return(new e).reject(new Error("plugin not connected"));r.id=String(m++);var t=new e;y[r.id]=t,t.then(null,function(e){l&&e instanceof Error&&"Cancel"===e.name&&b({requestId:r.id,method:"cancel",params:e.message?[e.message]:[]})});var o=Object.prototype.toString;return r.params.forEach(function(e,i){if("[object Object]"===o.call(e)&&!(e instanceof n)){var s,c;for(s in e)"[object Function]"===o.call(e[s])&&(c=c||[],c.push(s));if(c){var a=v++;w[a]=e;var u=function(){delete w[a]};t.then(u,u),r.params[i]=new n(a,c)}}}),b(r),t.promise}function a(e,n){e||0===e?b({id:e,result:null,error:n}):console.log(n)}function u(e,n,r,t){t.forEach(function(e,n){if(e&&"undefined"!=typeof e.__objectId){var r={};e.__methods.forEach(function(n){r[n]=function(){return c({objectId:e.__objectId,method:n,params:Array.prototype.slice.call(arguments)})}}),t[n]=r}});var o=void 0===typeof e?null:{id:e,result:null,error:null};try{var i=r.apply(n,t);if(!o)return;i&&"function"==typeof i.then?(g[e]=i,i.then(function(n){delete g[e],o.result=n,b(o)},function(n){g[e]&&(delete g[e],o.error=s(n),b(o))},function(){b({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=i,b(o))}catch(a){o&&(o.error=s(a),b(o))}}function f(e){if(e.source===p||"undefined"==typeof window){var n="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(n.method){var r=n.method,t=n.params||[];if("serviceId"in n){var o=j[n.serviceId];o||a(n.id,"service not found"),o=o.implementation,r in o?u(n.id,o,o[r],t):a(n.id,"method not found")}else if("objectId"in n){var i=w[n.objectId];i||a(n.id,"object not found"),!r in i?u(n.id,i,i[r],t):a(n.id,"method not found")}else if("requestId"in n){var s=g[n.requestId];s&&"cancel"===r&&s.cancel&&s.cancel.apply(s,t)}else{if(!("responseId"in n))throw new Error("Bad method: "+n.method);var c=y[n.responseId];c&&"progress"===r&&c.progress&&c.progress.apply(c,t)}}else{var f=y[String(n.id)];delete y[String(n.id)],n.error?f.reject(n.error):f.resolve(n.result)}}catch(d){console.log("Plugin._messageHandler "+d)}}}var d=r,l=!1,p=null,m=0,v=0,h=0,g={},y={},w={},j={},b=t;this.updateHeaders=function(e){if(l)throw new Error("Cannot update headers. Plugin Provider is connected");d=e},this.registerService=function(e,n,r){if(l)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var t=null,o=[];for(t in n)"function"==typeof n[t]&&o.push(t);j[h++]={names:e,methods:o,implementation:n,properties:r||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,n){if(l)return void(e&&e());if("undefined"==typeof window)p=self;else if(window!==window.parent)p=window.parent;else{if(null===window.opener)return void(n&&n("No valid plugin target"));p=window.opener}addEventListener("message",f,!1);var r={method:"plugin",params:[o()]};t(r),l=!0,e&&e()},this.disconnect=function(){l&&(removeEventListener("message",f),p=null,l=!1)}}return r}),define("plugins/npmPlugin",["orion/xhr","orion/Deferred","orion/plugin"],function(e,n,r){var t={name:"Orion NPM",version:"1.0",description:"Orion NPM"},o=new r(t);o.registerServiceProvider("orion.shell.command",null,{name:"npm",description:"Commands for interacting with node npm"});var i={callback:function(n,r){n.cwd=r.cwd,n.type="shrinkwrap";var t=e("POST","/npm",{headers:{"Orion-Version":"1"},data:JSON.stringify(n),timeout:3e5}).then(function(e){if(e.response){var n=JSON.parse(e.response);return n.cmdOutput}return""},function(e){return e.error});return t}};o.registerServiceProvider("orion.shell.command",i,{name:"npm shrinkwrap",description:"npm shrinkwrap",parameters:null});var s={callback:function(n,r){n.cwd=r.cwd,n.type="install";var t=e("POST","/npm",{headers:{"Orion-Version":"1"},data:JSON.stringify(n),timeout:3e5}).then(function(e){if(e.response){var n=JSON.parse(e.response);return n.cmdOutput}return""},function(e){return e.error});return t}};o.registerServiceProvider("orion.shell.command",s,{name:"npm install",description:"npm install",parameters:[{name:"package",type:"string",description:"package to install",defaultValue:null}]}),o.connect()});