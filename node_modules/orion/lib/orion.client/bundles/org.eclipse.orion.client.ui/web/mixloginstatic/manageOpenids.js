!function(){function e(e,n,t,o,r,i){n[e]&&(t.push(e),(n[e]===!0||1===n[e])&&o.push(r+e+"/"+i))}function n(e,n,t,o,r){var i=o+n+"/"+r;require._fileExists(e.toUrl(i+".js"))&&t.push(i)}function t(e,n,o){var r;for(r in n)!n.hasOwnProperty(r)||e.hasOwnProperty(r)&&!o?"object"==typeof n[r]&&t(e[r],n[r],o):e[r]=n[r]}var o=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(r){var i=r.config?r.config():{};return i=i||{},{version:"2.0.1+",load:function(r,a,c,s){s=s||{},s.locale&&(i.locale=s.locale);var d,u,l,f=o.exec(r),p=f[1],m=f[4],h=f[5],v=m.split("-"),g=[],y={},E="";if(f[5]?(p=f[1],d=p+h):(d=r,h=f[4],m=i.locale,m||(m=i.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),v=m.split("-")),s.isBuild){for(g.push(d),n(a,"root",g,p,h),u=0;u<v.length;u++)l=v[u],E+=(E?"-":"")+l,n(a,E,g,p,h);a(g,function(){c()})}else a([d],function(n){var o,r=[];for(e("root",n,r,g,p,h),u=0;u<v.length;u++)o=v[u],E+=(E?"-":"")+o,e(E,n,r,g,p,h);a(g,function(){var e,o,i;for(e=r.length-1;e>-1&&r[e];e--)i=r[e],o=n[i],(o===!0||1===o)&&(o=a(p+i+"/"+h)),t(y,o);c(y)})})}}})}(),define("orion/i18n",[],function(){return{load:function(e,n,t,o){o=o||{};var r=/(^.*(?:^|\/)nls(?:\/|$))([^\/]*)\/?([^\/]*)/,i=r.exec(e);if(!i)return void t(null);if(!n.defined||n.defined(e))try{return void t(n(e))}catch(a){}if(o.isBuild||o.isTest)return void t({});if(n.specified&&!n.specified("orion/bootstrap"))return void t({});var c=i[1],s=i[3]?i[2]:"",d=i[3]||i[2];n(["orion/bootstrap"],function(a){a.startup().then(function(a){var u=a.serviceRegistry,l=u.getServiceReferences("orion.i18n.message");if(s){var f=l.some(function(n){return e===n.getProperty("name")?(u.getService(n).getMessageBundle().then(function(e){t(e)},function(){t({})}),!0):!1});f||t({})}else{var p,m={};l.forEach(function(e){var t=e.getProperty("name");if((i=r.exec(t))&&c===i[1]&&d===(i[3]||i[2]))if(s=i[3]?i[2]:""){var a=o.locale||("undefined"!=typeof navigator?navigator.language||navigator.userLanguage:null);if(!a||0!==a.toLowerCase().indexOf(s.toLowerCase()))return;m[s]=!0,n.specified&&n.specified(t)||define(t,["orion/i18n!"+t],function(e){return e})}else p=e}),n.specified&&n.specified(e)?t(m):p?u.getService(p).getMessageBundle().then(function(n){Object.keys(m).forEach(function(e){"undefined"==typeof n[e]&&(n[e]=m[e])}),define(e,[],n),t(n)},function(){define(e,[],m),t(m)}):(define(e,[],m),t(m))}})})}}}),define("orion/mixloginstatic/nls/root/messages",{AddExternalAccount:"Add external account:"}),define("orion/mixloginstatic/nls/messages",["orion/i18n!orion/mixloginstatic/nls/messages","orion/mixloginstatic/nls/root/messages"],function(e,n){var t={root:n};return Object.keys(e).forEach(function(n){"undefined"==typeof t[n]&&(t[n]=e[n])}),t}),function(e,n){"function"==typeof define&&define.amd?define("orion/Deferred",n):"object"==typeof exports?module.exports=n():(e.orion=e.orion||{},e.orion.Deferred=n())}(this,function(){function e(){for(var e;e=i.shift();)e();a=!1}function n(e){i.push(e),a||(a=!0,c())}function t(e){return function(n){e(n)}}function o(e,n,o){try{var r=e(n),i=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof i)if(r===o.promise)o.reject(new TypeError);else{var a=r.cancel;"function"==typeof a?o._parentCancel=a.bind(r):delete o._parentCancel,i.call(r,t(o.resolve),t(o.reject),t(o.progress))}else o.resolve(r)}catch(c){o.reject(c)}}function r(){function e(){for(var e;e=d.shift();){var n=e.deferred,t="fulfilled"===s?"resolve":"reject",r=e[t];"function"==typeof r?o(r,c,n):n[t](c)}}function t(t){delete u._parentCancel,s="rejected",c=t,d.length&&n(e)}function i(o){function a(e){return function(n){s&&"assumed"!==s||e(n)}}delete u._parentCancel;try{var l=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof l)if(o===u)t(new TypeError);else{s="assumed";var f=o&&o.cancel;if("function"!=typeof f){var p=new r;o=p.promise;try{l(p.resolve,p.reject,p.progress)}catch(m){p.reject(m)}f=o.cancel,l=o.then}c=o,l.call(o,a(i),a(t)),u._parentCancel=f.bind(o)}else s="fulfilled",c=o,d.length&&n(e)}catch(h){a(t)(h)}}function a(){var e=u._parentCancel;if(e)delete u._parentCancel,e();else if(!s){var n=new Error("Cancel");n.name="Cancel",t(n)}}var c,s,d=[],u=this;this.resolve=function(e){return s||i(e),u},this.reject=function(e){return s||t(e),u},this.progress=function(e){return s||d.forEach(function(n){if(n.progress)try{n.progress(e)}catch(t){}}),u.promise},this.cancel=function(){return u._parentCancel?setTimeout(a,0):a(),u},this.then=function(t,o,i){var a=new r;return a._parentCancel=u.promise.cancel,d.push({resolve:t,reject:o,progress:i,deferred:a}),("fulfilled"===s||"rejected"===s)&&n(e),a.promise},this.promise={then:u.then,cancel:u.cancel}}var i=[],a=!1,c=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var n=process.nextTick;return function(){n(e)}}if("function"==typeof MutationObserver){var t=document.createElement("div"),o=new MutationObserver(e);return o.observe(t,{attributes:!0}),function(){t.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return r.all=function(e,n){function t(e,n){c||(a[e]=n,0===--i&&s.resolve(a))}function o(e,o){if(!c){if(n)try{return void t(e,n(o))}catch(r){o=r}s.reject(o)}}var i=e.length,a=[],c=!1,s=new r;return s.then(void 0,function(){c=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?s.resolve(a):e.forEach(function(e,n){e.then(t.bind(void 0,n),o.bind(void 0,n))}),s.promise},r.when=function(e,n,t,o){var i,a;return e&&"function"==typeof e.then?i=e:(a=new r,a.resolve(e),i=a.promise),i.then(n,t,o)},r}),define("orion/xhr",["orion/Deferred"],function(e){function n(e,n,t,o){var r,i="undefined"!=typeof t.response?t.response:t.responseText,a="string"==typeof i?i:null;try{r=t.status}catch(c){r=0}var s={args:n,response:i,responseText:a,status:r,url:e,xhr:t};return"undefined"!=typeof o&&(s.error=o),s}function t(t,o,r){r=r||{};var i,a=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,c=new e,s=r.headers||{},d=r.log||!1;"undefined"==typeof s["X-Requested-With"]&&(s["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof r.data||"POST"!==t&&"PUT"!==t||(i=r.data);var u=!1,l=!1;c.promise.then(void 0,function(e){u=!0,!l&&e instanceof Error&&"Cancel"===e.name&&a.abort()}),a.onabort=function(){if(l=!0,!u){var e=new Error("Cancel");e.name="Cancel",c.reject(e)}},a.onload=function(){var e=n(o,r,a);200<=a.status&&a.status<400?c.resolve(e):(c.reject(e),d&&"undefined"!=typeof console&&console.log(new Error(a.statusText)))},a.onerror=function(){var e=n(o,r,a);c.reject(e),d&&"undefined"!=typeof console&&console.log(new Error(a.statusText))},a.onprogress=function(e){e.xhr=a,c.progress(e)};try{if(a.open(t,o,!0),"string"==typeof r.responseType&&(a.responseType=r.responseType),"number"==typeof r.timeout)if("number"==typeof a.timeout)a.timeout=r.timeout,a.addEventListener("timeout",function(){c.reject(n(o,r,a,"Timeout exceeded"))});else{var f=setTimeout(function(){c.reject(n(o,r,a,"Timeout exceeded"))},r.timeout);c.promise.then(clearTimeout.bind(null,f),clearTimeout.bind(null,f))}Object.keys(s).forEach(function(e){a.setRequestHeader(e,s[e])}),a.send(i||null)}catch(p){c.reject(n(o,r,a,p))}return c.promise}return t}),define("orion/util",[],function(){function e(e){var n=arguments;return e.replace(/\$\{([^\}]+)\}/g,function(e,t){return n[(t<<0)+1]})}function n(e,n){return e.createElementNS?e.createElementNS(y,n):e.createElement(n)}var t=navigator.userAgent,o=-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident")?document.documentMode:void 0,r=parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0,i=-1!==t.indexOf("Opera")?parseFloat(t.split("Version/")[1]):void 0,a=parseFloat(t.split("Chrome/")[1])||void 0,c=-1!==t.indexOf("Safari")&&!a,s=parseFloat(t.split("WebKit/")[1])||void 0,d=-1!==t.indexOf("Android"),u=-1!==t.indexOf("iPad"),l=-1!==t.indexOf("iPhone"),f=u||l,p=-1!==navigator.platform.indexOf("Mac"),m=-1!==navigator.platform.indexOf("Win"),h=-1!==navigator.platform.indexOf("Linux"),v="undefined"!=typeof document&&"ontouchstart"in document.createElement("input"),g=m?"\r\n":"\n",y="http://www.w3.org/1999/xhtml";return{formatMessage:e,createElement:n,isIE:o,isFirefox:r,isOpera:i,isChrome:a,isSafari:c,isWebkit:s,isAndroid:d,isIPad:u,isIPhone:l,isIOS:f,isMac:p,isWindows:m,isLinux:h,isTouch:v,platformDelimiter:g}}),define("orion/webui/littlelib",["orion/util"],function(e){function n(e,n){return n||(n=document),n.querySelector(e)}function t(e,n){return n||(n=document),n.querySelectorAll(e)}function o(e,n){return Array.prototype.slice.call(t(e,n))}function r(e){var n=e;return"string"==typeof e&&(n=document.getElementById(e)),n}function i(e,n){if(!e||!n)return!1;if(e===n)return!0;var t=e.compareDocumentPosition(n);return Boolean(16&t)}function a(e){var n=e.getBoundingClientRect();return{left:n.left+document.documentElement.scrollLeft,top:n.top+document.documentElement.scrollTop,width:n.width,height:n.height}}function c(e){for(;e.hasChildNodes();){var n=e.firstChild;e.removeChild(n)}}function s(n){var t=n.tabIndex;if(0===t&&e.isIE){var o={a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0};o[n.nodeName.toLowerCase()]||n.attributes.tabIndex||(t=-1)}return t}function d(e){if(s(e)>=0)return e;if(e.hasChildNodes())for(var n=0;n<e.childNodes.length;n++){var t=d(e.childNodes[n]);if(t)return t}return null}function u(e){if(s(e)>=0)return e;if(e.hasChildNodes())for(var n=e.childNodes.length-1;n>=0;n--){var t=u(e.childNodes[n]);if(t)return t}return null}function l(e,n){if(3===e.nodeType){var t=y.exec(e.nodeValue);t&&t.length>1&&n(e,t)}if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++)l(e.childNodes[o],n)}function f(e,n){l(e,function(e,t){var o=n[t[1]]||t[1];e.parentNode.replaceChild(document.createTextNode(o),e)})}function p(e,n){l(e,function(e,t){var o=n[t[1]];if(o){var r=document.createRange(),i=t.index;r.setStart(e,i),r.setEnd(e,i+t[0].length),r.deleteContents(),r.insertNode(o)}})}function m(n,t){function o(e){E.forEach(function(n){var t=!1,o=n.excludeNodes.some(function(n){return document.body.contains(n)?(t=!0,n.contains(e.target)):!1});if(t&&!o)try{n.dismiss(e)}catch(r){"undefined"!=typeof console&&console&&console.error(r&&r.message)}}),E=E.filter(function(e){return e.excludeNodes.some(function(e){return document.body.contains(e)})})}null===E&&(E=[],document.addEventListener("click",o,!0),e.isIOS&&document.addEventListener("touchend",function(e){function n(){e.target.removeEventListener("click",n)}0===e.touches.length&&e.target.addEventListener("click",n)},!1)),E.push({excludeNodes:n,dismiss:t})}function h(e){E=E.filter(function(n){return e!==n.dismiss})}function v(e){window.document.all&&(e.keyCode=0),e.preventDefault&&(e.preventDefault(),e.stopPropagation())}function g(e){for(var n=document.getElementsByTagName("iframe"),t=0;t<n.length;t++)n[t].parentNode.style.pointerEvents=e?"":"none"}var y=/\$\{([^\}]+)\}/,E=null,x={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46};return{$:n,$$:t,$$array:o,node:r,contains:i,bounds:a,empty:c,firstTabbable:d,lastTabbable:u,stop:v,processTextNodes:f,processDOMNodes:p,addAutoDismiss:m,setFramesEnabled:g,removeAutoDismiss:h,KEY:x}}),define("domReady",[],function(){function e(e){var n;for(n=0;n<e.length;n+=1)e[n](d)}function n(){var n=u;s&&n.length&&(u=[],e(n))}function t(){s||(s=!0,a&&clearInterval(a),n())}function o(e){return s?e(d):u.push(e),o}var r,i,a,c="undefined"!=typeof window&&window.document,s=!c,d=c?document:null,u=[];if(c){if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1);else if(window.attachEvent){window.attachEvent("onload",t),i=document.createElement("div");try{r=null===window.frameElement}catch(l){}i.doScroll&&r&&window.external&&(a=setInterval(function(){try{i.doScroll(),t()}catch(e){}},30))}"complete"===document.readyState&&t()}return o.version="2.0.1",o.load=function(e,n,t,r){r.isBuild?t(null):o(t)},o}),define("mixloginstatic/manageOpenids",["i18n!orion/mixloginstatic/nls/messages","orion/xhr","orion/webui/littlelib","domReady!"],function(e,n,t){function o(e){if(confirm("Are you sure you want to remove "+e+" from the list of your external accounts?")){for(var t=d.properties.openid.split("\n"),o="",r=0;r<t.length;r++)t[r]!==e&&(o+=t[r]+"\n");d.properties.openid=o,n("PUT",d.Location,{data:JSON.stringify(d),headers:{"Orion-Version":"1"},timeout:15e3}).then(function(){l(d.Location)},function(e){console.error(e.error)})}}function r(e){s!==e&&(l(e),s=e)}function i(e){""!==e&&null!==e&&window.open("../mixlogin/manageopenids/openid?openid="+encodeURIComponent(e),"openid_popup","width=790,height=580")}function a(e,n,t){var o=document.createElement("img");o.className="loginWindow",o.id=o.alt=o.title=e,o.src=n;var r=document.createElement("a");return r.className="loginWindow",r.onclick=t,r.setAttribute("aria-labelledby","addExternalAccount "+e),r.appendChild(o),r}function c(){var n=document.getElementById("newOpenId"),t=document.createElement("h2");t.style.margin="10px 5px 10px 0",t.style.cssFloat="left",t.id="addExternalAccount",t.innerHTML=e.AddExternalAccount,n.appendChild(t)}var s,d,u,l;u=function(e){d=e;var n=t.node("openidList");n.childNodes.length&&n.removeChild(n.childNodes[0]);var r=document.createElement("table");if(r.classList.add("manageOpenIdsTable"),n.appendChild(r),d.properties&&d.properties.openid){for(var i=d.properties.openid?d.properties.openid.split("\n"):[],a=i.length-1;a>=0;a--)""===i[a]&&i.splice(a,1);if(i.length){var c=document.createElement("thead");c.classList.add("navTableHeading"),r.appendChild(c);var s=document.createElement("tr");c.appendChild(s);var u=document.createElement("td");u.classList.add("navColumn"),u.innerHTML="<h2>External Id</h2>",s.appendChild(u)}for(var a=0;a<i.length;a++){var l=i[a],s=document.createElement("tr");s.classList.add(a%2===0?"lightTreeTableRow":"darkTreeTableRow"),s.classList.add("manageOpenIdRow"),s.style.verticalAlign="baseline",r.appendChild(s);var u=document.createElement("td");u.classList.add("navColumn"),s.appendChild(u);var f=document.createElement("span");f.title=l,u.appendChild(f);var p=document.createTextNode(l.length>70?l.substring(0,65)+"...":l);f.appendChild(p),u=document.createElement("td"),u.classList.add("navColumn"),s.appendChild(u);var m=document.createElement("a");m.classList.add("removeOpenId"),m.id="remlink"+a,m.innerHTML="Remove",m.style.visibility="hidden",m.title="Remove "+l,u.appendChild(m),m.addEventListener("click",function(e){o(e)}.bind(this,l))}}},l=function(e){n("GET",e,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(e){u(JSON.parse(e.response))},function(e){console.error(e.error)})},window.handleOpenIDResponse=function(e){for(var t=d.properties.openid?d.properties.openid.split("\n"):[],o=0;o<t.length;o++)if(t[o]===e)return;d.properties.openid?d.properties.openid+="\n"+e:d.properties.openid=e,n("PUT",d.Location,{data:JSON.stringify(d),headers:{"Orion-Version":"1"},timeout:15e3}).then(function(){l(d.Location)},function(e){console.error(e.error)})},window.addEventListener("hashchange",function(){r(window.location.hash.substring(1))}),r(window.location.hash.substring(1)),c(),n("GET","../mixlogin/manageopenids").then(function(e){var n=JSON.parse(e.response),t=n.map(function(e){return a(e.Name,e.Image,i.bind(null,e.Url))});t.push(a("Mozilla Persona","../mixloginstatic/images/persona.png",alert.bind(null,"To link your account with a Persona, set your Orion email address above to match your Persona email address.")));var o=document.getElementById("newOpenId");t.forEach(function(e){o.appendChild(e),o.appendChild(document.createTextNode(" "))})})});